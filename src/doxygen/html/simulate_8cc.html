<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>gem5: sim/simulate.cc File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>sim/simulate.cc File Reference</h1><code>#include &lt;mutex&gt;</code><br/>
<code>#include &lt;thread&gt;</code><br/>
<code>#include &quot;<a class="el" href="base_2misc_8hh_source.html">base/misc.hh</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="pollevent_8hh_source.html">base/pollevent.hh</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="base_2types_8hh_source.html">base/types.hh</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="async_8hh_source.html">sim/async.hh</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="eventq__impl_8hh_source.html">sim/eventq_impl.hh</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="sim__events_8hh_source.html">sim/sim_events.hh</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="sim__exit_8hh_source.html">sim/sim_exit.hh</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="simulate_8hh_source.html">sim/simulate.hh</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="stat__control_8hh_source.html">sim/stat_control.hh</a>&quot;</code><br/>

<p><a href="simulate_8cc_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classEvent.html">Event</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="simulate_8cc.html#a7d2706b05f0c4da961b8aa67ce8404a7">doSimLoop</a> (<a class="el" href="classEventQueue.html">EventQueue</a> *)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">forward declaration  <a href="#a7d2706b05f0c4da961b8aa67ce8404a7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="simulate_8cc.html#ab3858fd370e2d11aede1a80dba5c9ff2">thread_loop</a> (<a class="el" href="classEventQueue.html">EventQueue</a> *queue)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The main function for all subordinate threads (i.e., all threads other than the main thread).  <a href="#ab3858fd370e2d11aede1a80dba5c9ff2"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classGlobalSimLoopExitEvent.html">GlobalSimLoopExitEvent</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="simulate_8cc.html#a3a884c4af4f0e3a598820c81c1c368b2">simulate</a> (<a class="el" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a> num_cycles)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Simulate for num_cycles additional cycles.  <a href="#a3a884c4af4f0e3a598820c81c1c368b2"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="simulate_8cc.html#aa3a5d08b32f7a8d5d91cf0a21ee4a381">testAndClearAsyncEvent</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Test and clear the global async_event flag, such that each time the flag is cleared, only one thread returns true (and thus is assigned to handle the corresponding async event(s)).  <a href="#aa3a5d08b32f7a8d5d91cf0a21ee4a381"></a><br/></td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::mutex&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="simulate_8cc.html#ad41feb6ead671893788fbca0edfafaf4">asyncEventMutex</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Mutex for handling async events.  <a href="#ad41feb6ead671893788fbca0edfafaf4"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classBarrier.html">Barrier</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="simulate_8cc.html#a573e4b44e5405d58cbe76faa6e5e9d52">threadBarrier</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Global barrier for synchronizing threads entering/exiting the simulation loop.  <a href="#a573e4b44e5405d58cbe76faa6e5e9d52"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classGlobalSimLoopExitEvent.html">GlobalSimLoopExitEvent</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="simulate_8cc.html#ac0a6e478a8f9a3f4d5d44f9743aed332">simulate_limit_event</a> = nullptr</td></tr>
</table>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a7d2706b05f0c4da961b8aa67ce8404a7"></a><!-- doxytag: member="simulate.cc::doSimLoop" ref="a7d2706b05f0c4da961b8aa67ce8404a7" args="(EventQueue *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classEvent.html">Event</a> * doSimLoop </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classEventQueue.html">EventQueue</a> *&nbsp;</td>
          <td class="paramname"> <em>eventq</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>forward declaration </p>
<p>The main per-thread simulation loop.</p>
<p>This loop is executed by all simulation threads (the main thread and the subordinate threads) in parallel. </p>

<p>Definition at line <a class="el" href="simulate_8cc_source.html#l00179">179</a> of file <a class="el" href="simulate_8cc_source.html">simulate.cc</a>.</p>

<p>References <a class="el" href="async_8cc_source.html#l00031">async_event</a>, <a class="el" href="async_8cc_source.html#l00036">async_exception</a>, <a class="el" href="async_8cc_source.html#l00034">async_exit</a>, <a class="el" href="async_8cc_source.html#l00035">async_io</a>, <a class="el" href="async_8cc_source.html#l00032">async_statdump</a>, <a class="el" href="async_8cc_source.html#l00033">async_statreset</a>, <a class="el" href="eventq_8hh_source.html#l00088">curEventQueue()</a>, <a class="el" href="core_8hh_source.html#l00047">curTick()</a>, <a class="el" href="eventq_8hh_source.html#l00599">EventQueue::empty()</a>, <a class="el" href="sim__events_8cc_source.html#l00083">exitSimLoop()</a>, <a class="el" href="eventq_8cc_source.html#l00476">EventQueue::handleAsyncInsertions()</a>, <a class="el" href="arch_2x86_2types_8hh_source.html#l00077">X86ISA::lock</a>, <a class="el" href="eventq_8hh_source.html#l00571">EventQueue::nextTick()</a>, <a class="el" href="pollevent_8cc_source.html#l00052">pollQueue</a>, <a class="el" href="namespaceStats.html#a86077cf00080e4a9b57c43d5af924d07">Stats::schedStatEvent()</a>, <a class="el" href="pollevent_8cc_source.html#l00183">PollQueue::service()</a>, <a class="el" href="eventq_8cc_source.html#l00204">EventQueue::serviceOne()</a>, and <a class="el" href="simulate_8cc_source.html#l00159">testAndClearAsyncEvent()</a>.</p>

<p>Referenced by <a class="el" href="simulate_8cc_source.html#l00082">simulate()</a>, and <a class="el" href="simulate_8cc_source.html#l00066">thread_loop()</a>.</p>

</div>
</div>
<a class="anchor" id="a3a884c4af4f0e3a598820c81c1c368b2"></a><!-- doxytag: member="simulate.cc::simulate" ref="a3a884c4af4f0e3a598820c81c1c368b2" args="(Tick num_cycles)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classGlobalSimLoopExitEvent.html">GlobalSimLoopExitEvent</a>* simulate </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a>&nbsp;</td>
          <td class="paramname"> <em>num_cycles</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Simulate for num_cycles additional cycles. </p>
<p>If num_cycles is -1 (the default), do not limit simulation; some other event must terminate the loop. Exported to Python via SWIG. </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>The SimLoopExitEvent that caused the loop to exit. </dd></dl>

<p><p>Delete the simulation quantum event. </p>
</p>

<p>Definition at line <a class="el" href="simulate_8cc_source.html#l00082">82</a> of file <a class="el" href="simulate_8cc_source.html">simulate.cc</a>.</p>

<p>References <a class="el" href="core_8hh_source.html#l00047">curTick()</a>, <a class="el" href="global__event_8cc_source.html#l00084">BaseGlobalEvent::deschedule()</a>, <a class="el" href="simulate_8cc_source.html#l00179">doSimLoop()</a>, <a class="el" href="base_2misc_8hh_source.html#l00113">fatal</a>, <a class="el" href="eventq_8hh_source.html#l00350">Event::globalEvent()</a>, <a class="el" href="arm_2miscregs_8hh_source.html#l01377">ArmISA::i</a>, <a class="el" href="base_2misc_8hh_source.html#l00209">inform</a>, <a class="el" href="eventq_8cc_source.html#l00061">inParallelMode</a>, <a class="el" href="eventq_8cc_source.html#l00059">mainEventQueue</a>, <a class="el" href="base_2types_8hh_source.html#l00064">MaxTick</a>, <a class="el" href="eventq_8cc_source.html#l00058">numMainEventQueues</a>, <a class="el" href="eventq_8hh_source.html#l00166">EventBase::Progress_Event_Pri</a>, <a class="el" href="global__event_8cc_source.html#l00097">BaseGlobalEvent::reschedule()</a>, <a class="el" href="eventq_8cc_source.html#l00050">simQuantum</a>, <a class="el" href="simulate_8cc_source.html#l00066">thread_loop()</a>, and <a class="el" href="barrier_8hh_source.html#l00065">Barrier::wait()</a>.</p>

<p>Referenced by <a class="el" href="System_8cc_source.html#l00137">RubySystem::serialize()</a>, and <a class="el" href="System_8cc_source.html#l00279">RubySystem::startup()</a>.</p>

</div>
</div>
<a class="anchor" id="aa3a5d08b32f7a8d5d91cf0a21ee4a381"></a><!-- doxytag: member="simulate.cc::testAndClearAsyncEvent" ref="aa3a5d08b32f7a8d5d91cf0a21ee4a381" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static bool testAndClearAsyncEvent </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Test and clear the global async_event flag, such that each time the flag is cleared, only one thread returns true (and thus is assigned to handle the corresponding async event(s)). </p>

<p>Definition at line <a class="el" href="simulate_8cc_source.html#l00159">159</a> of file <a class="el" href="simulate_8cc_source.html">simulate.cc</a>.</p>

<p>References <a class="el" href="async_8cc_source.html#l00031">async_event</a>, and <a class="el" href="simulate_8cc_source.html#l00048">asyncEventMutex</a>.</p>

<p>Referenced by <a class="el" href="simulate_8cc_source.html#l00179">doSimLoop()</a>.</p>

</div>
</div>
<a class="anchor" id="ab3858fd370e2d11aede1a80dba5c9ff2"></a><!-- doxytag: member="simulate.cc::thread_loop" ref="ab3858fd370e2d11aede1a80dba5c9ff2" args="(EventQueue *queue)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void thread_loop </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classEventQueue.html">EventQueue</a> *&nbsp;</td>
          <td class="paramname"> <em>queue</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>The main function for all subordinate threads (i.e., all threads other than the main thread). </p>
<p>These threads start by waiting on threadBarrier. Once all threads have arrived at threadBarrier, they enter the simulation loop concurrently. When they exit the loop, they return to waiting on threadBarrier. This process is repeated until the simulation terminates. </p>

<p>Definition at line <a class="el" href="simulate_8cc_source.html#l00066">66</a> of file <a class="el" href="simulate_8cc_source.html">simulate.cc</a>.</p>

<p>References <a class="el" href="simulate_8cc_source.html#l00179">doSimLoop()</a>, and <a class="el" href="barrier_8hh_source.html#l00065">Barrier::wait()</a>.</p>

<p>Referenced by <a class="el" href="simulate_8cc_source.html#l00082">simulate()</a>.</p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="ad41feb6ead671893788fbca0edfafaf4"></a><!-- doxytag: member="simulate.cc::asyncEventMutex" ref="ad41feb6ead671893788fbca0edfafaf4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::mutex <a class="el" href="simulate_8cc.html#ad41feb6ead671893788fbca0edfafaf4">asyncEventMutex</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Mutex for handling async events. </p>

<p>Definition at line <a class="el" href="simulate_8cc_source.html#l00048">48</a> of file <a class="el" href="simulate_8cc_source.html">simulate.cc</a>.</p>

<p>Referenced by <a class="el" href="simulate_8cc_source.html#l00159">testAndClearAsyncEvent()</a>.</p>

</div>
</div>
<a class="anchor" id="ac0a6e478a8f9a3f4d5d44f9743aed332"></a><!-- doxytag: member="simulate.cc::simulate_limit_event" ref="ac0a6e478a8f9a3f4d5d44f9743aed332" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classGlobalSimLoopExitEvent.html">GlobalSimLoopExitEvent</a>* <a class="el" href="simulate_8hh.html#ac0a6e478a8f9a3f4d5d44f9743aed332">simulate_limit_event</a> = nullptr</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="simulate_8cc_source.html#l00074">74</a> of file <a class="el" href="simulate_8cc_source.html">simulate.cc</a>.</p>

</div>
</div>
<a class="anchor" id="a573e4b44e5405d58cbe76faa6e5e9d52"></a><!-- doxytag: member="simulate.cc::threadBarrier" ref="a573e4b44e5405d58cbe76faa6e5e9d52" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classBarrier.html">Barrier</a>* <a class="el" href="simulate_8cc.html#a573e4b44e5405d58cbe76faa6e5e9d52">threadBarrier</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Global barrier for synchronizing threads entering/exiting the simulation loop. </p>

<p>Definition at line <a class="el" href="simulate_8cc_source.html#l00052">52</a> of file <a class="el" href="simulate_8cc_source.html">simulate.cc</a>.</p>

</div>
</div>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&nbsp;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"><address style="align: right;"><small>
Generated on Mon Dec 7 02:33:14 2015 for gem5 by <a href="http://www.doxygen.org/index.html"> doxygen</a> 1.6.1</small></address>

</body>
</html>
