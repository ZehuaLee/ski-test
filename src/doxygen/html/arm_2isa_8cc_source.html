<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>gem5: arch/arm/isa.cc Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>arch/arm/isa.cc</h1><a href="arm_2isa_8cc.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * Copyright (c) 2010-2015 ARM Limited</span>
<a name="l00003"></a>00003 <span class="comment"> * All rights reserved</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> * The license below extends only to copyright in the software and shall</span>
<a name="l00006"></a>00006 <span class="comment"> * not be construed as granting a license to any other intellectual</span>
<a name="l00007"></a>00007 <span class="comment"> * property including but not limited to intellectual property relating</span>
<a name="l00008"></a>00008 <span class="comment"> * to a hardware implementation of the functionality of the software</span>
<a name="l00009"></a>00009 <span class="comment"> * licensed hereunder.  You may use the software subject to the license</span>
<a name="l00010"></a>00010 <span class="comment"> * terms below provided that you ensure that this notice is replicated</span>
<a name="l00011"></a>00011 <span class="comment"> * unmodified and in its entirety in all distributions of the software,</span>
<a name="l00012"></a>00012 <span class="comment"> * modified or unmodified, in source code or in binary form.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * Redistribution and use in source and binary forms, with or without</span>
<a name="l00015"></a>00015 <span class="comment"> * modification, are permitted provided that the following conditions are</span>
<a name="l00016"></a>00016 <span class="comment"> * met: redistributions of source code must retain the above copyright</span>
<a name="l00017"></a>00017 <span class="comment"> * notice, this list of conditions and the following disclaimer;</span>
<a name="l00018"></a>00018 <span class="comment"> * redistributions in binary form must reproduce the above copyright</span>
<a name="l00019"></a>00019 <span class="comment"> * notice, this list of conditions and the following disclaimer in the</span>
<a name="l00020"></a>00020 <span class="comment"> * documentation and/or other materials provided with the distribution;</span>
<a name="l00021"></a>00021 <span class="comment"> * neither the name of the copyright holders nor the names of its</span>
<a name="l00022"></a>00022 <span class="comment"> * contributors may be used to endorse or promote products derived from</span>
<a name="l00023"></a>00023 <span class="comment"> * this software without specific prior written permission.</span>
<a name="l00024"></a>00024 <span class="comment"> *</span>
<a name="l00025"></a>00025 <span class="comment"> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<a name="l00026"></a>00026 <span class="comment"> * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<a name="l00027"></a>00027 <span class="comment"> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span>
<a name="l00028"></a>00028 <span class="comment"> * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span>
<a name="l00029"></a>00029 <span class="comment"> * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span>
<a name="l00030"></a>00030 <span class="comment"> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span>
<a name="l00031"></a>00031 <span class="comment"> * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span>
<a name="l00032"></a>00032 <span class="comment"> * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span>
<a name="l00033"></a>00033 <span class="comment"> * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
<a name="l00034"></a>00034 <span class="comment"> * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span>
<a name="l00035"></a>00035 <span class="comment"> * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00036"></a>00036 <span class="comment"> *</span>
<a name="l00037"></a>00037 <span class="comment"> * Authors: Gabe Black</span>
<a name="l00038"></a>00038 <span class="comment"> *          Ali Saidi</span>
<a name="l00039"></a>00039 <span class="comment"> */</span>
<a name="l00040"></a>00040 
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="arm_2isa_8hh.html">arch/arm/isa.hh</a>&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="arch_2arm_2pmu_8hh.html">arch/arm/pmu.hh</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="arch_2arm_2system_8hh.html">arch/arm/system.hh</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="checker_2cpu_8hh.html">cpu/checker/cpu.hh</a>&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="cpu_2base_8hh.html">cpu/base.hh</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;debug/Arm.hh&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;debug/MiscRegs.hh&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="generic__timer_8hh.html" title="This module implements the global system counter and the local per-CPU architected...">dev/arm/generic_timer.hh</a>&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;params/ArmISA.hh&quot;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;<a class="code" href="sim_2faults_8hh.html">sim/faults.hh</a>&quot;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;<a class="code" href="stat__control_8hh.html">sim/stat_control.hh</a>&quot;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &quot;<a class="code" href="sim_2system_8hh.html">sim/system.hh</a>&quot;</span>
<a name="l00053"></a>00053 
<a name="l00054"></a>00054 <span class="keyword">namespace </span>ArmISA
<a name="l00055"></a>00055 {
<a name="l00056"></a>00056 
<a name="l00057"></a>00057 
<a name="l00065"></a><a class="code" href="structArmISA_1_1ISA.html">00065</a> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structArmISA_1_1ISA_1_1MiscRegInitializerEntry.html">ISA::MiscRegInitializerEntry</a>
<a name="l00066"></a>00066     <a class="code" href="structArmISA_1_1ISA.html" title="Some registers aliase with others, and therefore need to be translated.">ISA</a>::MiscRegSwitch[<a class="code" href="namespaceArmISA.html#ad3418b128d81f0799645ae004435eef8a0406eeca96d67444d889e3f2fff862a7">miscRegTranslateMax</a>] = {
<a name="l00067"></a>00067     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca64bea1b1a9ee2b02db32ffb4b636f429">MISCREG_CSSELR_EL1</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca3c709b276a04ec5ca9ee382b797dfcc5">MISCREG_CSSELR</a>, 0}},
<a name="l00068"></a>00068     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6a053ea48f0a33993f665a3583be7cce">MISCREG_SCTLR_EL1</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca540af25d1d321d1891bf4d9292c227c1">MISCREG_SCTLR</a>, 0}},
<a name="l00069"></a>00069     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca4750c028a717da1f74e34035b16b9848">MISCREG_SCTLR_EL2</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca5a527cd4f6298497a08d3a0b3ecc9e99">MISCREG_HSCTLR</a>, 0}},
<a name="l00070"></a>00070     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cacf7366ade0a8b66d2c31487f60f7d5db">MISCREG_ACTLR_EL1</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6827da006da460886fdcd488c3a119a0">MISCREG_ACTLR</a>, 0}},
<a name="l00071"></a>00071     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cadf3846c4440e1c5556623e405c322724">MISCREG_ACTLR_EL2</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca5f2a71fb19040159bd7f06d1ac4f2b18">MISCREG_HACTLR</a>, 0}},
<a name="l00072"></a>00072     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6314fd451148954c2a66286c04cefdaf">MISCREG_CPACR_EL1</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca56f5859b27c49381dd9e0d7f3310565d">MISCREG_CPACR</a>, 0}},
<a name="l00073"></a>00073     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca47def05a9be0494d6ad9553885cc09c5">MISCREG_CPTR_EL2</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cae4a87918573b1f768605e2b9d9d8997f">MISCREG_HCPTR</a>, 0}},
<a name="l00074"></a>00074     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caf7b3320067d0141f9d3e408adb3200ea">MISCREG_HCR_EL2</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cacc6c0d54b3de785d3e9bd57250007f71">MISCREG_HCR</a>, 0}},
<a name="l00075"></a>00075     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca2838d0aa9c391efb59ffd8ffd1182060">MISCREG_MDCR_EL2</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca97eecbdef114ffd3a77f279c034d909d">MISCREG_HDCR</a>, 0}},
<a name="l00076"></a>00076     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cae55f13d525fb8764f84e3b3585716b30">MISCREG_HSTR_EL2</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6b82a84c0a0b651d68df7a89ad8d9509">MISCREG_HSTR</a>, 0}},
<a name="l00077"></a>00077     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca22053ae2e96c47efca477ea6c27af7c6">MISCREG_HACR_EL2</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca86bba169e8dae53bfbcf575cb86b8c9b">MISCREG_HACR</a>, 0}},
<a name="l00078"></a>00078     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca8445c66a08413a3565f5796bd9ac2d56">MISCREG_TTBR0_EL1</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6a636c5129391c23216bcea3bde6f0f8">MISCREG_TTBR0</a>, 0}},
<a name="l00079"></a>00079     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca50ff79a603fadbd7cac516d7bbf28ee3">MISCREG_TTBR1_EL1</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cac0d0e5ddda9dea55e2ae3223a5f1c9fc">MISCREG_TTBR1</a>, 0}},
<a name="l00080"></a>00080     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca0eb9b86d344a323006d673c55417e9fd">MISCREG_TTBR0_EL2</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6f17e06a75d4a8dd7543708ac3cff02a">MISCREG_HTTBR</a>, 0}},
<a name="l00081"></a>00081     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca2697fc0a230c6d30c694645d31874b58">MISCREG_VTTBR_EL2</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caeb8a6ed844e484a42d84318742e9ad1d">MISCREG_VTTBR</a>, 0}},
<a name="l00082"></a>00082     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca483fe08e0ab9e0d7dccba21804547878">MISCREG_TCR_EL1</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca5bfc9d84a913f4403092c34f4fdb68f0">MISCREG_TTBCR</a>, 0}},
<a name="l00083"></a>00083     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caca13cb1ca00fd3bd2130da500c0b92bf">MISCREG_TCR_EL2</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caaec739922d29ac6e2180c87616914737">MISCREG_HTCR</a>, 0}},
<a name="l00084"></a>00084     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca4c268d118638b812382607d175623814">MISCREG_VTCR_EL2</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca0323c35822c34ca5d438f8b9459bb21d">MISCREG_VTCR</a>, 0}},
<a name="l00085"></a>00085     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caa8b9c34c699cef0ef241121a77c820fc">MISCREG_AFSR0_EL1</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca96b0c3b1461ade48e19adb577bb93cd4">MISCREG_ADFSR</a>, 0}},
<a name="l00086"></a>00086     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca537d2e4752810da7ed76836270629426">MISCREG_AFSR1_EL1</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6d627cfe11c273e094f6cd72cde19ba9">MISCREG_AIFSR</a>, 0}},
<a name="l00087"></a>00087     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca99c2f5f69dc43f1d9ad31db321c21efa">MISCREG_AFSR0_EL2</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca9de3dc5ae4c2c1c385a91aa9c337c710">MISCREG_HADFSR</a>, 0}},
<a name="l00088"></a>00088     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caa78709f79eece6533d7d3385f3ed4b72">MISCREG_AFSR1_EL2</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca2391321765440382f2cd26252cfca0fc">MISCREG_HAIFSR</a>, 0}},
<a name="l00089"></a>00089     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca852880390e7b97cca94dd92985898c2b">MISCREG_ESR_EL2</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caed4f4a6f8aae9686c22ae8d180f40ab8">MISCREG_HSR</a>, 0}},
<a name="l00090"></a>00090     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6e1c29f8f88c8befb0737028c053d3c4">MISCREG_FAR_EL1</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca02fa0575976eba48928d8d99abe26a5a">MISCREG_DFAR</a>, <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca26989c87e432f012c3f2a5ae1c8a369f">MISCREG_IFAR</a>}},
<a name="l00091"></a>00091     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caa29f08635f388d3c388635bd77940829">MISCREG_FAR_EL2</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca52f0ff1daa8b976035d238029243ec9a">MISCREG_HDFAR</a>, <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca52a41307defcb5fb997785be15877013">MISCREG_HIFAR</a>}},
<a name="l00092"></a>00092     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cac1d11d41fbfc2bd28293d43e1ad85b60">MISCREG_HPFAR_EL2</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6bb1943e82738f9d9ad7b6b9fea703b1">MISCREG_HPFAR</a>, 0}},
<a name="l00093"></a>00093     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cab0068d369cc2c322740d26568643ef24">MISCREG_PAR_EL1</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca2963346f87bf29113a2fabb125b43f7a">MISCREG_PAR</a>, 0}},
<a name="l00094"></a>00094     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca5c4454017ba7645808043123511c41ed">MISCREG_MAIR_EL1</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca558657ebddea41bb1fc2cf61e725f6a9">MISCREG_PRRR</a>, <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cac979e506d9ce19425eb582d6acd8cee0">MISCREG_NMRR</a>}},
<a name="l00095"></a>00095     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca0c52c4f593a472a21dbf9d8acbbe1fc9">MISCREG_MAIR_EL2</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cacb4f149cac7b3dde2aa3e97a1d1a2fc6">MISCREG_HMAIR0</a>, <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca1a81addb4a201f2a0d39f636b094bc23">MISCREG_HMAIR1</a>}},
<a name="l00096"></a>00096     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caf6c8263390075c367e32d1c93f4de3d7">MISCREG_AMAIR_EL1</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca0797215d149dd6d506aa742e4bddabc1">MISCREG_AMAIR0</a>, <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca81deed498a989d6b3bf8739c22e3bdf0">MISCREG_AMAIR1</a>}},
<a name="l00097"></a>00097     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca4d415fa145a5b12231d0ceeb4c910e32">MISCREG_VBAR_EL1</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca7c75d790c0b82fa49e3891e5fa334e1e">MISCREG_VBAR</a>, 0}},
<a name="l00098"></a>00098     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca374ecc2ab96831f90c813f7cc9b9c06c">MISCREG_VBAR_EL2</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cad31e9d4cb740f361765b5604985f048f">MISCREG_HVBAR</a>, 0}},
<a name="l00099"></a>00099     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca1992f8149f4bdf313042a26b47b56670">MISCREG_CONTEXTIDR_EL1</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cac2263aa3fc056992a20bdd9dce32c61c">MISCREG_CONTEXTIDR</a>, 0}},
<a name="l00100"></a>00100     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caa46e6bad32d64ae244bde882a78afeef">MISCREG_TPIDR_EL0</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cab6caebec784f3ce62f3b9a8f9980b923">MISCREG_TPIDRURW</a>, 0}},
<a name="l00101"></a>00101     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca16c8681391a73928edeeed7c5286522d">MISCREG_TPIDRRO_EL0</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6b74e3f18bf8eacd7b5a7881b97a2733">MISCREG_TPIDRURO</a>, 0}},
<a name="l00102"></a>00102     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca7f399d597ca2b0b789ede6f2c1908c2d">MISCREG_TPIDR_EL1</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caacad0c4dbe020a85e34a289c36f5ed24">MISCREG_TPIDRPRW</a>, 0}},
<a name="l00103"></a>00103     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cac6d0adf24fa3748adfc982c8343481ab">MISCREG_TPIDR_EL2</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca3ed1d63b8da44a9df605f926d2202a7c">MISCREG_HTPIDR</a>, 0}},
<a name="l00104"></a>00104     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6e789b8daadca7673a3490bd44b1e6e9">MISCREG_TEECR32_EL1</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca83575b0ef8d6e228a8871db4e726740b">MISCREG_TEECR</a>, 0}},
<a name="l00105"></a>00105     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cafd4f2dc13098a69749546fa0aa65f084">MISCREG_CNTFRQ_EL0</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca0f74fcabaec0585fa64fdd5320ac8460">MISCREG_CNTFRQ</a>, 0}},
<a name="l00106"></a>00106     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca1bdf4578a5e265d32a55d0f8ab9abab9">MISCREG_CNTPCT_EL0</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca5b48045b79595b2d016c3d11c39f4882">MISCREG_CNTPCT</a>, 0}},
<a name="l00107"></a>00107     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca31f837eb4eeabffb98e02a8ec370a4e2">MISCREG_CNTVCT_EL0</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caeb45e6814275b8ce1dece3fd413849ff">MISCREG_CNTVCT</a>, 0}},
<a name="l00108"></a>00108     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caed2d1d95ea9004de926f3e66e14be983">MISCREG_CNTVOFF_EL2</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca384f75e1bfc9f600f494e201aa41e21e">MISCREG_CNTVOFF</a>, 0}},
<a name="l00109"></a>00109     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca7aee5179ce9c4ec339670c2ee5c09fb5">MISCREG_CNTKCTL_EL1</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caed93090a1aa63572ce90982348465372">MISCREG_CNTKCTL</a>, 0}},
<a name="l00110"></a>00110     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca7030299ddc28f6e8a58c8e7932443517">MISCREG_CNTHCTL_EL2</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca5c78e264cbf6b3f4975f5d40f327d1f0">MISCREG_CNTHCTL</a>, 0}},
<a name="l00111"></a>00111     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca8b8ba12391888855aa8c6ee4f0d95fbf">MISCREG_CNTP_TVAL_EL0</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cab242418e6715eb2d32569a483e006167">MISCREG_CNTP_TVAL</a>, 0}},
<a name="l00112"></a>00112     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca0dd783ae59dea6ad152d870ec5ddd425">MISCREG_CNTP_CTL_EL0</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca204a6d2cd0a99834e0d6e537bfc620b8">MISCREG_CNTP_CTL</a>, 0}},
<a name="l00113"></a>00113     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca8ce7ffd2641bac06cf038d4e05660a85">MISCREG_CNTP_CVAL_EL0</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca5235ab07f4e67209c7410ffc44205f58">MISCREG_CNTP_CVAL</a>, 0}},
<a name="l00114"></a>00114     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca32dc548ab83e879ea9072d5515b967fd">MISCREG_CNTV_TVAL_EL0</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca653e9ff9c2a68888f026be73522561e5">MISCREG_CNTV_TVAL</a>, 0}},
<a name="l00115"></a>00115     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca10c5d74680a2aaf6f75ff2e3f7ae7b15">MISCREG_CNTV_CTL_EL0</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca7dff860856caeb9e32f0a69f5c81c2dd">MISCREG_CNTV_CTL</a>, 0}},
<a name="l00116"></a>00116     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca255138f5bb2c4542e7a935eef561dd5c">MISCREG_CNTV_CVAL_EL0</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca0f4f807da435a90439a6f345fc410947">MISCREG_CNTV_CVAL</a>, 0}},
<a name="l00117"></a>00117     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca0af8aed45e49e6ea4b4f08428adb30bc">MISCREG_CNTHP_TVAL_EL2</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca267abed97aec857351e10aec7e93159a">MISCREG_CNTHP_TVAL</a>, 0}},
<a name="l00118"></a>00118     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca43538e54f94540ee41ee0456f0334b48">MISCREG_CNTHP_CTL_EL2</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca145142160e70a4a7f8201eb06236a6db">MISCREG_CNTHP_CTL</a>, 0}},
<a name="l00119"></a>00119     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca03430ce753cc40fd1ebfeed326a505bf">MISCREG_CNTHP_CVAL_EL2</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cada0a86c3391596b18b194e09c8d34c69">MISCREG_CNTHP_CVAL</a>, 0}},
<a name="l00120"></a>00120     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caeb586fac4da352f4940bb43ee8e3743b">MISCREG_DACR32_EL2</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca75883e1c671c8d333ef80bbb64c09233">MISCREG_DACR</a>, 0}},
<a name="l00121"></a>00121     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cae701c72f04b7748ee82dcd21d43dcdbf">MISCREG_IFSR32_EL2</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cac2645bfecf67b4eff0518ae7a7f8e95e">MISCREG_IFSR</a>, 0}},
<a name="l00122"></a>00122     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca8cd5c111cd6a409e3c21804ae740e9c2">MISCREG_TEEHBR32_EL1</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cafbcd03563973ad7b8180c82b286381a4">MISCREG_TEEHBR</a>, 0}},
<a name="l00123"></a>00123     {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caaa7759d8b49ebe71e14b0bda9bbcf539">MISCREG_SDER32_EL3</a>, {<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca5026f0ba544d51e04a56157937c96c42">MISCREG_SDER</a>, 0}}
<a name="l00124"></a>00124 };
<a name="l00125"></a>00125 
<a name="l00126"></a>00126 
<a name="l00127"></a><a class="code" href="structArmISA_1_1ISA.html#a696504da50402bd6ca90d15f68e4ea05">00127</a> <a class="code" href="structArmISA_1_1ISA.html#a696504da50402bd6ca90d15f68e4ea05">ISA::ISA</a>(Params *<a class="code" href="namespaceMipsISA.html#ae12ae9e12fab22594609e2fefce7f7c2">p</a>)
<a name="l00128"></a>00128     : <a class="code" href="classSimObject.html" title="Abstract superclass for simulation objects.">SimObject</a>(p),
<a name="l00129"></a>00129       <a class="code" href="namespaceX86ISA.html#a313686d10ce407058a35bddec45c211f">system</a>(NULL),
<a name="l00130"></a>00130       pmu(p-&gt;pmu),
<a name="l00131"></a>00131       lookUpMiscReg(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca60265248cffe34ad11fbddc732234970">NUM_MISCREGS</a>, {0,0})
<a name="l00132"></a>00132 {
<a name="l00133"></a>00133     SCTLR sctlr;
<a name="l00134"></a>00134     sctlr = 0;
<a name="l00135"></a>00135     miscRegs[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cace4697875a688fbf366db1453175e3c1">MISCREG_SCTLR_RST</a>] = sctlr;
<a name="l00136"></a>00136 
<a name="l00137"></a>00137     <span class="comment">// Hook up a dummy device if we haven&apos;t been configured with a</span>
<a name="l00138"></a>00138     <span class="comment">// real PMU. By using a dummy device, we don&apos;t need to check that</span>
<a name="l00139"></a>00139     <span class="comment">// the PMU exist every time we try to access a PMU register.</span>
<a name="l00140"></a>00140     <span class="keywordflow">if</span> (!pmu)
<a name="l00141"></a>00141         pmu = &amp;dummyDevice;
<a name="l00142"></a>00142 
<a name="l00143"></a>00143     <span class="comment">// Give all ISA devices a pointer to this ISA</span>
<a name="l00144"></a>00144     pmu-&gt;setISA(<span class="keyword">this</span>);
<a name="l00145"></a>00145 
<a name="l00146"></a>00146     <a class="code" href="namespaceX86ISA.html#a313686d10ce407058a35bddec45c211f">system</a> = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classArmSystem.html">ArmSystem</a> *<span class="keyword">&gt;</span>(<a class="code" href="namespaceMipsISA.html#ae12ae9e12fab22594609e2fefce7f7c2">p</a>-&gt;system);
<a name="l00147"></a>00147 
<a name="l00148"></a>00148     <span class="comment">// Cache system-level properties</span>
<a name="l00149"></a>00149     <span class="keywordflow">if</span> (<a class="code" href="full__system_8hh.html#af929576af6f85c8849704b66d04b8370" title="The FullSystem variable can be used to determine the current mode of simulation.">FullSystem</a> &amp;&amp; <a class="code" href="namespaceX86ISA.html#a313686d10ce407058a35bddec45c211f">system</a>) {
<a name="l00150"></a>00150         haveSecurity = <a class="code" href="namespaceX86ISA.html#a313686d10ce407058a35bddec45c211f">system</a>-&gt;haveSecurity();
<a name="l00151"></a>00151         haveLPAE = <a class="code" href="namespaceX86ISA.html#a313686d10ce407058a35bddec45c211f">system</a>-&gt;haveLPAE();
<a name="l00152"></a>00152         haveVirtualization = <a class="code" href="namespaceX86ISA.html#a313686d10ce407058a35bddec45c211f">system</a>-&gt;haveVirtualization();
<a name="l00153"></a>00153         haveLargeAsid64 = <a class="code" href="namespaceX86ISA.html#a313686d10ce407058a35bddec45c211f">system</a>-&gt;haveLargeAsid64();
<a name="l00154"></a>00154         physAddrRange64 = <a class="code" href="namespaceX86ISA.html#a313686d10ce407058a35bddec45c211f">system</a>-&gt;physAddrRange64();
<a name="l00155"></a>00155     } <span class="keywordflow">else</span> {
<a name="l00156"></a>00156         haveSecurity = haveLPAE = haveVirtualization = <span class="keyword">false</span>;
<a name="l00157"></a>00157         haveLargeAsid64 = <span class="keyword">false</span>;
<a name="l00158"></a>00158         physAddrRange64 = 32;  <span class="comment">// dummy value</span>
<a name="l00159"></a>00159     }
<a name="l00160"></a>00160 
<a name="l00162"></a>00162     <span class="keywordflow">for</span> (uint32_t <a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a> = 0; <a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a> &lt; <a class="code" href="namespaceArmISA.html#ad3418b128d81f0799645ae004435eef8a0406eeca96d67444d889e3f2fff862a7">miscRegTranslateMax</a>; <a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a>++) {
<a name="l00163"></a>00163         <span class="keyword">struct </span>MiscRegLUTEntry new_entry;
<a name="l00164"></a>00164 
<a name="l00165"></a>00165         uint32_t select = MiscRegSwitch[<a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a>].index;
<a name="l00166"></a>00166         new_entry = MiscRegSwitch[<a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a>].entry;
<a name="l00167"></a>00167 
<a name="l00168"></a>00168         lookUpMiscReg[select] = new_entry;
<a name="l00169"></a>00169     }
<a name="l00170"></a>00170 
<a name="l00171"></a>00171     <a class="code" href="namespaceArmISA.html#abf802f16fbf0845b6ec7f191189b8fff">preUnflattenMiscReg</a>();
<a name="l00172"></a>00172 
<a name="l00173"></a>00173     clear();
<a name="l00174"></a>00174 }
<a name="l00175"></a>00175 
<a name="l00176"></a>00176 <span class="keyword">const</span> ArmISAParams *
<a name="l00177"></a>00177 <a class="code" href="structArmISA_1_1ISA.html#aefe151add401ddbd25a82009ff4802c3">ISA::params</a>()<span class="keyword"> const</span>
<a name="l00178"></a>00178 <span class="keyword"></span>{
<a name="l00179"></a>00179     <span class="keywordflow">return</span> <span class="keyword">dynamic_cast&lt;</span><span class="keyword">const </span><a class="code" href="structArmISA_1_1ISA.html#af7ac4951de0ff1086a3f2bd48e42de5f">Params</a> *<span class="keyword">&gt;</span>(<a class="code" href="classSimObject.html#a99880551669bb51d749676f678b1dcc8" title="Cached copy of the object parameters.">_params</a>);
<a name="l00180"></a>00180 }
<a name="l00181"></a>00181 
<a name="l00182"></a>00182 <span class="keywordtype">void</span>
<a name="l00183"></a>00183 <a class="code" href="structArmISA_1_1ISA.html#a4b762a304f8265af5fb8d74532bd3e41">ISA::clear</a>()
<a name="l00184"></a>00184 {
<a name="l00185"></a>00185     <span class="keyword">const</span> <a class="code" href="structArmISA_1_1ISA.html#af7ac4951de0ff1086a3f2bd48e42de5f">Params</a> *<a class="code" href="namespaceMipsISA.html#ae12ae9e12fab22594609e2fefce7f7c2">p</a>(<a class="code" href="structArmISA_1_1ISA.html#aefe151add401ddbd25a82009ff4802c3">params</a>());
<a name="l00186"></a>00186 
<a name="l00187"></a>00187     SCTLR sctlr_rst = <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cace4697875a688fbf366db1453175e3c1">MISCREG_SCTLR_RST</a>];
<a name="l00188"></a>00188     memset(<a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>));
<a name="l00189"></a>00189 
<a name="l00190"></a>00190     <span class="comment">// Initialize configurable default values</span>
<a name="l00191"></a>00191     <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cadc608e04cb976f686af795b444bc6832">MISCREG_MIDR</a>] = <a class="code" href="namespaceMipsISA.html#ae12ae9e12fab22594609e2fefce7f7c2">p</a>-&gt;midr;
<a name="l00192"></a>00192     <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca87c650300c5e82bd513de83eafa1cd20">MISCREG_MIDR_EL1</a>] = <a class="code" href="namespaceMipsISA.html#ae12ae9e12fab22594609e2fefce7f7c2">p</a>-&gt;midr;
<a name="l00193"></a>00193     <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca132fc3bf23dbf11e3469c5793f36746a">MISCREG_VPIDR</a>] = <a class="code" href="namespaceMipsISA.html#ae12ae9e12fab22594609e2fefce7f7c2">p</a>-&gt;midr;
<a name="l00194"></a>00194 
<a name="l00195"></a>00195     <span class="keywordflow">if</span> (<a class="code" href="full__system_8hh.html#af929576af6f85c8849704b66d04b8370" title="The FullSystem variable can be used to determine the current mode of simulation.">FullSystem</a> &amp;&amp; <a class="code" href="structArmISA_1_1ISA.html#a2e13e022fad3518a8c0691b6f76ea857">system</a>-&gt;<a class="code" href="classArmSystem.html#a72878f01ee57214d9f61ab22dfd56f71" title="Returns true if the register width of the highest implemented exception level is...">highestELIs64</a>()) {
<a name="l00196"></a>00196         <span class="comment">// Initialize AArch64 state</span>
<a name="l00197"></a>00197         <a class="code" href="structArmISA_1_1ISA.html#a0e59e38fefa62795f88557c8c7c4e4d2">clear64</a>(<a class="code" href="namespaceMipsISA.html#ae12ae9e12fab22594609e2fefce7f7c2">p</a>);
<a name="l00198"></a>00198         <span class="keywordflow">return</span>;
<a name="l00199"></a>00199     }
<a name="l00200"></a>00200 
<a name="l00201"></a>00201     <span class="comment">// Initialize AArch32 state...</span>
<a name="l00202"></a>00202 
<a name="l00203"></a>00203     CPSR <a class="code" href="namespaceArmISA.html#a28eb434b8e612e94308a551ad1ece71a">cpsr</a> = 0;
<a name="l00204"></a>00204     cpsr.mode = <a class="code" href="namespaceArmISA.html#a5e5caf7b8ca343e256c2ac66262990caad87337169ced79741200c7319ef71811">MODE_USER</a>;
<a name="l00205"></a>00205     <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca1d2df46d160cfa336591aaebdd6f99ba">MISCREG_CPSR</a>] = cpsr;
<a name="l00206"></a>00206     <a class="code" href="structArmISA_1_1ISA.html#ae9bde810329001eee4820b6a26bb17b8">updateRegMap</a>(cpsr);
<a name="l00207"></a>00207 
<a name="l00208"></a>00208     SCTLR sctlr = 0;
<a name="l00209"></a>00209     sctlr.te = (bool) sctlr_rst.te;
<a name="l00210"></a>00210     sctlr.nmfi = (<span class="keywordtype">bool</span>) sctlr_rst.nmfi;
<a name="l00211"></a>00211     sctlr.v = (bool) sctlr_rst.v;
<a name="l00212"></a>00212     sctlr.u = 1;
<a name="l00213"></a>00213     sctlr.xp = 1;
<a name="l00214"></a>00214     sctlr.rao2 = 1;
<a name="l00215"></a>00215     sctlr.rao3 = 1;
<a name="l00216"></a>00216     sctlr.rao4 = 0xf;  <span class="comment">// SCTLR[6:3]</span>
<a name="l00217"></a>00217     sctlr.uci = 1;
<a name="l00218"></a>00218     sctlr.dze = 1;
<a name="l00219"></a>00219     <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca360b79ced0619e6a76eace131cf7c1b9">MISCREG_SCTLR_NS</a>] = sctlr;
<a name="l00220"></a>00220     <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cace4697875a688fbf366db1453175e3c1">MISCREG_SCTLR_RST</a>] = sctlr_rst;
<a name="l00221"></a>00221     <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cae4a87918573b1f768605e2b9d9d8997f">MISCREG_HCPTR</a>] = 0;
<a name="l00222"></a>00222 
<a name="l00223"></a>00223     <span class="comment">// Start with an event in the mailbox</span>
<a name="l00224"></a>00224     <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca309489dd7ba7778d15ee0407215a20a4">MISCREG_SEV_MAILBOX</a>] = 1;
<a name="l00225"></a>00225 
<a name="l00226"></a>00226     <span class="comment">// Separate Instruction and Data TLBs</span>
<a name="l00227"></a>00227     <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cace40afc520e485c32007d226062894b5">MISCREG_TLBTR</a>] = 1;
<a name="l00228"></a>00228 
<a name="l00229"></a>00229     MVFR0 mvfr0 = 0;
<a name="l00230"></a>00230     mvfr0.advSimdRegisters = 2;
<a name="l00231"></a>00231     mvfr0.singlePrecision = 2;
<a name="l00232"></a>00232     mvfr0.doublePrecision = 2;
<a name="l00233"></a>00233     mvfr0.vfpExceptionTrapping = 0;
<a name="l00234"></a>00234     mvfr0.divide = 1;
<a name="l00235"></a>00235     mvfr0.squareRoot = 1;
<a name="l00236"></a>00236     mvfr0.shortVectors = 1;
<a name="l00237"></a>00237     mvfr0.roundingModes = 1;
<a name="l00238"></a>00238     <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca8b23d147e2f3f690f1b9468c67554e13">MISCREG_MVFR0</a>] = mvfr0;
<a name="l00239"></a>00239 
<a name="l00240"></a>00240     MVFR1 mvfr1 = 0;
<a name="l00241"></a>00241     mvfr1.flushToZero = 1;
<a name="l00242"></a>00242     mvfr1.defaultNaN = 1;
<a name="l00243"></a>00243     mvfr1.advSimdLoadStore = 1;
<a name="l00244"></a>00244     mvfr1.advSimdInteger = 1;
<a name="l00245"></a>00245     mvfr1.advSimdSinglePrecision = 1;
<a name="l00246"></a>00246     mvfr1.advSimdHalfPrecision = 1;
<a name="l00247"></a>00247     mvfr1.vfpHalfPrecision = 1;
<a name="l00248"></a>00248     <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca95c008bfb7e9778da090ead9cce7aeee">MISCREG_MVFR1</a>] = mvfr1;
<a name="l00249"></a>00249 
<a name="l00250"></a>00250     <span class="comment">// Reset values of PRRR and NMRR are implementation dependent</span>
<a name="l00251"></a>00251 
<a name="l00252"></a>00252     <span class="comment">// @todo: PRRR and NMRR in secure state?</span>
<a name="l00253"></a>00253     <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caf1c70bb7740522e70853ddcccadcafd2">MISCREG_PRRR_NS</a>] =
<a name="l00254"></a>00254         (1 &lt;&lt; 19) | <span class="comment">// 19</span>
<a name="l00255"></a>00255         (0 &lt;&lt; 18) | <span class="comment">// 18</span>
<a name="l00256"></a>00256         (0 &lt;&lt; 17) | <span class="comment">// 17</span>
<a name="l00257"></a>00257         (1 &lt;&lt; 16) | <span class="comment">// 16</span>
<a name="l00258"></a>00258         (2 &lt;&lt; 14) | <span class="comment">// 15:14</span>
<a name="l00259"></a>00259         (0 &lt;&lt; 12) | <span class="comment">// 13:12</span>
<a name="l00260"></a>00260         (2 &lt;&lt; 10) | <span class="comment">// 11:10</span>
<a name="l00261"></a>00261         (2 &lt;&lt; 8)  | <span class="comment">// 9:8</span>
<a name="l00262"></a>00262         (2 &lt;&lt; 6)  | <span class="comment">// 7:6</span>
<a name="l00263"></a>00263         (2 &lt;&lt; 4)  | <span class="comment">// 5:4</span>
<a name="l00264"></a>00264         (1 &lt;&lt; 2)  | <span class="comment">// 3:2</span>
<a name="l00265"></a>00265         0;          <span class="comment">// 1:0</span>
<a name="l00266"></a>00266     <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caa5cd859db6e65607457beba177f35f1a">MISCREG_NMRR_NS</a>] =
<a name="l00267"></a>00267         (1 &lt;&lt; 30) | <span class="comment">// 31:30</span>
<a name="l00268"></a>00268         (0 &lt;&lt; 26) | <span class="comment">// 27:26</span>
<a name="l00269"></a>00269         (0 &lt;&lt; 24) | <span class="comment">// 25:24</span>
<a name="l00270"></a>00270         (3 &lt;&lt; 22) | <span class="comment">// 23:22</span>
<a name="l00271"></a>00271         (2 &lt;&lt; 20) | <span class="comment">// 21:20</span>
<a name="l00272"></a>00272         (0 &lt;&lt; 18) | <span class="comment">// 19:18</span>
<a name="l00273"></a>00273         (0 &lt;&lt; 16) | <span class="comment">// 17:16</span>
<a name="l00274"></a>00274         (1 &lt;&lt; 14) | <span class="comment">// 15:14</span>
<a name="l00275"></a>00275         (0 &lt;&lt; 12) | <span class="comment">// 13:12</span>
<a name="l00276"></a>00276         (2 &lt;&lt; 10) | <span class="comment">// 11:10</span>
<a name="l00277"></a>00277         (0 &lt;&lt; 8)  | <span class="comment">// 9:8</span>
<a name="l00278"></a>00278         (3 &lt;&lt; 6)  | <span class="comment">// 7:6</span>
<a name="l00279"></a>00279         (2 &lt;&lt; 4)  | <span class="comment">// 5:4</span>
<a name="l00280"></a>00280         (0 &lt;&lt; 2)  | <span class="comment">// 3:2</span>
<a name="l00281"></a>00281         0;          <span class="comment">// 1:0</span>
<a name="l00282"></a>00282 
<a name="l00283"></a>00283     <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca56f5859b27c49381dd9e0d7f3310565d">MISCREG_CPACR</a>] = 0;
<a name="l00284"></a>00284 
<a name="l00285"></a>00285 
<a name="l00286"></a>00286     <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cae3ff6125f3635480b95f7cc4eea900ff">MISCREG_ID_PFR0</a>] = <a class="code" href="namespaceMipsISA.html#ae12ae9e12fab22594609e2fefce7f7c2">p</a>-&gt;id_pfr0;
<a name="l00287"></a>00287     <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cacdd627b13d30f6f82676f789b0e0c44c">MISCREG_ID_PFR1</a>] = <a class="code" href="namespaceMipsISA.html#ae12ae9e12fab22594609e2fefce7f7c2">p</a>-&gt;id_pfr1;
<a name="l00288"></a>00288 
<a name="l00289"></a>00289     <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca344b758a27d1db96e5bce041a14a4ed7">MISCREG_ID_MMFR0</a>] = <a class="code" href="namespaceMipsISA.html#ae12ae9e12fab22594609e2fefce7f7c2">p</a>-&gt;id_mmfr0;
<a name="l00290"></a>00290     <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cab9036bd4d98170cbdbc70125a8ba9397">MISCREG_ID_MMFR1</a>] = <a class="code" href="namespaceMipsISA.html#ae12ae9e12fab22594609e2fefce7f7c2">p</a>-&gt;id_mmfr1;
<a name="l00291"></a>00291     <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca17ae208709284d34c21f53edb7d46aea">MISCREG_ID_MMFR2</a>] = <a class="code" href="namespaceMipsISA.html#ae12ae9e12fab22594609e2fefce7f7c2">p</a>-&gt;id_mmfr2;
<a name="l00292"></a>00292     <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cac3c9dfa10bb5aa634e1df2f7d7d9adb0">MISCREG_ID_MMFR3</a>] = <a class="code" href="namespaceMipsISA.html#ae12ae9e12fab22594609e2fefce7f7c2">p</a>-&gt;id_mmfr3;
<a name="l00293"></a>00293 
<a name="l00294"></a>00294     <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca68fe3af92534b9a943a114580b3c9d39">MISCREG_ID_ISAR0</a>] = <a class="code" href="namespaceMipsISA.html#ae12ae9e12fab22594609e2fefce7f7c2">p</a>-&gt;id_isar0;
<a name="l00295"></a>00295     <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caf4cef18dbef50885e187adddd1327d9e">MISCREG_ID_ISAR1</a>] = <a class="code" href="namespaceMipsISA.html#ae12ae9e12fab22594609e2fefce7f7c2">p</a>-&gt;id_isar1;
<a name="l00296"></a>00296     <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca30812347ebd4dd4acb50048b317e9ed7">MISCREG_ID_ISAR2</a>] = <a class="code" href="namespaceMipsISA.html#ae12ae9e12fab22594609e2fefce7f7c2">p</a>-&gt;id_isar2;
<a name="l00297"></a>00297     <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caa4e546048874cb8aeb47584175559326">MISCREG_ID_ISAR3</a>] = <a class="code" href="namespaceMipsISA.html#ae12ae9e12fab22594609e2fefce7f7c2">p</a>-&gt;id_isar3;
<a name="l00298"></a>00298     <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cab58b694aa4d1972b88a238c813f87173">MISCREG_ID_ISAR4</a>] = <a class="code" href="namespaceMipsISA.html#ae12ae9e12fab22594609e2fefce7f7c2">p</a>-&gt;id_isar4;
<a name="l00299"></a>00299     <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca097734a5fdc6fce17ce5caa5606af525">MISCREG_ID_ISAR5</a>] = <a class="code" href="namespaceMipsISA.html#ae12ae9e12fab22594609e2fefce7f7c2">p</a>-&gt;id_isar5;
<a name="l00300"></a>00300 
<a name="l00301"></a>00301     <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca782403f98b3f18d1c87433562a046a27">MISCREG_FPSID</a>] = <a class="code" href="namespaceMipsISA.html#ae12ae9e12fab22594609e2fefce7f7c2">p</a>-&gt;fpsid;
<a name="l00302"></a>00302 
<a name="l00303"></a>00303     <span class="keywordflow">if</span> (<a class="code" href="structArmISA_1_1ISA.html#a3aebe12b75ff4d71745ec872dddd0ac2">haveLPAE</a>) {
<a name="l00304"></a>00304         TTBCR ttbcr = <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca16206c90c6020addfc5855ddc0edf038">MISCREG_TTBCR_NS</a>];
<a name="l00305"></a>00305         ttbcr.eae = 0;
<a name="l00306"></a>00306         <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca16206c90c6020addfc5855ddc0edf038">MISCREG_TTBCR_NS</a>] = ttbcr;
<a name="l00307"></a>00307         <span class="comment">// Enforce consistency with system-level settings</span>
<a name="l00308"></a>00308         <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca344b758a27d1db96e5bce041a14a4ed7">MISCREG_ID_MMFR0</a>] = (<a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca344b758a27d1db96e5bce041a14a4ed7">MISCREG_ID_MMFR0</a>] &amp; ~0xf) | 0x5;
<a name="l00309"></a>00309     }
<a name="l00310"></a>00310 
<a name="l00311"></a>00311     <span class="keywordflow">if</span> (<a class="code" href="structArmISA_1_1ISA.html#a2b5cf38edef41a2219914fabbe91bca9">haveSecurity</a>) {
<a name="l00312"></a>00312         <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caad47953fcca722f8446003f5e293569f">MISCREG_SCTLR_S</a>] = sctlr;
<a name="l00313"></a>00313         <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6ec2fd6368d4b6668ee8155fc93d93b8">MISCREG_SCR</a>] = 0;
<a name="l00314"></a>00314         <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6d7e11b1bdc559e11bd2ca9ff1bb9634">MISCREG_VBAR_S</a>] = 0;
<a name="l00315"></a>00315     } <span class="keywordflow">else</span> {
<a name="l00316"></a>00316         <span class="comment">// we&apos;re always non-secure</span>
<a name="l00317"></a>00317         <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6ec2fd6368d4b6668ee8155fc93d93b8">MISCREG_SCR</a>] = 1;
<a name="l00318"></a>00318     }
<a name="l00319"></a>00319 
<a name="l00320"></a>00320     <span class="comment">//XXX We need to initialize the rest of the state.</span>
<a name="l00321"></a>00321 }
<a name="l00322"></a>00322 
<a name="l00323"></a>00323 <span class="keywordtype">void</span>
<a name="l00324"></a>00324 <a class="code" href="structArmISA_1_1ISA.html#a0e59e38fefa62795f88557c8c7c4e4d2">ISA::clear64</a>(<span class="keyword">const</span> ArmISAParams *<a class="code" href="namespaceMipsISA.html#ae12ae9e12fab22594609e2fefce7f7c2">p</a>)
<a name="l00325"></a>00325 {
<a name="l00326"></a>00326     CPSR cpsr = 0;
<a name="l00327"></a>00327     <a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232" title="Address type This will probably be moved somewhere else in the near future.">Addr</a> rvbar = <a class="code" href="structArmISA_1_1ISA.html#a2e13e022fad3518a8c0691b6f76ea857">system</a>-&gt;<a class="code" href="classArmSystem.html#a876f4bf27c621a73ba755d96e7c2fe88" title="Returns the reset address if the highest implemented exception level is 64 bits (ARMv8)...">resetAddr64</a>();
<a name="l00328"></a>00328     <span class="keywordflow">switch</span> (<a class="code" href="structArmISA_1_1ISA.html#a2e13e022fad3518a8c0691b6f76ea857">system</a>-&gt;<a class="code" href="classArmSystem.html#a9c440bbdcae9f357c2b98eb084e62e52" title="Returns the highest implemented exception level.">highestEL</a>()) {
<a name="l00329"></a>00329         <span class="comment">// Set initial EL to highest implemented EL using associated stack</span>
<a name="l00330"></a>00330         <span class="comment">// pointer (SP_ELx); set RVBAR_ELx to implementation defined reset</span>
<a name="l00331"></a>00331         <span class="comment">// value</span>
<a name="l00332"></a>00332       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a6b7c17b7a5b9b9b5c8f8610bd27ba98da3dcb0a3ebc6bb1438051b3e943ae5325">EL3</a>:
<a name="l00333"></a>00333         cpsr.mode = <a class="code" href="namespaceArmISA.html#a5e5caf7b8ca343e256c2ac66262990caa0ad2586bf3231bb4f0a257eb300b989b">MODE_EL3H</a>;
<a name="l00334"></a>00334         <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca8cb9b57dddbd676a068f8dfd3556f0c2">MISCREG_RVBAR_EL3</a>] = rvbar;
<a name="l00335"></a>00335         <span class="keywordflow">break</span>;
<a name="l00336"></a>00336       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a6b7c17b7a5b9b9b5c8f8610bd27ba98daa4c3712f2de98a3c6557776ed120b2ed">EL2</a>:
<a name="l00337"></a>00337         cpsr.mode = <a class="code" href="namespaceArmISA.html#a5e5caf7b8ca343e256c2ac66262990caa14db321486ae70478159f1b474897d6d">MODE_EL2H</a>;
<a name="l00338"></a>00338         <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca027dd496fd4bef2bbe03585c8c7ee46f">MISCREG_RVBAR_EL2</a>] = rvbar;
<a name="l00339"></a>00339         <span class="keywordflow">break</span>;
<a name="l00340"></a>00340       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a6b7c17b7a5b9b9b5c8f8610bd27ba98dad1b4a69ba239877df9def4576845dfe5">EL1</a>:
<a name="l00341"></a>00341         cpsr.mode = <a class="code" href="namespaceArmISA.html#a5e5caf7b8ca343e256c2ac66262990caa28de6045ec325526e6b101c46115bcf0">MODE_EL1H</a>;
<a name="l00342"></a>00342         <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cad3f4001caae3a6c7e0153dc413483668">MISCREG_RVBAR_EL1</a>] = rvbar;
<a name="l00343"></a>00343         <span class="keywordflow">break</span>;
<a name="l00344"></a>00344       <span class="keywordflow">default</span>:
<a name="l00345"></a>00345         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Invalid highest implemented exception level&quot;</span>);
<a name="l00346"></a>00346         <span class="keywordflow">break</span>;
<a name="l00347"></a>00347     }
<a name="l00348"></a>00348 
<a name="l00349"></a>00349     <span class="comment">// Initialize rest of CPSR</span>
<a name="l00350"></a>00350     cpsr.daif = 0xf;  <span class="comment">// Mask all interrupts</span>
<a name="l00351"></a>00351     cpsr.ss = 0;
<a name="l00352"></a>00352     cpsr.il = 0;
<a name="l00353"></a>00353     <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca1d2df46d160cfa336591aaebdd6f99ba">MISCREG_CPSR</a>] = cpsr;
<a name="l00354"></a>00354     <a class="code" href="structArmISA_1_1ISA.html#ae9bde810329001eee4820b6a26bb17b8">updateRegMap</a>(cpsr);
<a name="l00355"></a>00355 
<a name="l00356"></a>00356     <span class="comment">// Initialize other control registers</span>
<a name="l00357"></a>00357     <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cac35c2c26bf6a839a1844bd85c46b2e83">MISCREG_MPIDR_EL1</a>] = 0x80000000;
<a name="l00358"></a>00358     <span class="keywordflow">if</span> (<a class="code" href="structArmISA_1_1ISA.html#a2b5cf38edef41a2219914fabbe91bca9">haveSecurity</a>) {
<a name="l00359"></a>00359         <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca0b410ff413a02c9b8979d026cb151bcc">MISCREG_SCTLR_EL3</a>] = 0x30c50870;
<a name="l00360"></a>00360         <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca25e01e2437793648b59e468b134153e4">MISCREG_SCR_EL3</a>]   = 0x00000030;  <span class="comment">// RES1 fields</span>
<a name="l00361"></a>00361     <span class="comment">// @todo: uncomment this to enable Virtualization</span>
<a name="l00362"></a>00362     <span class="comment">// } else if (haveVirtualization) {</span>
<a name="l00363"></a>00363     <span class="comment">//     miscRegs[MISCREG_SCTLR_EL2] = 0x30c50870;</span>
<a name="l00364"></a>00364     } <span class="keywordflow">else</span> {
<a name="l00365"></a>00365         <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6a053ea48f0a33993f665a3583be7cce">MISCREG_SCTLR_EL1</a>] = 0x30c50870;
<a name="l00366"></a>00366         <span class="comment">// Always non-secure</span>
<a name="l00367"></a>00367         <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca25e01e2437793648b59e468b134153e4">MISCREG_SCR_EL3</a>] = 1;
<a name="l00368"></a>00368     }
<a name="l00369"></a>00369 
<a name="l00370"></a>00370     <span class="comment">// Initialize configurable id registers</span>
<a name="l00371"></a>00371     <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cab8b39010cdc0fe971922aefa57837d23">MISCREG_ID_AA64AFR0_EL1</a>] = p-&gt;id_aa64afr0_el1;
<a name="l00372"></a>00372     <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca8797f004798df47a089e9c3f2e81d2f2">MISCREG_ID_AA64AFR1_EL1</a>] = p-&gt;id_aa64afr1_el1;
<a name="l00373"></a>00373     <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca257ebe5fbd21331eeacf40de02b9c869">MISCREG_ID_AA64DFR0_EL1</a>] =
<a name="l00374"></a>00374         (p-&gt;id_aa64dfr0_el1 &amp; 0xfffffffffffff0ff<a class="code" href="base_2types_8hh.html#adcc3cf526a71c0dfaae020d432c78b83" title="uint64_t constant">ULL</a>) |
<a name="l00375"></a>00375         (p-&gt;pmu ?             0x0000000000000100ULL : 0); <span class="comment">// Enable PMUv3</span>
<a name="l00376"></a>00376 
<a name="l00377"></a>00377     <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca88c1e000248c4359e401304f2c4de082">MISCREG_ID_AA64DFR1_EL1</a>] = p-&gt;id_aa64dfr1_el1;
<a name="l00378"></a>00378     <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca2e4c38994591183a2a4f9824c2f04de1">MISCREG_ID_AA64ISAR0_EL1</a>] = p-&gt;id_aa64isar0_el1;
<a name="l00379"></a>00379     <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca30e718528af33a5acae4bb80df269b0e">MISCREG_ID_AA64ISAR1_EL1</a>] = p-&gt;id_aa64isar1_el1;
<a name="l00380"></a>00380     <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca094617d2658838c1f5ad737b50608112">MISCREG_ID_AA64MMFR0_EL1</a>] = p-&gt;id_aa64mmfr0_el1;
<a name="l00381"></a>00381     <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cacc1a75c0a4b9ecbfe29cddd1176f7a3f">MISCREG_ID_AA64MMFR1_EL1</a>] = p-&gt;id_aa64mmfr1_el1;
<a name="l00382"></a>00382     <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca1f67b0b70cd63a9d580183f96e302c25">MISCREG_ID_AA64PFR0_EL1</a>] = p-&gt;id_aa64pfr0_el1;
<a name="l00383"></a>00383     <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cad4624483d0fde58150bac9a05d2d93c2">MISCREG_ID_AA64PFR1_EL1</a>] = p-&gt;id_aa64pfr1_el1;
<a name="l00384"></a>00384 
<a name="l00385"></a>00385     <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca12b84daa436a1291c54089e563bfe62b">MISCREG_ID_DFR0_EL1</a>] =
<a name="l00386"></a>00386         (p-&gt;pmu ? 0x03000000<a class="code" href="base_2types_8hh.html#adcc3cf526a71c0dfaae020d432c78b83" title="uint64_t constant">ULL</a> : 0); <span class="comment">// Enable PMUv3</span>
<a name="l00387"></a>00387 
<a name="l00388"></a>00388     <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca2d551ec7da0544e4816550f590cb6801">MISCREG_ID_DFR0</a>] = <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca12b84daa436a1291c54089e563bfe62b">MISCREG_ID_DFR0_EL1</a>];
<a name="l00389"></a>00389 
<a name="l00390"></a>00390     <span class="comment">// Enforce consistency with system-level settings...</span>
<a name="l00391"></a>00391 
<a name="l00392"></a>00392     <span class="comment">// EL3</span>
<a name="l00393"></a>00393     <span class="comment">// (no AArch32/64 interprocessing support for now)</span>
<a name="l00394"></a>00394     <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca1f67b0b70cd63a9d580183f96e302c25">MISCREG_ID_AA64PFR0_EL1</a>] = <a class="code" href="bitfield_8hh.html#a2aa7004e37a8c54bf3e5ce81c3125075" title="Return val with bits first to last set to bit_val.">insertBits</a>(
<a name="l00395"></a>00395         <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca1f67b0b70cd63a9d580183f96e302c25">MISCREG_ID_AA64PFR0_EL1</a>], 15, 12,
<a name="l00396"></a>00396         <a class="code" href="structArmISA_1_1ISA.html#a2b5cf38edef41a2219914fabbe91bca9">haveSecurity</a> ? 0x1 : 0x0);
<a name="l00397"></a>00397     <span class="comment">// EL2</span>
<a name="l00398"></a>00398     <span class="comment">// (no AArch32/64 interprocessing support for now)</span>
<a name="l00399"></a>00399     <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca1f67b0b70cd63a9d580183f96e302c25">MISCREG_ID_AA64PFR0_EL1</a>] = <a class="code" href="bitfield_8hh.html#a2aa7004e37a8c54bf3e5ce81c3125075" title="Return val with bits first to last set to bit_val.">insertBits</a>(
<a name="l00400"></a>00400         <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca1f67b0b70cd63a9d580183f96e302c25">MISCREG_ID_AA64PFR0_EL1</a>], 11, 8,
<a name="l00401"></a>00401         <a class="code" href="structArmISA_1_1ISA.html#a3682c749403746c279089e180b3a503e">haveVirtualization</a> ? 0x1 : 0x0);
<a name="l00402"></a>00402     <span class="comment">// Large ASID support</span>
<a name="l00403"></a>00403     <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca094617d2658838c1f5ad737b50608112">MISCREG_ID_AA64MMFR0_EL1</a>] = <a class="code" href="bitfield_8hh.html#a2aa7004e37a8c54bf3e5ce81c3125075" title="Return val with bits first to last set to bit_val.">insertBits</a>(
<a name="l00404"></a>00404         <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca094617d2658838c1f5ad737b50608112">MISCREG_ID_AA64MMFR0_EL1</a>], 7, 4,
<a name="l00405"></a>00405         <a class="code" href="structArmISA_1_1ISA.html#a2856f99be78123643814dc843efdd874">haveLargeAsid64</a> ? 0x2 : 0x0);
<a name="l00406"></a>00406     <span class="comment">// Physical address size</span>
<a name="l00407"></a>00407     <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca094617d2658838c1f5ad737b50608112">MISCREG_ID_AA64MMFR0_EL1</a>] = <a class="code" href="bitfield_8hh.html#a2aa7004e37a8c54bf3e5ce81c3125075" title="Return val with bits first to last set to bit_val.">insertBits</a>(
<a name="l00408"></a>00408         <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca094617d2658838c1f5ad737b50608112">MISCREG_ID_AA64MMFR0_EL1</a>], 3, 0,
<a name="l00409"></a>00409         <a class="code" href="namespaceArmISA.html#a74e39019e6d3d3cc122fc34d99503141" title="Returns the encoding corresponding to the specified n.">encodePhysAddrRange64</a>(<a class="code" href="structArmISA_1_1ISA.html#a04fff4c8211f75af68a8ebf37c75b4ee">physAddrRange64</a>));
<a name="l00410"></a>00410 }
<a name="l00411"></a>00411 
<a name="l00412"></a>00412 <a class="code" href="namespaceArmISA.html#ae6de70120f06c08f390947f9e5cf7f7a">MiscReg</a>
<a name="l00413"></a>00413 <a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">ISA::readMiscRegNoEffect</a>(<span class="keywordtype">int</span> misc_reg)<span class="keyword"> const</span>
<a name="l00414"></a>00414 <span class="keyword"></span>{
<a name="l00415"></a>00415     assert(misc_reg &lt; <a class="code" href="namespaceArmISA.html#af51c226f6d8f413a1d210ea0c9ece771">NumMiscRegs</a>);
<a name="l00416"></a>00416 
<a name="l00417"></a>00417     <span class="keywordtype">int</span> flat_idx = <a class="code" href="structArmISA_1_1ISA.html#a17eaa0e5b086dd8f54241e876c510228">flattenMiscIndex</a>(misc_reg);  <span class="comment">// Note: indexes of AArch64</span>
<a name="l00418"></a>00418                                                 <span class="comment">// registers are left unchanged</span>
<a name="l00419"></a>00419     <a class="code" href="namespaceArmISA.html#ae6de70120f06c08f390947f9e5cf7f7a">MiscReg</a> <a class="code" href="namespaceX86ISA.html#ab4e00e23f8f36386f97d8abcccb17180">val</a>;
<a name="l00420"></a>00420 
<a name="l00421"></a>00421     <span class="keywordflow">if</span> (<a class="code" href="structArmISA_1_1ISA.html#a49d05393cb7ad28cf9b830e80c357029" title="Translation table accessible via the value of the register.">lookUpMiscReg</a>[flat_idx].lower == 0 || flat_idx == <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca629c5a91c7c38b30701184fd3e8c19b8">MISCREG_SPSR</a>
<a name="l00422"></a>00422             || flat_idx == <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6a053ea48f0a33993f665a3583be7cce">MISCREG_SCTLR_EL1</a>) {
<a name="l00423"></a>00423         <span class="keywordflow">if</span> (flat_idx == <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca629c5a91c7c38b30701184fd3e8c19b8">MISCREG_SPSR</a>)
<a name="l00424"></a>00424             flat_idx = <a class="code" href="structArmISA_1_1ISA.html#a17eaa0e5b086dd8f54241e876c510228">flattenMiscIndex</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca629c5a91c7c38b30701184fd3e8c19b8">MISCREG_SPSR</a>);
<a name="l00425"></a>00425         <span class="keywordflow">if</span> (flat_idx == <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6a053ea48f0a33993f665a3583be7cce">MISCREG_SCTLR_EL1</a>)
<a name="l00426"></a>00426             flat_idx = <a class="code" href="structArmISA_1_1ISA.html#a17eaa0e5b086dd8f54241e876c510228">flattenMiscIndex</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca540af25d1d321d1891bf4d9292c227c1">MISCREG_SCTLR</a>);
<a name="l00427"></a>00427         val = <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[flat_idx];
<a name="l00428"></a>00428     } <span class="keywordflow">else</span>
<a name="l00429"></a>00429         <span class="keywordflow">if</span> (<a class="code" href="structArmISA_1_1ISA.html#a49d05393cb7ad28cf9b830e80c357029" title="Translation table accessible via the value of the register.">lookUpMiscReg</a>[flat_idx].upper &gt; 0)
<a name="l00430"></a>00430             val = ((<a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="structArmISA_1_1ISA.html#a49d05393cb7ad28cf9b830e80c357029" title="Translation table accessible via the value of the register.">lookUpMiscReg</a>[flat_idx].lower] &amp; <a class="code" href="namespaceArmISA.html#aedf8742bbf65a60cf102a4b3f9ba3d68">mask</a>(32))
<a name="l00431"></a>00431                     | (<a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="structArmISA_1_1ISA.html#a49d05393cb7ad28cf9b830e80c357029" title="Translation table accessible via the value of the register.">lookUpMiscReg</a>[flat_idx].upper] &lt;&lt; 32));
<a name="l00432"></a>00432         <span class="keywordflow">else</span>
<a name="l00433"></a>00433             val = <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="structArmISA_1_1ISA.html#a49d05393cb7ad28cf9b830e80c357029" title="Translation table accessible via the value of the register.">lookUpMiscReg</a>[flat_idx].lower];
<a name="l00434"></a>00434 
<a name="l00435"></a>00435     <span class="keywordflow">return</span> val;
<a name="l00436"></a>00436 }
<a name="l00437"></a>00437 
<a name="l00438"></a>00438 
<a name="l00439"></a>00439 <a class="code" href="namespaceArmISA.html#ae6de70120f06c08f390947f9e5cf7f7a">MiscReg</a>
<a name="l00440"></a>00440 <a class="code" href="structArmISA_1_1ISA.html#a1a89f346ae6d1ebe6475c53151ee0187">ISA::readMiscReg</a>(<span class="keywordtype">int</span> misc_reg, <a class="code" href="classThreadContext.html" title="ThreadContext is the external interface to all thread state for anything outside...">ThreadContext</a> *<a class="code" href="namespaceArmISA.html#ad231afd8f3ee15e80991d6fbd5ba2e9a">tc</a>)
<a name="l00441"></a>00441 {
<a name="l00442"></a>00442     CPSR cpsr = 0;
<a name="l00443"></a>00443     <a class="code" href="namespaceAlphaISA.html#a233e755911c9143f96bef37eedb1e009">PCState</a> <a class="code" href="namespaceMipsISA.html#a4f7ed975e7137b5c369214789649451f">pc</a> = 0;
<a name="l00444"></a>00444     SCR <a class="code" href="namespaceArmISA.html#a4982970a6e14df1bcdec992e13010ea6">scr</a> = 0;
<a name="l00445"></a>00445 
<a name="l00446"></a>00446     <span class="keywordflow">if</span> (misc_reg == <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca1d2df46d160cfa336591aaebdd6f99ba">MISCREG_CPSR</a>) {
<a name="l00447"></a>00447         cpsr = <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[misc_reg];
<a name="l00448"></a>00448         pc = tc-&gt;<a class="code" href="classThreadContext.html#ab15f0db0e7c7afb40dfbbbd13d62dc2e">pcState</a>();
<a name="l00449"></a>00449         cpsr.j = pc.jazelle() ? 1 : 0;
<a name="l00450"></a>00450         cpsr.t = pc.thumb() ? 1 : 0;
<a name="l00451"></a>00451         <span class="keywordflow">return</span> cpsr;
<a name="l00452"></a>00452     }
<a name="l00453"></a>00453 
<a name="l00454"></a>00454 <span class="preprocessor">#ifndef NDEBUG</span>
<a name="l00455"></a>00455 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (!<a class="code" href="namespaceArmISA.html#a5acac006216a2ea59125ca03fe16de1c">miscRegInfo</a>[misc_reg][<a class="code" href="namespaceArmISA.html#acbfe4414fa174a85a2473fcdcd7b829aafd6bee87a898b977c42b81ce84df3c48">MISCREG_IMPLEMENTED</a>]) {
<a name="l00456"></a>00456         <span class="keywordflow">if</span> (<a class="code" href="namespaceArmISA.html#a5acac006216a2ea59125ca03fe16de1c">miscRegInfo</a>[misc_reg][<a class="code" href="namespaceArmISA.html#acbfe4414fa174a85a2473fcdcd7b829aad1d3caec9105e35f8e05448a4724b016">MISCREG_WARN_NOT_FAIL</a>])
<a name="l00457"></a>00457             <a class="code" href="base_2misc_8hh.html#a8224a361dddd2ad59b411982e5ea746f">warn</a>(<span class="stringliteral">&quot;Unimplemented system register %s read.\n&quot;</span>,
<a name="l00458"></a>00458                  <a class="code" href="namespaceArmISA.html#a86b05be1092b70a38660616b2b7e6793">miscRegName</a>[misc_reg]);
<a name="l00459"></a>00459         <span class="keywordflow">else</span>
<a name="l00460"></a>00460             <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Unimplemented system register %s read.\n&quot;</span>,
<a name="l00461"></a>00461                   <a class="code" href="namespaceArmISA.html#a86b05be1092b70a38660616b2b7e6793">miscRegName</a>[misc_reg]);
<a name="l00462"></a>00462     }
<a name="l00463"></a>00463 <span class="preprocessor">#endif</span>
<a name="l00464"></a>00464 <span class="preprocessor"></span>
<a name="l00465"></a>00465     <span class="keywordflow">switch</span> (<a class="code" href="namespaceArmISA.html#aed4783414a4ae046bb75551deff7e829">unflattenMiscReg</a>(misc_reg)) {
<a name="l00466"></a>00466       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cacc6c0d54b3de785d3e9bd57250007f71">MISCREG_HCR</a>:
<a name="l00467"></a>00467         {
<a name="l00468"></a>00468             <span class="keywordflow">if</span> (!<a class="code" href="structArmISA_1_1ISA.html#a3682c749403746c279089e180b3a503e">haveVirtualization</a>)
<a name="l00469"></a>00469                 <span class="keywordflow">return</span> 0;
<a name="l00470"></a>00470             <span class="keywordflow">else</span>
<a name="l00471"></a>00471                 <span class="keywordflow">return</span> <a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cacc6c0d54b3de785d3e9bd57250007f71">MISCREG_HCR</a>);
<a name="l00472"></a>00472         }
<a name="l00473"></a>00473       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca56f5859b27c49381dd9e0d7f3310565d">MISCREG_CPACR</a>:
<a name="l00474"></a>00474         {
<a name="l00475"></a>00475             <span class="keyword">const</span> uint32_t ones = (uint32_t)(-1);
<a name="l00476"></a>00476             CPACR cpacrMask = 0;
<a name="l00477"></a>00477             <span class="comment">// Only cp10, cp11, and ase are implemented, nothing else should</span>
<a name="l00478"></a>00478             <span class="comment">// be readable? (straight copy from the write code)</span>
<a name="l00479"></a>00479             cpacrMask.cp10 = ones;
<a name="l00480"></a>00480             cpacrMask.cp11 = ones;
<a name="l00481"></a>00481             cpacrMask.asedis = ones;
<a name="l00482"></a>00482 
<a name="l00483"></a>00483             <span class="comment">// Security Extensions may limit the readability of CPACR</span>
<a name="l00484"></a>00484             <span class="keywordflow">if</span> (<a class="code" href="structArmISA_1_1ISA.html#a2b5cf38edef41a2219914fabbe91bca9">haveSecurity</a>) {
<a name="l00485"></a>00485                 scr = <a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6ec2fd6368d4b6668ee8155fc93d93b8">MISCREG_SCR</a>);
<a name="l00486"></a>00486                 cpsr = <a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca1d2df46d160cfa336591aaebdd6f99ba">MISCREG_CPSR</a>);
<a name="l00487"></a>00487                 <span class="keywordflow">if</span> (scr.ns &amp;&amp; (cpsr.mode != <a class="code" href="namespaceArmISA.html#a5e5caf7b8ca343e256c2ac66262990caaedd810eb5d1b0c2632821f8b7abc0fe0">MODE_MON</a>)) {
<a name="l00488"></a>00488                     NSACR nsacr = <a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca227ca1dc43b4cc7be618d433e8e9bf07">MISCREG_NSACR</a>);
<a name="l00489"></a>00489                     <span class="comment">// NB: Skipping the full loop, here</span>
<a name="l00490"></a>00490                     <span class="keywordflow">if</span> (!nsacr.cp10) cpacrMask.cp10 = 0;
<a name="l00491"></a>00491                     <span class="keywordflow">if</span> (!nsacr.cp11) cpacrMask.cp11 = 0;
<a name="l00492"></a>00492                 }
<a name="l00493"></a>00493             }
<a name="l00494"></a>00494             <a class="code" href="namespaceArmISA.html#ae6de70120f06c08f390947f9e5cf7f7a">MiscReg</a> val = <a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca56f5859b27c49381dd9e0d7f3310565d">MISCREG_CPACR</a>);
<a name="l00495"></a>00495             val &amp;= cpacrMask;
<a name="l00496"></a>00496             <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(MiscRegs, <span class="stringliteral">&quot;Reading misc reg %s: %#x\n&quot;</span>,
<a name="l00497"></a>00497                     <a class="code" href="namespaceArmISA.html#a86b05be1092b70a38660616b2b7e6793">miscRegName</a>[misc_reg], val);
<a name="l00498"></a>00498             <span class="keywordflow">return</span> val;
<a name="l00499"></a>00499         }
<a name="l00500"></a>00500       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cadd221dda6f7809c358100c45f0724020">MISCREG_MPIDR</a>:
<a name="l00501"></a>00501         cpsr = <a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca1d2df46d160cfa336591aaebdd6f99ba">MISCREG_CPSR</a>);
<a name="l00502"></a>00502         scr  = <a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6ec2fd6368d4b6668ee8155fc93d93b8">MISCREG_SCR</a>);
<a name="l00503"></a>00503         <span class="keywordflow">if</span> ((cpsr.mode == <a class="code" href="namespaceArmISA.html#a5e5caf7b8ca343e256c2ac66262990caabe7248ed532124da7df4c82944df7225">MODE_HYP</a>) || <a class="code" href="namespaceArmISA.html#abb263f4ec2a2852ac26b5c33c6f5897b">inSecureState</a>(scr, cpsr)) {
<a name="l00504"></a>00504             <span class="keywordflow">return</span> <a class="code" href="namespaceArmISA.html#ae8ed317b90403e645f829663ecce4173">getMPIDR</a>(<a class="code" href="structArmISA_1_1ISA.html#a2e13e022fad3518a8c0691b6f76ea857">system</a>, tc);
<a name="l00505"></a>00505         } <span class="keywordflow">else</span> {
<a name="l00506"></a>00506             <span class="keywordflow">return</span> <a class="code" href="structArmISA_1_1ISA.html#a1a89f346ae6d1ebe6475c53151ee0187">readMiscReg</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cac71e99c4e6f9de9760e1ea474af349d7">MISCREG_VMPIDR</a>, tc);
<a name="l00507"></a>00507         }
<a name="l00508"></a>00508             <span class="keywordflow">break</span>;
<a name="l00509"></a>00509       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cac35c2c26bf6a839a1844bd85c46b2e83">MISCREG_MPIDR_EL1</a>:
<a name="l00510"></a>00510         <span class="comment">// @todo in the absence of v8 virtualization support just return MPIDR_EL1</span>
<a name="l00511"></a>00511         <span class="keywordflow">return</span> <a class="code" href="namespaceArmISA.html#ae8ed317b90403e645f829663ecce4173">getMPIDR</a>(<a class="code" href="structArmISA_1_1ISA.html#a2e13e022fad3518a8c0691b6f76ea857">system</a>, tc) &amp; 0xffffffff;
<a name="l00512"></a>00512       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cac71e99c4e6f9de9760e1ea474af349d7">MISCREG_VMPIDR</a>:
<a name="l00513"></a>00513         <span class="comment">// top bit defined as RES1</span>
<a name="l00514"></a>00514         <span class="keywordflow">return</span> <a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(misc_reg) | 0x80000000;
<a name="l00515"></a>00515       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca5c98c3088aaac33f27695e1e71fe7cb3">MISCREG_ID_AFR0</a>: <span class="comment">// not implemented, so alias MIDR</span>
<a name="l00516"></a>00516       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca8aac71cc6d5777ddb1a51ae04972bae3">MISCREG_REVIDR</a>:  <span class="comment">// not implemented, so alias MIDR</span>
<a name="l00517"></a>00517       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cadc608e04cb976f686af795b444bc6832">MISCREG_MIDR</a>:
<a name="l00518"></a>00518         cpsr = <a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca1d2df46d160cfa336591aaebdd6f99ba">MISCREG_CPSR</a>);
<a name="l00519"></a>00519         scr  = <a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6ec2fd6368d4b6668ee8155fc93d93b8">MISCREG_SCR</a>);
<a name="l00520"></a>00520         <span class="keywordflow">if</span> ((cpsr.mode == <a class="code" href="namespaceArmISA.html#a5e5caf7b8ca343e256c2ac66262990caabe7248ed532124da7df4c82944df7225">MODE_HYP</a>) || <a class="code" href="namespaceArmISA.html#abb263f4ec2a2852ac26b5c33c6f5897b">inSecureState</a>(scr, cpsr)) {
<a name="l00521"></a>00521             <span class="keywordflow">return</span> <a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(misc_reg);
<a name="l00522"></a>00522         } <span class="keywordflow">else</span> {
<a name="l00523"></a>00523             <span class="keywordflow">return</span> <a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca132fc3bf23dbf11e3469c5793f36746a">MISCREG_VPIDR</a>);
<a name="l00524"></a>00524         }
<a name="l00525"></a>00525         <span class="keywordflow">break</span>;
<a name="l00526"></a>00526       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caa2af19acb96e1a0d8eb8626bebdfb26e">MISCREG_JOSCR</a>: <span class="comment">// Jazelle trivial implementation, RAZ/WI</span>
<a name="l00527"></a>00527       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca4d826882684c582e3d48bc29e86be523">MISCREG_JMCR</a>:  <span class="comment">// Jazelle trivial implementation, RAZ/WI</span>
<a name="l00528"></a>00528       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cab113c71592638c5ee446fb6619cdff1d">MISCREG_JIDR</a>:  <span class="comment">// Jazelle trivial implementation, RAZ/WI</span>
<a name="l00529"></a>00529       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caabcef3978aa7e1d659b66d0456565ac2">MISCREG_AIDR</a>:  <span class="comment">// AUX ID set to 0</span>
<a name="l00530"></a>00530       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caa6fd30cedd3f1cd6138bc919dfb16399">MISCREG_TCMTR</a>: <span class="comment">// No TCM&apos;s</span>
<a name="l00531"></a>00531         <span class="keywordflow">return</span> 0;
<a name="l00532"></a>00532 
<a name="l00533"></a>00533       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca2feec33736b14518adcfe04c6528c522">MISCREG_CLIDR</a>:
<a name="l00534"></a>00534         <a class="code" href="base_2misc_8hh.html#abb243c15dfbeedf4ae64aa213f4f18c7">warn_once</a>(<span class="stringliteral">&quot;The clidr register always reports 0 caches.\n&quot;</span>);
<a name="l00535"></a>00535         <a class="code" href="base_2misc_8hh.html#abb243c15dfbeedf4ae64aa213f4f18c7">warn_once</a>(<span class="stringliteral">&quot;clidr LoUIS field of 0b001 to match current &quot;</span>
<a name="l00536"></a>00536                   <span class="stringliteral">&quot;ARM implementations.\n&quot;</span>);
<a name="l00537"></a>00537         <span class="keywordflow">return</span> 0x00200000;
<a name="l00538"></a>00538       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cae77eb577ec63504b8bcdab694febc75f">MISCREG_CCSIDR</a>:
<a name="l00539"></a>00539         <a class="code" href="base_2misc_8hh.html#abb243c15dfbeedf4ae64aa213f4f18c7">warn_once</a>(<span class="stringliteral">&quot;The ccsidr register isn&apos;t implemented and &quot;</span>
<a name="l00540"></a>00540                 <span class="stringliteral">&quot;always reads as 0.\n&quot;</span>);
<a name="l00541"></a>00541         <span class="keywordflow">break</span>;
<a name="l00542"></a>00542       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caad24ccdd262d2fda58c5818c16ce9d52">MISCREG_CTR</a>:
<a name="l00543"></a>00543         {
<a name="l00544"></a>00544             <span class="comment">//all caches have the same line size in gem5</span>
<a name="l00545"></a>00545             <span class="comment">//4 byte words in ARM</span>
<a name="l00546"></a>00546             <span class="keywordtype">unsigned</span> lineSizeWords =
<a name="l00547"></a>00547                 tc-&gt;<a class="code" href="classThreadContext.html#a119dd28f703f77bafb74788f8110300c">getSystemPtr</a>()-&gt;<a class="code" href="classSystem.html#a66b0c4a8be53793ead2007ea4aa7ea70" title="Get the cache line size of the system.">cacheLineSize</a>() / 4;
<a name="l00548"></a>00548             <span class="keywordtype">unsigned</span> log2LineSizeWords = 0;
<a name="l00549"></a>00549 
<a name="l00550"></a>00550             <span class="keywordflow">while</span> (lineSizeWords &gt;&gt;= 1) {
<a name="l00551"></a>00551                 ++log2LineSizeWords;
<a name="l00552"></a>00552             }
<a name="l00553"></a>00553 
<a name="l00554"></a>00554             CTR ctr = 0;
<a name="l00555"></a>00555             <span class="comment">//log2 of minimun i-cache line size (words)</span>
<a name="l00556"></a>00556             ctr.iCacheLineSize = log2LineSizeWords;
<a name="l00557"></a>00557             <span class="comment">//b11 - gem5 uses pipt</span>
<a name="l00558"></a>00558             ctr.l1IndexPolicy = 0x3;
<a name="l00559"></a>00559             <span class="comment">//log2 of minimum d-cache line size (words)</span>
<a name="l00560"></a>00560             ctr.dCacheLineSize = log2LineSizeWords;
<a name="l00561"></a>00561             <span class="comment">//log2 of max reservation size (words)</span>
<a name="l00562"></a>00562             ctr.erg = log2LineSizeWords;
<a name="l00563"></a>00563             <span class="comment">//log2 of max writeback size (words)</span>
<a name="l00564"></a>00564             ctr.cwg = log2LineSizeWords;
<a name="l00565"></a>00565             <span class="comment">//b100 - gem5 format is ARMv7</span>
<a name="l00566"></a>00566             ctr.format = 0x4;
<a name="l00567"></a>00567 
<a name="l00568"></a>00568             <span class="keywordflow">return</span> ctr;
<a name="l00569"></a>00569         }
<a name="l00570"></a>00570       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6827da006da460886fdcd488c3a119a0">MISCREG_ACTLR</a>:
<a name="l00571"></a>00571         <a class="code" href="base_2misc_8hh.html#a8224a361dddd2ad59b411982e5ea746f">warn</a>(<span class="stringliteral">&quot;Not doing anything for miscreg ACTLR\n&quot;</span>);
<a name="l00572"></a>00572         <span class="keywordflow">break</span>;
<a name="l00573"></a>00573 
<a name="l00574"></a>00574       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caeef899821c19dd5493d8bd98acffd4e4">MISCREG_PMXEVTYPER_PMCCFILTR</a>:
<a name="l00575"></a>00575       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca2085b2b651e11b2a29ef484a21f88173">MISCREG_PMINTENSET_EL1</a> ... <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cabc94068b71b9fc4fb93b1eb56beea516">MISCREG_PMOVSSET_EL0</a>:
<a name="l00576"></a>00576       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca23ff27da919b86d96764817c6e17da90">MISCREG_PMEVCNTR0_EL0</a> ... <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca9b4952560e9bd7ca38f5d510282937f6">MISCREG_PMEVTYPER5_EL0</a>:
<a name="l00577"></a>00577       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6c0878622bb5a09bfd8c9c2e2aee6ae7">MISCREG_PMCR</a> ... <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca5c4a6fba359353a9ce354a9a1d36ee6a">MISCREG_PMOVSSET</a>:
<a name="l00578"></a>00578         <span class="keywordflow">return</span> <a class="code" href="structArmISA_1_1ISA.html#a3399d9bc3fccb0d7321b6db8ec32e12e">pmu</a>-&gt;<a class="code" href="classArmISA_1_1BaseISADevice.html#a8c8948b1ca591266e3b19ece89869607" title="Read a system register belonging to this device.">readMiscReg</a>(misc_reg);
<a name="l00579"></a>00579 
<a name="l00580"></a>00580       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca433dee61bef8154a3532959bc919a16b">MISCREG_CPSR_Q</a>:
<a name="l00581"></a>00581         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;shouldn&apos;t be reading this register seperately\n&quot;</span>);
<a name="l00582"></a>00582       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caeed16351097472c356b961608e012a0e">MISCREG_FPSCR_QC</a>:
<a name="l00583"></a>00583         <span class="keywordflow">return</span> <a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca2c4f71a64cf54679d41471a7e0ca7664">MISCREG_FPSCR</a>) &amp; ~<a class="code" href="namespaceArmISA.html#a7e1718dd34f5135e284d42af8e3aa26d">FpscrQcMask</a>;
<a name="l00584"></a>00584       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca06562c3508fb0a2743cb7dd85b217a84">MISCREG_FPSCR_EXC</a>:
<a name="l00585"></a>00585         <span class="keywordflow">return</span> <a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca2c4f71a64cf54679d41471a7e0ca7664">MISCREG_FPSCR</a>) &amp; ~<a class="code" href="namespaceArmISA.html#a22037edf537f6b1d2d9156efa0726172">FpscrExcMask</a>;
<a name="l00586"></a>00586       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca41f3fa5f2b85d9748ee5d4264f67d6c3">MISCREG_FPSR</a>:
<a name="l00587"></a>00587         {
<a name="l00588"></a>00588             <span class="keyword">const</span> uint32_t ones = (uint32_t)(-1);
<a name="l00589"></a>00589             FPSCR fpscrMask = 0;
<a name="l00590"></a>00590             fpscrMask.ioc = ones;
<a name="l00591"></a>00591             fpscrMask.dzc = ones;
<a name="l00592"></a>00592             fpscrMask.ofc = ones;
<a name="l00593"></a>00593             fpscrMask.ufc = ones;
<a name="l00594"></a>00594             fpscrMask.ixc = ones;
<a name="l00595"></a>00595             fpscrMask.idc = ones;
<a name="l00596"></a>00596             fpscrMask.qc = ones;
<a name="l00597"></a>00597             fpscrMask.v = ones;
<a name="l00598"></a>00598             fpscrMask.c = ones;
<a name="l00599"></a>00599             fpscrMask.z = ones;
<a name="l00600"></a>00600             fpscrMask.n = ones;
<a name="l00601"></a>00601             <span class="keywordflow">return</span> <a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca2c4f71a64cf54679d41471a7e0ca7664">MISCREG_FPSCR</a>) &amp; (uint32_t)fpscrMask;
<a name="l00602"></a>00602         }
<a name="l00603"></a>00603       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca2b7a9afa7586c3f1bb44289b2aeba619">MISCREG_FPCR</a>:
<a name="l00604"></a>00604         {
<a name="l00605"></a>00605             <span class="keyword">const</span> uint32_t ones = (uint32_t)(-1);
<a name="l00606"></a>00606             FPSCR fpscrMask  = 0;
<a name="l00607"></a>00607             fpscrMask.ioe = ones;
<a name="l00608"></a>00608             fpscrMask.dze = ones;
<a name="l00609"></a>00609             fpscrMask.ofe = ones;
<a name="l00610"></a>00610             fpscrMask.ufe = ones;
<a name="l00611"></a>00611             fpscrMask.ixe = ones;
<a name="l00612"></a>00612             fpscrMask.ide = ones;
<a name="l00613"></a>00613             fpscrMask.len    = ones;
<a name="l00614"></a>00614             fpscrMask.stride = ones;
<a name="l00615"></a>00615             fpscrMask.rMode  = ones;
<a name="l00616"></a>00616             fpscrMask.fz     = ones;
<a name="l00617"></a>00617             fpscrMask.dn     = ones;
<a name="l00618"></a>00618             fpscrMask.ahp    = ones;
<a name="l00619"></a>00619             <span class="keywordflow">return</span> <a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca2c4f71a64cf54679d41471a7e0ca7664">MISCREG_FPSCR</a>) &amp; (uint32_t)fpscrMask;
<a name="l00620"></a>00620         }
<a name="l00621"></a>00621       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca087f90f8a16dcee78371adcf2462d8d2">MISCREG_NZCV</a>:
<a name="l00622"></a>00622         {
<a name="l00623"></a>00623             CPSR cpsr = 0;
<a name="l00624"></a>00624             cpsr.nz   = tc-&gt;<a class="code" href="classThreadContext.html#a0ad679d4a176414793e81b6f7b5ce575">readCCReg</a>(<a class="code" href="namespaceArmISA.html#afbab0e7d68feea024ad3248f7ad74375a6caf2afe46c16a29dcbdc5718ae95463">CCREG_NZ</a>);
<a name="l00625"></a>00625             cpsr.c    = tc-&gt;<a class="code" href="classThreadContext.html#a0ad679d4a176414793e81b6f7b5ce575">readCCReg</a>(<a class="code" href="namespaceArmISA.html#afbab0e7d68feea024ad3248f7ad74375af4aad7c6308575281c1a92a5a7ae3504">CCREG_C</a>);
<a name="l00626"></a>00626             cpsr.v    = tc-&gt;<a class="code" href="classThreadContext.html#a0ad679d4a176414793e81b6f7b5ce575">readCCReg</a>(<a class="code" href="namespaceArmISA.html#afbab0e7d68feea024ad3248f7ad74375a06d5ab8df8dab970d45cfe16408262bc">CCREG_V</a>);
<a name="l00627"></a>00627             <span class="keywordflow">return</span> cpsr;
<a name="l00628"></a>00628         }
<a name="l00629"></a>00629       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca91c269465cc875f5528de43581f3901a">MISCREG_DAIF</a>:
<a name="l00630"></a>00630         {
<a name="l00631"></a>00631             CPSR cpsr = 0;
<a name="l00632"></a>00632             cpsr.daif = (uint8_t) ((CPSR) <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca1d2df46d160cfa336591aaebdd6f99ba">MISCREG_CPSR</a>]).<a class="code" href="namespaceArmISA.html#ab94f7a6415286a6dcb0c58e3fe4f191e">daif</a>;
<a name="l00633"></a>00633             <span class="keywordflow">return</span> cpsr;
<a name="l00634"></a>00634         }
<a name="l00635"></a>00635       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cabb4600ac78743974130ebf8581b9beba">MISCREG_SP_EL0</a>:
<a name="l00636"></a>00636         {
<a name="l00637"></a>00637             <span class="keywordflow">return</span> tc-&gt;<a class="code" href="classThreadContext.html#a328471149b318afecfe5b52d9696bfdc">readIntReg</a>(<a class="code" href="namespaceArmISA.html#a28f9c55fc1ae496fd36bca4b09be4a5fa21fa949889362c27926c1965bb2073aa">INTREG_SP0</a>);
<a name="l00638"></a>00638         }
<a name="l00639"></a>00639       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cab42e1e8c6b691bc52dd4144ac05377d3">MISCREG_SP_EL1</a>:
<a name="l00640"></a>00640         {
<a name="l00641"></a>00641             <span class="keywordflow">return</span> tc-&gt;<a class="code" href="classThreadContext.html#a328471149b318afecfe5b52d9696bfdc">readIntReg</a>(<a class="code" href="namespaceArmISA.html#a28f9c55fc1ae496fd36bca4b09be4a5faebb0b7237f827c636a9b4dcb78697c51">INTREG_SP1</a>);
<a name="l00642"></a>00642         }
<a name="l00643"></a>00643       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caf5674665a5a4c9d27f6b42d0f34a2f6e">MISCREG_SP_EL2</a>:
<a name="l00644"></a>00644         {
<a name="l00645"></a>00645             <span class="keywordflow">return</span> tc-&gt;<a class="code" href="classThreadContext.html#a328471149b318afecfe5b52d9696bfdc">readIntReg</a>(<a class="code" href="namespaceArmISA.html#a28f9c55fc1ae496fd36bca4b09be4a5fa47d7f27a4ebfdf0d925d7e413a376243">INTREG_SP2</a>);
<a name="l00646"></a>00646         }
<a name="l00647"></a>00647       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cab2cbf3e305339d4934cb3c5972ccb16e">MISCREG_SPSEL</a>:
<a name="l00648"></a>00648         {
<a name="l00649"></a>00649             <span class="keywordflow">return</span> <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca1d2df46d160cfa336591aaebdd6f99ba">MISCREG_CPSR</a>] &amp; 0x1;
<a name="l00650"></a>00650         }
<a name="l00651"></a>00651       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cac2a12012517b99ae0a5e437c08abf980">MISCREG_CURRENTEL</a>:
<a name="l00652"></a>00652         {
<a name="l00653"></a>00653             <span class="keywordflow">return</span> <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca1d2df46d160cfa336591aaebdd6f99ba">MISCREG_CPSR</a>] &amp; 0xc;
<a name="l00654"></a>00654         }
<a name="l00655"></a>00655       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca4c0eb4a6ce76f0de03e15a2152f190ac">MISCREG_L2CTLR</a>:
<a name="l00656"></a>00656         {
<a name="l00657"></a>00657             <span class="comment">// mostly unimplemented, just set NumCPUs field from sim and return</span>
<a name="l00658"></a>00658             L2CTLR l2ctlr = 0;
<a name="l00659"></a>00659             <span class="comment">// b00:1CPU to b11:4CPUs</span>
<a name="l00660"></a>00660             l2ctlr.numCPUs = tc-&gt;<a class="code" href="classThreadContext.html#a119dd28f703f77bafb74788f8110300c">getSystemPtr</a>()-&gt;<a class="code" href="classSystem.html#ab123a0793826eea0796f70ec2b2e07f7">numContexts</a>() - 1;
<a name="l00661"></a>00661             <span class="keywordflow">return</span> l2ctlr;
<a name="l00662"></a>00662         }
<a name="l00663"></a>00663       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cafd6a9968c82040c289a1e8df818da64f">MISCREG_DBGDIDR</a>:
<a name="l00664"></a>00664         <span class="comment">/* For now just implement the version number.</span>
<a name="l00665"></a>00665 <span class="comment">         * ARMv7, v7.1 Debug architecture (0b0101 --&gt; 0x5)</span>
<a name="l00666"></a>00666 <span class="comment">         */</span>
<a name="l00667"></a>00667         <span class="keywordflow">return</span> 0x5 &lt;&lt; 16;
<a name="l00668"></a>00668       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cad0c33d11314b76e0a32fd3fbe22cdd80">MISCREG_DBGDSCRint</a>:
<a name="l00669"></a>00669         <span class="keywordflow">return</span> 0;
<a name="l00670"></a>00670       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caf84c258967a8d4832795785a8ac961b5">MISCREG_ISR</a>:
<a name="l00671"></a>00671         <span class="keywordflow">return</span> tc-&gt;<a class="code" href="classThreadContext.html#add24ea69a3c1a7862d25bec95f9bdc95">getCpuPtr</a>()-&gt;getInterruptController()-&gt;getISR(
<a name="l00672"></a>00672             <a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cacc6c0d54b3de785d3e9bd57250007f71">MISCREG_HCR</a>),
<a name="l00673"></a>00673             <a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca1d2df46d160cfa336591aaebdd6f99ba">MISCREG_CPSR</a>),
<a name="l00674"></a>00674             <a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6ec2fd6368d4b6668ee8155fc93d93b8">MISCREG_SCR</a>));
<a name="l00675"></a>00675       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cab29ca10d20ebdb11baa47750b1fdde80">MISCREG_ISR_EL1</a>:
<a name="l00676"></a>00676         <span class="keywordflow">return</span> tc-&gt;<a class="code" href="classThreadContext.html#add24ea69a3c1a7862d25bec95f9bdc95">getCpuPtr</a>()-&gt;getInterruptController()-&gt;getISR(
<a name="l00677"></a>00677             <a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caf7b3320067d0141f9d3e408adb3200ea">MISCREG_HCR_EL2</a>),
<a name="l00678"></a>00678             <a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca1d2df46d160cfa336591aaebdd6f99ba">MISCREG_CPSR</a>),
<a name="l00679"></a>00679             <a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca25e01e2437793648b59e468b134153e4">MISCREG_SCR_EL3</a>));
<a name="l00680"></a>00680       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caa2ee3b8cc1e57624465775ccb4b83a51">MISCREG_DCZID_EL0</a>:
<a name="l00681"></a>00681         <span class="keywordflow">return</span> 0x04;  <span class="comment">// DC ZVA clear 64-byte chunks</span>
<a name="l00682"></a>00682       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cae4a87918573b1f768605e2b9d9d8997f">MISCREG_HCPTR</a>:
<a name="l00683"></a>00683         {
<a name="l00684"></a>00684             <a class="code" href="namespaceArmISA.html#ae6de70120f06c08f390947f9e5cf7f7a">MiscReg</a> val = <a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(misc_reg);
<a name="l00685"></a>00685             <span class="comment">// The trap bit associated with CP14 is defined as RAZ</span>
<a name="l00686"></a>00686             val &amp;= ~(1 &lt;&lt; 14);
<a name="l00687"></a>00687             <span class="comment">// If a CP bit in NSACR is 0 then the corresponding bit in</span>
<a name="l00688"></a>00688             <span class="comment">// HCPTR is RAO/WI</span>
<a name="l00689"></a>00689             <span class="keywordtype">bool</span> secure_lookup = <a class="code" href="structArmISA_1_1ISA.html#a2b5cf38edef41a2219914fabbe91bca9">haveSecurity</a> &amp;&amp;
<a name="l00690"></a>00690                 <a class="code" href="namespaceArmISA.html#abb263f4ec2a2852ac26b5c33c6f5897b">inSecureState</a>(<a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6ec2fd6368d4b6668ee8155fc93d93b8">MISCREG_SCR</a>),
<a name="l00691"></a>00691                               <a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca1d2df46d160cfa336591aaebdd6f99ba">MISCREG_CPSR</a>));
<a name="l00692"></a>00692             <span class="keywordflow">if</span> (!secure_lookup) {
<a name="l00693"></a>00693                 <a class="code" href="namespaceArmISA.html#ae6de70120f06c08f390947f9e5cf7f7a">MiscReg</a> <a class="code" href="namespaceArmISA.html#aedf8742bbf65a60cf102a4b3f9ba3d68">mask</a> = <a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca227ca1dc43b4cc7be618d433e8e9bf07">MISCREG_NSACR</a>);
<a name="l00694"></a>00694                 val |= (mask ^ 0x7FFF) &amp; 0xBFFF;
<a name="l00695"></a>00695             }
<a name="l00696"></a>00696             <span class="comment">// Set the bits for unimplemented coprocessors to RAO/WI</span>
<a name="l00697"></a>00697             val |= 0x33FF;
<a name="l00698"></a>00698             <span class="keywordflow">return</span> (val);
<a name="l00699"></a>00699         }
<a name="l00700"></a>00700       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca52f0ff1daa8b976035d238029243ec9a">MISCREG_HDFAR</a>: <span class="comment">// alias for secure DFAR</span>
<a name="l00701"></a>00701         <span class="keywordflow">return</span> <a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca70221da844bfb51ee592e571c59d8499">MISCREG_DFAR_S</a>);
<a name="l00702"></a>00702       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca52a41307defcb5fb997785be15877013">MISCREG_HIFAR</a>: <span class="comment">// alias for secure IFAR</span>
<a name="l00703"></a>00703         <span class="keywordflow">return</span> <a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca3c24661983e158c2111c319db6fd4259">MISCREG_IFAR_S</a>);
<a name="l00704"></a>00704       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cad31e9d4cb740f361765b5604985f048f">MISCREG_HVBAR</a>: <span class="comment">// bottom bits reserved</span>
<a name="l00705"></a>00705         <span class="keywordflow">return</span> <a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cad31e9d4cb740f361765b5604985f048f">MISCREG_HVBAR</a>) &amp; 0xFFFFFFE0;
<a name="l00706"></a>00706       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca540af25d1d321d1891bf4d9292c227c1">MISCREG_SCTLR</a>: <span class="comment">// Some bits hardwired</span>
<a name="l00707"></a>00707         <span class="comment">// The FI field (bit 21) is common between S/NS versions of the register</span>
<a name="l00708"></a>00708         <span class="keywordflow">return</span> (<a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caad47953fcca722f8446003f5e293569f">MISCREG_SCTLR_S</a>) &amp; (1 &lt;&lt; 21))  |
<a name="l00709"></a>00709                (<a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(misc_reg)        &amp; 0x72DD39FF) | 0x00C00818; <span class="comment">// V8 SCTLR</span>
<a name="l00710"></a>00710       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6a053ea48f0a33993f665a3583be7cce">MISCREG_SCTLR_EL1</a>:
<a name="l00711"></a>00711         <span class="comment">// The FI field (bit 21) is common between S/NS versions of the register</span>
<a name="l00712"></a>00712         <span class="keywordflow">return</span> (<a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caad47953fcca722f8446003f5e293569f">MISCREG_SCTLR_S</a>) &amp; (1 &lt;&lt; 21))  |
<a name="l00713"></a>00713                (<a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(misc_reg)        &amp; 0x37DDDBFF) | 0x30D00800; <span class="comment">// V8 SCTLR_EL1</span>
<a name="l00714"></a>00714       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca0b410ff413a02c9b8979d026cb151bcc">MISCREG_SCTLR_EL3</a>:
<a name="l00715"></a>00715         <span class="comment">// The FI field (bit 21) is common between S/NS versions of the register</span>
<a name="l00716"></a>00716         <span class="keywordflow">return</span> (<a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caad47953fcca722f8446003f5e293569f">MISCREG_SCTLR_S</a>) &amp; (1 &lt;&lt; 21))  |
<a name="l00717"></a>00717                (<a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(misc_reg)        &amp; 0x32CD183F) | 0x30C50830; <span class="comment">// V8 SCTLR_EL3</span>
<a name="l00718"></a>00718       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca5a527cd4f6298497a08d3a0b3ecc9e99">MISCREG_HSCTLR</a>: <span class="comment">// FI comes from SCTLR</span>
<a name="l00719"></a>00719         {
<a name="l00720"></a>00720             uint32_t <a class="code" href="namespaceArmISA.html#aedf8742bbf65a60cf102a4b3f9ba3d68">mask</a> = 1 &lt;&lt; 27;
<a name="l00721"></a>00721             <span class="keywordflow">return</span> (<a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca5a527cd4f6298497a08d3a0b3ecc9e99">MISCREG_HSCTLR</a>) &amp; ~mask) |
<a name="l00722"></a>00722                 (<a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca540af25d1d321d1891bf4d9292c227c1">MISCREG_SCTLR</a>)  &amp;  mask);
<a name="l00723"></a>00723         }
<a name="l00724"></a>00724       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6ec2fd6368d4b6668ee8155fc93d93b8">MISCREG_SCR</a>:
<a name="l00725"></a>00725         {
<a name="l00726"></a>00726             CPSR cpsr = <a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca1d2df46d160cfa336591aaebdd6f99ba">MISCREG_CPSR</a>);
<a name="l00727"></a>00727             <span class="keywordflow">if</span> (cpsr.width) {
<a name="l00728"></a>00728                 <span class="keywordflow">return</span> <a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6ec2fd6368d4b6668ee8155fc93d93b8">MISCREG_SCR</a>);
<a name="l00729"></a>00729             } <span class="keywordflow">else</span> {
<a name="l00730"></a>00730                 <span class="keywordflow">return</span> <a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca25e01e2437793648b59e468b134153e4">MISCREG_SCR_EL3</a>);
<a name="l00731"></a>00731             }
<a name="l00732"></a>00732         }
<a name="l00733"></a>00733 
<a name="l00734"></a>00734       <span class="comment">// Generic Timer registers</span>
<a name="l00735"></a>00735       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca0f74fcabaec0585fa64fdd5320ac8460">MISCREG_CNTFRQ</a> ... <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca145142160e70a4a7f8201eb06236a6db">MISCREG_CNTHP_CTL</a>:
<a name="l00736"></a>00736       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca5b48045b79595b2d016c3d11c39f4882">MISCREG_CNTPCT</a> ... <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cada0a86c3391596b18b194e09c8d34c69">MISCREG_CNTHP_CVAL</a>:
<a name="l00737"></a>00737       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca7aee5179ce9c4ec339670c2ee5c09fb5">MISCREG_CNTKCTL_EL1</a> ... <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca255138f5bb2c4542e7a935eef561dd5c">MISCREG_CNTV_CVAL_EL0</a>:
<a name="l00738"></a>00738       <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caed2d1d95ea9004de926f3e66e14be983">MISCREG_CNTVOFF_EL2</a> ... <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca2ee954daabf9280f901a7ff40f55123c">MISCREG_CNTPS_CVAL_EL1</a>:
<a name="l00739"></a>00739         <span class="keywordflow">return</span> <a class="code" href="structArmISA_1_1ISA.html#a1aa959f5c3a1167ba91011df43909098">getGenericTimer</a>(tc).<a class="code" href="classArmISA_1_1BaseISADevice.html#a8c8948b1ca591266e3b19ece89869607" title="Read a system register belonging to this device.">readMiscReg</a>(misc_reg);
<a name="l00740"></a>00740 
<a name="l00741"></a>00741       <span class="keywordflow">default</span>:
<a name="l00742"></a>00742         <span class="keywordflow">break</span>;
<a name="l00743"></a>00743 
<a name="l00744"></a>00744     }
<a name="l00745"></a>00745     <span class="keywordflow">return</span> <a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(misc_reg);
<a name="l00746"></a>00746 }
<a name="l00747"></a>00747 
<a name="l00748"></a>00748 <span class="keywordtype">void</span>
<a name="l00749"></a>00749 <a class="code" href="structArmISA_1_1ISA.html#a90cbf55664f2b0de9bea7be53a56cf2e">ISA::setMiscRegNoEffect</a>(<span class="keywordtype">int</span> misc_reg, <span class="keyword">const</span> <a class="code" href="namespaceArmISA.html#ae6de70120f06c08f390947f9e5cf7f7a">MiscReg</a> &amp;val)
<a name="l00750"></a>00750 {
<a name="l00751"></a>00751     assert(misc_reg &lt; <a class="code" href="namespaceArmISA.html#af51c226f6d8f413a1d210ea0c9ece771">NumMiscRegs</a>);
<a name="l00752"></a>00752 
<a name="l00753"></a>00753     <span class="keywordtype">int</span> flat_idx = <a class="code" href="structArmISA_1_1ISA.html#a17eaa0e5b086dd8f54241e876c510228">flattenMiscIndex</a>(misc_reg);  <span class="comment">// Note: indexes of AArch64</span>
<a name="l00754"></a>00754                                                 <span class="comment">// registers are left unchanged</span>
<a name="l00755"></a>00755 
<a name="l00756"></a>00756     <span class="keywordtype">int</span> flat_idx2 = <a class="code" href="structArmISA_1_1ISA.html#a49d05393cb7ad28cf9b830e80c357029" title="Translation table accessible via the value of the register.">lookUpMiscReg</a>[flat_idx].upper;
<a name="l00757"></a>00757 
<a name="l00758"></a>00758     <span class="keywordflow">if</span> (flat_idx2 &gt; 0) {
<a name="l00759"></a>00759         <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="structArmISA_1_1ISA.html#a49d05393cb7ad28cf9b830e80c357029" title="Translation table accessible via the value of the register.">lookUpMiscReg</a>[flat_idx].lower] = <a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123" title="Extract the bitfield from position &amp;#39;first&amp;#39; to &amp;#39;last&amp;#39; (inclusive)...">bits</a>(val, 31, 0);
<a name="l00760"></a>00760         <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[flat_idx2] = <a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123" title="Extract the bitfield from position &amp;#39;first&amp;#39; to &amp;#39;last&amp;#39; (inclusive)...">bits</a>(val, 63, 32);
<a name="l00761"></a>00761         <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(MiscRegs, <span class="stringliteral">&quot;Writing to misc reg %d (%d:%d) : %#x\n&quot;</span>,
<a name="l00762"></a>00762                 misc_reg, flat_idx, flat_idx2, val);
<a name="l00763"></a>00763     } <span class="keywordflow">else</span> {
<a name="l00764"></a>00764         <span class="keywordflow">if</span> (flat_idx == <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca629c5a91c7c38b30701184fd3e8c19b8">MISCREG_SPSR</a>)
<a name="l00765"></a>00765             flat_idx = <a class="code" href="structArmISA_1_1ISA.html#a17eaa0e5b086dd8f54241e876c510228">flattenMiscIndex</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca629c5a91c7c38b30701184fd3e8c19b8">MISCREG_SPSR</a>);
<a name="l00766"></a>00766         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (flat_idx == <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6a053ea48f0a33993f665a3583be7cce">MISCREG_SCTLR_EL1</a>)
<a name="l00767"></a>00767             flat_idx = <a class="code" href="structArmISA_1_1ISA.html#a17eaa0e5b086dd8f54241e876c510228">flattenMiscIndex</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca540af25d1d321d1891bf4d9292c227c1">MISCREG_SCTLR</a>);
<a name="l00768"></a>00768         <span class="keywordflow">else</span>
<a name="l00769"></a>00769             flat_idx = (<a class="code" href="structArmISA_1_1ISA.html#a49d05393cb7ad28cf9b830e80c357029" title="Translation table accessible via the value of the register.">lookUpMiscReg</a>[flat_idx].lower &gt; 0) ?
<a name="l00770"></a>00770                        <a class="code" href="structArmISA_1_1ISA.html#a49d05393cb7ad28cf9b830e80c357029" title="Translation table accessible via the value of the register.">lookUpMiscReg</a>[flat_idx].lower : flat_idx;
<a name="l00771"></a>00771         <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[flat_idx] = val;
<a name="l00772"></a>00772         <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(MiscRegs, <span class="stringliteral">&quot;Writing to misc reg %d (%d) : %#x\n&quot;</span>,
<a name="l00773"></a>00773                 misc_reg, flat_idx, val);
<a name="l00774"></a>00774     }
<a name="l00775"></a>00775 }
<a name="l00776"></a>00776 
<a name="l00777"></a>00777 <span class="keywordtype">void</span>
<a name="l00778"></a>00778 <a class="code" href="structArmISA_1_1ISA.html#adb4a00afe934b881dbb38647a608e14f">ISA::setMiscReg</a>(<span class="keywordtype">int</span> misc_reg, <span class="keyword">const</span> <a class="code" href="namespaceArmISA.html#ae6de70120f06c08f390947f9e5cf7f7a">MiscReg</a> &amp;val, <a class="code" href="classThreadContext.html" title="ThreadContext is the external interface to all thread state for anything outside...">ThreadContext</a> *tc)
<a name="l00779"></a>00779 {
<a name="l00780"></a>00780 
<a name="l00781"></a>00781     <a class="code" href="namespaceArmISA.html#ae6de70120f06c08f390947f9e5cf7f7a">MiscReg</a> newVal = val;
<a name="l00782"></a>00782     <span class="keywordtype">int</span> <a class="code" href="namespaceX86ISA.html#a7329cbd3da39e27c5b311899bac95a04">x</a>;
<a name="l00783"></a>00783     <span class="keywordtype">bool</span> secure_lookup;
<a name="l00784"></a>00784     <span class="keywordtype">bool</span> hyp;
<a name="l00785"></a>00785     <a class="code" href="classSystem.html">System</a> *sys;
<a name="l00786"></a>00786     <a class="code" href="classThreadContext.html" title="ThreadContext is the external interface to all thread state for anything outside...">ThreadContext</a> *oc;
<a name="l00787"></a>00787     uint8_t target_el;
<a name="l00788"></a>00788     uint16_t <a class="code" href="namespaceArmISA.html#aaff4c7c57057268242cad9e94c8ff5d7">asid</a>;
<a name="l00789"></a>00789     SCR scr;
<a name="l00790"></a>00790 
<a name="l00791"></a>00791     <span class="keywordflow">if</span> (misc_reg == <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca1d2df46d160cfa336591aaebdd6f99ba">MISCREG_CPSR</a>) {
<a name="l00792"></a>00792         <a class="code" href="structArmISA_1_1ISA.html#ae9bde810329001eee4820b6a26bb17b8">updateRegMap</a>(val);
<a name="l00793"></a>00793 
<a name="l00794"></a>00794 
<a name="l00795"></a>00795         CPSR old_cpsr = <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca1d2df46d160cfa336591aaebdd6f99ba">MISCREG_CPSR</a>];
<a name="l00796"></a>00796         <span class="keywordtype">int</span> old_mode = old_cpsr.mode;
<a name="l00797"></a>00797         CPSR cpsr = val;
<a name="l00798"></a>00798         <span class="keywordflow">if</span> (old_mode != cpsr.mode) {
<a name="l00799"></a>00799             tc-&gt;<a class="code" href="classThreadContext.html#a71910c6ab34a67cb0bc65dbc874cbb27">getITBPtr</a>()-&gt;invalidateMiscReg();
<a name="l00800"></a>00800             tc-&gt;<a class="code" href="classThreadContext.html#a66f0298b284053daa1f4318c585c091f">getDTBPtr</a>()-&gt;invalidateMiscReg();
<a name="l00801"></a>00801         }
<a name="l00802"></a>00802 
<a name="l00803"></a>00803         <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Arm, <span class="stringliteral">&quot;Updating CPSR from %#x to %#x f:%d i:%d a:%d mode:%#x\n&quot;</span>,
<a name="l00804"></a>00804                 <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[misc_reg], cpsr, cpsr.f, cpsr.i, cpsr.a, cpsr.mode);
<a name="l00805"></a>00805         <a class="code" href="namespaceAlphaISA.html#a233e755911c9143f96bef37eedb1e009">PCState</a> pc = tc-&gt;<a class="code" href="classThreadContext.html#ab15f0db0e7c7afb40dfbbbd13d62dc2e">pcState</a>();
<a name="l00806"></a>00806         pc.nextThumb(cpsr.t);
<a name="l00807"></a>00807         pc.nextJazelle(cpsr.j);
<a name="l00808"></a>00808 
<a name="l00809"></a>00809         <span class="comment">// Follow slightly different semantics if a CheckerCPU object</span>
<a name="l00810"></a>00810         <span class="comment">// is connected</span>
<a name="l00811"></a>00811         <a class="code" href="classCheckerCPU.html" title="CheckerCPU class.">CheckerCPU</a> *checker = tc-&gt;<a class="code" href="classThreadContext.html#a594e114a4cc2ff653bc8a30fe49b986b">getCheckerCpuPtr</a>();
<a name="l00812"></a>00812         <span class="keywordflow">if</span> (checker) {
<a name="l00813"></a>00813             tc-&gt;<a class="code" href="classThreadContext.html#aa14e914ae572dfff033c3efb3d06d896">pcStateNoRecord</a>(pc);
<a name="l00814"></a>00814         } <span class="keywordflow">else</span> {
<a name="l00815"></a>00815             tc-&gt;<a class="code" href="classThreadContext.html#ab15f0db0e7c7afb40dfbbbd13d62dc2e">pcState</a>(pc);
<a name="l00816"></a>00816         }
<a name="l00817"></a>00817     } <span class="keywordflow">else</span> {
<a name="l00818"></a>00818 <span class="preprocessor">#ifndef NDEBUG</span>
<a name="l00819"></a>00819 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (!<a class="code" href="namespaceArmISA.html#a5acac006216a2ea59125ca03fe16de1c">miscRegInfo</a>[misc_reg][MISCREG_IMPLEMENTED]) {
<a name="l00820"></a>00820             <span class="keywordflow">if</span> (<a class="code" href="namespaceArmISA.html#a5acac006216a2ea59125ca03fe16de1c">miscRegInfo</a>[misc_reg][<a class="code" href="namespaceArmISA.html#acbfe4414fa174a85a2473fcdcd7b829aad1d3caec9105e35f8e05448a4724b016">MISCREG_WARN_NOT_FAIL</a>])
<a name="l00821"></a>00821                 <a class="code" href="base_2misc_8hh.html#a8224a361dddd2ad59b411982e5ea746f">warn</a>(<span class="stringliteral">&quot;Unimplemented system register %s write with %#x.\n&quot;</span>,
<a name="l00822"></a>00822                     <a class="code" href="namespaceArmISA.html#a86b05be1092b70a38660616b2b7e6793">miscRegName</a>[misc_reg], val);
<a name="l00823"></a>00823             <span class="keywordflow">else</span>
<a name="l00824"></a>00824                 <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Unimplemented system register %s write with %#x.\n&quot;</span>,
<a name="l00825"></a>00825                     <a class="code" href="namespaceArmISA.html#a86b05be1092b70a38660616b2b7e6793">miscRegName</a>[misc_reg], val);
<a name="l00826"></a>00826         }
<a name="l00827"></a>00827 <span class="preprocessor">#endif</span>
<a name="l00828"></a>00828 <span class="preprocessor"></span>        <span class="keywordflow">switch</span> (<a class="code" href="namespaceArmISA.html#aed4783414a4ae046bb75551deff7e829">unflattenMiscReg</a>(misc_reg)) {
<a name="l00829"></a>00829           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca56f5859b27c49381dd9e0d7f3310565d">MISCREG_CPACR</a>:
<a name="l00830"></a>00830             {
<a name="l00831"></a>00831 
<a name="l00832"></a>00832                 <span class="keyword">const</span> uint32_t ones = (uint32_t)(-1);
<a name="l00833"></a>00833                 CPACR cpacrMask = 0;
<a name="l00834"></a>00834                 <span class="comment">// Only cp10, cp11, and ase are implemented, nothing else should</span>
<a name="l00835"></a>00835                 <span class="comment">// be writable</span>
<a name="l00836"></a>00836                 cpacrMask.cp10 = ones;
<a name="l00837"></a>00837                 cpacrMask.cp11 = ones;
<a name="l00838"></a>00838                 cpacrMask.asedis = ones;
<a name="l00839"></a>00839 
<a name="l00840"></a>00840                 <span class="comment">// Security Extensions may limit the writability of CPACR</span>
<a name="l00841"></a>00841                 <span class="keywordflow">if</span> (<a class="code" href="structArmISA_1_1ISA.html#a2b5cf38edef41a2219914fabbe91bca9">haveSecurity</a>) {
<a name="l00842"></a>00842                     scr = <a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6ec2fd6368d4b6668ee8155fc93d93b8">MISCREG_SCR</a>);
<a name="l00843"></a>00843                     CPSR cpsr = <a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca1d2df46d160cfa336591aaebdd6f99ba">MISCREG_CPSR</a>);
<a name="l00844"></a>00844                     <span class="keywordflow">if</span> (scr.ns &amp;&amp; (cpsr.mode != <a class="code" href="namespaceArmISA.html#a5e5caf7b8ca343e256c2ac66262990caaedd810eb5d1b0c2632821f8b7abc0fe0">MODE_MON</a>)) {
<a name="l00845"></a>00845                         NSACR nsacr = <a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca227ca1dc43b4cc7be618d433e8e9bf07">MISCREG_NSACR</a>);
<a name="l00846"></a>00846                         <span class="comment">// NB: Skipping the full loop, here</span>
<a name="l00847"></a>00847                         <span class="keywordflow">if</span> (!nsacr.cp10) cpacrMask.cp10 = 0;
<a name="l00848"></a>00848                         <span class="keywordflow">if</span> (!nsacr.cp11) cpacrMask.cp11 = 0;
<a name="l00849"></a>00849                     }
<a name="l00850"></a>00850                 }
<a name="l00851"></a>00851 
<a name="l00852"></a>00852                 <a class="code" href="namespaceArmISA.html#ae6de70120f06c08f390947f9e5cf7f7a">MiscReg</a> old_val = <a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca56f5859b27c49381dd9e0d7f3310565d">MISCREG_CPACR</a>);
<a name="l00853"></a>00853                 newVal &amp;= cpacrMask;
<a name="l00854"></a>00854                 newVal |= old_val &amp; ~cpacrMask;
<a name="l00855"></a>00855                 <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(MiscRegs, <span class="stringliteral">&quot;Writing misc reg %s: %#x\n&quot;</span>,
<a name="l00856"></a>00856                         <a class="code" href="namespaceArmISA.html#a86b05be1092b70a38660616b2b7e6793">miscRegName</a>[misc_reg], newVal);
<a name="l00857"></a>00857             }
<a name="l00858"></a>00858             <span class="keywordflow">break</span>;
<a name="l00859"></a>00859           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6314fd451148954c2a66286c04cefdaf">MISCREG_CPACR_EL1</a>:
<a name="l00860"></a>00860             {
<a name="l00861"></a>00861                 <span class="keyword">const</span> uint32_t ones = (uint32_t)(-1);
<a name="l00862"></a>00862                 CPACR cpacrMask = 0;
<a name="l00863"></a>00863                 cpacrMask.tta = ones;
<a name="l00864"></a>00864                 cpacrMask.fpen = ones;
<a name="l00865"></a>00865                 newVal &amp;= cpacrMask;
<a name="l00866"></a>00866                 <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(MiscRegs, <span class="stringliteral">&quot;Writing misc reg %s: %#x\n&quot;</span>,
<a name="l00867"></a>00867                         <a class="code" href="namespaceArmISA.html#a86b05be1092b70a38660616b2b7e6793">miscRegName</a>[misc_reg], newVal);
<a name="l00868"></a>00868             }
<a name="l00869"></a>00869             <span class="keywordflow">break</span>;
<a name="l00870"></a>00870           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca47def05a9be0494d6ad9553885cc09c5">MISCREG_CPTR_EL2</a>:
<a name="l00871"></a>00871             {
<a name="l00872"></a>00872                 <span class="keyword">const</span> uint32_t ones = (uint32_t)(-1);
<a name="l00873"></a>00873                 CPTR cptrMask = 0;
<a name="l00874"></a>00874                 cptrMask.tcpac = ones;
<a name="l00875"></a>00875                 cptrMask.tta = ones;
<a name="l00876"></a>00876                 cptrMask.tfp = ones;
<a name="l00877"></a>00877                 newVal &amp;= cptrMask;
<a name="l00878"></a>00878                 cptrMask = 0;
<a name="l00879"></a>00879                 cptrMask.res1_13_12_el2 = ones;
<a name="l00880"></a>00880                 cptrMask.res1_9_0_el2 = ones;
<a name="l00881"></a>00881                 newVal |= cptrMask;
<a name="l00882"></a>00882                 <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(MiscRegs, <span class="stringliteral">&quot;Writing misc reg %s: %#x\n&quot;</span>,
<a name="l00883"></a>00883                         <a class="code" href="namespaceArmISA.html#a86b05be1092b70a38660616b2b7e6793">miscRegName</a>[misc_reg], newVal);
<a name="l00884"></a>00884             }
<a name="l00885"></a>00885             <span class="keywordflow">break</span>;
<a name="l00886"></a>00886           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca682e050ac376ea746a94e3f0be8768f9">MISCREG_CPTR_EL3</a>:
<a name="l00887"></a>00887             {
<a name="l00888"></a>00888                 <span class="keyword">const</span> uint32_t ones = (uint32_t)(-1);
<a name="l00889"></a>00889                 CPTR cptrMask = 0;
<a name="l00890"></a>00890                 cptrMask.tcpac = ones;
<a name="l00891"></a>00891                 cptrMask.tta = ones;
<a name="l00892"></a>00892                 cptrMask.tfp = ones;
<a name="l00893"></a>00893                 newVal &amp;= cptrMask;
<a name="l00894"></a>00894                 <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(MiscRegs, <span class="stringliteral">&quot;Writing misc reg %s: %#x\n&quot;</span>,
<a name="l00895"></a>00895                         <a class="code" href="namespaceArmISA.html#a86b05be1092b70a38660616b2b7e6793">miscRegName</a>[misc_reg], newVal);
<a name="l00896"></a>00896             }
<a name="l00897"></a>00897             <span class="keywordflow">break</span>;
<a name="l00898"></a>00898           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca3c709b276a04ec5ca9ee382b797dfcc5">MISCREG_CSSELR</a>:
<a name="l00899"></a>00899             <a class="code" href="base_2misc_8hh.html#abb243c15dfbeedf4ae64aa213f4f18c7">warn_once</a>(<span class="stringliteral">&quot;The csselr register isn&apos;t implemented.\n&quot;</span>);
<a name="l00900"></a>00900             <span class="keywordflow">return</span>;
<a name="l00901"></a>00901 
<a name="l00902"></a>00902           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca67e1cf2bf863f32eaddb0b0597f48099">MISCREG_DC_ZVA_Xt</a>:
<a name="l00903"></a>00903             <a class="code" href="base_2misc_8hh.html#a8224a361dddd2ad59b411982e5ea746f">warn</a>(<span class="stringliteral">&quot;Calling DC ZVA! Not Implemeted! Expect WEIRD results\n&quot;</span>);
<a name="l00904"></a>00904             <span class="keywordflow">return</span>;
<a name="l00905"></a>00905 
<a name="l00906"></a>00906           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca2c4f71a64cf54679d41471a7e0ca7664">MISCREG_FPSCR</a>:
<a name="l00907"></a>00907             {
<a name="l00908"></a>00908                 <span class="keyword">const</span> uint32_t ones = (uint32_t)(-1);
<a name="l00909"></a>00909                 FPSCR fpscrMask = 0;
<a name="l00910"></a>00910                 fpscrMask.ioc = ones;
<a name="l00911"></a>00911                 fpscrMask.dzc = ones;
<a name="l00912"></a>00912                 fpscrMask.ofc = ones;
<a name="l00913"></a>00913                 fpscrMask.ufc = ones;
<a name="l00914"></a>00914                 fpscrMask.ixc = ones;
<a name="l00915"></a>00915                 fpscrMask.idc = ones;
<a name="l00916"></a>00916                 fpscrMask.ioe = ones;
<a name="l00917"></a>00917                 fpscrMask.dze = ones;
<a name="l00918"></a>00918                 fpscrMask.ofe = ones;
<a name="l00919"></a>00919                 fpscrMask.ufe = ones;
<a name="l00920"></a>00920                 fpscrMask.ixe = ones;
<a name="l00921"></a>00921                 fpscrMask.ide = ones;
<a name="l00922"></a>00922                 fpscrMask.len = ones;
<a name="l00923"></a>00923                 fpscrMask.stride = ones;
<a name="l00924"></a>00924                 fpscrMask.rMode = ones;
<a name="l00925"></a>00925                 fpscrMask.fz = ones;
<a name="l00926"></a>00926                 fpscrMask.dn = ones;
<a name="l00927"></a>00927                 fpscrMask.ahp = ones;
<a name="l00928"></a>00928                 fpscrMask.qc = ones;
<a name="l00929"></a>00929                 fpscrMask.v = ones;
<a name="l00930"></a>00930                 fpscrMask.c = ones;
<a name="l00931"></a>00931                 fpscrMask.z = ones;
<a name="l00932"></a>00932                 fpscrMask.n = ones;
<a name="l00933"></a>00933                 newVal = (newVal &amp; (uint32_t)fpscrMask) |
<a name="l00934"></a>00934                          (<a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca2c4f71a64cf54679d41471a7e0ca7664">MISCREG_FPSCR</a>) &amp;
<a name="l00935"></a>00935                           ~(uint32_t)fpscrMask);
<a name="l00936"></a>00936                 tc-&gt;<a class="code" href="classThreadContext.html#a8e70eee48e3846e8eb7ed55b085f9c7d">getDecoderPtr</a>()-&gt;setContext(newVal);
<a name="l00937"></a>00937             }
<a name="l00938"></a>00938             <span class="keywordflow">break</span>;
<a name="l00939"></a>00939           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca41f3fa5f2b85d9748ee5d4264f67d6c3">MISCREG_FPSR</a>:
<a name="l00940"></a>00940             {
<a name="l00941"></a>00941                 <span class="keyword">const</span> uint32_t ones = (uint32_t)(-1);
<a name="l00942"></a>00942                 FPSCR fpscrMask = 0;
<a name="l00943"></a>00943                 fpscrMask.ioc = ones;
<a name="l00944"></a>00944                 fpscrMask.dzc = ones;
<a name="l00945"></a>00945                 fpscrMask.ofc = ones;
<a name="l00946"></a>00946                 fpscrMask.ufc = ones;
<a name="l00947"></a>00947                 fpscrMask.ixc = ones;
<a name="l00948"></a>00948                 fpscrMask.idc = ones;
<a name="l00949"></a>00949                 fpscrMask.qc = ones;
<a name="l00950"></a>00950                 fpscrMask.v = ones;
<a name="l00951"></a>00951                 fpscrMask.c = ones;
<a name="l00952"></a>00952                 fpscrMask.z = ones;
<a name="l00953"></a>00953                 fpscrMask.n = ones;
<a name="l00954"></a>00954                 newVal = (newVal &amp; (uint32_t)fpscrMask) |
<a name="l00955"></a>00955                          (<a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca2c4f71a64cf54679d41471a7e0ca7664">MISCREG_FPSCR</a>) &amp;
<a name="l00956"></a>00956                           ~(uint32_t)fpscrMask);
<a name="l00957"></a>00957                 misc_reg = <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca2c4f71a64cf54679d41471a7e0ca7664">MISCREG_FPSCR</a>;
<a name="l00958"></a>00958             }
<a name="l00959"></a>00959             <span class="keywordflow">break</span>;
<a name="l00960"></a>00960           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca2b7a9afa7586c3f1bb44289b2aeba619">MISCREG_FPCR</a>:
<a name="l00961"></a>00961             {
<a name="l00962"></a>00962                 <span class="keyword">const</span> uint32_t ones = (uint32_t)(-1);
<a name="l00963"></a>00963                 FPSCR fpscrMask  = 0;
<a name="l00964"></a>00964                 fpscrMask.ioe = ones;
<a name="l00965"></a>00965                 fpscrMask.dze = ones;
<a name="l00966"></a>00966                 fpscrMask.ofe = ones;
<a name="l00967"></a>00967                 fpscrMask.ufe = ones;
<a name="l00968"></a>00968                 fpscrMask.ixe = ones;
<a name="l00969"></a>00969                 fpscrMask.ide = ones;
<a name="l00970"></a>00970                 fpscrMask.len    = ones;
<a name="l00971"></a>00971                 fpscrMask.stride = ones;
<a name="l00972"></a>00972                 fpscrMask.rMode  = ones;
<a name="l00973"></a>00973                 fpscrMask.fz     = ones;
<a name="l00974"></a>00974                 fpscrMask.dn     = ones;
<a name="l00975"></a>00975                 fpscrMask.ahp    = ones;
<a name="l00976"></a>00976                 newVal = (newVal &amp; (uint32_t)fpscrMask) |
<a name="l00977"></a>00977                          (<a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca2c4f71a64cf54679d41471a7e0ca7664">MISCREG_FPSCR</a>) &amp;
<a name="l00978"></a>00978                           ~(uint32_t)fpscrMask);
<a name="l00979"></a>00979                 misc_reg = <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca2c4f71a64cf54679d41471a7e0ca7664">MISCREG_FPSCR</a>;
<a name="l00980"></a>00980             }
<a name="l00981"></a>00981             <span class="keywordflow">break</span>;
<a name="l00982"></a>00982           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca433dee61bef8154a3532959bc919a16b">MISCREG_CPSR_Q</a>:
<a name="l00983"></a>00983             {
<a name="l00984"></a>00984                 assert(!(newVal &amp; ~<a class="code" href="namespaceArmISA.html#afc6f213ea883270c5134042145dc46ab">CpsrMaskQ</a>));
<a name="l00985"></a>00985                 newVal = <a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca1d2df46d160cfa336591aaebdd6f99ba">MISCREG_CPSR</a>) | newVal;
<a name="l00986"></a>00986                 misc_reg = <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca1d2df46d160cfa336591aaebdd6f99ba">MISCREG_CPSR</a>;
<a name="l00987"></a>00987             }
<a name="l00988"></a>00988             <span class="keywordflow">break</span>;
<a name="l00989"></a>00989           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caeed16351097472c356b961608e012a0e">MISCREG_FPSCR_QC</a>:
<a name="l00990"></a>00990             {
<a name="l00991"></a>00991                 newVal = <a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca2c4f71a64cf54679d41471a7e0ca7664">MISCREG_FPSCR</a>) |
<a name="l00992"></a>00992                          (newVal &amp; <a class="code" href="namespaceArmISA.html#a7e1718dd34f5135e284d42af8e3aa26d">FpscrQcMask</a>);
<a name="l00993"></a>00993                 misc_reg = <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca2c4f71a64cf54679d41471a7e0ca7664">MISCREG_FPSCR</a>;
<a name="l00994"></a>00994             }
<a name="l00995"></a>00995             <span class="keywordflow">break</span>;
<a name="l00996"></a>00996           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca06562c3508fb0a2743cb7dd85b217a84">MISCREG_FPSCR_EXC</a>:
<a name="l00997"></a>00997             {
<a name="l00998"></a>00998                 newVal = <a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca2c4f71a64cf54679d41471a7e0ca7664">MISCREG_FPSCR</a>) |
<a name="l00999"></a>00999                          (newVal &amp; <a class="code" href="namespaceArmISA.html#a22037edf537f6b1d2d9156efa0726172">FpscrExcMask</a>);
<a name="l01000"></a>01000                 misc_reg = <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca2c4f71a64cf54679d41471a7e0ca7664">MISCREG_FPSCR</a>;
<a name="l01001"></a>01001             }
<a name="l01002"></a>01002             <span class="keywordflow">break</span>;
<a name="l01003"></a>01003           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca48af8eafc532123e001df274b82f2de9">MISCREG_FPEXC</a>:
<a name="l01004"></a>01004             {
<a name="l01005"></a>01005                 <span class="comment">// vfpv3 architecture, section B.6.1 of DDI04068</span>
<a name="l01006"></a>01006                 <span class="comment">// bit 29 - valid only if fpexc[31] is 0</span>
<a name="l01007"></a>01007                 <span class="keyword">const</span> uint32_t fpexcMask = 0x60000000;
<a name="l01008"></a>01008                 newVal = (newVal &amp; fpexcMask) |
<a name="l01009"></a>01009                          (<a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca48af8eafc532123e001df274b82f2de9">MISCREG_FPEXC</a>) &amp; ~fpexcMask);
<a name="l01010"></a>01010             }
<a name="l01011"></a>01011             <span class="keywordflow">break</span>;
<a name="l01012"></a>01012           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cacc6c0d54b3de785d3e9bd57250007f71">MISCREG_HCR</a>:
<a name="l01013"></a>01013             {
<a name="l01014"></a>01014                 <span class="keywordflow">if</span> (!<a class="code" href="structArmISA_1_1ISA.html#a3682c749403746c279089e180b3a503e">haveVirtualization</a>)
<a name="l01015"></a>01015                     <span class="keywordflow">return</span>;
<a name="l01016"></a>01016             }
<a name="l01017"></a>01017             <span class="keywordflow">break</span>;
<a name="l01018"></a>01018           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cac2645bfecf67b4eff0518ae7a7f8e95e">MISCREG_IFSR</a>:
<a name="l01019"></a>01019             {
<a name="l01020"></a>01020                 <span class="comment">// ARM ARM (ARM DDI 0406C.b) B4.1.96</span>
<a name="l01021"></a>01021                 <span class="keyword">const</span> uint32_t ifsrMask =
<a name="l01022"></a>01022                     <a class="code" href="namespaceArmISA.html#aedf8742bbf65a60cf102a4b3f9ba3d68">mask</a>(31, 13) | <a class="code" href="namespaceArmISA.html#aedf8742bbf65a60cf102a4b3f9ba3d68">mask</a>(11, 11) | <a class="code" href="namespaceArmISA.html#aedf8742bbf65a60cf102a4b3f9ba3d68">mask</a>(8, 6);
<a name="l01023"></a>01023                 newVal = newVal &amp; ~ifsrMask;
<a name="l01024"></a>01024             }
<a name="l01025"></a>01025             <span class="keywordflow">break</span>;
<a name="l01026"></a>01026           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca20a213d7fbe0563819180bb2de4914e4">MISCREG_DFSR</a>:
<a name="l01027"></a>01027             {
<a name="l01028"></a>01028                 <span class="comment">// ARM ARM (ARM DDI 0406C.b) B4.1.52</span>
<a name="l01029"></a>01029                 <span class="keyword">const</span> uint32_t dfsrMask = <a class="code" href="namespaceArmISA.html#aedf8742bbf65a60cf102a4b3f9ba3d68">mask</a>(31, 14) | <a class="code" href="namespaceArmISA.html#aedf8742bbf65a60cf102a4b3f9ba3d68">mask</a>(8, 8);
<a name="l01030"></a>01030                 newVal = newVal &amp; ~dfsrMask;
<a name="l01031"></a>01031             }
<a name="l01032"></a>01032             <span class="keywordflow">break</span>;
<a name="l01033"></a>01033           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca0797215d149dd6d506aa742e4bddabc1">MISCREG_AMAIR0</a>:
<a name="l01034"></a>01034           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca81deed498a989d6b3bf8739c22e3bdf0">MISCREG_AMAIR1</a>:
<a name="l01035"></a>01035             {
<a name="l01036"></a>01036                 <span class="comment">// ARM ARM (ARM DDI 0406C.b) B4.1.5</span>
<a name="l01037"></a>01037                 <span class="comment">// Valid only with LPAE</span>
<a name="l01038"></a>01038                 <span class="keywordflow">if</span> (!<a class="code" href="structArmISA_1_1ISA.html#a3aebe12b75ff4d71745ec872dddd0ac2">haveLPAE</a>)
<a name="l01039"></a>01039                     <span class="keywordflow">return</span>;
<a name="l01040"></a>01040                 <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(MiscRegs, <span class="stringliteral">&quot;Writing AMAIR: %#x\n&quot;</span>, newVal);
<a name="l01041"></a>01041             }
<a name="l01042"></a>01042             <span class="keywordflow">break</span>;
<a name="l01043"></a>01043           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6ec2fd6368d4b6668ee8155fc93d93b8">MISCREG_SCR</a>:
<a name="l01044"></a>01044             tc-&gt;<a class="code" href="classThreadContext.html#a71910c6ab34a67cb0bc65dbc874cbb27">getITBPtr</a>()-&gt;invalidateMiscReg();
<a name="l01045"></a>01045             tc-&gt;<a class="code" href="classThreadContext.html#a66f0298b284053daa1f4318c585c091f">getDTBPtr</a>()-&gt;invalidateMiscReg();
<a name="l01046"></a>01046             <span class="keywordflow">break</span>;
<a name="l01047"></a>01047           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca540af25d1d321d1891bf4d9292c227c1">MISCREG_SCTLR</a>:
<a name="l01048"></a>01048             {
<a name="l01049"></a>01049                 <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(MiscRegs, <span class="stringliteral">&quot;Writing SCTLR: %#x\n&quot;</span>, newVal);
<a name="l01050"></a>01050                 <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919c">MiscRegIndex</a> sctlr_idx;
<a name="l01051"></a>01051                 scr = <a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6ec2fd6368d4b6668ee8155fc93d93b8">MISCREG_SCR</a>);
<a name="l01052"></a>01052                 <span class="keywordflow">if</span> (<a class="code" href="structArmISA_1_1ISA.html#a2b5cf38edef41a2219914fabbe91bca9">haveSecurity</a> &amp;&amp; !scr.ns) {
<a name="l01053"></a>01053                     sctlr_idx = <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caad47953fcca722f8446003f5e293569f">MISCREG_SCTLR_S</a>;
<a name="l01054"></a>01054                 } <span class="keywordflow">else</span> {
<a name="l01055"></a>01055                     sctlr_idx = <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca360b79ced0619e6a76eace131cf7c1b9">MISCREG_SCTLR_NS</a>;
<a name="l01056"></a>01056                     <span class="comment">// The FI field (bit 21) is common between S/NS versions</span>
<a name="l01057"></a>01057                     <span class="comment">// of the register, we store this in the secure copy of</span>
<a name="l01058"></a>01058                     <span class="comment">// the reg</span>
<a name="l01059"></a>01059                     <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caad47953fcca722f8446003f5e293569f">MISCREG_SCTLR_S</a>] &amp;=         ~(1 &lt;&lt; 21);
<a name="l01060"></a>01060                     <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caad47953fcca722f8446003f5e293569f">MISCREG_SCTLR_S</a>] |= newVal &amp; (1 &lt;&lt; 21);
<a name="l01061"></a>01061                 }
<a name="l01062"></a>01062                 SCTLR sctlr = <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[sctlr_idx];
<a name="l01063"></a>01063                 SCTLR new_sctlr = newVal;
<a name="l01064"></a>01064                 new_sctlr.nmfi =  ((bool)sctlr.nmfi) &amp;&amp; !<a class="code" href="structArmISA_1_1ISA.html#a3682c749403746c279089e180b3a503e">haveVirtualization</a>;
<a name="l01065"></a>01065                 <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[sctlr_idx] = (<a class="code" href="namespaceArmISA.html#ae6de70120f06c08f390947f9e5cf7f7a">MiscReg</a>)new_sctlr;
<a name="l01066"></a>01066                 tc-&gt;<a class="code" href="classThreadContext.html#a71910c6ab34a67cb0bc65dbc874cbb27">getITBPtr</a>()-&gt;invalidateMiscReg();
<a name="l01067"></a>01067                 tc-&gt;<a class="code" href="classThreadContext.html#a66f0298b284053daa1f4318c585c091f">getDTBPtr</a>()-&gt;invalidateMiscReg();
<a name="l01068"></a>01068             }
<a name="l01069"></a>01069           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cadc608e04cb976f686af795b444bc6832">MISCREG_MIDR</a>:
<a name="l01070"></a>01070           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cae3ff6125f3635480b95f7cc4eea900ff">MISCREG_ID_PFR0</a>:
<a name="l01071"></a>01071           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cacdd627b13d30f6f82676f789b0e0c44c">MISCREG_ID_PFR1</a>:
<a name="l01072"></a>01072           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca2d551ec7da0544e4816550f590cb6801">MISCREG_ID_DFR0</a>:
<a name="l01073"></a>01073           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca344b758a27d1db96e5bce041a14a4ed7">MISCREG_ID_MMFR0</a>:
<a name="l01074"></a>01074           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cab9036bd4d98170cbdbc70125a8ba9397">MISCREG_ID_MMFR1</a>:
<a name="l01075"></a>01075           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca17ae208709284d34c21f53edb7d46aea">MISCREG_ID_MMFR2</a>:
<a name="l01076"></a>01076           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cac3c9dfa10bb5aa634e1df2f7d7d9adb0">MISCREG_ID_MMFR3</a>:
<a name="l01077"></a>01077           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca68fe3af92534b9a943a114580b3c9d39">MISCREG_ID_ISAR0</a>:
<a name="l01078"></a>01078           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caf4cef18dbef50885e187adddd1327d9e">MISCREG_ID_ISAR1</a>:
<a name="l01079"></a>01079           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca30812347ebd4dd4acb50048b317e9ed7">MISCREG_ID_ISAR2</a>:
<a name="l01080"></a>01080           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caa4e546048874cb8aeb47584175559326">MISCREG_ID_ISAR3</a>:
<a name="l01081"></a>01081           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cab58b694aa4d1972b88a238c813f87173">MISCREG_ID_ISAR4</a>:
<a name="l01082"></a>01082           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca097734a5fdc6fce17ce5caa5606af525">MISCREG_ID_ISAR5</a>:
<a name="l01083"></a>01083 
<a name="l01084"></a>01084           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cadd221dda6f7809c358100c45f0724020">MISCREG_MPIDR</a>:
<a name="l01085"></a>01085           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca782403f98b3f18d1c87433562a046a27">MISCREG_FPSID</a>:
<a name="l01086"></a>01086           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cace40afc520e485c32007d226062894b5">MISCREG_TLBTR</a>:
<a name="l01087"></a>01087           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca8b23d147e2f3f690f1b9468c67554e13">MISCREG_MVFR0</a>:
<a name="l01088"></a>01088           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca95c008bfb7e9778da090ead9cce7aeee">MISCREG_MVFR1</a>:
<a name="l01089"></a>01089 
<a name="l01090"></a>01090           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cab8b39010cdc0fe971922aefa57837d23">MISCREG_ID_AA64AFR0_EL1</a>:
<a name="l01091"></a>01091           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca8797f004798df47a089e9c3f2e81d2f2">MISCREG_ID_AA64AFR1_EL1</a>:
<a name="l01092"></a>01092           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca257ebe5fbd21331eeacf40de02b9c869">MISCREG_ID_AA64DFR0_EL1</a>:
<a name="l01093"></a>01093           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca88c1e000248c4359e401304f2c4de082">MISCREG_ID_AA64DFR1_EL1</a>:
<a name="l01094"></a>01094           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca2e4c38994591183a2a4f9824c2f04de1">MISCREG_ID_AA64ISAR0_EL1</a>:
<a name="l01095"></a>01095           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca30e718528af33a5acae4bb80df269b0e">MISCREG_ID_AA64ISAR1_EL1</a>:
<a name="l01096"></a>01096           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca094617d2658838c1f5ad737b50608112">MISCREG_ID_AA64MMFR0_EL1</a>:
<a name="l01097"></a>01097           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cacc1a75c0a4b9ecbfe29cddd1176f7a3f">MISCREG_ID_AA64MMFR1_EL1</a>:
<a name="l01098"></a>01098           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca1f67b0b70cd63a9d580183f96e302c25">MISCREG_ID_AA64PFR0_EL1</a>:
<a name="l01099"></a>01099           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cad4624483d0fde58150bac9a05d2d93c2">MISCREG_ID_AA64PFR1_EL1</a>:
<a name="l01100"></a>01100             <span class="comment">// ID registers are constants.</span>
<a name="l01101"></a>01101             <span class="keywordflow">return</span>;
<a name="l01102"></a>01102 
<a name="l01103"></a>01103           <span class="comment">// TLBI all entries, EL0&amp;1 inner sharable (ignored)</span>
<a name="l01104"></a>01104           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cad33f7d3ef73f518dba36b6cc5c881627">MISCREG_TLBIALLIS</a>:
<a name="l01105"></a>01105           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca0272e4641b1c33ec30a95b8d5b5b7274">MISCREG_TLBIALL</a>: <span class="comment">// TLBI all entries, EL0&amp;1,</span>
<a name="l01106"></a>01106             <a class="code" href="structArmISA_1_1ISA.html#a919c233e38c9a5c63093a70b75150989">assert32</a>(tc);
<a name="l01107"></a>01107             target_el = 1; <span class="comment">// el 0 and 1 are handled together</span>
<a name="l01108"></a>01108             scr = <a class="code" href="structArmISA_1_1ISA.html#a1a89f346ae6d1ebe6475c53151ee0187">readMiscReg</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6ec2fd6368d4b6668ee8155fc93d93b8">MISCREG_SCR</a>, tc);
<a name="l01109"></a>01109             secure_lookup = <a class="code" href="structArmISA_1_1ISA.html#a2b5cf38edef41a2219914fabbe91bca9">haveSecurity</a> &amp;&amp; !scr.ns;
<a name="l01110"></a>01110             sys = tc-&gt;<a class="code" href="classThreadContext.html#a119dd28f703f77bafb74788f8110300c">getSystemPtr</a>();
<a name="l01111"></a>01111             <span class="keywordflow">for</span> (x = 0; x &lt; sys-&gt;<a class="code" href="classSystem.html#ab123a0793826eea0796f70ec2b2e07f7">numContexts</a>(); x++) {
<a name="l01112"></a>01112                 oc = sys-&gt;<a class="code" href="classSystem.html#a289079f61fbd11f0c41b5e62ea6844ff">getThreadContext</a>(x);
<a name="l01113"></a>01113                 assert(oc-&gt;<a class="code" href="classThreadContext.html#a71910c6ab34a67cb0bc65dbc874cbb27">getITBPtr</a>() &amp;&amp; oc-&gt;<a class="code" href="classThreadContext.html#a66f0298b284053daa1f4318c585c091f">getDTBPtr</a>());
<a name="l01114"></a>01114                 oc-&gt;<a class="code" href="classThreadContext.html#a71910c6ab34a67cb0bc65dbc874cbb27">getITBPtr</a>()-&gt;flushAllSecurity(secure_lookup, target_el);
<a name="l01115"></a>01115                 oc-&gt;<a class="code" href="classThreadContext.html#a66f0298b284053daa1f4318c585c091f">getDTBPtr</a>()-&gt;flushAllSecurity(secure_lookup, target_el);
<a name="l01116"></a>01116 
<a name="l01117"></a>01117                 <span class="comment">// If CheckerCPU is connected, need to notify it of a flush</span>
<a name="l01118"></a>01118                 <a class="code" href="classCheckerCPU.html" title="CheckerCPU class.">CheckerCPU</a> *checker = oc-&gt;<a class="code" href="classThreadContext.html#a594e114a4cc2ff653bc8a30fe49b986b">getCheckerCpuPtr</a>();
<a name="l01119"></a>01119                 <span class="keywordflow">if</span> (checker) {
<a name="l01120"></a>01120                     checker-&gt;<a class="code" href="classCheckerCPU.html#a9a1bb6b2d38e725012d11831c25780c3">getITBPtr</a>()-&gt;flushAllSecurity(secure_lookup,
<a name="l01121"></a>01121                                                            target_el);
<a name="l01122"></a>01122                     checker-&gt;<a class="code" href="classCheckerCPU.html#a29eaa07d1ac8f4cbe8c7e24be85765fa">getDTBPtr</a>()-&gt;flushAllSecurity(secure_lookup,
<a name="l01123"></a>01123                                                            target_el);
<a name="l01124"></a>01124                 }
<a name="l01125"></a>01125             }
<a name="l01126"></a>01126             <span class="keywordflow">return</span>;
<a name="l01127"></a>01127           <span class="comment">// TLBI all entries, EL0&amp;1, instruction side</span>
<a name="l01128"></a>01128           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cad570b36e9185493a099894f58018fac0">MISCREG_ITLBIALL</a>:
<a name="l01129"></a>01129             <a class="code" href="structArmISA_1_1ISA.html#a919c233e38c9a5c63093a70b75150989">assert32</a>(tc);
<a name="l01130"></a>01130             target_el = 1; <span class="comment">// el 0 and 1 are handled together</span>
<a name="l01131"></a>01131             scr = <a class="code" href="structArmISA_1_1ISA.html#a1a89f346ae6d1ebe6475c53151ee0187">readMiscReg</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6ec2fd6368d4b6668ee8155fc93d93b8">MISCREG_SCR</a>, tc);
<a name="l01132"></a>01132             secure_lookup = <a class="code" href="structArmISA_1_1ISA.html#a2b5cf38edef41a2219914fabbe91bca9">haveSecurity</a> &amp;&amp; !scr.ns;
<a name="l01133"></a>01133             tc-&gt;<a class="code" href="classThreadContext.html#a71910c6ab34a67cb0bc65dbc874cbb27">getITBPtr</a>()-&gt;flushAllSecurity(secure_lookup, target_el);
<a name="l01134"></a>01134             <span class="keywordflow">return</span>;
<a name="l01135"></a>01135           <span class="comment">// TLBI all entries, EL0&amp;1, data side</span>
<a name="l01136"></a>01136           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca055d59fa0781ac72026b011dea0490cf">MISCREG_DTLBIALL</a>:
<a name="l01137"></a>01137             <a class="code" href="structArmISA_1_1ISA.html#a919c233e38c9a5c63093a70b75150989">assert32</a>(tc);
<a name="l01138"></a>01138             target_el = 1; <span class="comment">// el 0 and 1 are handled together</span>
<a name="l01139"></a>01139             scr = <a class="code" href="structArmISA_1_1ISA.html#a1a89f346ae6d1ebe6475c53151ee0187">readMiscReg</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6ec2fd6368d4b6668ee8155fc93d93b8">MISCREG_SCR</a>, tc);
<a name="l01140"></a>01140             secure_lookup = <a class="code" href="structArmISA_1_1ISA.html#a2b5cf38edef41a2219914fabbe91bca9">haveSecurity</a> &amp;&amp; !scr.ns;
<a name="l01141"></a>01141             tc-&gt;<a class="code" href="classThreadContext.html#a66f0298b284053daa1f4318c585c091f">getDTBPtr</a>()-&gt;flushAllSecurity(secure_lookup, target_el);
<a name="l01142"></a>01142             <span class="keywordflow">return</span>;
<a name="l01143"></a>01143           <span class="comment">// TLBI based on VA, EL0&amp;1 inner sharable (ignored)</span>
<a name="l01144"></a>01144           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca4d06fd3e9f671633ce1d5b151c5d3455">MISCREG_TLBIMVAIS</a>:
<a name="l01145"></a>01145           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cab0d3898aa2aaf2fffd4953283d284b88">MISCREG_TLBIMVA</a>:
<a name="l01146"></a>01146             <a class="code" href="structArmISA_1_1ISA.html#a919c233e38c9a5c63093a70b75150989">assert32</a>(tc);
<a name="l01147"></a>01147             target_el = 1; <span class="comment">// el 0 and 1 are handled together</span>
<a name="l01148"></a>01148             scr = <a class="code" href="structArmISA_1_1ISA.html#a1a89f346ae6d1ebe6475c53151ee0187">readMiscReg</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6ec2fd6368d4b6668ee8155fc93d93b8">MISCREG_SCR</a>, tc);
<a name="l01149"></a>01149             secure_lookup = <a class="code" href="structArmISA_1_1ISA.html#a2b5cf38edef41a2219914fabbe91bca9">haveSecurity</a> &amp;&amp; !scr.ns;
<a name="l01150"></a>01150             sys = tc-&gt;<a class="code" href="classThreadContext.html#a119dd28f703f77bafb74788f8110300c">getSystemPtr</a>();
<a name="l01151"></a>01151             <span class="keywordflow">for</span> (x = 0; x &lt; sys-&gt;<a class="code" href="classSystem.html#ab123a0793826eea0796f70ec2b2e07f7">numContexts</a>(); x++) {
<a name="l01152"></a>01152                 oc = sys-&gt;<a class="code" href="classSystem.html#a289079f61fbd11f0c41b5e62ea6844ff">getThreadContext</a>(x);
<a name="l01153"></a>01153                 assert(oc-&gt;<a class="code" href="classThreadContext.html#a71910c6ab34a67cb0bc65dbc874cbb27">getITBPtr</a>() &amp;&amp; oc-&gt;<a class="code" href="classThreadContext.html#a66f0298b284053daa1f4318c585c091f">getDTBPtr</a>());
<a name="l01154"></a>01154                 oc-&gt;<a class="code" href="classThreadContext.html#a71910c6ab34a67cb0bc65dbc874cbb27">getITBPtr</a>()-&gt;flushMvaAsid(<a class="code" href="bitfield_8hh.html#acaa3c424fec3407f14a01fe1ec22c2d4" title="Mask off the given bits in place like bits() but without shifting.">mbits</a>(newVal, 31, 12),
<a name="l01155"></a>01155                                               <a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123" title="Extract the bitfield from position &amp;#39;first&amp;#39; to &amp;#39;last&amp;#39; (inclusive)...">bits</a>(newVal, 7,0),
<a name="l01156"></a>01156                                               secure_lookup, target_el);
<a name="l01157"></a>01157                 oc-&gt;<a class="code" href="classThreadContext.html#a66f0298b284053daa1f4318c585c091f">getDTBPtr</a>()-&gt;flushMvaAsid(<a class="code" href="bitfield_8hh.html#acaa3c424fec3407f14a01fe1ec22c2d4" title="Mask off the given bits in place like bits() but without shifting.">mbits</a>(newVal, 31, 12),
<a name="l01158"></a>01158                                               <a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123" title="Extract the bitfield from position &amp;#39;first&amp;#39; to &amp;#39;last&amp;#39; (inclusive)...">bits</a>(newVal, 7,0),
<a name="l01159"></a>01159                                               secure_lookup, target_el);
<a name="l01160"></a>01160 
<a name="l01161"></a>01161                 <a class="code" href="classCheckerCPU.html" title="CheckerCPU class.">CheckerCPU</a> *checker = oc-&gt;<a class="code" href="classThreadContext.html#a594e114a4cc2ff653bc8a30fe49b986b">getCheckerCpuPtr</a>();
<a name="l01162"></a>01162                 <span class="keywordflow">if</span> (checker) {
<a name="l01163"></a>01163                     checker-&gt;<a class="code" href="classCheckerCPU.html#a9a1bb6b2d38e725012d11831c25780c3">getITBPtr</a>()-&gt;flushMvaAsid(<a class="code" href="bitfield_8hh.html#acaa3c424fec3407f14a01fe1ec22c2d4" title="Mask off the given bits in place like bits() but without shifting.">mbits</a>(newVal, 31, 12),
<a name="l01164"></a>01164                         <a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123" title="Extract the bitfield from position &amp;#39;first&amp;#39; to &amp;#39;last&amp;#39; (inclusive)...">bits</a>(newVal, 7,0), secure_lookup, target_el);
<a name="l01165"></a>01165                     checker-&gt;<a class="code" href="classCheckerCPU.html#a29eaa07d1ac8f4cbe8c7e24be85765fa">getDTBPtr</a>()-&gt;flushMvaAsid(<a class="code" href="bitfield_8hh.html#acaa3c424fec3407f14a01fe1ec22c2d4" title="Mask off the given bits in place like bits() but without shifting.">mbits</a>(newVal, 31, 12),
<a name="l01166"></a>01166                         <a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123" title="Extract the bitfield from position &amp;#39;first&amp;#39; to &amp;#39;last&amp;#39; (inclusive)...">bits</a>(newVal, 7,0), secure_lookup, target_el);
<a name="l01167"></a>01167                 }
<a name="l01168"></a>01168             }
<a name="l01169"></a>01169             <span class="keywordflow">return</span>;
<a name="l01170"></a>01170           <span class="comment">// TLBI by ASID, EL0&amp;1, inner sharable</span>
<a name="l01171"></a>01171           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caf6b27f38425b6c7e5b13119c1a5b1754">MISCREG_TLBIASIDIS</a>:
<a name="l01172"></a>01172           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caacb8cbb1c501ab158fedd21b52fa2220">MISCREG_TLBIASID</a>:
<a name="l01173"></a>01173             <a class="code" href="structArmISA_1_1ISA.html#a919c233e38c9a5c63093a70b75150989">assert32</a>(tc);
<a name="l01174"></a>01174             target_el = 1; <span class="comment">// el 0 and 1 are handled together</span>
<a name="l01175"></a>01175             scr = <a class="code" href="structArmISA_1_1ISA.html#a1a89f346ae6d1ebe6475c53151ee0187">readMiscReg</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6ec2fd6368d4b6668ee8155fc93d93b8">MISCREG_SCR</a>, tc);
<a name="l01176"></a>01176             secure_lookup = <a class="code" href="structArmISA_1_1ISA.html#a2b5cf38edef41a2219914fabbe91bca9">haveSecurity</a> &amp;&amp; !scr.ns;
<a name="l01177"></a>01177             sys = tc-&gt;<a class="code" href="classThreadContext.html#a119dd28f703f77bafb74788f8110300c">getSystemPtr</a>();
<a name="l01178"></a>01178             <span class="keywordflow">for</span> (x = 0; x &lt; sys-&gt;<a class="code" href="classSystem.html#ab123a0793826eea0796f70ec2b2e07f7">numContexts</a>(); x++) {
<a name="l01179"></a>01179                 oc = sys-&gt;<a class="code" href="classSystem.html#a289079f61fbd11f0c41b5e62ea6844ff">getThreadContext</a>(x);
<a name="l01180"></a>01180                 assert(oc-&gt;<a class="code" href="classThreadContext.html#a71910c6ab34a67cb0bc65dbc874cbb27">getITBPtr</a>() &amp;&amp; oc-&gt;<a class="code" href="classThreadContext.html#a66f0298b284053daa1f4318c585c091f">getDTBPtr</a>());
<a name="l01181"></a>01181                 oc-&gt;<a class="code" href="classThreadContext.html#a71910c6ab34a67cb0bc65dbc874cbb27">getITBPtr</a>()-&gt;flushAsid(<a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123" title="Extract the bitfield from position &amp;#39;first&amp;#39; to &amp;#39;last&amp;#39; (inclusive)...">bits</a>(newVal, 7,0),
<a name="l01182"></a>01182                     secure_lookup, target_el);
<a name="l01183"></a>01183                 oc-&gt;<a class="code" href="classThreadContext.html#a66f0298b284053daa1f4318c585c091f">getDTBPtr</a>()-&gt;flushAsid(<a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123" title="Extract the bitfield from position &amp;#39;first&amp;#39; to &amp;#39;last&amp;#39; (inclusive)...">bits</a>(newVal, 7,0),
<a name="l01184"></a>01184                     secure_lookup, target_el);
<a name="l01185"></a>01185                 <a class="code" href="classCheckerCPU.html" title="CheckerCPU class.">CheckerCPU</a> *checker = oc-&gt;<a class="code" href="classThreadContext.html#a594e114a4cc2ff653bc8a30fe49b986b">getCheckerCpuPtr</a>();
<a name="l01186"></a>01186                 <span class="keywordflow">if</span> (checker) {
<a name="l01187"></a>01187                     checker-&gt;<a class="code" href="classCheckerCPU.html#a9a1bb6b2d38e725012d11831c25780c3">getITBPtr</a>()-&gt;flushAsid(<a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123" title="Extract the bitfield from position &amp;#39;first&amp;#39; to &amp;#39;last&amp;#39; (inclusive)...">bits</a>(newVal, 7,0),
<a name="l01188"></a>01188                         secure_lookup, target_el);
<a name="l01189"></a>01189                     checker-&gt;<a class="code" href="classCheckerCPU.html#a29eaa07d1ac8f4cbe8c7e24be85765fa">getDTBPtr</a>()-&gt;flushAsid(<a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123" title="Extract the bitfield from position &amp;#39;first&amp;#39; to &amp;#39;last&amp;#39; (inclusive)...">bits</a>(newVal, 7,0),
<a name="l01190"></a>01190                         secure_lookup, target_el);
<a name="l01191"></a>01191                 }
<a name="l01192"></a>01192             }
<a name="l01193"></a>01193             <span class="keywordflow">return</span>;
<a name="l01194"></a>01194           <span class="comment">// TLBI by address, EL0&amp;1, inner sharable (ignored)</span>
<a name="l01195"></a>01195           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca11b8f3d7eb754bba1890b23ac9267a73">MISCREG_TLBIMVAAIS</a>:
<a name="l01196"></a>01196           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca7c70c1eac0935c3d1c30e66f5061b063">MISCREG_TLBIMVAA</a>:
<a name="l01197"></a>01197             <a class="code" href="structArmISA_1_1ISA.html#a919c233e38c9a5c63093a70b75150989">assert32</a>(tc);
<a name="l01198"></a>01198             target_el = 1; <span class="comment">// el 0 and 1 are handled together</span>
<a name="l01199"></a>01199             scr = <a class="code" href="structArmISA_1_1ISA.html#a1a89f346ae6d1ebe6475c53151ee0187">readMiscReg</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6ec2fd6368d4b6668ee8155fc93d93b8">MISCREG_SCR</a>, tc);
<a name="l01200"></a>01200             secure_lookup = <a class="code" href="structArmISA_1_1ISA.html#a2b5cf38edef41a2219914fabbe91bca9">haveSecurity</a> &amp;&amp; !scr.ns;
<a name="l01201"></a>01201             hyp = 0;
<a name="l01202"></a>01202             <a class="code" href="structArmISA_1_1ISA.html#a63c548a694ff3f8bd3244303ecdee6a9">tlbiMVA</a>(tc, newVal, secure_lookup, hyp, target_el);
<a name="l01203"></a>01203             <span class="keywordflow">return</span>;
<a name="l01204"></a>01204           <span class="comment">// TLBI by address, EL2, hypervisor mode</span>
<a name="l01205"></a>01205           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cafd10239b4680f6b68b0956c00f29f82d">MISCREG_TLBIMVAH</a>:
<a name="l01206"></a>01206           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cabb07e768de8f795296ebe9016671de9e">MISCREG_TLBIMVAHIS</a>:
<a name="l01207"></a>01207             <a class="code" href="structArmISA_1_1ISA.html#a919c233e38c9a5c63093a70b75150989">assert32</a>(tc);
<a name="l01208"></a>01208             target_el = 1; <span class="comment">// aarch32, use hyp bit</span>
<a name="l01209"></a>01209             scr = <a class="code" href="structArmISA_1_1ISA.html#a1a89f346ae6d1ebe6475c53151ee0187">readMiscReg</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6ec2fd6368d4b6668ee8155fc93d93b8">MISCREG_SCR</a>, tc);
<a name="l01210"></a>01210             secure_lookup = <a class="code" href="structArmISA_1_1ISA.html#a2b5cf38edef41a2219914fabbe91bca9">haveSecurity</a> &amp;&amp; !scr.ns;
<a name="l01211"></a>01211             hyp = 1;
<a name="l01212"></a>01212             <a class="code" href="structArmISA_1_1ISA.html#a63c548a694ff3f8bd3244303ecdee6a9">tlbiMVA</a>(tc, newVal, secure_lookup, hyp, target_el);
<a name="l01213"></a>01213             <span class="keywordflow">return</span>;
<a name="l01214"></a>01214           <span class="comment">// TLBI by address and asid, EL0&amp;1, instruction side only</span>
<a name="l01215"></a>01215           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca3f3bdac3de8737bd96516a00f0a24e2b">MISCREG_ITLBIMVA</a>:
<a name="l01216"></a>01216             <a class="code" href="structArmISA_1_1ISA.html#a919c233e38c9a5c63093a70b75150989">assert32</a>(tc);
<a name="l01217"></a>01217             target_el = 1; <span class="comment">// el 0 and 1 are handled together</span>
<a name="l01218"></a>01218             scr = <a class="code" href="structArmISA_1_1ISA.html#a1a89f346ae6d1ebe6475c53151ee0187">readMiscReg</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6ec2fd6368d4b6668ee8155fc93d93b8">MISCREG_SCR</a>, tc);
<a name="l01219"></a>01219             secure_lookup = <a class="code" href="structArmISA_1_1ISA.html#a2b5cf38edef41a2219914fabbe91bca9">haveSecurity</a> &amp;&amp; !scr.ns;
<a name="l01220"></a>01220             tc-&gt;<a class="code" href="classThreadContext.html#a71910c6ab34a67cb0bc65dbc874cbb27">getITBPtr</a>()-&gt;flushMvaAsid(<a class="code" href="bitfield_8hh.html#acaa3c424fec3407f14a01fe1ec22c2d4" title="Mask off the given bits in place like bits() but without shifting.">mbits</a>(newVal, 31, 12),
<a name="l01221"></a>01221                 <a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123" title="Extract the bitfield from position &amp;#39;first&amp;#39; to &amp;#39;last&amp;#39; (inclusive)...">bits</a>(newVal, 7,0), secure_lookup, target_el);
<a name="l01222"></a>01222             <span class="keywordflow">return</span>;
<a name="l01223"></a>01223           <span class="comment">// TLBI by address and asid, EL0&amp;1, data side only</span>
<a name="l01224"></a>01224           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca2bc0f84891bd9bced655f99817c7d73a">MISCREG_DTLBIMVA</a>:
<a name="l01225"></a>01225             <a class="code" href="structArmISA_1_1ISA.html#a919c233e38c9a5c63093a70b75150989">assert32</a>(tc);
<a name="l01226"></a>01226             target_el = 1; <span class="comment">// el 0 and 1 are handled together</span>
<a name="l01227"></a>01227             scr = <a class="code" href="structArmISA_1_1ISA.html#a1a89f346ae6d1ebe6475c53151ee0187">readMiscReg</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6ec2fd6368d4b6668ee8155fc93d93b8">MISCREG_SCR</a>, tc);
<a name="l01228"></a>01228             secure_lookup = <a class="code" href="structArmISA_1_1ISA.html#a2b5cf38edef41a2219914fabbe91bca9">haveSecurity</a> &amp;&amp; !scr.ns;
<a name="l01229"></a>01229             tc-&gt;<a class="code" href="classThreadContext.html#a66f0298b284053daa1f4318c585c091f">getDTBPtr</a>()-&gt;flushMvaAsid(<a class="code" href="bitfield_8hh.html#acaa3c424fec3407f14a01fe1ec22c2d4" title="Mask off the given bits in place like bits() but without shifting.">mbits</a>(newVal, 31, 12),
<a name="l01230"></a>01230                 <a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123" title="Extract the bitfield from position &amp;#39;first&amp;#39; to &amp;#39;last&amp;#39; (inclusive)...">bits</a>(newVal, 7,0), secure_lookup, target_el);
<a name="l01231"></a>01231             <span class="keywordflow">return</span>;
<a name="l01232"></a>01232           <span class="comment">// TLBI by ASID, EL0&amp;1, instrution side only</span>
<a name="l01233"></a>01233           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca8e66b41d02fe712ea99dc3560cc01537">MISCREG_ITLBIASID</a>:
<a name="l01234"></a>01234             <a class="code" href="structArmISA_1_1ISA.html#a919c233e38c9a5c63093a70b75150989">assert32</a>(tc);
<a name="l01235"></a>01235             target_el = 1; <span class="comment">// el 0 and 1 are handled together</span>
<a name="l01236"></a>01236             scr = <a class="code" href="structArmISA_1_1ISA.html#a1a89f346ae6d1ebe6475c53151ee0187">readMiscReg</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6ec2fd6368d4b6668ee8155fc93d93b8">MISCREG_SCR</a>, tc);
<a name="l01237"></a>01237             secure_lookup = <a class="code" href="structArmISA_1_1ISA.html#a2b5cf38edef41a2219914fabbe91bca9">haveSecurity</a> &amp;&amp; !scr.ns;
<a name="l01238"></a>01238             tc-&gt;<a class="code" href="classThreadContext.html#a71910c6ab34a67cb0bc65dbc874cbb27">getITBPtr</a>()-&gt;flushAsid(<a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123" title="Extract the bitfield from position &amp;#39;first&amp;#39; to &amp;#39;last&amp;#39; (inclusive)...">bits</a>(newVal, 7,0), secure_lookup,
<a name="l01239"></a>01239                                        target_el);
<a name="l01240"></a>01240             <span class="keywordflow">return</span>;
<a name="l01241"></a>01241           <span class="comment">// TLBI by ASID EL0&amp;1 data size only</span>
<a name="l01242"></a>01242           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cabe867f0cb674ef1a887da582894ea161">MISCREG_DTLBIASID</a>:
<a name="l01243"></a>01243             <a class="code" href="structArmISA_1_1ISA.html#a919c233e38c9a5c63093a70b75150989">assert32</a>(tc);
<a name="l01244"></a>01244             target_el = 1; <span class="comment">// el 0 and 1 are handled together</span>
<a name="l01245"></a>01245             scr = <a class="code" href="structArmISA_1_1ISA.html#a1a89f346ae6d1ebe6475c53151ee0187">readMiscReg</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6ec2fd6368d4b6668ee8155fc93d93b8">MISCREG_SCR</a>, tc);
<a name="l01246"></a>01246             secure_lookup = <a class="code" href="structArmISA_1_1ISA.html#a2b5cf38edef41a2219914fabbe91bca9">haveSecurity</a> &amp;&amp; !scr.ns;
<a name="l01247"></a>01247             tc-&gt;<a class="code" href="classThreadContext.html#a66f0298b284053daa1f4318c585c091f">getDTBPtr</a>()-&gt;flushAsid(<a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123" title="Extract the bitfield from position &amp;#39;first&amp;#39; to &amp;#39;last&amp;#39; (inclusive)...">bits</a>(newVal, 7,0), secure_lookup,
<a name="l01248"></a>01248                                        target_el);
<a name="l01249"></a>01249             <span class="keywordflow">return</span>;
<a name="l01250"></a>01250           <span class="comment">// Invalidate entire Non-secure Hyp/Non-Hyp Unified TLB</span>
<a name="l01251"></a>01251           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca69a89ff15c69327578136c4d1cbeac4b">MISCREG_TLBIALLNSNH</a>:
<a name="l01252"></a>01252           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cac7e1f92dfd7376c6f131741bc378213a">MISCREG_TLBIALLNSNHIS</a>:
<a name="l01253"></a>01253             <a class="code" href="structArmISA_1_1ISA.html#a919c233e38c9a5c63093a70b75150989">assert32</a>(tc);
<a name="l01254"></a>01254             target_el = 1; <span class="comment">// el 0 and 1 are handled together</span>
<a name="l01255"></a>01255             hyp = 0;
<a name="l01256"></a>01256             <a class="code" href="structArmISA_1_1ISA.html#a61a1291114c38dfebfd9a2afa66efea7">tlbiALLN</a>(tc, hyp, target_el);
<a name="l01257"></a>01257             <span class="keywordflow">return</span>;
<a name="l01258"></a>01258           <span class="comment">// TLBI all entries, EL2, hyp,</span>
<a name="l01259"></a>01259           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca983e18aec06c285abd5bd897534dd48c">MISCREG_TLBIALLH</a>:
<a name="l01260"></a>01260           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca4150e901d1d2e854c6cf9acb17e393f1">MISCREG_TLBIALLHIS</a>:
<a name="l01261"></a>01261             <a class="code" href="structArmISA_1_1ISA.html#a919c233e38c9a5c63093a70b75150989">assert32</a>(tc);
<a name="l01262"></a>01262             target_el = 1; <span class="comment">// aarch32, use hyp bit</span>
<a name="l01263"></a>01263             hyp = 1;
<a name="l01264"></a>01264             <a class="code" href="structArmISA_1_1ISA.html#a61a1291114c38dfebfd9a2afa66efea7">tlbiALLN</a>(tc, hyp, target_el);
<a name="l01265"></a>01265             <span class="keywordflow">return</span>;
<a name="l01266"></a>01266           <span class="comment">// AArch64 TLBI: invalidate all entries EL3</span>
<a name="l01267"></a>01267           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca0260e987b120bb2f05c477786bd7f353">MISCREG_TLBI_ALLE3IS</a>:
<a name="l01268"></a>01268           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca77b6e2b589383064719584e8556d67de">MISCREG_TLBI_ALLE3</a>:
<a name="l01269"></a>01269             <a class="code" href="structArmISA_1_1ISA.html#a8ec36493a37e78ea73079559e2289ab3">assert64</a>(tc);
<a name="l01270"></a>01270             target_el = 3;
<a name="l01271"></a>01271             secure_lookup = <span class="keyword">true</span>;
<a name="l01272"></a>01272             <a class="code" href="structArmISA_1_1ISA.html#ab7e5fdbd940d1cf766333f3c4795e35f">tlbiALL</a>(tc, secure_lookup, target_el);
<a name="l01273"></a>01273             <span class="keywordflow">return</span>;
<a name="l01274"></a>01274           <span class="comment">// @todo: uncomment this to enable Virtualization</span>
<a name="l01275"></a>01275           <span class="comment">// case MISCREG_TLBI_ALLE2IS:</span>
<a name="l01276"></a>01276           <span class="comment">// case MISCREG_TLBI_ALLE2:</span>
<a name="l01277"></a>01277           <span class="comment">// TLBI all entries, EL0&amp;1</span>
<a name="l01278"></a>01278           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caabcfd2d3aa33833f3f6e689e09b3b32a">MISCREG_TLBI_ALLE1IS</a>:
<a name="l01279"></a>01279           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caaa8ef27b2eb541cac70af31c99b7336c">MISCREG_TLBI_ALLE1</a>:
<a name="l01280"></a>01280           <span class="comment">// AArch64 TLBI: invalidate all entries, stage 1, current VMID</span>
<a name="l01281"></a>01281           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca29476e31e75583e33d2fdf6da8adb762">MISCREG_TLBI_VMALLE1IS</a>:
<a name="l01282"></a>01282           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca0942371ca40142865a823c0112fa6052">MISCREG_TLBI_VMALLE1</a>:
<a name="l01283"></a>01283           <span class="comment">// AArch64 TLBI: invalidate all entries, stages 1 &amp; 2, current VMID</span>
<a name="l01284"></a>01284           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca52f9b4f972970a240dbfc63eadb65758">MISCREG_TLBI_VMALLS12E1IS</a>:
<a name="l01285"></a>01285           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca2020033f494d46cd3d9fac2025c5b850">MISCREG_TLBI_VMALLS12E1</a>:
<a name="l01286"></a>01286             <span class="comment">// @todo: handle VMID and stage 2 to enable Virtualization</span>
<a name="l01287"></a>01287             <a class="code" href="structArmISA_1_1ISA.html#a8ec36493a37e78ea73079559e2289ab3">assert64</a>(tc);
<a name="l01288"></a>01288             target_el = 1; <span class="comment">// el 0 and 1 are handled together</span>
<a name="l01289"></a>01289             scr = <a class="code" href="structArmISA_1_1ISA.html#a1a89f346ae6d1ebe6475c53151ee0187">readMiscReg</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6ec2fd6368d4b6668ee8155fc93d93b8">MISCREG_SCR</a>, tc);
<a name="l01290"></a>01290             secure_lookup = <a class="code" href="structArmISA_1_1ISA.html#a2b5cf38edef41a2219914fabbe91bca9">haveSecurity</a> &amp;&amp; !scr.ns;
<a name="l01291"></a>01291             <a class="code" href="structArmISA_1_1ISA.html#ab7e5fdbd940d1cf766333f3c4795e35f">tlbiALL</a>(tc, secure_lookup, target_el);
<a name="l01292"></a>01292             <span class="keywordflow">return</span>;
<a name="l01293"></a>01293           <span class="comment">// AArch64 TLBI: invalidate by VA and ASID, stage 1, current VMID</span>
<a name="l01294"></a>01294           <span class="comment">// VAEx(IS) and VALEx(IS) are the same because TLBs only store entries</span>
<a name="l01295"></a>01295           <span class="comment">// from the last level of translation table walks</span>
<a name="l01296"></a>01296           <span class="comment">// @todo: handle VMID to enable Virtualization</span>
<a name="l01297"></a>01297           <span class="comment">// TLBI all entries, EL0&amp;1</span>
<a name="l01298"></a>01298           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca4c2f57562968c37f3e2b89063a5a4b1f">MISCREG_TLBI_VAE3IS_Xt</a>:
<a name="l01299"></a>01299           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca7b4f324456a33edcb78c9da5d75df68b">MISCREG_TLBI_VAE3_Xt</a>:
<a name="l01300"></a>01300           <span class="comment">// TLBI by VA, EL3  regime stage 1, last level walk</span>
<a name="l01301"></a>01301           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca76cfd2fa228ef3bc799330eabed1e827">MISCREG_TLBI_VALE3IS_Xt</a>:
<a name="l01302"></a>01302           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca59b4af0370b3394a76f59883801e7643">MISCREG_TLBI_VALE3_Xt</a>:
<a name="l01303"></a>01303             <a class="code" href="structArmISA_1_1ISA.html#a8ec36493a37e78ea73079559e2289ab3">assert64</a>(tc);
<a name="l01304"></a>01304             target_el = 3;
<a name="l01305"></a>01305             asid = 0xbeef; <span class="comment">// does not matter, tlbi is global</span>
<a name="l01306"></a>01306             secure_lookup = <span class="keyword">true</span>;
<a name="l01307"></a>01307             <a class="code" href="structArmISA_1_1ISA.html#a75a36d9a23fa7fed74f4be02097aac1b">tlbiVA</a>(tc, newVal, asid, secure_lookup, target_el);
<a name="l01308"></a>01308             <span class="keywordflow">return</span>;
<a name="l01309"></a>01309           <span class="comment">// TLBI by VA, EL2</span>
<a name="l01310"></a>01310           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca0e00b864ccb2996916f03458d6beb524">MISCREG_TLBI_VAE2IS_Xt</a>:
<a name="l01311"></a>01311           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6863ce533fb25783fe16f79f0c9532b2">MISCREG_TLBI_VAE2_Xt</a>:
<a name="l01312"></a>01312           <span class="comment">// TLBI by VA, EL2, stage1 last level walk</span>
<a name="l01313"></a>01313           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca79b7c034d50297edd462f13fa1bf9f35">MISCREG_TLBI_VALE2IS_Xt</a>:
<a name="l01314"></a>01314           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caa60b933f31788dd242b58ab0f56ca079">MISCREG_TLBI_VALE2_Xt</a>:
<a name="l01315"></a>01315             <a class="code" href="structArmISA_1_1ISA.html#a8ec36493a37e78ea73079559e2289ab3">assert64</a>(tc);
<a name="l01316"></a>01316             target_el = 2;
<a name="l01317"></a>01317             asid = 0xbeef; <span class="comment">// does not matter, tlbi is global</span>
<a name="l01318"></a>01318             scr = <a class="code" href="structArmISA_1_1ISA.html#a1a89f346ae6d1ebe6475c53151ee0187">readMiscReg</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6ec2fd6368d4b6668ee8155fc93d93b8">MISCREG_SCR</a>, tc);
<a name="l01319"></a>01319             secure_lookup = <a class="code" href="structArmISA_1_1ISA.html#a2b5cf38edef41a2219914fabbe91bca9">haveSecurity</a> &amp;&amp; !scr.ns;
<a name="l01320"></a>01320             <a class="code" href="structArmISA_1_1ISA.html#a75a36d9a23fa7fed74f4be02097aac1b">tlbiVA</a>(tc, newVal, asid, secure_lookup, target_el);
<a name="l01321"></a>01321             <span class="keywordflow">return</span>;
<a name="l01322"></a>01322           <span class="comment">// TLBI by VA EL1 &amp; 0, stage1, ASID, current VMID</span>
<a name="l01323"></a>01323           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca91cba30f8a939d27f1e3a54ccc6f44ce">MISCREG_TLBI_VAE1IS_Xt</a>:
<a name="l01324"></a>01324           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca74286deb81ace4783a59e67b8c39add0">MISCREG_TLBI_VAE1_Xt</a>:
<a name="l01325"></a>01325           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cab429365aa2f1fbb96d053348fa39fdd0">MISCREG_TLBI_VALE1IS_Xt</a>:
<a name="l01326"></a>01326           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca9d5a38f35665d1d75d544cdef2ba7ec6">MISCREG_TLBI_VALE1_Xt</a>:
<a name="l01327"></a>01327             <a class="code" href="structArmISA_1_1ISA.html#a8ec36493a37e78ea73079559e2289ab3">assert64</a>(tc);
<a name="l01328"></a>01328             asid = <a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123" title="Extract the bitfield from position &amp;#39;first&amp;#39; to &amp;#39;last&amp;#39; (inclusive)...">bits</a>(newVal, 63, 48);
<a name="l01329"></a>01329             target_el = 1; <span class="comment">// el 0 and 1 are handled together</span>
<a name="l01330"></a>01330             scr = <a class="code" href="structArmISA_1_1ISA.html#a1a89f346ae6d1ebe6475c53151ee0187">readMiscReg</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6ec2fd6368d4b6668ee8155fc93d93b8">MISCREG_SCR</a>, tc);
<a name="l01331"></a>01331             secure_lookup = <a class="code" href="structArmISA_1_1ISA.html#a2b5cf38edef41a2219914fabbe91bca9">haveSecurity</a> &amp;&amp; !scr.ns;
<a name="l01332"></a>01332             <a class="code" href="structArmISA_1_1ISA.html#a75a36d9a23fa7fed74f4be02097aac1b">tlbiVA</a>(tc, newVal, asid, secure_lookup, target_el);
<a name="l01333"></a>01333             <span class="keywordflow">return</span>;
<a name="l01334"></a>01334           <span class="comment">// AArch64 TLBI: invalidate by ASID, stage 1, current VMID</span>
<a name="l01335"></a>01335           <span class="comment">// @todo: handle VMID to enable Virtualization</span>
<a name="l01336"></a>01336           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6835186a9dd53568756680ebf622e2f1">MISCREG_TLBI_ASIDE1IS_Xt</a>:
<a name="l01337"></a>01337           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca78a101d810b6100f2353bc7a0b978e82">MISCREG_TLBI_ASIDE1_Xt</a>:
<a name="l01338"></a>01338             <a class="code" href="structArmISA_1_1ISA.html#a8ec36493a37e78ea73079559e2289ab3">assert64</a>(tc);
<a name="l01339"></a>01339             target_el = 1; <span class="comment">// el 0 and 1 are handled together</span>
<a name="l01340"></a>01340             scr = <a class="code" href="structArmISA_1_1ISA.html#a1a89f346ae6d1ebe6475c53151ee0187">readMiscReg</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6ec2fd6368d4b6668ee8155fc93d93b8">MISCREG_SCR</a>, tc);
<a name="l01341"></a>01341             secure_lookup = <a class="code" href="structArmISA_1_1ISA.html#a2b5cf38edef41a2219914fabbe91bca9">haveSecurity</a> &amp;&amp; !scr.ns;
<a name="l01342"></a>01342             sys = tc-&gt;<a class="code" href="classThreadContext.html#a119dd28f703f77bafb74788f8110300c">getSystemPtr</a>();
<a name="l01343"></a>01343             <span class="keywordflow">for</span> (x = 0; x &lt; sys-&gt;<a class="code" href="classSystem.html#ab123a0793826eea0796f70ec2b2e07f7">numContexts</a>(); x++) {
<a name="l01344"></a>01344                 oc = sys-&gt;<a class="code" href="classSystem.html#a289079f61fbd11f0c41b5e62ea6844ff">getThreadContext</a>(x);
<a name="l01345"></a>01345                 assert(oc-&gt;<a class="code" href="classThreadContext.html#a71910c6ab34a67cb0bc65dbc874cbb27">getITBPtr</a>() &amp;&amp; oc-&gt;<a class="code" href="classThreadContext.html#a66f0298b284053daa1f4318c585c091f">getDTBPtr</a>());
<a name="l01346"></a>01346                 asid = <a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123" title="Extract the bitfield from position &amp;#39;first&amp;#39; to &amp;#39;last&amp;#39; (inclusive)...">bits</a>(newVal, 63, 48);
<a name="l01347"></a>01347                 <span class="keywordflow">if</span> (!<a class="code" href="structArmISA_1_1ISA.html#a2856f99be78123643814dc843efdd874">haveLargeAsid64</a>)
<a name="l01348"></a>01348                     asid &amp;= <a class="code" href="namespaceArmISA.html#aedf8742bbf65a60cf102a4b3f9ba3d68">mask</a>(8);
<a name="l01349"></a>01349                 oc-&gt;<a class="code" href="classThreadContext.html#a71910c6ab34a67cb0bc65dbc874cbb27">getITBPtr</a>()-&gt;flushAsid(asid, secure_lookup, target_el);
<a name="l01350"></a>01350                 oc-&gt;<a class="code" href="classThreadContext.html#a66f0298b284053daa1f4318c585c091f">getDTBPtr</a>()-&gt;flushAsid(asid, secure_lookup, target_el);
<a name="l01351"></a>01351                 <a class="code" href="classCheckerCPU.html" title="CheckerCPU class.">CheckerCPU</a> *checker = oc-&gt;<a class="code" href="classThreadContext.html#a594e114a4cc2ff653bc8a30fe49b986b">getCheckerCpuPtr</a>();
<a name="l01352"></a>01352                 <span class="keywordflow">if</span> (checker) {
<a name="l01353"></a>01353                     checker-&gt;<a class="code" href="classCheckerCPU.html#a9a1bb6b2d38e725012d11831c25780c3">getITBPtr</a>()-&gt;flushAsid(asid,
<a name="l01354"></a>01354                         secure_lookup, target_el);
<a name="l01355"></a>01355                     checker-&gt;<a class="code" href="classCheckerCPU.html#a29eaa07d1ac8f4cbe8c7e24be85765fa">getDTBPtr</a>()-&gt;flushAsid(asid,
<a name="l01356"></a>01356                         secure_lookup, target_el);
<a name="l01357"></a>01357                 }
<a name="l01358"></a>01358             }
<a name="l01359"></a>01359             <span class="keywordflow">return</span>;
<a name="l01360"></a>01360           <span class="comment">// AArch64 TLBI: invalidate by VA, ASID, stage 1, current VMID</span>
<a name="l01361"></a>01361           <span class="comment">// VAAE1(IS) and VAALE1(IS) are the same because TLBs only store</span>
<a name="l01362"></a>01362           <span class="comment">// entries from the last level of translation table walks</span>
<a name="l01363"></a>01363           <span class="comment">// @todo: handle VMID to enable Virtualization</span>
<a name="l01364"></a>01364           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cab534432dcce55c6ce03b514e4a898067">MISCREG_TLBI_VAAE1IS_Xt</a>:
<a name="l01365"></a>01365           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caca12d96085a6e1c6bbeaff01525915ba">MISCREG_TLBI_VAAE1_Xt</a>:
<a name="l01366"></a>01366           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cad74b554719c6c9c0140b23023b86f754">MISCREG_TLBI_VAALE1IS_Xt</a>:
<a name="l01367"></a>01367           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca044b02f827e33c3580341dbe0608ea85">MISCREG_TLBI_VAALE1_Xt</a>:
<a name="l01368"></a>01368             <a class="code" href="structArmISA_1_1ISA.html#a8ec36493a37e78ea73079559e2289ab3">assert64</a>(tc);
<a name="l01369"></a>01369             target_el = 1; <span class="comment">// el 0 and 1 are handled together</span>
<a name="l01370"></a>01370             scr = <a class="code" href="structArmISA_1_1ISA.html#a1a89f346ae6d1ebe6475c53151ee0187">readMiscReg</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6ec2fd6368d4b6668ee8155fc93d93b8">MISCREG_SCR</a>, tc);
<a name="l01371"></a>01371             secure_lookup = <a class="code" href="structArmISA_1_1ISA.html#a2b5cf38edef41a2219914fabbe91bca9">haveSecurity</a> &amp;&amp; !scr.ns;
<a name="l01372"></a>01372             sys = tc-&gt;<a class="code" href="classThreadContext.html#a119dd28f703f77bafb74788f8110300c">getSystemPtr</a>();
<a name="l01373"></a>01373             <span class="keywordflow">for</span> (x = 0; x &lt; sys-&gt;<a class="code" href="classSystem.html#ab123a0793826eea0796f70ec2b2e07f7">numContexts</a>(); x++) {
<a name="l01374"></a>01374                 <span class="comment">// @todo: extra controls on TLBI broadcast?</span>
<a name="l01375"></a>01375                 oc = sys-&gt;<a class="code" href="classSystem.html#a289079f61fbd11f0c41b5e62ea6844ff">getThreadContext</a>(x);
<a name="l01376"></a>01376                 assert(oc-&gt;<a class="code" href="classThreadContext.html#a71910c6ab34a67cb0bc65dbc874cbb27">getITBPtr</a>() &amp;&amp; oc-&gt;<a class="code" href="classThreadContext.html#a66f0298b284053daa1f4318c585c091f">getDTBPtr</a>());
<a name="l01377"></a>01377                 <a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232" title="Address type This will probably be moved somewhere else in the near future.">Addr</a> <a class="code" href="namespaceArmISA.html#aa9331aab1c34d5babc25ea53e521b708">va</a> = ((<a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232" title="Address type This will probably be moved somewhere else in the near future.">Addr</a>) <a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123" title="Extract the bitfield from position &amp;#39;first&amp;#39; to &amp;#39;last&amp;#39; (inclusive)...">bits</a>(newVal, 43, 0)) &lt;&lt; 12;
<a name="l01378"></a>01378                 oc-&gt;<a class="code" href="classThreadContext.html#a71910c6ab34a67cb0bc65dbc874cbb27">getITBPtr</a>()-&gt;flushMva(va,
<a name="l01379"></a>01379                     secure_lookup, <span class="keyword">false</span>, target_el);
<a name="l01380"></a>01380                 oc-&gt;<a class="code" href="classThreadContext.html#a66f0298b284053daa1f4318c585c091f">getDTBPtr</a>()-&gt;flushMva(va,
<a name="l01381"></a>01381                     secure_lookup, <span class="keyword">false</span>, target_el);
<a name="l01382"></a>01382 
<a name="l01383"></a>01383                 <a class="code" href="classCheckerCPU.html" title="CheckerCPU class.">CheckerCPU</a> *checker = oc-&gt;<a class="code" href="classThreadContext.html#a594e114a4cc2ff653bc8a30fe49b986b">getCheckerCpuPtr</a>();
<a name="l01384"></a>01384                 <span class="keywordflow">if</span> (checker) {
<a name="l01385"></a>01385                     checker-&gt;<a class="code" href="classCheckerCPU.html#a9a1bb6b2d38e725012d11831c25780c3">getITBPtr</a>()-&gt;flushMva(va,
<a name="l01386"></a>01386                         secure_lookup, <span class="keyword">false</span>, target_el);
<a name="l01387"></a>01387                     checker-&gt;<a class="code" href="classCheckerCPU.html#a29eaa07d1ac8f4cbe8c7e24be85765fa">getDTBPtr</a>()-&gt;flushMva(va,
<a name="l01388"></a>01388                         secure_lookup, <span class="keyword">false</span>, target_el);
<a name="l01389"></a>01389                 }
<a name="l01390"></a>01390             }
<a name="l01391"></a>01391             <span class="keywordflow">return</span>;
<a name="l01392"></a>01392           <span class="comment">// AArch64 TLBI: invalidate by IPA, stage 2, current VMID</span>
<a name="l01393"></a>01393           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca583bc22cfa68a367339a8febfc90333c">MISCREG_TLBI_IPAS2LE1IS_Xt</a>:
<a name="l01394"></a>01394           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cad410a81c26fddedb1c1429a334214075">MISCREG_TLBI_IPAS2LE1_Xt</a>:
<a name="l01395"></a>01395           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cabe9fe1e4bd6a11d5d2336fc494848c23">MISCREG_TLBI_IPAS2E1IS_Xt</a>:
<a name="l01396"></a>01396           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cabf8dcf93a14c9520db4efa7ccb68b93f">MISCREG_TLBI_IPAS2E1_Xt</a>:
<a name="l01397"></a>01397             <a class="code" href="structArmISA_1_1ISA.html#a8ec36493a37e78ea73079559e2289ab3">assert64</a>(tc);
<a name="l01398"></a>01398             <span class="comment">// @todo: implement these as part of Virtualization</span>
<a name="l01399"></a>01399             <a class="code" href="base_2misc_8hh.html#a8224a361dddd2ad59b411982e5ea746f">warn</a>(<span class="stringliteral">&quot;Not doing anything for write of miscreg ITLB_IPAS2\n&quot;</span>);
<a name="l01400"></a>01400             <span class="keywordflow">return</span>;
<a name="l01401"></a>01401           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6827da006da460886fdcd488c3a119a0">MISCREG_ACTLR</a>:
<a name="l01402"></a>01402             <a class="code" href="base_2misc_8hh.html#a8224a361dddd2ad59b411982e5ea746f">warn</a>(<span class="stringliteral">&quot;Not doing anything for write of miscreg ACTLR\n&quot;</span>);
<a name="l01403"></a>01403             <span class="keywordflow">break</span>;
<a name="l01404"></a>01404 
<a name="l01405"></a>01405           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caeef899821c19dd5493d8bd98acffd4e4">MISCREG_PMXEVTYPER_PMCCFILTR</a>:
<a name="l01406"></a>01406           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca2085b2b651e11b2a29ef484a21f88173">MISCREG_PMINTENSET_EL1</a> ... <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cabc94068b71b9fc4fb93b1eb56beea516">MISCREG_PMOVSSET_EL0</a>:
<a name="l01407"></a>01407           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca23ff27da919b86d96764817c6e17da90">MISCREG_PMEVCNTR0_EL0</a> ... <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca9b4952560e9bd7ca38f5d510282937f6">MISCREG_PMEVTYPER5_EL0</a>:
<a name="l01408"></a>01408           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6c0878622bb5a09bfd8c9c2e2aee6ae7">MISCREG_PMCR</a> ... <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca5c4a6fba359353a9ce354a9a1d36ee6a">MISCREG_PMOVSSET</a>:
<a name="l01409"></a>01409             <a class="code" href="structArmISA_1_1ISA.html#a3399d9bc3fccb0d7321b6db8ec32e12e">pmu</a>-&gt;<a class="code" href="classArmISA_1_1BaseISADevice.html#ade3e3af7cf5da0025e56e81b6b776318" title="Write to a system register belonging to this device.">setMiscReg</a>(misc_reg, newVal);
<a name="l01410"></a>01410             <span class="keywordflow">break</span>;
<a name="l01411"></a>01411 
<a name="l01412"></a>01412 
<a name="l01413"></a>01413           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6b82a84c0a0b651d68df7a89ad8d9509">MISCREG_HSTR</a>: <span class="comment">// TJDBX, now redifined to be RES0</span>
<a name="l01414"></a>01414             {
<a name="l01415"></a>01415                 HSTR hstrMask = 0;
<a name="l01416"></a>01416                 hstrMask.tjdbx = 1;
<a name="l01417"></a>01417                 newVal &amp;= ~((uint32_t) hstrMask);
<a name="l01418"></a>01418                 <span class="keywordflow">break</span>;
<a name="l01419"></a>01419             }
<a name="l01420"></a>01420           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cae4a87918573b1f768605e2b9d9d8997f">MISCREG_HCPTR</a>:
<a name="l01421"></a>01421             {
<a name="l01422"></a>01422                 <span class="comment">// If a CP bit in NSACR is 0 then the corresponding bit in</span>
<a name="l01423"></a>01423                 <span class="comment">// HCPTR is RAO/WI. Same applies to NSASEDIS</span>
<a name="l01424"></a>01424                 secure_lookup = <a class="code" href="structArmISA_1_1ISA.html#a2b5cf38edef41a2219914fabbe91bca9">haveSecurity</a> &amp;&amp;
<a name="l01425"></a>01425                     <a class="code" href="namespaceArmISA.html#abb263f4ec2a2852ac26b5c33c6f5897b">inSecureState</a>(<a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6ec2fd6368d4b6668ee8155fc93d93b8">MISCREG_SCR</a>),
<a name="l01426"></a>01426                                   <a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca1d2df46d160cfa336591aaebdd6f99ba">MISCREG_CPSR</a>));
<a name="l01427"></a>01427                 <span class="keywordflow">if</span> (!secure_lookup) {
<a name="l01428"></a>01428                     <a class="code" href="namespaceArmISA.html#ae6de70120f06c08f390947f9e5cf7f7a">MiscReg</a> oldValue = <a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cae4a87918573b1f768605e2b9d9d8997f">MISCREG_HCPTR</a>);
<a name="l01429"></a>01429                     <a class="code" href="namespaceArmISA.html#ae6de70120f06c08f390947f9e5cf7f7a">MiscReg</a> mask = (<a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca227ca1dc43b4cc7be618d433e8e9bf07">MISCREG_NSACR</a>) ^ 0x7FFF) &amp; 0xBFFF;
<a name="l01430"></a>01430                     newVal = (newVal &amp; ~mask) | (oldValue &amp; mask);
<a name="l01431"></a>01431                 }
<a name="l01432"></a>01432                 <span class="keywordflow">break</span>;
<a name="l01433"></a>01433             }
<a name="l01434"></a>01434           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca52f0ff1daa8b976035d238029243ec9a">MISCREG_HDFAR</a>: <span class="comment">// alias for secure DFAR</span>
<a name="l01435"></a>01435             misc_reg = <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca70221da844bfb51ee592e571c59d8499">MISCREG_DFAR_S</a>;
<a name="l01436"></a>01436             <span class="keywordflow">break</span>;
<a name="l01437"></a>01437           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca52a41307defcb5fb997785be15877013">MISCREG_HIFAR</a>: <span class="comment">// alias for secure IFAR</span>
<a name="l01438"></a>01438             misc_reg = <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca3c24661983e158c2111c319db6fd4259">MISCREG_IFAR_S</a>;
<a name="l01439"></a>01439             <span class="keywordflow">break</span>;
<a name="l01440"></a>01440           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca1ba962a047972a6f2f7dad79de7be02a">MISCREG_ATS1CPR</a>:
<a name="l01441"></a>01441           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca0e72be333ef1543cc001ca9ae9f63445">MISCREG_ATS1CPW</a>:
<a name="l01442"></a>01442           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca24475198501dbf7113f730a6333b2718">MISCREG_ATS1CUR</a>:
<a name="l01443"></a>01443           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca0e4fb818ffdf772cc11e4caa0543538b">MISCREG_ATS1CUW</a>:
<a name="l01444"></a>01444           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cab9d125d426080bcc1d3499276d52e417">MISCREG_ATS12NSOPR</a>:
<a name="l01445"></a>01445           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caa38f0b5aad0a2e942e7ff6852395674b">MISCREG_ATS12NSOPW</a>:
<a name="l01446"></a>01446           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca3d31459809ae96d11b5f52bca0671ef3">MISCREG_ATS12NSOUR</a>:
<a name="l01447"></a>01447           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caf62e36359ee757b41e53c409ba9bfc69">MISCREG_ATS12NSOUW</a>:
<a name="l01448"></a>01448           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca20c0c15b945aded913fccb58caa31112">MISCREG_ATS1HR</a>:
<a name="l01449"></a>01449           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caafd2fc15216221de638c65ab6deeb9ff">MISCREG_ATS1HW</a>:
<a name="l01450"></a>01450             {
<a name="l01451"></a>01451               <span class="keywordtype">unsigned</span> flags = 0;
<a name="l01452"></a>01452               <a class="code" href="classBaseTLB.html#a26b67ef35b9f92e337acf48571c7585e">BaseTLB::Mode</a> <a class="code" href="namespaceArmISA.html#aab42c0db74065d35a4e8809e56f72f97">mode</a> = <a class="code" href="classBaseTLB.html#a26b67ef35b9f92e337acf48571c7585eaf4cd684f5d76a9d7d92f583393d1655f">BaseTLB::Read</a>;
<a name="l01453"></a>01453               <a class="code" href="classArmISA_1_1TLB.html#a8aaaf238d2bfe38a64a59fa71b2c4094">TLB::ArmTranslationType</a> tranType = <a class="code" href="classArmISA_1_1TLB.html#a8aaaf238d2bfe38a64a59fa71b2c4094aea46ff1625d97c2befb3695ac3bdbeeb">TLB::NormalTran</a>;
<a name="l01454"></a>01454               <a class="code" href="base_2types_8hh.html#afbdce43497ec3a10ccb2d2141fb1def1">Fault</a> fault;
<a name="l01455"></a>01455               <span class="keywordflow">switch</span>(misc_reg) {
<a name="l01456"></a>01456                 <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca1ba962a047972a6f2f7dad79de7be02a">MISCREG_ATS1CPR</a>:
<a name="l01457"></a>01457                   flags    = <a class="code" href="classArmISA_1_1TLB.html#a197413c7b18469b1f2130a40ea995cbba8f0bd8656496d2a811b655f4eb6804ab">TLB::MustBeOne</a>;
<a name="l01458"></a>01458                   tranType = <a class="code" href="classArmISA_1_1TLB.html#a8aaaf238d2bfe38a64a59fa71b2c4094a1d876ec22cd787c6b4c47f2f97c043c0">TLB::S1CTran</a>;
<a name="l01459"></a>01459                   mode     = <a class="code" href="classBaseTLB.html#a26b67ef35b9f92e337acf48571c7585eaf4cd684f5d76a9d7d92f583393d1655f">BaseTLB::Read</a>;
<a name="l01460"></a>01460                   <span class="keywordflow">break</span>;
<a name="l01461"></a>01461                 <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca0e72be333ef1543cc001ca9ae9f63445">MISCREG_ATS1CPW</a>:
<a name="l01462"></a>01462                   flags    = <a class="code" href="classArmISA_1_1TLB.html#a197413c7b18469b1f2130a40ea995cbba8f0bd8656496d2a811b655f4eb6804ab">TLB::MustBeOne</a>;
<a name="l01463"></a>01463                   tranType = <a class="code" href="classArmISA_1_1TLB.html#a8aaaf238d2bfe38a64a59fa71b2c4094a1d876ec22cd787c6b4c47f2f97c043c0">TLB::S1CTran</a>;
<a name="l01464"></a>01464                   mode     = <a class="code" href="classBaseTLB.html#a26b67ef35b9f92e337acf48571c7585ea19df812c62f939e92e6d395572c900b5">BaseTLB::Write</a>;
<a name="l01465"></a>01465                   <span class="keywordflow">break</span>;
<a name="l01466"></a>01466                 <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca24475198501dbf7113f730a6333b2718">MISCREG_ATS1CUR</a>:
<a name="l01467"></a>01467                   flags    = <a class="code" href="classArmISA_1_1TLB.html#a197413c7b18469b1f2130a40ea995cbba8f0bd8656496d2a811b655f4eb6804ab">TLB::MustBeOne</a> | <a class="code" href="classArmISA_1_1TLB.html#a197413c7b18469b1f2130a40ea995cbba3b6e86a4a2b30349df260f325e251c35">TLB::UserMode</a>;
<a name="l01468"></a>01468                   tranType = <a class="code" href="classArmISA_1_1TLB.html#a8aaaf238d2bfe38a64a59fa71b2c4094a1d876ec22cd787c6b4c47f2f97c043c0">TLB::S1CTran</a>;
<a name="l01469"></a>01469                   mode     = <a class="code" href="classBaseTLB.html#a26b67ef35b9f92e337acf48571c7585eaf4cd684f5d76a9d7d92f583393d1655f">BaseTLB::Read</a>;
<a name="l01470"></a>01470                   <span class="keywordflow">break</span>;
<a name="l01471"></a>01471                 <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca0e4fb818ffdf772cc11e4caa0543538b">MISCREG_ATS1CUW</a>:
<a name="l01472"></a>01472                   flags    = <a class="code" href="classArmISA_1_1TLB.html#a197413c7b18469b1f2130a40ea995cbba8f0bd8656496d2a811b655f4eb6804ab">TLB::MustBeOne</a> | <a class="code" href="classArmISA_1_1TLB.html#a197413c7b18469b1f2130a40ea995cbba3b6e86a4a2b30349df260f325e251c35">TLB::UserMode</a>;
<a name="l01473"></a>01473                   tranType = <a class="code" href="classArmISA_1_1TLB.html#a8aaaf238d2bfe38a64a59fa71b2c4094a1d876ec22cd787c6b4c47f2f97c043c0">TLB::S1CTran</a>;
<a name="l01474"></a>01474                   mode     = <a class="code" href="classBaseTLB.html#a26b67ef35b9f92e337acf48571c7585ea19df812c62f939e92e6d395572c900b5">BaseTLB::Write</a>;
<a name="l01475"></a>01475                   <span class="keywordflow">break</span>;
<a name="l01476"></a>01476                 <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cab9d125d426080bcc1d3499276d52e417">MISCREG_ATS12NSOPR</a>:
<a name="l01477"></a>01477                   <span class="keywordflow">if</span> (!<a class="code" href="structArmISA_1_1ISA.html#a2b5cf38edef41a2219914fabbe91bca9">haveSecurity</a>)
<a name="l01478"></a>01478                       <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Security Extensions required for ATS12NSOPR&quot;</span>);
<a name="l01479"></a>01479                   flags    = <a class="code" href="classArmISA_1_1TLB.html#a197413c7b18469b1f2130a40ea995cbba8f0bd8656496d2a811b655f4eb6804ab">TLB::MustBeOne</a>;
<a name="l01480"></a>01480                   tranType = <a class="code" href="classArmISA_1_1TLB.html#a8aaaf238d2bfe38a64a59fa71b2c4094a4ed197054e9e92dcc10ed6a427a1cf21">TLB::S1S2NsTran</a>;
<a name="l01481"></a>01481                   mode     = <a class="code" href="classBaseTLB.html#a26b67ef35b9f92e337acf48571c7585eaf4cd684f5d76a9d7d92f583393d1655f">BaseTLB::Read</a>;
<a name="l01482"></a>01482                   <span class="keywordflow">break</span>;
<a name="l01483"></a>01483                 <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caa38f0b5aad0a2e942e7ff6852395674b">MISCREG_ATS12NSOPW</a>:
<a name="l01484"></a>01484                   <span class="keywordflow">if</span> (!<a class="code" href="structArmISA_1_1ISA.html#a2b5cf38edef41a2219914fabbe91bca9">haveSecurity</a>)
<a name="l01485"></a>01485                       <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Security Extensions required for ATS12NSOPW&quot;</span>);
<a name="l01486"></a>01486                   flags    = <a class="code" href="classArmISA_1_1TLB.html#a197413c7b18469b1f2130a40ea995cbba8f0bd8656496d2a811b655f4eb6804ab">TLB::MustBeOne</a>;
<a name="l01487"></a>01487                   tranType = <a class="code" href="classArmISA_1_1TLB.html#a8aaaf238d2bfe38a64a59fa71b2c4094a4ed197054e9e92dcc10ed6a427a1cf21">TLB::S1S2NsTran</a>;
<a name="l01488"></a>01488                   mode     = <a class="code" href="classBaseTLB.html#a26b67ef35b9f92e337acf48571c7585ea19df812c62f939e92e6d395572c900b5">BaseTLB::Write</a>;
<a name="l01489"></a>01489                   <span class="keywordflow">break</span>;
<a name="l01490"></a>01490                 <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca3d31459809ae96d11b5f52bca0671ef3">MISCREG_ATS12NSOUR</a>:
<a name="l01491"></a>01491                   <span class="keywordflow">if</span> (!<a class="code" href="structArmISA_1_1ISA.html#a2b5cf38edef41a2219914fabbe91bca9">haveSecurity</a>)
<a name="l01492"></a>01492                       <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Security Extensions required for ATS12NSOUR&quot;</span>);
<a name="l01493"></a>01493                   flags    = <a class="code" href="classArmISA_1_1TLB.html#a197413c7b18469b1f2130a40ea995cbba8f0bd8656496d2a811b655f4eb6804ab">TLB::MustBeOne</a> | <a class="code" href="classArmISA_1_1TLB.html#a197413c7b18469b1f2130a40ea995cbba3b6e86a4a2b30349df260f325e251c35">TLB::UserMode</a>;
<a name="l01494"></a>01494                   tranType = <a class="code" href="classArmISA_1_1TLB.html#a8aaaf238d2bfe38a64a59fa71b2c4094a4ed197054e9e92dcc10ed6a427a1cf21">TLB::S1S2NsTran</a>;
<a name="l01495"></a>01495                   mode     = <a class="code" href="classBaseTLB.html#a26b67ef35b9f92e337acf48571c7585eaf4cd684f5d76a9d7d92f583393d1655f">BaseTLB::Read</a>;
<a name="l01496"></a>01496                   <span class="keywordflow">break</span>;
<a name="l01497"></a>01497                 <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caf62e36359ee757b41e53c409ba9bfc69">MISCREG_ATS12NSOUW</a>:
<a name="l01498"></a>01498                   <span class="keywordflow">if</span> (!<a class="code" href="structArmISA_1_1ISA.html#a2b5cf38edef41a2219914fabbe91bca9">haveSecurity</a>)
<a name="l01499"></a>01499                       <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Security Extensions required for ATS12NSOUW&quot;</span>);
<a name="l01500"></a>01500                   flags    = <a class="code" href="classArmISA_1_1TLB.html#a197413c7b18469b1f2130a40ea995cbba8f0bd8656496d2a811b655f4eb6804ab">TLB::MustBeOne</a> | <a class="code" href="classArmISA_1_1TLB.html#a197413c7b18469b1f2130a40ea995cbba3b6e86a4a2b30349df260f325e251c35">TLB::UserMode</a>;
<a name="l01501"></a>01501                   tranType = <a class="code" href="classArmISA_1_1TLB.html#a8aaaf238d2bfe38a64a59fa71b2c4094a4ed197054e9e92dcc10ed6a427a1cf21">TLB::S1S2NsTran</a>;
<a name="l01502"></a>01502                   mode     = <a class="code" href="classBaseTLB.html#a26b67ef35b9f92e337acf48571c7585ea19df812c62f939e92e6d395572c900b5">BaseTLB::Write</a>;
<a name="l01503"></a>01503                   <span class="keywordflow">break</span>;
<a name="l01504"></a>01504                 <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca20c0c15b945aded913fccb58caa31112">MISCREG_ATS1HR</a>: <span class="comment">// only really useful from secure mode.</span>
<a name="l01505"></a>01505                   flags    = <a class="code" href="classArmISA_1_1TLB.html#a197413c7b18469b1f2130a40ea995cbba8f0bd8656496d2a811b655f4eb6804ab">TLB::MustBeOne</a>;
<a name="l01506"></a>01506                   tranType = <a class="code" href="classArmISA_1_1TLB.html#a8aaaf238d2bfe38a64a59fa71b2c4094a05268cf17df4c0e18959c532f44c02d3">TLB::HypMode</a>;
<a name="l01507"></a>01507                   mode     = <a class="code" href="classBaseTLB.html#a26b67ef35b9f92e337acf48571c7585eaf4cd684f5d76a9d7d92f583393d1655f">BaseTLB::Read</a>;
<a name="l01508"></a>01508                   <span class="keywordflow">break</span>;
<a name="l01509"></a>01509                 <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caafd2fc15216221de638c65ab6deeb9ff">MISCREG_ATS1HW</a>:
<a name="l01510"></a>01510                   flags    = <a class="code" href="classArmISA_1_1TLB.html#a197413c7b18469b1f2130a40ea995cbba8f0bd8656496d2a811b655f4eb6804ab">TLB::MustBeOne</a>;
<a name="l01511"></a>01511                   tranType = <a class="code" href="classArmISA_1_1TLB.html#a8aaaf238d2bfe38a64a59fa71b2c4094a05268cf17df4c0e18959c532f44c02d3">TLB::HypMode</a>;
<a name="l01512"></a>01512                   mode     = <a class="code" href="classBaseTLB.html#a26b67ef35b9f92e337acf48571c7585ea19df812c62f939e92e6d395572c900b5">BaseTLB::Write</a>;
<a name="l01513"></a>01513                   <span class="keywordflow">break</span>;
<a name="l01514"></a>01514               }
<a name="l01515"></a>01515               <span class="comment">// If we&apos;re in timing mode then doing the translation in</span>
<a name="l01516"></a>01516               <span class="comment">// functional mode then we&apos;re slightly distorting performance</span>
<a name="l01517"></a>01517               <span class="comment">// results obtained from simulations. The translation should be</span>
<a name="l01518"></a>01518               <span class="comment">// done in the same mode the core is running in. NOTE: This</span>
<a name="l01519"></a>01519               <span class="comment">// can&apos;t be an atomic translation because that causes problems</span>
<a name="l01520"></a>01520               <span class="comment">// with unexpected atomic snoop requests.</span>
<a name="l01521"></a>01521               <a class="code" href="base_2misc_8hh.html#a8224a361dddd2ad59b411982e5ea746f">warn</a>(<span class="stringliteral">&quot;Translating via MISCREG(%d) in functional mode! Fix Me!\n&quot;</span>, misc_reg);
<a name="l01522"></a>01522               <a class="code" href="classRequest.html">Request</a> req(0, val, 1, flags,  <a class="code" href="classRequest.html#a3cf36924a7f39b5912cd76533023143e" title="This request id is used for functional requests that don&amp;#39;t come from a particular...">Request::funcMasterId</a>,
<a name="l01523"></a>01523                           tc-&gt;<a class="code" href="classThreadContext.html#ab15f0db0e7c7afb40dfbbbd13d62dc2e">pcState</a>().pc(), tc-&gt;<a class="code" href="classThreadContext.html#a24eb06bed6e31118e646e47a4b5f01e4">contextId</a>(),
<a name="l01524"></a>01524                           tc-&gt;<a class="code" href="classThreadContext.html#a9ffd283cc1a80721d5baf84ae2ee4d00">threadId</a>());
<a name="l01525"></a>01525               fault = tc-&gt;<a class="code" href="classThreadContext.html#a66f0298b284053daa1f4318c585c091f">getDTBPtr</a>()-&gt;translateFunctional(&amp;req, tc, mode, tranType);
<a name="l01526"></a>01526               TTBCR ttbcr = <a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca5bfc9d84a913f4403092c34f4fdb68f0">MISCREG_TTBCR</a>);
<a name="l01527"></a>01527               HCR   hcr   = <a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cacc6c0d54b3de785d3e9bd57250007f71">MISCREG_HCR</a>);
<a name="l01528"></a>01528 
<a name="l01529"></a>01529               <a class="code" href="namespaceArmISA.html#ae6de70120f06c08f390947f9e5cf7f7a">MiscReg</a> newVal;
<a name="l01530"></a>01530               <span class="keywordflow">if</span> (fault == NoFault) {
<a name="l01531"></a>01531                   <a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232" title="Address type This will probably be moved somewhere else in the near future.">Addr</a> paddr = req.getPaddr();
<a name="l01532"></a>01532                   <span class="keywordflow">if</span> (<a class="code" href="structArmISA_1_1ISA.html#a3aebe12b75ff4d71745ec872dddd0ac2">haveLPAE</a> &amp;&amp; (ttbcr.eae || tranType &amp; <a class="code" href="classArmISA_1_1TLB.html#a8aaaf238d2bfe38a64a59fa71b2c4094a05268cf17df4c0e18959c532f44c02d3">TLB::HypMode</a> ||
<a name="l01533"></a>01533                      ((tranType &amp; <a class="code" href="classArmISA_1_1TLB.html#a8aaaf238d2bfe38a64a59fa71b2c4094a4ed197054e9e92dcc10ed6a427a1cf21">TLB::S1S2NsTran</a>) &amp;&amp; hcr.vm) )) {
<a name="l01534"></a>01534                       newVal = (paddr &amp; <a class="code" href="namespaceArmISA.html#aedf8742bbf65a60cf102a4b3f9ba3d68">mask</a>(39, 12)) |
<a name="l01535"></a>01535                                (tc-&gt;<a class="code" href="classThreadContext.html#a66f0298b284053daa1f4318c585c091f">getDTBPtr</a>()-&gt;getAttr());
<a name="l01536"></a>01536                   } <span class="keywordflow">else</span> {
<a name="l01537"></a>01537                       newVal = (paddr &amp; 0xfffff000) |
<a name="l01538"></a>01538                                (tc-&gt;<a class="code" href="classThreadContext.html#a66f0298b284053daa1f4318c585c091f">getDTBPtr</a>()-&gt;getAttr());
<a name="l01539"></a>01539                   }
<a name="l01540"></a>01540                   <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(MiscRegs,
<a name="l01541"></a>01541                           <span class="stringliteral">&quot;MISCREG: Translated addr 0x%08x: PAR: 0x%08x\n&quot;</span>,
<a name="l01542"></a>01542                           val, newVal);
<a name="l01543"></a>01543               } <span class="keywordflow">else</span> {
<a name="l01544"></a>01544                   <a class="code" href="classArmISA_1_1ArmFault.html">ArmFault</a> *armFault = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="classArmISA_1_1ArmFault.html">ArmFault</a> *<span class="keyword">&gt;</span>(fault.get());
<a name="l01545"></a>01545                   <span class="comment">// Set fault bit and FSR</span>
<a name="l01546"></a>01546                   FSR fsr = armFault-&gt;<a class="code" href="classArmISA_1_1ArmFault.html#a7e855668d674eea06fd837322ab16600">getFsr</a>(tc);
<a name="l01547"></a>01547 
<a name="l01548"></a>01548                   newVal = ((fsr &gt;&gt; 9) &amp; 1) &lt;&lt; 11;
<a name="l01549"></a>01549                   <span class="keywordflow">if</span> (newVal) {
<a name="l01550"></a>01550                     <span class="comment">// LPAE - rearange fault status</span>
<a name="l01551"></a>01551                     newVal |= ((fsr &gt;&gt;  0) &amp; 0x3f) &lt;&lt; 1;
<a name="l01552"></a>01552                   } <span class="keywordflow">else</span> {
<a name="l01553"></a>01553                     <span class="comment">// VMSA - rearange fault status</span>
<a name="l01554"></a>01554                     newVal |= ((fsr &gt;&gt;  0) &amp; 0xf) &lt;&lt; 1;
<a name="l01555"></a>01555                     newVal |= ((fsr &gt;&gt; 10) &amp; 0x1) &lt;&lt; 5;
<a name="l01556"></a>01556                     newVal |= ((fsr &gt;&gt; 12) &amp; 0x1) &lt;&lt; 6;
<a name="l01557"></a>01557                   }
<a name="l01558"></a>01558                   newVal |= 0x1; <span class="comment">// F bit</span>
<a name="l01559"></a>01559                   newVal |= ((armFault-&gt;<a class="code" href="classArmISA_1_1ArmFault.html#af9738c784531315bb4ba685487e3104f">iss</a>() &gt;&gt; 7) &amp; 0x1) &lt;&lt; 8;
<a name="l01560"></a>01560                   newVal |= armFault-&gt;<a class="code" href="classArmISA_1_1ArmFault.html#a70e8e9a9f7ab1ca4c02588897ce61794">isStage2</a>() ? 0x200 : 0;
<a name="l01561"></a>01561                   <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(MiscRegs,
<a name="l01562"></a>01562                           <span class="stringliteral">&quot;MISCREG: Translated addr 0x%08x fault fsr %#x: PAR: 0x%08x\n&quot;</span>,
<a name="l01563"></a>01563                           val, fsr, newVal);
<a name="l01564"></a>01564               }
<a name="l01565"></a>01565               <a class="code" href="structArmISA_1_1ISA.html#a90cbf55664f2b0de9bea7be53a56cf2e">setMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca2963346f87bf29113a2fabb125b43f7a">MISCREG_PAR</a>, newVal);
<a name="l01566"></a>01566               <span class="keywordflow">return</span>;
<a name="l01567"></a>01567             }
<a name="l01568"></a>01568           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca5bfc9d84a913f4403092c34f4fdb68f0">MISCREG_TTBCR</a>:
<a name="l01569"></a>01569             {
<a name="l01570"></a>01570                 TTBCR ttbcr = <a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca5bfc9d84a913f4403092c34f4fdb68f0">MISCREG_TTBCR</a>);
<a name="l01571"></a>01571                 <span class="keyword">const</span> uint32_t ones = (uint32_t)(-1);
<a name="l01572"></a>01572                 TTBCR ttbcrMask = 0;
<a name="l01573"></a>01573                 TTBCR ttbcrNew = newVal;
<a name="l01574"></a>01574 
<a name="l01575"></a>01575                 <span class="comment">// ARM DDI 0406C.b, ARMv7-32</span>
<a name="l01576"></a>01576                 ttbcrMask.n = ones; <span class="comment">// T0SZ</span>
<a name="l01577"></a>01577                 <span class="keywordflow">if</span> (<a class="code" href="structArmISA_1_1ISA.html#a2b5cf38edef41a2219914fabbe91bca9">haveSecurity</a>) {
<a name="l01578"></a>01578                     ttbcrMask.pd0 = ones;
<a name="l01579"></a>01579                     ttbcrMask.pd1 = ones;
<a name="l01580"></a>01580                 }
<a name="l01581"></a>01581                 ttbcrMask.epd0 = ones;
<a name="l01582"></a>01582                 ttbcrMask.irgn0 = ones;
<a name="l01583"></a>01583                 ttbcrMask.orgn0 = ones;
<a name="l01584"></a>01584                 ttbcrMask.sh0 = ones;
<a name="l01585"></a>01585                 ttbcrMask.ps = ones; <span class="comment">// T1SZ</span>
<a name="l01586"></a>01586                 ttbcrMask.a1 = ones;
<a name="l01587"></a>01587                 ttbcrMask.epd1 = ones;
<a name="l01588"></a>01588                 ttbcrMask.irgn1 = ones;
<a name="l01589"></a>01589                 ttbcrMask.orgn1 = ones;
<a name="l01590"></a>01590                 ttbcrMask.sh1 = ones;
<a name="l01591"></a>01591                 <span class="keywordflow">if</span> (<a class="code" href="structArmISA_1_1ISA.html#a3aebe12b75ff4d71745ec872dddd0ac2">haveLPAE</a>)
<a name="l01592"></a>01592                     ttbcrMask.eae = ones;
<a name="l01593"></a>01593 
<a name="l01594"></a>01594                 <span class="keywordflow">if</span> (<a class="code" href="structArmISA_1_1ISA.html#a3aebe12b75ff4d71745ec872dddd0ac2">haveLPAE</a> &amp;&amp; ttbcrNew.eae) {
<a name="l01595"></a>01595                     newVal = newVal &amp; ttbcrMask;
<a name="l01596"></a>01596                 } <span class="keywordflow">else</span> {
<a name="l01597"></a>01597                     newVal = (newVal &amp; ttbcrMask) | (ttbcr &amp; (~ttbcrMask));
<a name="l01598"></a>01598                 }
<a name="l01599"></a>01599             }
<a name="l01600"></a>01600           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6a636c5129391c23216bcea3bde6f0f8">MISCREG_TTBR0</a>:
<a name="l01601"></a>01601           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cac0d0e5ddda9dea55e2ae3223a5f1c9fc">MISCREG_TTBR1</a>:
<a name="l01602"></a>01602             {
<a name="l01603"></a>01603                 TTBCR ttbcr = <a class="code" href="structArmISA_1_1ISA.html#a88660186b4803005fb5427577bdc4aa4">readMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca5bfc9d84a913f4403092c34f4fdb68f0">MISCREG_TTBCR</a>);
<a name="l01604"></a>01604                 <span class="keywordflow">if</span> (<a class="code" href="structArmISA_1_1ISA.html#a3aebe12b75ff4d71745ec872dddd0ac2">haveLPAE</a>) {
<a name="l01605"></a>01605                     <span class="keywordflow">if</span> (ttbcr.eae) {
<a name="l01606"></a>01606                         <span class="comment">// ARMv7 bit 63-56, 47-40 reserved, UNK/SBZP</span>
<a name="l01607"></a>01607                         <span class="comment">// ARMv8 AArch32 bit 63-56 only</span>
<a name="l01608"></a>01608                         uint64_t ttbrMask = <a class="code" href="namespaceArmISA.html#aedf8742bbf65a60cf102a4b3f9ba3d68">mask</a>(63,56) | <a class="code" href="namespaceArmISA.html#aedf8742bbf65a60cf102a4b3f9ba3d68">mask</a>(47,40);
<a name="l01609"></a>01609                         newVal = (newVal &amp; (~ttbrMask));
<a name="l01610"></a>01610                     }
<a name="l01611"></a>01611                 }
<a name="l01612"></a>01612             }
<a name="l01613"></a>01613           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca6a053ea48f0a33993f665a3583be7cce">MISCREG_SCTLR_EL1</a>:
<a name="l01614"></a>01614             {
<a name="l01615"></a>01615                 tc-&gt;<a class="code" href="classThreadContext.html#a71910c6ab34a67cb0bc65dbc874cbb27">getITBPtr</a>()-&gt;invalidateMiscReg();
<a name="l01616"></a>01616                 tc-&gt;<a class="code" href="classThreadContext.html#a66f0298b284053daa1f4318c585c091f">getDTBPtr</a>()-&gt;invalidateMiscReg();
<a name="l01617"></a>01617                 <a class="code" href="structArmISA_1_1ISA.html#a90cbf55664f2b0de9bea7be53a56cf2e">setMiscRegNoEffect</a>(misc_reg, newVal);
<a name="l01618"></a>01618             }
<a name="l01619"></a>01619           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cac2263aa3fc056992a20bdd9dce32c61c">MISCREG_CONTEXTIDR</a>:
<a name="l01620"></a>01620           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca558657ebddea41bb1fc2cf61e725f6a9">MISCREG_PRRR</a>:
<a name="l01621"></a>01621           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cac979e506d9ce19425eb582d6acd8cee0">MISCREG_NMRR</a>:
<a name="l01622"></a>01622           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca4f258252d52941bc7a97300ab7fd967e">MISCREG_MAIR0</a>:
<a name="l01623"></a>01623           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca890e14915a3e3da7c6637e71f8884633">MISCREG_MAIR1</a>:
<a name="l01624"></a>01624           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca75883e1c671c8d333ef80bbb64c09233">MISCREG_DACR</a>:
<a name="l01625"></a>01625           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caeb8a6ed844e484a42d84318742e9ad1d">MISCREG_VTTBR</a>:
<a name="l01626"></a>01626           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca25e01e2437793648b59e468b134153e4">MISCREG_SCR_EL3</a>:
<a name="l01627"></a>01627           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca483fe08e0ab9e0d7dccba21804547878">MISCREG_TCR_EL1</a>:
<a name="l01628"></a>01628           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caca13cb1ca00fd3bd2130da500c0b92bf">MISCREG_TCR_EL2</a>:
<a name="l01629"></a>01629           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cab0af73c5db0f641c99bcdf88b9ad7a60">MISCREG_TCR_EL3</a>:
<a name="l01630"></a>01630           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca4750c028a717da1f74e34035b16b9848">MISCREG_SCTLR_EL2</a>:
<a name="l01631"></a>01631           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca0b410ff413a02c9b8979d026cb151bcc">MISCREG_SCTLR_EL3</a>:
<a name="l01632"></a>01632           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca8445c66a08413a3565f5796bd9ac2d56">MISCREG_TTBR0_EL1</a>:
<a name="l01633"></a>01633           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca50ff79a603fadbd7cac516d7bbf28ee3">MISCREG_TTBR1_EL1</a>:
<a name="l01634"></a>01634           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca0eb9b86d344a323006d673c55417e9fd">MISCREG_TTBR0_EL2</a>:
<a name="l01635"></a>01635           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca59c8029c0336f282ed909147d6ad376e">MISCREG_TTBR0_EL3</a>:
<a name="l01636"></a>01636             tc-&gt;<a class="code" href="classThreadContext.html#a71910c6ab34a67cb0bc65dbc874cbb27">getITBPtr</a>()-&gt;invalidateMiscReg();
<a name="l01637"></a>01637             tc-&gt;<a class="code" href="classThreadContext.html#a66f0298b284053daa1f4318c585c091f">getDTBPtr</a>()-&gt;invalidateMiscReg();
<a name="l01638"></a>01638             <span class="keywordflow">break</span>;
<a name="l01639"></a>01639           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca087f90f8a16dcee78371adcf2462d8d2">MISCREG_NZCV</a>:
<a name="l01640"></a>01640             {
<a name="l01641"></a>01641                 CPSR cpsr = val;
<a name="l01642"></a>01642 
<a name="l01643"></a>01643                 tc-&gt;<a class="code" href="classThreadContext.html#aa9e42470b0b15e1dd4e69e6ef9d6877e">setCCReg</a>(<a class="code" href="namespaceArmISA.html#afbab0e7d68feea024ad3248f7ad74375a6caf2afe46c16a29dcbdc5718ae95463">CCREG_NZ</a>, cpsr.nz);
<a name="l01644"></a>01644                 tc-&gt;<a class="code" href="classThreadContext.html#aa9e42470b0b15e1dd4e69e6ef9d6877e">setCCReg</a>(<a class="code" href="namespaceArmISA.html#afbab0e7d68feea024ad3248f7ad74375af4aad7c6308575281c1a92a5a7ae3504">CCREG_C</a>,  cpsr.c);
<a name="l01645"></a>01645                 tc-&gt;<a class="code" href="classThreadContext.html#aa9e42470b0b15e1dd4e69e6ef9d6877e">setCCReg</a>(<a class="code" href="namespaceArmISA.html#afbab0e7d68feea024ad3248f7ad74375a06d5ab8df8dab970d45cfe16408262bc">CCREG_V</a>,  cpsr.v);
<a name="l01646"></a>01646             }
<a name="l01647"></a>01647             <span class="keywordflow">break</span>;
<a name="l01648"></a>01648           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca91c269465cc875f5528de43581f3901a">MISCREG_DAIF</a>:
<a name="l01649"></a>01649             {
<a name="l01650"></a>01650                 CPSR cpsr = <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca1d2df46d160cfa336591aaebdd6f99ba">MISCREG_CPSR</a>];
<a name="l01651"></a>01651                 cpsr.daif = (uint8_t) ((CPSR) newVal).<a class="code" href="namespaceArmISA.html#ab94f7a6415286a6dcb0c58e3fe4f191e">daif</a>;
<a name="l01652"></a>01652                 newVal = cpsr;
<a name="l01653"></a>01653                 misc_reg = <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca1d2df46d160cfa336591aaebdd6f99ba">MISCREG_CPSR</a>;
<a name="l01654"></a>01654             }
<a name="l01655"></a>01655             <span class="keywordflow">break</span>;
<a name="l01656"></a>01656           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cabb4600ac78743974130ebf8581b9beba">MISCREG_SP_EL0</a>:
<a name="l01657"></a>01657             tc-&gt;<a class="code" href="classThreadContext.html#ad008e016fd7ac09d11a85a80aa917b41">setIntReg</a>(<a class="code" href="namespaceArmISA.html#a28f9c55fc1ae496fd36bca4b09be4a5fa21fa949889362c27926c1965bb2073aa">INTREG_SP0</a>, newVal);
<a name="l01658"></a>01658             <span class="keywordflow">break</span>;
<a name="l01659"></a>01659           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cab42e1e8c6b691bc52dd4144ac05377d3">MISCREG_SP_EL1</a>:
<a name="l01660"></a>01660             tc-&gt;<a class="code" href="classThreadContext.html#ad008e016fd7ac09d11a85a80aa917b41">setIntReg</a>(<a class="code" href="namespaceArmISA.html#a28f9c55fc1ae496fd36bca4b09be4a5faebb0b7237f827c636a9b4dcb78697c51">INTREG_SP1</a>, newVal);
<a name="l01661"></a>01661             <span class="keywordflow">break</span>;
<a name="l01662"></a>01662           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caf5674665a5a4c9d27f6b42d0f34a2f6e">MISCREG_SP_EL2</a>:
<a name="l01663"></a>01663             tc-&gt;<a class="code" href="classThreadContext.html#ad008e016fd7ac09d11a85a80aa917b41">setIntReg</a>(<a class="code" href="namespaceArmISA.html#a28f9c55fc1ae496fd36bca4b09be4a5fa47d7f27a4ebfdf0d925d7e413a376243">INTREG_SP2</a>, newVal);
<a name="l01664"></a>01664             <span class="keywordflow">break</span>;
<a name="l01665"></a>01665           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cab2cbf3e305339d4934cb3c5972ccb16e">MISCREG_SPSEL</a>:
<a name="l01666"></a>01666             {
<a name="l01667"></a>01667                 CPSR cpsr = <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca1d2df46d160cfa336591aaebdd6f99ba">MISCREG_CPSR</a>];
<a name="l01668"></a>01668                 cpsr.sp = (uint8_t) ((CPSR) newVal).<a class="code" href="namespaceArmISA.html#a374fc69ddc2f21b9b13d2dcdcad3531f">sp</a>;
<a name="l01669"></a>01669                 newVal = cpsr;
<a name="l01670"></a>01670                 misc_reg = <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca1d2df46d160cfa336591aaebdd6f99ba">MISCREG_CPSR</a>;
<a name="l01671"></a>01671             }
<a name="l01672"></a>01672             <span class="keywordflow">break</span>;
<a name="l01673"></a>01673           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cac2a12012517b99ae0a5e437c08abf980">MISCREG_CURRENTEL</a>:
<a name="l01674"></a>01674             {
<a name="l01675"></a>01675                 CPSR cpsr = <a class="code" href="structArmISA_1_1ISA.html#ab52542b950526134ba96b9dc22a95030">miscRegs</a>[<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca1d2df46d160cfa336591aaebdd6f99ba">MISCREG_CPSR</a>];
<a name="l01676"></a>01676                 cpsr.el = (uint8_t) ((CPSR) newVal).<a class="code" href="namespaceArmISA.html#a536bb38d0b4534415c908e6796c9685b">el</a>;
<a name="l01677"></a>01677                 newVal = cpsr;
<a name="l01678"></a>01678                 misc_reg = <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca1d2df46d160cfa336591aaebdd6f99ba">MISCREG_CPSR</a>;
<a name="l01679"></a>01679             }
<a name="l01680"></a>01680             <span class="keywordflow">break</span>;
<a name="l01681"></a>01681           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca0bc74310160b9a89f9c0e3564ad68a4f">MISCREG_AT_S1E1R_Xt</a>:
<a name="l01682"></a>01682           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cad6357a936aeea919b0f95fde5f0a0e77">MISCREG_AT_S1E1W_Xt</a>:
<a name="l01683"></a>01683           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca567dd5a736bb8621d9cc7fc4f5a7fc43">MISCREG_AT_S1E0R_Xt</a>:
<a name="l01684"></a>01684           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caa8932b2f0aa24944298fa3a6a9b52ea5">MISCREG_AT_S1E0W_Xt</a>:
<a name="l01685"></a>01685           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cae9640f4ea488e0c0261b721e2325ef90">MISCREG_AT_S1E2R_Xt</a>:
<a name="l01686"></a>01686           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca429302703f6f489e9681c006252684ad">MISCREG_AT_S1E2W_Xt</a>:
<a name="l01687"></a>01687           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca35dc49aa33c2f270cbc89fff4103332f">MISCREG_AT_S12E1R_Xt</a>:
<a name="l01688"></a>01688           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caaf2bf1eeec24c007e19e9a995a47bac6">MISCREG_AT_S12E1W_Xt</a>:
<a name="l01689"></a>01689           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cae9ab8840c265e86bd339868d028298b5">MISCREG_AT_S12E0R_Xt</a>:
<a name="l01690"></a>01690           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca19955b37138e16426a27b51244498e8a">MISCREG_AT_S12E0W_Xt</a>:
<a name="l01691"></a>01691           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca4ba9662fe232e634ae52438fed010087">MISCREG_AT_S1E3R_Xt</a>:
<a name="l01692"></a>01692           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caabb39224602d449b6816124c7825d103">MISCREG_AT_S1E3W_Xt</a>:
<a name="l01693"></a>01693             {
<a name="l01694"></a>01694                 <a class="code" href="classRequest.html">RequestPtr</a> req = <span class="keyword">new</span> <a class="code" href="classRequest.html">Request</a>;
<a name="l01695"></a>01695                 <span class="keywordtype">unsigned</span> flags = 0;
<a name="l01696"></a>01696                 <a class="code" href="classBaseTLB.html#a26b67ef35b9f92e337acf48571c7585e">BaseTLB::Mode</a> mode = <a class="code" href="classBaseTLB.html#a26b67ef35b9f92e337acf48571c7585eaf4cd684f5d76a9d7d92f583393d1655f">BaseTLB::Read</a>;
<a name="l01697"></a>01697                 <a class="code" href="classArmISA_1_1TLB.html#a8aaaf238d2bfe38a64a59fa71b2c4094">TLB::ArmTranslationType</a> tranType = <a class="code" href="classArmISA_1_1TLB.html#a8aaaf238d2bfe38a64a59fa71b2c4094aea46ff1625d97c2befb3695ac3bdbeeb">TLB::NormalTran</a>;
<a name="l01698"></a>01698                 <a class="code" href="base_2types_8hh.html#afbdce43497ec3a10ccb2d2141fb1def1">Fault</a> fault;
<a name="l01699"></a>01699                 <span class="keywordflow">switch</span>(misc_reg) {
<a name="l01700"></a>01700                   <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca0bc74310160b9a89f9c0e3564ad68a4f">MISCREG_AT_S1E1R_Xt</a>:
<a name="l01701"></a>01701                     flags    = <a class="code" href="classArmISA_1_1TLB.html#a197413c7b18469b1f2130a40ea995cbba8f0bd8656496d2a811b655f4eb6804ab">TLB::MustBeOne</a>;
<a name="l01702"></a>01702                     tranType = <a class="code" href="classArmISA_1_1TLB.html#a8aaaf238d2bfe38a64a59fa71b2c4094a1d876ec22cd787c6b4c47f2f97c043c0">TLB::S1CTran</a>;
<a name="l01703"></a>01703                     mode     = <a class="code" href="classBaseTLB.html#a26b67ef35b9f92e337acf48571c7585eaf4cd684f5d76a9d7d92f583393d1655f">BaseTLB::Read</a>;
<a name="l01704"></a>01704                     <span class="keywordflow">break</span>;
<a name="l01705"></a>01705                   <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cad6357a936aeea919b0f95fde5f0a0e77">MISCREG_AT_S1E1W_Xt</a>:
<a name="l01706"></a>01706                     flags    = <a class="code" href="classArmISA_1_1TLB.html#a197413c7b18469b1f2130a40ea995cbba8f0bd8656496d2a811b655f4eb6804ab">TLB::MustBeOne</a>;
<a name="l01707"></a>01707                     tranType = <a class="code" href="classArmISA_1_1TLB.html#a8aaaf238d2bfe38a64a59fa71b2c4094a1d876ec22cd787c6b4c47f2f97c043c0">TLB::S1CTran</a>;
<a name="l01708"></a>01708                     mode     = <a class="code" href="classBaseTLB.html#a26b67ef35b9f92e337acf48571c7585ea19df812c62f939e92e6d395572c900b5">BaseTLB::Write</a>;
<a name="l01709"></a>01709                     <span class="keywordflow">break</span>;
<a name="l01710"></a>01710                   <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca567dd5a736bb8621d9cc7fc4f5a7fc43">MISCREG_AT_S1E0R_Xt</a>:
<a name="l01711"></a>01711                     flags    = <a class="code" href="classArmISA_1_1TLB.html#a197413c7b18469b1f2130a40ea995cbba8f0bd8656496d2a811b655f4eb6804ab">TLB::MustBeOne</a> | <a class="code" href="classArmISA_1_1TLB.html#a197413c7b18469b1f2130a40ea995cbba3b6e86a4a2b30349df260f325e251c35">TLB::UserMode</a>;
<a name="l01712"></a>01712                     tranType = <a class="code" href="classArmISA_1_1TLB.html#a8aaaf238d2bfe38a64a59fa71b2c4094a1d876ec22cd787c6b4c47f2f97c043c0">TLB::S1CTran</a>;
<a name="l01713"></a>01713                     mode     = <a class="code" href="classBaseTLB.html#a26b67ef35b9f92e337acf48571c7585eaf4cd684f5d76a9d7d92f583393d1655f">BaseTLB::Read</a>;
<a name="l01714"></a>01714                     <span class="keywordflow">break</span>;
<a name="l01715"></a>01715                   <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caa8932b2f0aa24944298fa3a6a9b52ea5">MISCREG_AT_S1E0W_Xt</a>:
<a name="l01716"></a>01716                     flags    = <a class="code" href="classArmISA_1_1TLB.html#a197413c7b18469b1f2130a40ea995cbba8f0bd8656496d2a811b655f4eb6804ab">TLB::MustBeOne</a> | <a class="code" href="classArmISA_1_1TLB.html#a197413c7b18469b1f2130a40ea995cbba3b6e86a4a2b30349df260f325e251c35">TLB::UserMode</a>;
<a name="l01717"></a>01717                     tranType = <a class="code" href="classArmISA_1_1TLB.html#a8aaaf238d2bfe38a64a59fa71b2c4094a1d876ec22cd787c6b4c47f2f97c043c0">TLB::S1CTran</a>;
<a name="l01718"></a>01718                     mode     = <a class="code" href="classBaseTLB.html#a26b67ef35b9f92e337acf48571c7585ea19df812c62f939e92e6d395572c900b5">BaseTLB::Write</a>;
<a name="l01719"></a>01719                     <span class="keywordflow">break</span>;
<a name="l01720"></a>01720                   <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cae9640f4ea488e0c0261b721e2325ef90">MISCREG_AT_S1E2R_Xt</a>:
<a name="l01721"></a>01721                     flags    = <a class="code" href="classArmISA_1_1TLB.html#a197413c7b18469b1f2130a40ea995cbba8f0bd8656496d2a811b655f4eb6804ab">TLB::MustBeOne</a>;
<a name="l01722"></a>01722                     tranType = <a class="code" href="classArmISA_1_1TLB.html#a8aaaf238d2bfe38a64a59fa71b2c4094a05268cf17df4c0e18959c532f44c02d3">TLB::HypMode</a>;
<a name="l01723"></a>01723                     mode     = <a class="code" href="classBaseTLB.html#a26b67ef35b9f92e337acf48571c7585eaf4cd684f5d76a9d7d92f583393d1655f">BaseTLB::Read</a>;
<a name="l01724"></a>01724                     <span class="keywordflow">break</span>;
<a name="l01725"></a>01725                   <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca429302703f6f489e9681c006252684ad">MISCREG_AT_S1E2W_Xt</a>:
<a name="l01726"></a>01726                     flags    = <a class="code" href="classArmISA_1_1TLB.html#a197413c7b18469b1f2130a40ea995cbba8f0bd8656496d2a811b655f4eb6804ab">TLB::MustBeOne</a>;
<a name="l01727"></a>01727                     tranType = <a class="code" href="classArmISA_1_1TLB.html#a8aaaf238d2bfe38a64a59fa71b2c4094a05268cf17df4c0e18959c532f44c02d3">TLB::HypMode</a>;
<a name="l01728"></a>01728                     mode     = <a class="code" href="classBaseTLB.html#a26b67ef35b9f92e337acf48571c7585ea19df812c62f939e92e6d395572c900b5">BaseTLB::Write</a>;
<a name="l01729"></a>01729                     <span class="keywordflow">break</span>;
<a name="l01730"></a>01730                   <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cae9ab8840c265e86bd339868d028298b5">MISCREG_AT_S12E0R_Xt</a>:
<a name="l01731"></a>01731                     flags    = <a class="code" href="classArmISA_1_1TLB.html#a197413c7b18469b1f2130a40ea995cbba8f0bd8656496d2a811b655f4eb6804ab">TLB::MustBeOne</a> | <a class="code" href="classArmISA_1_1TLB.html#a197413c7b18469b1f2130a40ea995cbba3b6e86a4a2b30349df260f325e251c35">TLB::UserMode</a>;
<a name="l01732"></a>01732                     tranType = TLB::S1S2NsTran;
<a name="l01733"></a>01733                     mode     = <a class="code" href="classBaseTLB.html#a26b67ef35b9f92e337acf48571c7585eaf4cd684f5d76a9d7d92f583393d1655f">BaseTLB::Read</a>;
<a name="l01734"></a>01734                     <span class="keywordflow">break</span>;
<a name="l01735"></a>01735                   <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca19955b37138e16426a27b51244498e8a">MISCREG_AT_S12E0W_Xt</a>:
<a name="l01736"></a>01736                     flags    = <a class="code" href="classArmISA_1_1TLB.html#a197413c7b18469b1f2130a40ea995cbba8f0bd8656496d2a811b655f4eb6804ab">TLB::MustBeOne</a> | <a class="code" href="classArmISA_1_1TLB.html#a197413c7b18469b1f2130a40ea995cbba3b6e86a4a2b30349df260f325e251c35">TLB::UserMode</a>;
<a name="l01737"></a>01737                     tranType = TLB::S1S2NsTran;
<a name="l01738"></a>01738                     mode     = <a class="code" href="classBaseTLB.html#a26b67ef35b9f92e337acf48571c7585ea19df812c62f939e92e6d395572c900b5">BaseTLB::Write</a>;
<a name="l01739"></a>01739                     <span class="keywordflow">break</span>;
<a name="l01740"></a>01740                   <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca35dc49aa33c2f270cbc89fff4103332f">MISCREG_AT_S12E1R_Xt</a>:
<a name="l01741"></a>01741                     flags    = <a class="code" href="classArmISA_1_1TLB.html#a197413c7b18469b1f2130a40ea995cbba8f0bd8656496d2a811b655f4eb6804ab">TLB::MustBeOne</a>;
<a name="l01742"></a>01742                     tranType = TLB::S1S2NsTran;
<a name="l01743"></a>01743                     mode     = <a class="code" href="classBaseTLB.html#a26b67ef35b9f92e337acf48571c7585eaf4cd684f5d76a9d7d92f583393d1655f">BaseTLB::Read</a>;
<a name="l01744"></a>01744                     <span class="keywordflow">break</span>;
<a name="l01745"></a>01745                   <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caaf2bf1eeec24c007e19e9a995a47bac6">MISCREG_AT_S12E1W_Xt</a>:
<a name="l01746"></a>01746                     flags    = <a class="code" href="classArmISA_1_1TLB.html#a197413c7b18469b1f2130a40ea995cbba8f0bd8656496d2a811b655f4eb6804ab">TLB::MustBeOne</a>;
<a name="l01747"></a>01747                     tranType = TLB::S1S2NsTran;
<a name="l01748"></a>01748                     mode     = <a class="code" href="classBaseTLB.html#a26b67ef35b9f92e337acf48571c7585ea19df812c62f939e92e6d395572c900b5">BaseTLB::Write</a>;
<a name="l01749"></a>01749                     <span class="keywordflow">break</span>;
<a name="l01750"></a>01750                   <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca4ba9662fe232e634ae52438fed010087">MISCREG_AT_S1E3R_Xt</a>:
<a name="l01751"></a>01751                     flags    = <a class="code" href="classArmISA_1_1TLB.html#a197413c7b18469b1f2130a40ea995cbba8f0bd8656496d2a811b655f4eb6804ab">TLB::MustBeOne</a>;
<a name="l01752"></a>01752                     tranType = <a class="code" href="classArmISA_1_1TLB.html#a8aaaf238d2bfe38a64a59fa71b2c4094a05268cf17df4c0e18959c532f44c02d3">TLB::HypMode</a>; <span class="comment">// There is no TZ mode defined.</span>
<a name="l01753"></a>01753                     mode     = <a class="code" href="classBaseTLB.html#a26b67ef35b9f92e337acf48571c7585eaf4cd684f5d76a9d7d92f583393d1655f">BaseTLB::Read</a>;
<a name="l01754"></a>01754                     <span class="keywordflow">break</span>;
<a name="l01755"></a>01755                   <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caabb39224602d449b6816124c7825d103">MISCREG_AT_S1E3W_Xt</a>:
<a name="l01756"></a>01756                     flags    = <a class="code" href="classArmISA_1_1TLB.html#a197413c7b18469b1f2130a40ea995cbba8f0bd8656496d2a811b655f4eb6804ab">TLB::MustBeOne</a>;
<a name="l01757"></a>01757                     tranType = <a class="code" href="classArmISA_1_1TLB.html#a8aaaf238d2bfe38a64a59fa71b2c4094a05268cf17df4c0e18959c532f44c02d3">TLB::HypMode</a>; <span class="comment">// There is no TZ mode defined.</span>
<a name="l01758"></a>01758                     mode     = <a class="code" href="classBaseTLB.html#a26b67ef35b9f92e337acf48571c7585ea19df812c62f939e92e6d395572c900b5">BaseTLB::Write</a>;
<a name="l01759"></a>01759                     <span class="keywordflow">break</span>;
<a name="l01760"></a>01760                 }
<a name="l01761"></a>01761                 <span class="comment">// If we&apos;re in timing mode then doing the translation in</span>
<a name="l01762"></a>01762                 <span class="comment">// functional mode then we&apos;re slightly distorting performance</span>
<a name="l01763"></a>01763                 <span class="comment">// results obtained from simulations. The translation should be</span>
<a name="l01764"></a>01764                 <span class="comment">// done in the same mode the core is running in. NOTE: This</span>
<a name="l01765"></a>01765                 <span class="comment">// can&apos;t be an atomic translation because that causes problems</span>
<a name="l01766"></a>01766                 <span class="comment">// with unexpected atomic snoop requests.</span>
<a name="l01767"></a>01767                 <a class="code" href="base_2misc_8hh.html#a8224a361dddd2ad59b411982e5ea746f">warn</a>(<span class="stringliteral">&quot;Translating via MISCREG(%d) in functional mode! Fix Me!\n&quot;</span>, misc_reg);
<a name="l01768"></a>01768                 req-&gt;<a class="code" href="classRequest.html#ac308d7b7145a7aaf9aa20c5e89fdf095" title="Set up a virtual (e.g., CPU) request in a previously allocated Request object.">setVirt</a>(0, val, 1, flags,  <a class="code" href="classRequest.html#a3cf36924a7f39b5912cd76533023143e" title="This request id is used for functional requests that don&amp;#39;t come from a particular...">Request::funcMasterId</a>,
<a name="l01769"></a>01769                                tc-&gt;<a class="code" href="classThreadContext.html#ab15f0db0e7c7afb40dfbbbd13d62dc2e">pcState</a>().pc());
<a name="l01770"></a>01770                 req-&gt;<a class="code" href="classRequest.html#a0b067551ee420e924c5e2402539df311" title="Set up CPU and thread numbers.">setThreadContext</a>(tc-&gt;<a class="code" href="classThreadContext.html#a24eb06bed6e31118e646e47a4b5f01e4">contextId</a>(), tc-&gt;<a class="code" href="classThreadContext.html#a9ffd283cc1a80721d5baf84ae2ee4d00">threadId</a>());
<a name="l01771"></a>01771                 fault = tc-&gt;<a class="code" href="classThreadContext.html#a66f0298b284053daa1f4318c585c091f">getDTBPtr</a>()-&gt;translateFunctional(req, tc, mode,
<a name="l01772"></a>01772                                                              tranType);
<a name="l01773"></a>01773 
<a name="l01774"></a>01774                 <a class="code" href="namespaceArmISA.html#ae6de70120f06c08f390947f9e5cf7f7a">MiscReg</a> newVal;
<a name="l01775"></a>01775                 <span class="keywordflow">if</span> (fault == NoFault) {
<a name="l01776"></a>01776                     <a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232" title="Address type This will probably be moved somewhere else in the near future.">Addr</a> paddr = req-&gt;<a class="code" href="classRequest.html#a7879d8a6ae8ad1af09a4cd55d7787fba">getPaddr</a>();
<a name="l01777"></a>01777                     uint64_t <a class="code" href="namespaceArmISA.html#a0ff9290207eddeb5cf7bfc3fa0c9cd14">attr</a> = tc-&gt;<a class="code" href="classThreadContext.html#a66f0298b284053daa1f4318c585c091f">getDTBPtr</a>()-&gt;getAttr();
<a name="l01778"></a>01778                     uint64_t attr1 = attr &gt;&gt; 56;
<a name="l01779"></a>01779                     <span class="keywordflow">if</span> (!attr1 || attr1 ==0x44) {
<a name="l01780"></a>01780                         attr |= 0x100;
<a name="l01781"></a>01781                         attr &amp;= ~ uint64_t(0x80);
<a name="l01782"></a>01782                     }
<a name="l01783"></a>01783                     newVal = (paddr &amp; <a class="code" href="namespaceArmISA.html#aedf8742bbf65a60cf102a4b3f9ba3d68">mask</a>(47, 12)) | attr;
<a name="l01784"></a>01784                     <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(MiscRegs,
<a name="l01785"></a>01785                           <span class="stringliteral">&quot;MISCREG: Translated addr %#x: PAR_EL1: %#xx\n&quot;</span>,
<a name="l01786"></a>01786                           val, newVal);
<a name="l01787"></a>01787                 } <span class="keywordflow">else</span> {
<a name="l01788"></a>01788                     <a class="code" href="classArmISA_1_1ArmFault.html">ArmFault</a> *armFault = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="classArmISA_1_1ArmFault.html">ArmFault</a> *<span class="keyword">&gt;</span>(fault.get());
<a name="l01789"></a>01789                     <span class="comment">// Set fault bit and FSR</span>
<a name="l01790"></a>01790                     FSR fsr = armFault-&gt;<a class="code" href="classArmISA_1_1ArmFault.html#a7e855668d674eea06fd837322ab16600">getFsr</a>(tc);
<a name="l01791"></a>01791 
<a name="l01792"></a>01792                     newVal = ((fsr &gt;&gt; 9) &amp; 1) &lt;&lt; 11;
<a name="l01793"></a>01793                     <span class="comment">// rearange fault status</span>
<a name="l01794"></a>01794                     newVal |= ((fsr &gt;&gt;  0) &amp; 0x3f) &lt;&lt; 1;
<a name="l01795"></a>01795                     newVal |= 0x1; <span class="comment">// F bit</span>
<a name="l01796"></a>01796                     newVal |= ((armFault-&gt;<a class="code" href="classArmISA_1_1ArmFault.html#af9738c784531315bb4ba685487e3104f">iss</a>() &gt;&gt; 7) &amp; 0x1) &lt;&lt; 8;
<a name="l01797"></a>01797                     newVal |= armFault-&gt;<a class="code" href="classArmISA_1_1ArmFault.html#a70e8e9a9f7ab1ca4c02588897ce61794">isStage2</a>() ? 0x200 : 0;
<a name="l01798"></a>01798                     <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(MiscRegs,
<a name="l01799"></a>01799                             <span class="stringliteral">&quot;MISCREG: Translated addr %#x fault fsr %#x: PAR: %#x\n&quot;</span>,
<a name="l01800"></a>01800                             val, fsr, newVal);
<a name="l01801"></a>01801                 }
<a name="l01802"></a>01802                 <span class="keyword">delete</span> req;
<a name="l01803"></a>01803                 <a class="code" href="structArmISA_1_1ISA.html#a90cbf55664f2b0de9bea7be53a56cf2e">setMiscRegNoEffect</a>(<a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cab0068d369cc2c322740d26568643ef24">MISCREG_PAR_EL1</a>, newVal);
<a name="l01804"></a>01804                 <span class="keywordflow">return</span>;
<a name="l01805"></a>01805             }
<a name="l01806"></a>01806           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca896e0f9942a14136d8bac636196fbc26">MISCREG_SPSR_EL3</a>:
<a name="l01807"></a>01807           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cab05fb75ce53c570d46d8707a58e5444d">MISCREG_SPSR_EL2</a>:
<a name="l01808"></a>01808           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cabf77dd155ddd1020a03a9f11e2c44803">MISCREG_SPSR_EL1</a>:
<a name="l01809"></a>01809             <span class="comment">// Force bits 23:21 to 0</span>
<a name="l01810"></a>01810             newVal = val &amp; ~(0x7 &lt;&lt; 21);
<a name="l01811"></a>01811             <span class="keywordflow">break</span>;
<a name="l01812"></a>01812           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca4c0eb4a6ce76f0de03e15a2152f190ac">MISCREG_L2CTLR</a>:
<a name="l01813"></a>01813             <a class="code" href="base_2misc_8hh.html#a8224a361dddd2ad59b411982e5ea746f">warn</a>(<span class="stringliteral">&quot;miscreg L2CTLR (%s) written with %#x. ignored...\n&quot;</span>,
<a name="l01814"></a>01814                  <a class="code" href="namespaceArmISA.html#a86b05be1092b70a38660616b2b7e6793">miscRegName</a>[misc_reg], uint32_t(val));
<a name="l01815"></a>01815             <span class="keywordflow">break</span>;
<a name="l01816"></a>01816 
<a name="l01817"></a>01817           <span class="comment">// Generic Timer registers</span>
<a name="l01818"></a>01818           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca0f74fcabaec0585fa64fdd5320ac8460">MISCREG_CNTFRQ</a> ... <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca145142160e70a4a7f8201eb06236a6db">MISCREG_CNTHP_CTL</a>:
<a name="l01819"></a>01819           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca5b48045b79595b2d016c3d11c39f4882">MISCREG_CNTPCT</a> ... <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919cada0a86c3391596b18b194e09c8d34c69">MISCREG_CNTHP_CVAL</a>:
<a name="l01820"></a>01820           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca7aee5179ce9c4ec339670c2ee5c09fb5">MISCREG_CNTKCTL_EL1</a> ... <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca255138f5bb2c4542e7a935eef561dd5c">MISCREG_CNTV_CVAL_EL0</a>:
<a name="l01821"></a>01821           <span class="keywordflow">case</span> <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919caed2d1d95ea9004de926f3e66e14be983">MISCREG_CNTVOFF_EL2</a> ... <a class="code" href="namespaceArmISA.html#a95c4749b8e05d58cf7536163a9ce919ca2ee954daabf9280f901a7ff40f55123c">MISCREG_CNTPS_CVAL_EL1</a>:
<a name="l01822"></a>01822             <a class="code" href="structArmISA_1_1ISA.html#a1aa959f5c3a1167ba91011df43909098">getGenericTimer</a>(tc).<a class="code" href="classArmISA_1_1BaseISADevice.html#ade3e3af7cf5da0025e56e81b6b776318" title="Write to a system register belonging to this device.">setMiscReg</a>(misc_reg, newVal);
<a name="l01823"></a>01823             <span class="keywordflow">break</span>;
<a name="l01824"></a>01824         }
<a name="l01825"></a>01825     }
<a name="l01826"></a>01826     <a class="code" href="structArmISA_1_1ISA.html#a90cbf55664f2b0de9bea7be53a56cf2e">setMiscRegNoEffect</a>(misc_reg, newVal);
<a name="l01827"></a>01827 }
<a name="l01828"></a>01828 
<a name="l01829"></a>01829 <span class="keywordtype">void</span>
<a name="l01830"></a>01830 <a class="code" href="structArmISA_1_1ISA.html#a75a36d9a23fa7fed74f4be02097aac1b">ISA::tlbiVA</a>(<a class="code" href="classThreadContext.html" title="ThreadContext is the external interface to all thread state for anything outside...">ThreadContext</a> *tc, <a class="code" href="namespaceArmISA.html#ae6de70120f06c08f390947f9e5cf7f7a">MiscReg</a> newVal, uint16_t asid,
<a name="l01831"></a>01831             <span class="keywordtype">bool</span> secure_lookup, uint8_t target_el)
<a name="l01832"></a>01832 {
<a name="l01833"></a>01833     <span class="keywordflow">if</span> (!<a class="code" href="structArmISA_1_1ISA.html#a2856f99be78123643814dc843efdd874">haveLargeAsid64</a>)
<a name="l01834"></a>01834         asid &amp;= <a class="code" href="namespaceArmISA.html#aedf8742bbf65a60cf102a4b3f9ba3d68">mask</a>(8);
<a name="l01835"></a>01835     <a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232" title="Address type This will probably be moved somewhere else in the near future.">Addr</a> va = ((<a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232" title="Address type This will probably be moved somewhere else in the near future.">Addr</a>) <a class="code" href="bitfield_8hh.html#a4ee0dc0723e11679c52429d5f8e05123" title="Extract the bitfield from position &amp;#39;first&amp;#39; to &amp;#39;last&amp;#39; (inclusive)...">bits</a>(newVal, 43, 0)) &lt;&lt; 12;
<a name="l01836"></a>01836     <a class="code" href="classSystem.html">System</a> *sys = tc-&gt;<a class="code" href="classThreadContext.html#a119dd28f703f77bafb74788f8110300c">getSystemPtr</a>();
<a name="l01837"></a>01837     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x = 0; x &lt; sys-&gt;<a class="code" href="classSystem.html#ab123a0793826eea0796f70ec2b2e07f7">numContexts</a>(); x++) {
<a name="l01838"></a>01838         <a class="code" href="classThreadContext.html" title="ThreadContext is the external interface to all thread state for anything outside...">ThreadContext</a> *oc = sys-&gt;<a class="code" href="classSystem.html#a289079f61fbd11f0c41b5e62ea6844ff">getThreadContext</a>(x);
<a name="l01839"></a>01839         assert(oc-&gt;<a class="code" href="classThreadContext.html#a71910c6ab34a67cb0bc65dbc874cbb27">getITBPtr</a>() &amp;&amp; oc-&gt;<a class="code" href="classThreadContext.html#a66f0298b284053daa1f4318c585c091f">getDTBPtr</a>());
<a name="l01840"></a>01840         oc-&gt;<a class="code" href="classThreadContext.html#a71910c6ab34a67cb0bc65dbc874cbb27">getITBPtr</a>()-&gt;flushMvaAsid(va, asid,
<a name="l01841"></a>01841                                       secure_lookup, target_el);
<a name="l01842"></a>01842         oc-&gt;<a class="code" href="classThreadContext.html#a66f0298b284053daa1f4318c585c091f">getDTBPtr</a>()-&gt;flushMvaAsid(va, asid,
<a name="l01843"></a>01843                                       secure_lookup, target_el);
<a name="l01844"></a>01844 
<a name="l01845"></a>01845         <a class="code" href="classCheckerCPU.html" title="CheckerCPU class.">CheckerCPU</a> *checker = oc-&gt;<a class="code" href="classThreadContext.html#a594e114a4cc2ff653bc8a30fe49b986b">getCheckerCpuPtr</a>();
<a name="l01846"></a>01846         <span class="keywordflow">if</span> (checker) {
<a name="l01847"></a>01847             checker-&gt;<a class="code" href="classCheckerCPU.html#a9a1bb6b2d38e725012d11831c25780c3">getITBPtr</a>()-&gt;flushMvaAsid(
<a name="l01848"></a>01848                 va, asid, secure_lookup, target_el);
<a name="l01849"></a>01849             checker-&gt;<a class="code" href="classCheckerCPU.html#a29eaa07d1ac8f4cbe8c7e24be85765fa">getDTBPtr</a>()-&gt;flushMvaAsid(
<a name="l01850"></a>01850                 va, asid, secure_lookup, target_el);
<a name="l01851"></a>01851         }
<a name="l01852"></a>01852     }
<a name="l01853"></a>01853 }
<a name="l01854"></a>01854 
<a name="l01855"></a>01855 <span class="keywordtype">void</span>
<a name="l01856"></a>01856 <a class="code" href="structArmISA_1_1ISA.html#ab7e5fdbd940d1cf766333f3c4795e35f">ISA::tlbiALL</a>(<a class="code" href="classThreadContext.html" title="ThreadContext is the external interface to all thread state for anything outside...">ThreadContext</a> *tc, <span class="keywordtype">bool</span> secure_lookup, uint8_t target_el)
<a name="l01857"></a>01857 {
<a name="l01858"></a>01858     <a class="code" href="classSystem.html">System</a> *sys = tc-&gt;<a class="code" href="classThreadContext.html#a119dd28f703f77bafb74788f8110300c">getSystemPtr</a>();
<a name="l01859"></a>01859     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x = 0; x &lt; sys-&gt;<a class="code" href="classSystem.html#ab123a0793826eea0796f70ec2b2e07f7">numContexts</a>(); x++) {
<a name="l01860"></a>01860         <a class="code" href="classThreadContext.html" title="ThreadContext is the external interface to all thread state for anything outside...">ThreadContext</a> *oc = sys-&gt;<a class="code" href="classSystem.html#a289079f61fbd11f0c41b5e62ea6844ff">getThreadContext</a>(x);
<a name="l01861"></a>01861         assert(oc-&gt;<a class="code" href="classThreadContext.html#a71910c6ab34a67cb0bc65dbc874cbb27">getITBPtr</a>() &amp;&amp; oc-&gt;<a class="code" href="classThreadContext.html#a66f0298b284053daa1f4318c585c091f">getDTBPtr</a>());
<a name="l01862"></a>01862         oc-&gt;<a class="code" href="classThreadContext.html#a71910c6ab34a67cb0bc65dbc874cbb27">getITBPtr</a>()-&gt;flushAllSecurity(secure_lookup, target_el);
<a name="l01863"></a>01863         oc-&gt;<a class="code" href="classThreadContext.html#a66f0298b284053daa1f4318c585c091f">getDTBPtr</a>()-&gt;flushAllSecurity(secure_lookup, target_el);
<a name="l01864"></a>01864 
<a name="l01865"></a>01865         <span class="comment">// If CheckerCPU is connected, need to notify it of a flush</span>
<a name="l01866"></a>01866         <a class="code" href="classCheckerCPU.html" title="CheckerCPU class.">CheckerCPU</a> *checker = oc-&gt;<a class="code" href="classThreadContext.html#a594e114a4cc2ff653bc8a30fe49b986b">getCheckerCpuPtr</a>();
<a name="l01867"></a>01867         <span class="keywordflow">if</span> (checker) {
<a name="l01868"></a>01868             checker-&gt;<a class="code" href="classCheckerCPU.html#a9a1bb6b2d38e725012d11831c25780c3">getITBPtr</a>()-&gt;flushAllSecurity(secure_lookup,
<a name="l01869"></a>01869                                                    target_el);
<a name="l01870"></a>01870             checker-&gt;<a class="code" href="classCheckerCPU.html#a29eaa07d1ac8f4cbe8c7e24be85765fa">getDTBPtr</a>()-&gt;flushAllSecurity(secure_lookup,
<a name="l01871"></a>01871                                                    target_el);
<a name="l01872"></a>01872         }
<a name="l01873"></a>01873     }
<a name="l01874"></a>01874 }
<a name="l01875"></a>01875 
<a name="l01876"></a>01876 <span class="keywordtype">void</span>
<a name="l01877"></a>01877 <a class="code" href="structArmISA_1_1ISA.html#a61a1291114c38dfebfd9a2afa66efea7">ISA::tlbiALLN</a>(<a class="code" href="classThreadContext.html" title="ThreadContext is the external interface to all thread state for anything outside...">ThreadContext</a> *tc, <span class="keywordtype">bool</span> hyp, uint8_t target_el)
<a name="l01878"></a>01878 {
<a name="l01879"></a>01879     <a class="code" href="classSystem.html">System</a> *sys = tc-&gt;<a class="code" href="classThreadContext.html#a119dd28f703f77bafb74788f8110300c">getSystemPtr</a>();
<a name="l01880"></a>01880     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x = 0; x &lt; sys-&gt;<a class="code" href="classSystem.html#ab123a0793826eea0796f70ec2b2e07f7">numContexts</a>(); x++) {
<a name="l01881"></a>01881       <a class="code" href="classThreadContext.html" title="ThreadContext is the external interface to all thread state for anything outside...">ThreadContext</a> *oc = sys-&gt;<a class="code" href="classSystem.html#a289079f61fbd11f0c41b5e62ea6844ff">getThreadContext</a>(x);
<a name="l01882"></a>01882       assert(oc-&gt;<a class="code" href="classThreadContext.html#a71910c6ab34a67cb0bc65dbc874cbb27">getITBPtr</a>() &amp;&amp; oc-&gt;<a class="code" href="classThreadContext.html#a66f0298b284053daa1f4318c585c091f">getDTBPtr</a>());
<a name="l01883"></a>01883       oc-&gt;<a class="code" href="classThreadContext.html#a71910c6ab34a67cb0bc65dbc874cbb27">getITBPtr</a>()-&gt;flushAllNs(hyp, target_el);
<a name="l01884"></a>01884       oc-&gt;<a class="code" href="classThreadContext.html#a66f0298b284053daa1f4318c585c091f">getDTBPtr</a>()-&gt;flushAllNs(hyp, target_el);
<a name="l01885"></a>01885 
<a name="l01886"></a>01886       <a class="code" href="classCheckerCPU.html" title="CheckerCPU class.">CheckerCPU</a> *checker = oc-&gt;<a class="code" href="classThreadContext.html#a594e114a4cc2ff653bc8a30fe49b986b">getCheckerCpuPtr</a>();
<a name="l01887"></a>01887       <span class="keywordflow">if</span> (checker) {
<a name="l01888"></a>01888           checker-&gt;<a class="code" href="classCheckerCPU.html#a9a1bb6b2d38e725012d11831c25780c3">getITBPtr</a>()-&gt;flushAllNs(hyp, target_el);
<a name="l01889"></a>01889           checker-&gt;<a class="code" href="classCheckerCPU.html#a29eaa07d1ac8f4cbe8c7e24be85765fa">getDTBPtr</a>()-&gt;flushAllNs(hyp, target_el);
<a name="l01890"></a>01890       }
<a name="l01891"></a>01891     }
<a name="l01892"></a>01892 }
<a name="l01893"></a>01893 
<a name="l01894"></a>01894 <span class="keywordtype">void</span>
<a name="l01895"></a>01895 <a class="code" href="structArmISA_1_1ISA.html#a63c548a694ff3f8bd3244303ecdee6a9">ISA::tlbiMVA</a>(<a class="code" href="classThreadContext.html" title="ThreadContext is the external interface to all thread state for anything outside...">ThreadContext</a> *tc, <a class="code" href="namespaceArmISA.html#ae6de70120f06c08f390947f9e5cf7f7a">MiscReg</a> newVal, <span class="keywordtype">bool</span> secure_lookup, <span class="keywordtype">bool</span> hyp,
<a name="l01896"></a>01896              uint8_t target_el)
<a name="l01897"></a>01897 {
<a name="l01898"></a>01898     <a class="code" href="classSystem.html">System</a> *sys = tc-&gt;<a class="code" href="classThreadContext.html#a119dd28f703f77bafb74788f8110300c">getSystemPtr</a>();
<a name="l01899"></a>01899     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x = 0; x &lt; sys-&gt;<a class="code" href="classSystem.html#ab123a0793826eea0796f70ec2b2e07f7">numContexts</a>(); x++) {
<a name="l01900"></a>01900         <a class="code" href="classThreadContext.html" title="ThreadContext is the external interface to all thread state for anything outside...">ThreadContext</a> *oc = sys-&gt;<a class="code" href="classSystem.html#a289079f61fbd11f0c41b5e62ea6844ff">getThreadContext</a>(x);
<a name="l01901"></a>01901         assert(oc-&gt;<a class="code" href="classThreadContext.html#a71910c6ab34a67cb0bc65dbc874cbb27">getITBPtr</a>() &amp;&amp; oc-&gt;<a class="code" href="classThreadContext.html#a66f0298b284053daa1f4318c585c091f">getDTBPtr</a>());
<a name="l01902"></a>01902         oc-&gt;<a class="code" href="classThreadContext.html#a71910c6ab34a67cb0bc65dbc874cbb27">getITBPtr</a>()-&gt;flushMva(<a class="code" href="bitfield_8hh.html#acaa3c424fec3407f14a01fe1ec22c2d4" title="Mask off the given bits in place like bits() but without shifting.">mbits</a>(newVal, 31,12),
<a name="l01903"></a>01903             secure_lookup, hyp, target_el);
<a name="l01904"></a>01904         oc-&gt;<a class="code" href="classThreadContext.html#a66f0298b284053daa1f4318c585c091f">getDTBPtr</a>()-&gt;flushMva(<a class="code" href="bitfield_8hh.html#acaa3c424fec3407f14a01fe1ec22c2d4" title="Mask off the given bits in place like bits() but without shifting.">mbits</a>(newVal, 31,12),
<a name="l01905"></a>01905             secure_lookup, hyp, target_el);
<a name="l01906"></a>01906 
<a name="l01907"></a>01907         <a class="code" href="classCheckerCPU.html" title="CheckerCPU class.">CheckerCPU</a> *checker = oc-&gt;<a class="code" href="classThreadContext.html#a594e114a4cc2ff653bc8a30fe49b986b">getCheckerCpuPtr</a>();
<a name="l01908"></a>01908         <span class="keywordflow">if</span> (checker) {
<a name="l01909"></a>01909             checker-&gt;<a class="code" href="classCheckerCPU.html#a9a1bb6b2d38e725012d11831c25780c3">getITBPtr</a>()-&gt;flushMva(<a class="code" href="bitfield_8hh.html#acaa3c424fec3407f14a01fe1ec22c2d4" title="Mask off the given bits in place like bits() but without shifting.">mbits</a>(newVal, 31,12),
<a name="l01910"></a>01910                 secure_lookup, hyp, target_el);
<a name="l01911"></a>01911             checker-&gt;<a class="code" href="classCheckerCPU.html#a29eaa07d1ac8f4cbe8c7e24be85765fa">getDTBPtr</a>()-&gt;flushMva(<a class="code" href="bitfield_8hh.html#acaa3c424fec3407f14a01fe1ec22c2d4" title="Mask off the given bits in place like bits() but without shifting.">mbits</a>(newVal, 31,12),
<a name="l01912"></a>01912                 secure_lookup, hyp, target_el);
<a name="l01913"></a>01913         }
<a name="l01914"></a>01914     }
<a name="l01915"></a>01915 }
<a name="l01916"></a>01916 
<a name="l01917"></a>01917 <a class="code" href="classArmISA_1_1BaseISADevice.html" title="Base class for devices that use the MiscReg interfaces.">BaseISADevice</a> &amp;
<a name="l01918"></a>01918 <a class="code" href="structArmISA_1_1ISA.html#a1aa959f5c3a1167ba91011df43909098">ISA::getGenericTimer</a>(<a class="code" href="classThreadContext.html" title="ThreadContext is the external interface to all thread state for anything outside...">ThreadContext</a> *tc)
<a name="l01919"></a>01919 {
<a name="l01920"></a>01920     <span class="comment">// We only need to create an ISA interface the first time we try</span>
<a name="l01921"></a>01921     <span class="comment">// to access the timer.</span>
<a name="l01922"></a>01922     <span class="keywordflow">if</span> (<a class="code" href="structArmISA_1_1ISA.html#a631d555a2dfda9c7167a550de6906822">timer</a>)
<a name="l01923"></a>01923         <span class="keywordflow">return</span> *<a class="code" href="structArmISA_1_1ISA.html#a631d555a2dfda9c7167a550de6906822">timer</a>.get();
<a name="l01924"></a>01924 
<a name="l01925"></a>01925     assert(<a class="code" href="structArmISA_1_1ISA.html#a2e13e022fad3518a8c0691b6f76ea857">system</a>);
<a name="l01926"></a>01926     <a class="code" href="classGenericTimer.html">GenericTimer</a> *generic_timer(<a class="code" href="structArmISA_1_1ISA.html#a2e13e022fad3518a8c0691b6f76ea857">system</a>-&gt;<a class="code" href="classArmSystem.html#aa3ef77a29974c3979fd687a9705a6536" title="Get a pointer to the system&amp;#39;s generic timer model.">getGenericTimer</a>());
<a name="l01927"></a>01927     <span class="keywordflow">if</span> (!generic_timer) {
<a name="l01928"></a>01928         <a class="code" href="base_2misc_8hh.html#a1445e207e36c97ff84c54b47288cea19">panic</a>(<span class="stringliteral">&quot;Trying to get a generic timer from a system that hasn&apos;t &quot;</span>
<a name="l01929"></a>01929               <span class="stringliteral">&quot;been configured to use a generic timer.\n&quot;</span>);
<a name="l01930"></a>01930     }
<a name="l01931"></a>01931 
<a name="l01932"></a>01932     <a class="code" href="structArmISA_1_1ISA.html#a631d555a2dfda9c7167a550de6906822">timer</a>.reset(<span class="keyword">new</span> <a class="code" href="classGenericTimerISA.html">GenericTimerISA</a>(*generic_timer, tc-&gt;<a class="code" href="classThreadContext.html#a68fd2366a3d5690409cd974c54d64aa7">cpuId</a>()));
<a name="l01933"></a>01933     <span class="keywordflow">return</span> *<a class="code" href="structArmISA_1_1ISA.html#a631d555a2dfda9c7167a550de6906822">timer</a>.get();
<a name="l01934"></a>01934 }
<a name="l01935"></a>01935 
<a name="l01936"></a>01936 }
<a name="l01937"></a>01937 
<a name="l01938"></a>01938 <a class="code" href="structArmISA_1_1ISA.html" title="Some registers aliase with others, and therefore need to be translated.">ArmISA::ISA</a> *
<a name="l01939"></a>01939 ArmISAParams::create()
<a name="l01940"></a>01940 {
<a name="l01941"></a>01941     <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="structArmISA_1_1ISA.html#a696504da50402bd6ca90d15f68e4ea05">ArmISA::ISA</a>(<span class="keyword">this</span>);
<a name="l01942"></a>01942 }
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&nbsp;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"><address style="align: right;"><small>
Generated on Mon Dec 7 02:33:05 2015 for gem5 by <a href="http://www.doxygen.org/index.html"> doxygen</a> 1.6.1</small></address>

</body>
</html>
