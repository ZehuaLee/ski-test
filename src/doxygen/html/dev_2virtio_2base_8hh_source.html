<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>gem5: dev/virtio/base.hh Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>dev/virtio/base.hh</h1><a href="dev_2virtio_2base_8hh.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * Copyright (c) 2014 ARM Limited</span>
<a name="l00003"></a>00003 <span class="comment"> * All rights reserved</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> * The license below extends only to copyright in the software and shall</span>
<a name="l00006"></a>00006 <span class="comment"> * not be construed as granting a license to any other intellectual</span>
<a name="l00007"></a>00007 <span class="comment"> * property including but not limited to intellectual property relating</span>
<a name="l00008"></a>00008 <span class="comment"> * to a hardware implementation of the functionality of the software</span>
<a name="l00009"></a>00009 <span class="comment"> * licensed hereunder.  You may use the software subject to the license</span>
<a name="l00010"></a>00010 <span class="comment"> * terms below provided that you ensure that this notice is replicated</span>
<a name="l00011"></a>00011 <span class="comment"> * unmodified and in its entirety in all distributions of the software,</span>
<a name="l00012"></a>00012 <span class="comment"> * modified or unmodified, in source code or in binary form.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * Redistribution and use in source and binary forms, with or without</span>
<a name="l00015"></a>00015 <span class="comment"> * modification, are permitted provided that the following conditions are</span>
<a name="l00016"></a>00016 <span class="comment"> * met: redistributions of source code must retain the above copyright</span>
<a name="l00017"></a>00017 <span class="comment"> * notice, this list of conditions and the following disclaimer;</span>
<a name="l00018"></a>00018 <span class="comment"> * redistributions in binary form must reproduce the above copyright</span>
<a name="l00019"></a>00019 <span class="comment"> * notice, this list of conditions and the following disclaimer in the</span>
<a name="l00020"></a>00020 <span class="comment"> * documentation and/or other materials provided with the distribution;</span>
<a name="l00021"></a>00021 <span class="comment"> * neither the name of the copyright holders nor the names of its</span>
<a name="l00022"></a>00022 <span class="comment"> * contributors may be used to endorse or promote products derived from</span>
<a name="l00023"></a>00023 <span class="comment"> * this software without specific prior written permission.</span>
<a name="l00024"></a>00024 <span class="comment"> *</span>
<a name="l00025"></a>00025 <span class="comment"> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<a name="l00026"></a>00026 <span class="comment"> * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<a name="l00027"></a>00027 <span class="comment"> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span>
<a name="l00028"></a>00028 <span class="comment"> * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span>
<a name="l00029"></a>00029 <span class="comment"> * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span>
<a name="l00030"></a>00030 <span class="comment"> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span>
<a name="l00031"></a>00031 <span class="comment"> * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span>
<a name="l00032"></a>00032 <span class="comment"> * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span>
<a name="l00033"></a>00033 <span class="comment"> * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
<a name="l00034"></a>00034 <span class="comment"> * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span>
<a name="l00035"></a>00035 <span class="comment"> * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00036"></a>00036 <span class="comment"> *</span>
<a name="l00037"></a>00037 <span class="comment"> * Authors: Andreas Sandberg</span>
<a name="l00038"></a>00038 <span class="comment"> */</span>
<a name="l00039"></a>00039 
<a name="l00040"></a>00040 <span class="preprocessor">#ifndef __DEV_VIRTIO_BASE_HH__</span>
<a name="l00041"></a>00041 <span class="preprocessor"></span><span class="preprocessor">#define __DEV_VIRTIO_BASE_HH__</span>
<a name="l00042"></a>00042 <span class="preprocessor"></span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;arch/isa_traits.hh&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="bitunion_8hh.html">base/bitunion.hh</a>&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="callback_8hh.html">base/callback.hh</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="virtio__ring_8h.html">dev/virtio/virtio_ring.h</a>&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="port__proxy_8hh.html" title="PortProxy Object Declaration.">mem/port_proxy.hh</a>&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="sim__object_8hh.html">sim/sim_object.hh</a>&quot;</span>
<a name="l00049"></a>00049 
<a name="l00050"></a>00050 <span class="keyword">struct </span>VirtIODeviceBaseParams;
<a name="l00051"></a>00051 <span class="keyword">class </span><a class="code" href="classVirtQueue.html" title="Base wrapper around a virtqueue.">VirtQueue</a>;
<a name="l00052"></a>00052 
<a name="l00067"></a>00067 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> T
<a name="l00068"></a><a class="code" href="dev_2virtio_2base_8hh.html#aa2cf72a71acd4de79cc37a7f8db47b1d">00068</a> <a class="code" href="dev_2virtio_2base_8hh.html#aa2cf72a71acd4de79cc37a7f8db47b1d" title="Convert legacy VirtIO endianness to host endianness.">vtoh_legacy</a>(T <a class="code" href="namespaceArmISA.html#ab5a71200b0a7550ed87398d38b7aedc6">v</a>) {
<a name="l00069"></a>00069     <span class="keywordflow">return</span> <a class="code" href="namespaceBigEndianGuest.html#adb51b41dd17278558edf419359f52de6">TheISA::gtoh</a>(v);
<a name="l00070"></a>00070 }
<a name="l00071"></a>00071 
<a name="l00073"></a>00073 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> T
<a name="l00074"></a><a class="code" href="dev_2virtio_2base_8hh.html#ab30532842b0fcec9ce19141d56fa9a1c">00074</a> <a class="code" href="dev_2virtio_2base_8hh.html#ab30532842b0fcec9ce19141d56fa9a1c" title="Convert host endianness to legacy VirtIO endianness.">htov_legacy</a>(T <a class="code" href="namespaceArmISA.html#ab5a71200b0a7550ed87398d38b7aedc6">v</a>) {
<a name="l00075"></a>00075     <span class="keywordflow">return</span> <a class="code" href="namespaceBigEndianGuest.html#a10c3370b6af5a1216a2a64c0d379f788">TheISA::htog</a>(v);
<a name="l00076"></a>00076 }
<a name="l00077"></a>00077 
<a name="l00078"></a>00078 
<a name="l00079"></a>00079 <span class="keyword">template</span> &lt;&gt; <span class="keyword">inline</span> <a class="code" href="structvring__used__elem.html">vring_used_elem</a>
<a name="l00080"></a><a class="code" href="dev_2virtio_2base_8hh.html#a9626671297e250211aeeb05bf207070b">00080</a> <a class="code" href="dev_2virtio_2base_8hh.html#aa2cf72a71acd4de79cc37a7f8db47b1d" title="Convert legacy VirtIO endianness to host endianness.">vtoh_legacy</a>(<a class="code" href="structvring__used__elem.html">vring_used_elem</a> <a class="code" href="namespaceArmISA.html#ab5a71200b0a7550ed87398d38b7aedc6">v</a>) {
<a name="l00081"></a>00081     v.<a class="code" href="structvring__used__elem.html#a5115f759f587665de0faa818693786d2">id</a> = <a class="code" href="dev_2virtio_2base_8hh.html#aa2cf72a71acd4de79cc37a7f8db47b1d" title="Convert legacy VirtIO endianness to host endianness.">vtoh_legacy</a>(v.<a class="code" href="structvring__used__elem.html#a5115f759f587665de0faa818693786d2">id</a>);
<a name="l00082"></a>00082     v.<a class="code" href="structvring__used__elem.html#a5145ffe72f7fa5528199b3e47d48ab77">len</a> = <a class="code" href="dev_2virtio_2base_8hh.html#aa2cf72a71acd4de79cc37a7f8db47b1d" title="Convert legacy VirtIO endianness to host endianness.">vtoh_legacy</a>(v.<a class="code" href="structvring__used__elem.html#a5145ffe72f7fa5528199b3e47d48ab77">len</a>);
<a name="l00083"></a>00083     <span class="keywordflow">return</span> v;
<a name="l00084"></a>00084 }
<a name="l00085"></a>00085 
<a name="l00086"></a>00086 <span class="keyword">template</span> &lt;&gt; <span class="keyword">inline</span> <a class="code" href="structvring__used__elem.html">vring_used_elem</a>
<a name="l00087"></a><a class="code" href="dev_2virtio_2base_8hh.html#a5e53b4161e8867290135b6c998777c23">00087</a> <a class="code" href="dev_2virtio_2base_8hh.html#ab30532842b0fcec9ce19141d56fa9a1c" title="Convert host endianness to legacy VirtIO endianness.">htov_legacy</a>(<a class="code" href="structvring__used__elem.html">vring_used_elem</a> <a class="code" href="namespaceArmISA.html#ab5a71200b0a7550ed87398d38b7aedc6">v</a>) {
<a name="l00088"></a>00088     v.<a class="code" href="structvring__used__elem.html#a5115f759f587665de0faa818693786d2">id</a> = <a class="code" href="dev_2virtio_2base_8hh.html#ab30532842b0fcec9ce19141d56fa9a1c" title="Convert host endianness to legacy VirtIO endianness.">htov_legacy</a>(v.<a class="code" href="structvring__used__elem.html#a5115f759f587665de0faa818693786d2">id</a>);
<a name="l00089"></a>00089     v.<a class="code" href="structvring__used__elem.html#a5145ffe72f7fa5528199b3e47d48ab77">len</a> = <a class="code" href="dev_2virtio_2base_8hh.html#ab30532842b0fcec9ce19141d56fa9a1c" title="Convert host endianness to legacy VirtIO endianness.">htov_legacy</a>(v.<a class="code" href="structvring__used__elem.html#a5145ffe72f7fa5528199b3e47d48ab77">len</a>);
<a name="l00090"></a>00090     <span class="keywordflow">return</span> v;
<a name="l00091"></a>00091 }
<a name="l00092"></a>00092 
<a name="l00093"></a>00093 <span class="keyword">template</span> &lt;&gt; <span class="keyword">inline</span> <a class="code" href="structvring__desc.html">vring_desc</a>
<a name="l00094"></a><a class="code" href="dev_2virtio_2base_8hh.html#a0bd961204fbd419f82a86cefcfec16f4">00094</a> <a class="code" href="dev_2virtio_2base_8hh.html#aa2cf72a71acd4de79cc37a7f8db47b1d" title="Convert legacy VirtIO endianness to host endianness.">vtoh_legacy</a>(<a class="code" href="structvring__desc.html">vring_desc</a> <a class="code" href="namespaceArmISA.html#ab5a71200b0a7550ed87398d38b7aedc6">v</a>) {
<a name="l00095"></a>00095     v.<a class="code" href="structvring__desc.html#a24012b95247951b86e962f1acf538aa5">addr</a> = <a class="code" href="dev_2virtio_2base_8hh.html#aa2cf72a71acd4de79cc37a7f8db47b1d" title="Convert legacy VirtIO endianness to host endianness.">vtoh_legacy</a>(v.<a class="code" href="structvring__desc.html#a24012b95247951b86e962f1acf538aa5">addr</a>);
<a name="l00096"></a>00096     v.<a class="code" href="structvring__desc.html#ac1c5fe0c5e1e8e28f2c38263e28a82ce">len</a> = <a class="code" href="dev_2virtio_2base_8hh.html#aa2cf72a71acd4de79cc37a7f8db47b1d" title="Convert legacy VirtIO endianness to host endianness.">vtoh_legacy</a>(v.<a class="code" href="structvring__desc.html#ac1c5fe0c5e1e8e28f2c38263e28a82ce">len</a>);
<a name="l00097"></a>00097     v.<a class="code" href="structvring__desc.html#a81a7d7268f146217db8d91886ec6502e">flags</a> = <a class="code" href="dev_2virtio_2base_8hh.html#aa2cf72a71acd4de79cc37a7f8db47b1d" title="Convert legacy VirtIO endianness to host endianness.">vtoh_legacy</a>(v.<a class="code" href="structvring__desc.html#a81a7d7268f146217db8d91886ec6502e">flags</a>);
<a name="l00098"></a>00098     v.<a class="code" href="structvring__desc.html#a7d1a05acc86ccc917fe06b2f81d0e0d8">next</a> = <a class="code" href="dev_2virtio_2base_8hh.html#aa2cf72a71acd4de79cc37a7f8db47b1d" title="Convert legacy VirtIO endianness to host endianness.">vtoh_legacy</a>(v.<a class="code" href="structvring__desc.html#a7d1a05acc86ccc917fe06b2f81d0e0d8">next</a>);
<a name="l00099"></a>00099     <span class="keywordflow">return</span> v;
<a name="l00100"></a>00100 }
<a name="l00101"></a>00101 
<a name="l00102"></a>00102 <span class="keyword">template</span> &lt;&gt; <span class="keyword">inline</span> <a class="code" href="structvring__desc.html">vring_desc</a>
<a name="l00103"></a><a class="code" href="dev_2virtio_2base_8hh.html#aae1a205eb519af5e7696917f2a1f28eb">00103</a> <a class="code" href="dev_2virtio_2base_8hh.html#ab30532842b0fcec9ce19141d56fa9a1c" title="Convert host endianness to legacy VirtIO endianness.">htov_legacy</a>(<a class="code" href="structvring__desc.html">vring_desc</a> <a class="code" href="namespaceArmISA.html#ab5a71200b0a7550ed87398d38b7aedc6">v</a>) {
<a name="l00104"></a>00104     v.<a class="code" href="structvring__desc.html#a24012b95247951b86e962f1acf538aa5">addr</a> = <a class="code" href="dev_2virtio_2base_8hh.html#ab30532842b0fcec9ce19141d56fa9a1c" title="Convert host endianness to legacy VirtIO endianness.">htov_legacy</a>(v.<a class="code" href="structvring__desc.html#a24012b95247951b86e962f1acf538aa5">addr</a>);
<a name="l00105"></a>00105     v.<a class="code" href="structvring__desc.html#ac1c5fe0c5e1e8e28f2c38263e28a82ce">len</a> = <a class="code" href="dev_2virtio_2base_8hh.html#ab30532842b0fcec9ce19141d56fa9a1c" title="Convert host endianness to legacy VirtIO endianness.">htov_legacy</a>(v.<a class="code" href="structvring__desc.html#ac1c5fe0c5e1e8e28f2c38263e28a82ce">len</a>);
<a name="l00106"></a>00106     v.<a class="code" href="structvring__desc.html#a81a7d7268f146217db8d91886ec6502e">flags</a> = <a class="code" href="dev_2virtio_2base_8hh.html#ab30532842b0fcec9ce19141d56fa9a1c" title="Convert host endianness to legacy VirtIO endianness.">htov_legacy</a>(v.<a class="code" href="structvring__desc.html#a81a7d7268f146217db8d91886ec6502e">flags</a>);
<a name="l00107"></a>00107     v.<a class="code" href="structvring__desc.html#a7d1a05acc86ccc917fe06b2f81d0e0d8">next</a> = <a class="code" href="dev_2virtio_2base_8hh.html#ab30532842b0fcec9ce19141d56fa9a1c" title="Convert host endianness to legacy VirtIO endianness.">htov_legacy</a>(v.<a class="code" href="structvring__desc.html#a7d1a05acc86ccc917fe06b2f81d0e0d8">next</a>);
<a name="l00108"></a>00108     <span class="keywordflow">return</span> v;
<a name="l00109"></a>00109 }
<a name="l00110"></a>00110 
<a name="l00134"></a><a class="code" href="classVirtDescriptor.html">00134</a> <span class="keyword">class </span><a class="code" href="classVirtDescriptor.html" title="VirtIO descriptor (chain) wrapper.">VirtDescriptor</a>
<a name="l00135"></a>00135 {
<a name="l00136"></a>00136   <span class="keyword">public</span>:
<a name="l00138"></a><a class="code" href="classVirtDescriptor.html#ad010130392fd979e56763c4ebe62766a">00138</a>     <span class="keyword">typedef</span> uint16_t <a class="code" href="classVirtDescriptor.html#ad010130392fd979e56763c4ebe62766a" title="Descriptor index in virtqueue.">Index</a>;
<a name="l00139"></a>00139 
<a name="l00150"></a>00150     <a class="code" href="classVirtDescriptor.html#a27d9f8899637b2f8228cd1a2f784fee7">VirtDescriptor</a>(<a class="code" href="classPortProxy.html" title="This object is a proxy for a structural port, to be used for debug accesses.">PortProxy</a> &amp;<a class="code" href="classVirtDescriptor.html#aa298c2e2ea887206bb93af30e355f688" title="Pointer to memory proxy.">memProxy</a>, <a class="code" href="classVirtQueue.html" title="Base wrapper around a virtqueue.">VirtQueue</a> &amp;<a class="code" href="classVirtDescriptor.html#ae770c39175438bce8d4c1df66951dc60" title="Pointer to virtqueue owning this descriptor.">queue</a>, <a class="code" href="classVirtDescriptor.html#ad010130392fd979e56763c4ebe62766a" title="Descriptor index in virtqueue.">Index</a> <a class="code" href="classVirtDescriptor.html#aa954db2e59636c29f936f1c6994079b8" title="Get the descriptor&amp;#39;s index into the virtqueue.">index</a>);
<a name="l00151"></a>00151     <span class="comment">// WORKAROUND: The noexcept declaration works around a bug where</span>
<a name="l00152"></a>00152     <span class="comment">// gcc 4.7 tries to call the wrong constructor when emplacing</span>
<a name="l00153"></a>00153     <span class="comment">// something into a vector.</span>
<a name="l00154"></a>00154     <a class="code" href="classVirtDescriptor.html#a27d9f8899637b2f8228cd1a2f784fee7">VirtDescriptor</a>(<a class="code" href="classVirtDescriptor.html" title="VirtIO descriptor (chain) wrapper.">VirtDescriptor</a> &amp;&amp;other) noexcept;
<a name="l00155"></a>00155     ~<a class="code" href="classVirtDescriptor.html" title="VirtIO descriptor (chain) wrapper.">VirtDescriptor</a>() noexcept;
<a name="l00156"></a>00156 
<a name="l00157"></a>00157     <a class="code" href="classVirtDescriptor.html" title="VirtIO descriptor (chain) wrapper.">VirtDescriptor</a> &amp;operator=(<a class="code" href="classVirtDescriptor.html" title="VirtIO descriptor (chain) wrapper.">VirtDescriptor</a> &amp;&amp;rhs) noexcept;
<a name="l00158"></a>00158 
<a name="l00160"></a><a class="code" href="classVirtDescriptor.html#aa954db2e59636c29f936f1c6994079b8">00160</a>     <a class="code" href="classVirtDescriptor.html#ad010130392fd979e56763c4ebe62766a" title="Descriptor index in virtqueue.">Index</a> <a class="code" href="classVirtDescriptor.html#aa954db2e59636c29f936f1c6994079b8" title="Get the descriptor&amp;#39;s index into the virtqueue.">index</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classVirtDescriptor.html#a5b5e3c72f02ad67d127225301028bfbb" title="Index in virtqueue.">_index</a>; }
<a name="l00161"></a>00161 
<a name="l00163"></a>00163     <span class="keywordtype">void</span> <a class="code" href="classVirtDescriptor.html#a0c84269b4f81ac01fbad0d037564ab30" title="Populate this descriptor with data from the guest.">update</a>();
<a name="l00164"></a>00164 
<a name="l00166"></a>00166     <span class="keywordtype">void</span> <a class="code" href="classVirtDescriptor.html#a0987e4f0e66975235c120b2dd422906d" title="Populate this descriptor chain with data from the guest.">updateChain</a>();
<a name="l00175"></a>00175     <span class="keywordtype">void</span> <a class="code" href="classVirtDescriptor.html#a334d1255df493d6acacc26ba6f0ff6bf" title="Dump the contents of a descriptor.">dump</a>() <span class="keyword">const</span>;
<a name="l00180"></a>00180     <span class="keywordtype">void</span> <a class="code" href="classVirtDescriptor.html#a070c28a78f3e3e15ef25d9aece61d324" title="Dump the contents of a descriptor chain starting at this descriptor.">dumpChain</a>() <span class="keyword">const</span>;
<a name="l00201"></a>00201     <span class="keywordtype">void</span> <a class="code" href="classVirtDescriptor.html#a8b076e3cb3516339507e87b911b44c32" title="Read the contents of a descriptor.">read</a>(<span class="keywordtype">size_t</span> <a class="code" href="namespaceArmISA.html#a19e4a68ca5c93c6136351d804b432b09">offset</a>, uint8_t *dst, <span class="keywordtype">size_t</span> <a class="code" href="classVirtDescriptor.html#a15ca6fa90f28bbf064848f199ae368e8" title="Retrieve the size of this descriptor.">size</a>) <span class="keyword">const</span>;
<a name="l00216"></a>00216     <span class="keywordtype">void</span> <a class="code" href="classVirtDescriptor.html#a7dc81783acf26ffd39275e705fca3e8a" title="Write to the contents of a descriptor.">write</a>(<span class="keywordtype">size_t</span> <a class="code" href="namespaceArmISA.html#a19e4a68ca5c93c6136351d804b432b09">offset</a>, <span class="keyword">const</span> uint8_t *src, <span class="keywordtype">size_t</span> <a class="code" href="classVirtDescriptor.html#a15ca6fa90f28bbf064848f199ae368e8" title="Retrieve the size of this descriptor.">size</a>);
<a name="l00229"></a><a class="code" href="classVirtDescriptor.html#a15ca6fa90f28bbf064848f199ae368e8">00229</a>     <span class="keywordtype">size_t</span> <a class="code" href="classVirtDescriptor.html#a15ca6fa90f28bbf064848f199ae368e8" title="Retrieve the size of this descriptor.">size</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classVirtDescriptor.html#acbdac4a3a4acb7a9d55068b4bfba15ca" title="Underlying descriptor.">desc</a>.<a class="code" href="structvring__desc.html#ac1c5fe0c5e1e8e28f2c38263e28a82ce">len</a>; }
<a name="l00230"></a>00230 
<a name="l00236"></a><a class="code" href="classVirtDescriptor.html#a67e07f8396a766be525132b6b57751e7">00236</a>     <span class="keywordtype">bool</span> <a class="code" href="classVirtDescriptor.html#a67e07f8396a766be525132b6b57751e7" title="Is this descriptor chained to another descriptor?">hasNext</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classVirtDescriptor.html#acbdac4a3a4acb7a9d55068b4bfba15ca" title="Underlying descriptor.">desc</a>.<a class="code" href="structvring__desc.html#a81a7d7268f146217db8d91886ec6502e">flags</a> &amp; <a class="code" href="virtio__ring_8h.html#ac98030127cfdd5b7e53a4756a38d3e28">VRING_DESC_F_NEXT</a>; }
<a name="l00243"></a>00243     <a class="code" href="classVirtDescriptor.html" title="VirtIO descriptor (chain) wrapper.">VirtDescriptor</a> *<a class="code" href="classVirtDescriptor.html#a8128579aaad158dc54ca3e82de38a85a" title="Get the pointer to the next descriptor in a chain.">next</a>() <span class="keyword">const</span>;
<a name="l00244"></a>00244 
<a name="l00246"></a><a class="code" href="classVirtDescriptor.html#aae7082a92bd61ef8b2a90aff7e4a6b85">00246</a>     <span class="keywordtype">bool</span> <a class="code" href="classVirtDescriptor.html#aae7082a92bd61ef8b2a90aff7e4a6b85" title="Check if this is a read-only descriptor (incoming data).">isIncoming</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> !<a class="code" href="classVirtDescriptor.html#ae5f0045a9323b3c2fe10e944e44db301" title="Check if this is a write-only descriptor (outgoing data).">isOutgoing</a>(); }
<a name="l00248"></a><a class="code" href="classVirtDescriptor.html#ae5f0045a9323b3c2fe10e944e44db301">00248</a>     <span class="keywordtype">bool</span> <a class="code" href="classVirtDescriptor.html#ae5f0045a9323b3c2fe10e944e44db301" title="Check if this is a write-only descriptor (outgoing data).">isOutgoing</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classVirtDescriptor.html#acbdac4a3a4acb7a9d55068b4bfba15ca" title="Underlying descriptor.">desc</a>.<a class="code" href="structvring__desc.html#a81a7d7268f146217db8d91886ec6502e">flags</a> &amp; <a class="code" href="virtio__ring_8h.html#a74fe2dbfe07fd3d386e87e7e7a921691">VRING_DESC_F_WRITE</a>; }
<a name="l00249"></a>00249 
<a name="l00250"></a>00250 
<a name="l00263"></a>00263     <span class="keywordtype">void</span> <a class="code" href="classVirtDescriptor.html#a8e9604756d44d41965c2485d2bab2120" title="Read the contents of a descriptor chain.">chainRead</a>(<span class="keywordtype">size_t</span> <a class="code" href="namespaceArmISA.html#a19e4a68ca5c93c6136351d804b432b09">offset</a>, uint8_t *dst, <span class="keywordtype">size_t</span> <a class="code" href="classVirtDescriptor.html#a15ca6fa90f28bbf064848f199ae368e8" title="Retrieve the size of this descriptor.">size</a>) <span class="keyword">const</span>;
<a name="l00276"></a>00276     <span class="keywordtype">void</span> <a class="code" href="classVirtDescriptor.html#a6240118e99f82d6afc18b03667e3143a" title="Write to a descriptor chain.">chainWrite</a>(<span class="keywordtype">size_t</span> <a class="code" href="namespaceArmISA.html#a19e4a68ca5c93c6136351d804b432b09">offset</a>, <span class="keyword">const</span> uint8_t *src, <span class="keywordtype">size_t</span> <a class="code" href="classVirtDescriptor.html#a15ca6fa90f28bbf064848f199ae368e8" title="Retrieve the size of this descriptor.">size</a>);
<a name="l00285"></a>00285     <span class="keywordtype">size_t</span> <a class="code" href="classVirtDescriptor.html#a8e236bd171508bd691eb5efd460bbeca" title="Retrieve the size of this descriptor chain.">chainSize</a>() <span class="keyword">const</span>;
<a name="l00288"></a>00288   <span class="keyword">private</span>:
<a name="l00289"></a>00289     <span class="comment">// Remove default constructor</span>
<a name="l00290"></a>00290     <a class="code" href="classVirtDescriptor.html#a27d9f8899637b2f8228cd1a2f784fee7">VirtDescriptor</a>();
<a name="l00291"></a>00291     <span class="comment">// Prevent copying</span>
<a name="l00292"></a>00292     <a class="code" href="classVirtDescriptor.html#a27d9f8899637b2f8228cd1a2f784fee7">VirtDescriptor</a>(<span class="keyword">const</span> <a class="code" href="classVirtDescriptor.html" title="VirtIO descriptor (chain) wrapper.">VirtDescriptor</a> &amp;other);
<a name="l00293"></a>00293 
<a name="l00295"></a><a class="code" href="classVirtDescriptor.html#aa298c2e2ea887206bb93af30e355f688">00295</a>     <a class="code" href="classPortProxy.html" title="This object is a proxy for a structural port, to be used for debug accesses.">PortProxy</a> *<a class="code" href="classVirtDescriptor.html#aa298c2e2ea887206bb93af30e355f688" title="Pointer to memory proxy.">memProxy</a>;
<a name="l00297"></a><a class="code" href="classVirtDescriptor.html#ae770c39175438bce8d4c1df66951dc60">00297</a>     <a class="code" href="classVirtQueue.html" title="Base wrapper around a virtqueue.">VirtQueue</a> *<a class="code" href="classVirtDescriptor.html#ae770c39175438bce8d4c1df66951dc60" title="Pointer to virtqueue owning this descriptor.">queue</a>;
<a name="l00298"></a>00298 
<a name="l00300"></a><a class="code" href="classVirtDescriptor.html#a5b5e3c72f02ad67d127225301028bfbb">00300</a>     <a class="code" href="classVirtDescriptor.html#ad010130392fd979e56763c4ebe62766a" title="Descriptor index in virtqueue.">Index</a> <a class="code" href="classVirtDescriptor.html#a5b5e3c72f02ad67d127225301028bfbb" title="Index in virtqueue.">_index</a>;
<a name="l00301"></a>00301 
<a name="l00303"></a><a class="code" href="classVirtDescriptor.html#acbdac4a3a4acb7a9d55068b4bfba15ca">00303</a>     <a class="code" href="structvring__desc.html">vring_desc</a> <a class="code" href="classVirtDescriptor.html#acbdac4a3a4acb7a9d55068b4bfba15ca" title="Underlying descriptor.">desc</a>;
<a name="l00304"></a>00304 };
<a name="l00305"></a>00305 
<a name="l00315"></a><a class="code" href="classVirtQueue.html">00315</a> <span class="keyword">class </span><a class="code" href="classVirtQueue.html" title="Base wrapper around a virtqueue.">VirtQueue</a> {
<a name="l00316"></a>00316 <span class="keyword">public</span>:
<a name="l00317"></a><a class="code" href="classVirtQueue.html#a4a27306f351edef9c04f0c6edf3afc6c">00317</a>     <span class="keyword">virtual</span> <a class="code" href="classVirtQueue.html#a4a27306f351edef9c04f0c6edf3afc6c">~VirtQueue</a>() {};
<a name="l00318"></a>00318 
<a name="l00322"></a>00322     <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classVirtQueue.html#aa5e12978bbad82a14b292871a95db86a">serialize</a>(std::ostream &amp;<a class="code" href="namespaceX86ISA.html#aea9fbab71662ba06cf536e05edfaaad1">os</a>);
<a name="l00323"></a>00323     <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classVirtQueue.html#aa5043642b2e94488e93f267f781eeb29">unserialize</a>(<a class="code" href="classCheckpoint.html">Checkpoint</a> *cp, <span class="keyword">const</span> std::string &amp;section);
<a name="l00334"></a>00334     <span class="keywordtype">void</span> <a class="code" href="classVirtQueue.html#a8df253c2c607fe685cb65b088ae2cc3f" title="Set the base address of this queue.">setAddress</a>(<a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232" title="Address type This will probably be moved somewhere else in the near future.">Addr</a> address);
<a name="l00340"></a><a class="code" href="classVirtQueue.html#a891828e9833b8e1845c644c860ef8eab">00340</a>     <a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232" title="Address type This will probably be moved somewhere else in the near future.">Addr</a> <a class="code" href="classVirtQueue.html#a891828e9833b8e1845c644c860ef8eab" title="Get the guest physical address of this queue.">getAddress</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classVirtQueue.html#a3dc0f840a9e8654f65852011c21b927c" title="Base address of the queue.">_address</a>; }
<a name="l00341"></a>00341 
<a name="l00347"></a><a class="code" href="classVirtQueue.html#ac18a072a0e09ba5e37c36cc9d61b61e5">00347</a>      uint16_t <a class="code" href="classVirtQueue.html#ac18a072a0e09ba5e37c36cc9d61b61e5" title="Get the number of descriptors available in this queue.">getSize</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classVirtQueue.html#a37ce0d531523c3ca49927f927ec4e671" title="Queue size in terms of number of descriptors.">_size</a>; }
<a name="l00348"></a>00348 
<a name="l00358"></a><a class="code" href="classVirtQueue.html#a720b4d5c8617d8b495ab2fd36c650fda">00358</a>     <a class="code" href="classVirtDescriptor.html" title="VirtIO descriptor (chain) wrapper.">VirtDescriptor</a> *<a class="code" href="classVirtQueue.html#a720b4d5c8617d8b495ab2fd36c650fda" title="Get a pointer to a specific descriptor in the queue.">getDescriptor</a>(<a class="code" href="classVirtDescriptor.html#ad010130392fd979e56763c4ebe62766a" title="Descriptor index in virtqueue.">VirtDescriptor::Index</a> <a class="code" href="namespaceMipsISA.html#aeeb2c1446acc9f3e056faacf09c36f7a">index</a>) {
<a name="l00359"></a>00359         <span class="keywordflow">return</span> &amp;<a class="code" href="classVirtQueue.html#aec39f2dbae5b768b997ab1f08ae7a71b" title="Vector of pre-created descriptors indexed by their index into the queue.">descriptors</a>[index];
<a name="l00360"></a>00360     }
<a name="l00372"></a>00372     <a class="code" href="classVirtDescriptor.html" title="VirtIO descriptor (chain) wrapper.">VirtDescriptor</a> *<a class="code" href="classVirtQueue.html#ae3bc14e76b6bf8dff13d832cf4645ed0" title="Get an incoming descriptor chain from the queue.">consumeDescriptor</a>();
<a name="l00391"></a>00391     <span class="keywordtype">void</span> <a class="code" href="classVirtQueue.html#a5aa96983ba9571f6c9b3a8f57dd1d8bb" title="Send a descriptor chain to the guest.">produceDescriptor</a>(<a class="code" href="classVirtDescriptor.html" title="VirtIO descriptor (chain) wrapper.">VirtDescriptor</a> *desc, uint32_t <a class="code" href="namespaceArmISA.html#a66ba49a199b7663294cb7eaba4654127">len</a>);
<a name="l00409"></a>00409     <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classVirtQueue.html#a5238735c36c30ff3fb34a1d324306e2a" title="Notify queue of pending events.">onNotify</a>();
<a name="l00420"></a><a class="code" href="classVirtQueue.html#a6db919d9160b0ea94bcabdd72ba4f1c3">00420</a>     <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classVirtQueue.html#a6db919d9160b0ea94bcabdd72ba4f1c3" title="Notify queue of pending incoming descriptor.">onNotifyDescriptor</a>(<a class="code" href="classVirtDescriptor.html" title="VirtIO descriptor (chain) wrapper.">VirtDescriptor</a> *desc) {};
<a name="l00427"></a>00427     <span class="keywordtype">void</span> <a class="code" href="classVirtQueue.html#a84d30f811dd2d49782151e890c96d091" title="Dump the contents of a queue.">dump</a>() <span class="keyword">const</span>;
<a name="l00435"></a><a class="code" href="classVirtQueue.html#ad1c71bd9cf5b6e30cbc5a24670539e5a">00435</a>     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <a class="code" href="classVirtQueue.html#ad1c71bd9cf5b6e30cbc5a24670539e5a" title="Page size used by VirtIO. It&amp;#39;s hard-coded to 4096 bytes in the spec for historical...">ALIGN_BITS</a> = 12;
<a name="l00436"></a><a class="code" href="classVirtQueue.html#a1de5662375725d771bfa77c83d8b64c8">00436</a>     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <a class="code" href="classVirtQueue.html#a1de5662375725d771bfa77c83d8b64c8">ALIGN_SIZE</a> = 1 &lt;&lt; <a class="code" href="classVirtQueue.html#ad1c71bd9cf5b6e30cbc5a24670539e5a" title="Page size used by VirtIO. It&amp;#39;s hard-coded to 4096 bytes in the spec for historical...">ALIGN_BITS</a>;
<a name="l00439"></a>00439   <span class="keyword">protected</span>:
<a name="l00449"></a>00449     <a class="code" href="classVirtQueue.html#a6f1bd9fd79c35bdad9230ae74586de9c">VirtQueue</a>(<a class="code" href="classPortProxy.html" title="This object is a proxy for a structural port, to be used for debug accesses.">PortProxy</a> &amp;proxy, uint16_t size);
<a name="l00450"></a>00450 
<a name="l00451"></a>00451   <span class="keyword">private</span>:
<a name="l00452"></a>00452     <a class="code" href="classVirtQueue.html#a6f1bd9fd79c35bdad9230ae74586de9c">VirtQueue</a>();
<a name="l00453"></a>00453 
<a name="l00455"></a><a class="code" href="classVirtQueue.html#a37ce0d531523c3ca49927f927ec4e671">00455</a>     <span class="keyword">const</span> uint16_t <a class="code" href="classVirtQueue.html#a37ce0d531523c3ca49927f927ec4e671" title="Queue size in terms of number of descriptors.">_size</a>;
<a name="l00457"></a><a class="code" href="classVirtQueue.html#a3dc0f840a9e8654f65852011c21b927c">00457</a>     <a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232" title="Address type This will probably be moved somewhere else in the near future.">Addr</a> <a class="code" href="classVirtQueue.html#a3dc0f840a9e8654f65852011c21b927c" title="Base address of the queue.">_address</a>;
<a name="l00459"></a><a class="code" href="classVirtQueue.html#aa53b1bd65f6ba7b646c55d2766735414">00459</a>     <a class="code" href="classPortProxy.html" title="This object is a proxy for a structural port, to be used for debug accesses.">PortProxy</a> &amp;<a class="code" href="classVirtQueue.html#aa53b1bd65f6ba7b646c55d2766735414" title="Guest physical memory proxy.">memProxy</a>;
<a name="l00460"></a>00460 
<a name="l00461"></a>00461   <span class="keyword">private</span>:
<a name="l00469"></a>00469     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<a name="l00470"></a><a class="code" href="classVirtQueue_1_1VirtRing.html">00470</a>     <span class="keyword">class </span><a class="code" href="classVirtQueue_1_1VirtRing.html" title="VirtIO ring buffer wrapper.">VirtRing</a>
<a name="l00471"></a>00471     {
<a name="l00472"></a>00472       <span class="keyword">public</span>:
<a name="l00473"></a><a class="code" href="classVirtQueue_1_1VirtRing.html#a61db561a2774c9596af2e87a21cb0ccc">00473</a>         <span class="keyword">typedef</span> uint16_t <a class="code" href="classFlags.html">Flags</a>;
<a name="l00474"></a><a class="code" href="classVirtQueue_1_1VirtRing.html#a12d71bc91d38dd4c797c4215cacbb399">00474</a>         <span class="keyword">typedef</span> uint16_t <a class="code" href="classVirtQueue_1_1VirtRing.html#a12d71bc91d38dd4c797c4215cacbb399">Index</a>;
<a name="l00475"></a>00475 
<a name="l00476"></a><a class="code" href="structVirtQueue_1_1VirtRing_1_1Header.html">00476</a>         <span class="keyword">struct </span><a class="code" href="structVirtQueue_1_1VirtRing_1_1Header.html">Header</a> {
<a name="l00477"></a><a class="code" href="structVirtQueue_1_1VirtRing_1_1Header.html#abdd6b689a080d93572fb36c0899f7ebf">00477</a>             <a class="code" href="classFlags.html">Flags</a> <a class="code" href="structVirtQueue_1_1VirtRing_1_1Header.html#abdd6b689a080d93572fb36c0899f7ebf">flags</a>;
<a name="l00478"></a><a class="code" href="structVirtQueue_1_1VirtRing_1_1Header.html#a21a942d664ef76a33e9d9729d87c5bbd">00478</a>             <a class="code" href="classVirtQueue_1_1VirtRing.html#a12d71bc91d38dd4c797c4215cacbb399">Index</a> <a class="code" href="structVirtQueue_1_1VirtRing_1_1Header.html#a21a942d664ef76a33e9d9729d87c5bbd">index</a>;
<a name="l00479"></a>00479         } <a class="code" href="classVirtQueue_1_1VirtRing.html#a47ede7fb85c2b5607b7c8f770394f3d0">M5_ATTR_PACKED</a>;
<a name="l00480"></a>00480 
<a name="l00481"></a>00481         <a class="code" href="classVirtQueue_1_1VirtRing.html" title="VirtIO ring buffer wrapper.">VirtRing&lt;T&gt;</a>(<a class="code" href="classPortProxy.html" title="This object is a proxy for a structural port, to be used for debug accesses.">PortProxy</a> &amp;proxy, uint16_t size)
<a name="l00482"></a><a class="code" href="classVirtQueue_1_1VirtRing.html#a77e256610bf7d7cf36fb6e3143696b60">00482</a>         : <a class="code" href="classVirtQueue_1_1VirtRing.html#ae1590ed75b28f2ef05b88dc1df1a59bc" title="Ring buffer header in host byte order.">header</a>{0, 0}, <a class="code" href="classVirtQueue_1_1VirtRing.html#ae4ad50d3476d6ceb9d57a0c9869f3d02" title="Elements in ring in host byte order.">ring</a>(size), <a class="code" href="classVirtQueue_1_1VirtRing.html#aabd42babdd40058414e10cc236257caa" title="Guest physical memory proxy.">_proxy</a>(proxy), <a class="code" href="classVirtQueue_1_1VirtRing.html#acfe2da32a42200289e06ec556d66fea4" title="Guest physical base address of the ring buffer.">_base</a>(0) {}
<a name="l00483"></a>00483 
<a name="l00489"></a><a class="code" href="classVirtQueue_1_1VirtRing.html#a7a472eab1bcfb8e89b804dd95ad2bdb2">00489</a>         <span class="keywordtype">void</span> <a class="code" href="classVirtQueue_1_1VirtRing.html#a7a472eab1bcfb8e89b804dd95ad2bdb2" title="Set the base address of the VirtIO ring buffer.">setAddress</a>(<a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232" title="Address type This will probably be moved somewhere else in the near future.">Addr</a> <a class="code" href="namespaceX86ISA.html#a79b5c08c190167d17c9b9b3fd40112f6">addr</a>) { <a class="code" href="classVirtQueue_1_1VirtRing.html#acfe2da32a42200289e06ec556d66fea4" title="Guest physical base address of the ring buffer.">_base</a> = addr; }
<a name="l00490"></a>00490 
<a name="l00492"></a><a class="code" href="classVirtQueue_1_1VirtRing.html#a3c5f166706919d8bed983b02e38258e3">00492</a>         <span class="keywordtype">void</span> <a class="code" href="classVirtQueue_1_1VirtRing.html#a3c5f166706919d8bed983b02e38258e3" title="Update the ring buffer header with data from the guest.">readHeader</a>() {
<a name="l00493"></a>00493             assert(<a class="code" href="classVirtQueue_1_1VirtRing.html#acfe2da32a42200289e06ec556d66fea4" title="Guest physical base address of the ring buffer.">_base</a> != 0);
<a name="l00494"></a>00494             <a class="code" href="classVirtQueue_1_1VirtRing.html#aabd42babdd40058414e10cc236257caa" title="Guest physical memory proxy.">_proxy</a>.<a class="code" href="classPortProxy.html#a1cb54e2a7566a652ff1b7634e9802261" title="Read size bytes memory at address and store in p.">readBlob</a>(<a class="code" href="classVirtQueue_1_1VirtRing.html#acfe2da32a42200289e06ec556d66fea4" title="Guest physical base address of the ring buffer.">_base</a>, (uint8_t *)&amp;<a class="code" href="classVirtQueue_1_1VirtRing.html#ae1590ed75b28f2ef05b88dc1df1a59bc" title="Ring buffer header in host byte order.">header</a>, <span class="keyword">sizeof</span>(header));
<a name="l00495"></a>00495             header.flags = <a class="code" href="dev_2virtio_2base_8hh.html#aa2cf72a71acd4de79cc37a7f8db47b1d" title="Convert legacy VirtIO endianness to host endianness.">vtoh_legacy</a>(header.flags);
<a name="l00496"></a>00496             header.index = <a class="code" href="dev_2virtio_2base_8hh.html#aa2cf72a71acd4de79cc37a7f8db47b1d" title="Convert legacy VirtIO endianness to host endianness.">vtoh_legacy</a>(header.index);
<a name="l00497"></a>00497         }
<a name="l00498"></a>00498 
<a name="l00499"></a><a class="code" href="classVirtQueue_1_1VirtRing.html#af2271ba248d9a1a98e313c4997ef6b5d">00499</a>         <span class="keywordtype">void</span> <a class="code" href="classVirtQueue_1_1VirtRing.html#af2271ba248d9a1a98e313c4997ef6b5d">writeHeader</a>() {
<a name="l00500"></a>00500             Header out;
<a name="l00501"></a>00501             assert(<a class="code" href="classVirtQueue_1_1VirtRing.html#acfe2da32a42200289e06ec556d66fea4" title="Guest physical base address of the ring buffer.">_base</a> != 0);
<a name="l00502"></a>00502             out.flags = <a class="code" href="dev_2virtio_2base_8hh.html#ab30532842b0fcec9ce19141d56fa9a1c" title="Convert host endianness to legacy VirtIO endianness.">htov_legacy</a>(<a class="code" href="classVirtQueue_1_1VirtRing.html#ae1590ed75b28f2ef05b88dc1df1a59bc" title="Ring buffer header in host byte order.">header</a>.<a class="code" href="structVirtQueue_1_1VirtRing_1_1Header.html#abdd6b689a080d93572fb36c0899f7ebf">flags</a>);
<a name="l00503"></a>00503             out.index = <a class="code" href="dev_2virtio_2base_8hh.html#ab30532842b0fcec9ce19141d56fa9a1c" title="Convert host endianness to legacy VirtIO endianness.">htov_legacy</a>(<a class="code" href="classVirtQueue_1_1VirtRing.html#ae1590ed75b28f2ef05b88dc1df1a59bc" title="Ring buffer header in host byte order.">header</a>.<a class="code" href="structVirtQueue_1_1VirtRing_1_1Header.html#a21a942d664ef76a33e9d9729d87c5bbd">index</a>);
<a name="l00504"></a>00504             <a class="code" href="classVirtQueue_1_1VirtRing.html#aabd42babdd40058414e10cc236257caa" title="Guest physical memory proxy.">_proxy</a>.<a class="code" href="classPortProxy.html#a94a9855f06460a600901fab19506ae3a" title="Write size bytes from p to address.">writeBlob</a>(<a class="code" href="classVirtQueue_1_1VirtRing.html#acfe2da32a42200289e06ec556d66fea4" title="Guest physical base address of the ring buffer.">_base</a>, (uint8_t *)&amp;out, <span class="keyword">sizeof</span>(out));
<a name="l00505"></a>00505         }
<a name="l00506"></a>00506 
<a name="l00507"></a><a class="code" href="classVirtQueue_1_1VirtRing.html#a326c7fc81d909bd4cb4cbc7fab212dc7">00507</a>         <span class="keywordtype">void</span> <a class="code" href="classVirtQueue_1_1VirtRing.html#a326c7fc81d909bd4cb4cbc7fab212dc7">read</a>() {
<a name="l00508"></a>00508             <a class="code" href="classVirtQueue_1_1VirtRing.html#a3c5f166706919d8bed983b02e38258e3" title="Update the ring buffer header with data from the guest.">readHeader</a>();
<a name="l00509"></a>00509 
<a name="l00510"></a>00510             <span class="comment">/* Read and byte-swap the elements in the ring */</span>
<a name="l00511"></a>00511             T temp[<a class="code" href="classVirtQueue_1_1VirtRing.html#ae4ad50d3476d6ceb9d57a0c9869f3d02" title="Elements in ring in host byte order.">ring</a>.size()];
<a name="l00512"></a>00512             <a class="code" href="classVirtQueue_1_1VirtRing.html#aabd42babdd40058414e10cc236257caa" title="Guest physical memory proxy.">_proxy</a>.<a class="code" href="classPortProxy.html#a1cb54e2a7566a652ff1b7634e9802261" title="Read size bytes memory at address and store in p.">readBlob</a>(<a class="code" href="classVirtQueue_1_1VirtRing.html#acfe2da32a42200289e06ec556d66fea4" title="Guest physical base address of the ring buffer.">_base</a> + <span class="keyword">sizeof</span>(<a class="code" href="classVirtQueue_1_1VirtRing.html#ae1590ed75b28f2ef05b88dc1df1a59bc" title="Ring buffer header in host byte order.">header</a>),
<a name="l00513"></a>00513                             (uint8_t *)temp, <span class="keyword">sizeof</span>(T) * <a class="code" href="classVirtQueue_1_1VirtRing.html#ae4ad50d3476d6ceb9d57a0c9869f3d02" title="Elements in ring in host byte order.">ring</a>.size());
<a name="l00514"></a>00514             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a> = 0; <a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a> &lt; <a class="code" href="classVirtQueue_1_1VirtRing.html#ae4ad50d3476d6ceb9d57a0c9869f3d02" title="Elements in ring in host byte order.">ring</a>.size(); ++<a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a>)
<a name="l00515"></a>00515                 <a class="code" href="classVirtQueue_1_1VirtRing.html#ae4ad50d3476d6ceb9d57a0c9869f3d02" title="Elements in ring in host byte order.">ring</a>[<a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a>] = <a class="code" href="dev_2virtio_2base_8hh.html#aa2cf72a71acd4de79cc37a7f8db47b1d" title="Convert legacy VirtIO endianness to host endianness.">vtoh_legacy</a>(temp[<a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a>]);
<a name="l00516"></a>00516         }
<a name="l00517"></a>00517 
<a name="l00518"></a><a class="code" href="classVirtQueue_1_1VirtRing.html#a729fc96815da100496a0cb95919d7dec">00518</a>         <span class="keywordtype">void</span> <a class="code" href="classVirtQueue_1_1VirtRing.html#a729fc96815da100496a0cb95919d7dec">write</a>() {
<a name="l00519"></a>00519             assert(<a class="code" href="classVirtQueue_1_1VirtRing.html#acfe2da32a42200289e06ec556d66fea4" title="Guest physical base address of the ring buffer.">_base</a> != 0);
<a name="l00520"></a>00520             <span class="comment">/* Create a byte-swapped copy of the ring and write it to</span>
<a name="l00521"></a>00521 <span class="comment">             * guest memory. */</span>
<a name="l00522"></a>00522             T temp[<a class="code" href="classVirtQueue_1_1VirtRing.html#ae4ad50d3476d6ceb9d57a0c9869f3d02" title="Elements in ring in host byte order.">ring</a>.size()];
<a name="l00523"></a>00523             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a> = 0; <a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a> &lt; <a class="code" href="classVirtQueue_1_1VirtRing.html#ae4ad50d3476d6ceb9d57a0c9869f3d02" title="Elements in ring in host byte order.">ring</a>.size(); ++<a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a>)
<a name="l00524"></a>00524                 temp[<a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a>] = <a class="code" href="dev_2virtio_2base_8hh.html#ab30532842b0fcec9ce19141d56fa9a1c" title="Convert host endianness to legacy VirtIO endianness.">htov_legacy</a>(<a class="code" href="classVirtQueue_1_1VirtRing.html#ae4ad50d3476d6ceb9d57a0c9869f3d02" title="Elements in ring in host byte order.">ring</a>[<a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a>]);
<a name="l00525"></a>00525             <a class="code" href="classVirtQueue_1_1VirtRing.html#aabd42babdd40058414e10cc236257caa" title="Guest physical memory proxy.">_proxy</a>.<a class="code" href="classPortProxy.html#a94a9855f06460a600901fab19506ae3a" title="Write size bytes from p to address.">writeBlob</a>(<a class="code" href="classVirtQueue_1_1VirtRing.html#acfe2da32a42200289e06ec556d66fea4" title="Guest physical base address of the ring buffer.">_base</a> + <span class="keyword">sizeof</span>(<a class="code" href="classVirtQueue_1_1VirtRing.html#ae1590ed75b28f2ef05b88dc1df1a59bc" title="Ring buffer header in host byte order.">header</a>),
<a name="l00526"></a>00526                              (uint8_t *)temp, <span class="keyword">sizeof</span>(T) * <a class="code" href="classVirtQueue_1_1VirtRing.html#ae4ad50d3476d6ceb9d57a0c9869f3d02" title="Elements in ring in host byte order.">ring</a>.size());
<a name="l00527"></a>00527             <a class="code" href="classVirtQueue_1_1VirtRing.html#af2271ba248d9a1a98e313c4997ef6b5d">writeHeader</a>();
<a name="l00528"></a>00528         }
<a name="l00529"></a>00529 
<a name="l00531"></a><a class="code" href="classVirtQueue_1_1VirtRing.html#ae1590ed75b28f2ef05b88dc1df1a59bc">00531</a>         Header <a class="code" href="classVirtQueue_1_1VirtRing.html#ae1590ed75b28f2ef05b88dc1df1a59bc" title="Ring buffer header in host byte order.">header</a>;
<a name="l00533"></a><a class="code" href="classVirtQueue_1_1VirtRing.html#ae4ad50d3476d6ceb9d57a0c9869f3d02">00533</a>         <a class="code" href="classstd_1_1vector.html" title="STL vector class.">std::vector&lt;T&gt;</a> <a class="code" href="classVirtQueue_1_1VirtRing.html#ae4ad50d3476d6ceb9d57a0c9869f3d02" title="Elements in ring in host byte order.">ring</a>;
<a name="l00534"></a>00534 
<a name="l00535"></a>00535       <span class="keyword">private</span>:
<a name="l00536"></a>00536         <span class="comment">// Remove default constructor</span>
<a name="l00537"></a>00537         <a class="code" href="classVirtQueue_1_1VirtRing.html" title="VirtIO ring buffer wrapper.">VirtRing&lt;T&gt;</a>();
<a name="l00538"></a>00538 
<a name="l00540"></a><a class="code" href="classVirtQueue_1_1VirtRing.html#aabd42babdd40058414e10cc236257caa">00540</a>         <a class="code" href="classPortProxy.html" title="This object is a proxy for a structural port, to be used for debug accesses.">PortProxy</a> &amp;<a class="code" href="classVirtQueue_1_1VirtRing.html#aabd42babdd40058414e10cc236257caa" title="Guest physical memory proxy.">_proxy</a>;
<a name="l00542"></a><a class="code" href="classVirtQueue_1_1VirtRing.html#acfe2da32a42200289e06ec556d66fea4">00542</a>         <a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232" title="Address type This will probably be moved somewhere else in the near future.">Addr</a> <a class="code" href="classVirtQueue_1_1VirtRing.html#acfe2da32a42200289e06ec556d66fea4" title="Guest physical base address of the ring buffer.">_base</a>;
<a name="l00543"></a>00543     };
<a name="l00544"></a>00544 
<a name="l00546"></a><a class="code" href="classVirtQueue.html#a1e9571271f4639c24fb1e668ef5cca44">00546</a>     <a class="code" href="classVirtQueue_1_1VirtRing.html">VirtRing&lt;VirtDescriptor::Index&gt;</a> <a class="code" href="classVirtQueue.html#a1e9571271f4639c24fb1e668ef5cca44" title="Ring of available (incoming) descriptors.">avail</a>;
<a name="l00548"></a><a class="code" href="classVirtQueue.html#a6b3ec20f5b6a7a308792355905ef1aac">00548</a>     <a class="code" href="classVirtQueue_1_1VirtRing.html">VirtRing&lt;struct vring_used_elem&gt;</a> <a class="code" href="classVirtQueue.html#a6b3ec20f5b6a7a308792355905ef1aac" title="Ring of used (outgoing) descriptors.">used</a>;
<a name="l00549"></a>00549 
<a name="l00552"></a><a class="code" href="classVirtQueue.html#ae2f9c0c2c250b585ea2755948f9a9757">00552</a>     uint16_t <a class="code" href="classVirtQueue.html#ae2f9c0c2c250b585ea2755948f9a9757" title="Offset of last consumed descriptor in the VirtQueue::avail ring.">_last_avail</a>;
<a name="l00553"></a>00553 
<a name="l00556"></a><a class="code" href="classVirtQueue.html#aec39f2dbae5b768b997ab1f08ae7a71b">00556</a>     <a class="code" href="classstd_1_1vector.html">std::vector&lt;VirtDescriptor&gt;</a> <a class="code" href="classVirtQueue.html#aec39f2dbae5b768b997ab1f08ae7a71b" title="Vector of pre-created descriptors indexed by their index into the queue.">descriptors</a>;
<a name="l00557"></a>00557 };
<a name="l00558"></a>00558 
<a name="l00569"></a><a class="code" href="classVirtIODeviceBase.html">00569</a> <span class="keyword">class </span><a class="code" href="classVirtIODeviceBase.html" title="Base class for all VirtIO-based devices.">VirtIODeviceBase</a> : <span class="keyword">public</span> <a class="code" href="classSimObject.html" title="Abstract superclass for simulation objects.">SimObject</a>
<a name="l00570"></a>00570 {
<a name="l00571"></a>00571   <span class="keyword">public</span>:
<a name="l00572"></a><a class="code" href="classVirtIODeviceBase.html#a3f931bdf244c344bf0b266d790a8feff">00572</a>     <span class="keyword">typedef</span> uint16_t <a class="code" href="classVirtIODeviceBase.html#a3f931bdf244c344bf0b266d790a8feff">QueueID</a>;
<a name="l00573"></a><a class="code" href="classVirtIODeviceBase.html#a7e1d97e8524192841f59e900860e3855">00573</a>     <span class="keyword">typedef</span> uint32_t <a class="code" href="classVirtIODeviceBase.html#a7e1d97e8524192841f59e900860e3855">FeatureBits</a>;
<a name="l00579"></a><a class="code" href="classVirtIODeviceBase.html#a61cd20b81c5465449dd2a39a35b26018">00579</a>     <span class="keyword">typedef</span> uint16_t <a class="code" href="classVirtIODeviceBase.html#a61cd20b81c5465449dd2a39a35b26018" title="This is a VirtQueue address as exposed through the low-level interface. The address...">VirtAddress</a>;
<a name="l00581"></a><a class="code" href="classVirtIODeviceBase.html#a1b22ed10b4e720755cb018308f9f6334">00581</a>     <span class="keyword">typedef</span> uint16_t <a class="code" href="classVirtIODeviceBase.html#a1b22ed10b4e720755cb018308f9f6334" title="Device Type (sometimes known as subsystem ID).">DeviceId</a>;
<a name="l00582"></a>00582 
<a name="l00583"></a>00583     <a class="code" href="classVirtIODeviceBase.html#a2fa7f27b22889bf562b00dac0e263ad7">BitUnion8</a>(DeviceStatus)
<a name="l00584"></a>00584         Bitfield&lt;7&gt; failed;
<a name="l00585"></a><a class="code" href="classVirtIODeviceBase.html#a8a5af8337598ec43bb6f65df97e5de59">00585</a>         Bitfield&lt;2&gt; <a class="code" href="classVirtIODeviceBase.html#a8a5af8337598ec43bb6f65df97e5de59">driver_ok</a>;
<a name="l00586"></a><a class="code" href="classVirtIODeviceBase.html#a77d5f282ccb6ab2f908319f0f98b5eac">00586</a>         Bitfield&lt;1&gt; <a class="code" href="classVirtIODeviceBase.html#a77d5f282ccb6ab2f908319f0f98b5eac">driver</a>;
<a name="l00587"></a><a class="code" href="classVirtIODeviceBase.html#a4fa3b4cd2c26ea6ad086daa708c54e58">00587</a>         Bitfield&lt;0&gt; <a class="code" href="classVirtIODeviceBase.html#a4fa3b4cd2c26ea6ad086daa708c54e58">acknowledge</a>;
<a name="l00588"></a>00588     <a class="code" href="classVirtIODeviceBase.html#a01568bd6744907d30ca3db431e227f5c">EndBitUnion</a>(DeviceStatus)
<a name="l00589"></a>00589 
<a name="l00590"></a>00590     typedef VirtIODeviceBaseParams <a class="code" href="classSimObject.html#a5ec10f06fd6e6061713b405aa822ae51">Params</a>;
<a name="l00591"></a>00591     <a class="code" href="classVirtIODeviceBase.html" title="Base class for all VirtIO-based devices.">VirtIODeviceBase</a>(Params *<a class="code" href="classSimObject.html#a43d73d4e5a424c32210e0135eb8db59d">params</a>, <a class="code" href="classVirtIODeviceBase.html#a1b22ed10b4e720755cb018308f9f6334" title="Device Type (sometimes known as subsystem ID).">DeviceId</a> <span class="keywordtype">id</span>, <span class="keywordtype">size_t</span> config_size,
<a name="l00592"></a>00592                      <a class="code" href="classVirtIODeviceBase.html#a7e1d97e8524192841f59e900860e3855">FeatureBits</a> features);
<a name="l00593"></a>00593     virtual ~<a class="code" href="classVirtIODeviceBase.html" title="Base class for all VirtIO-based devices.">VirtIODeviceBase</a>();
<a name="l00594"></a>00594 
<a name="l00595"></a>00595   public:
<a name="l00600"></a>00600     <span class="keywordtype">void</span> <a class="code" href="classVirtIODeviceBase.html#a9409147a12d59e1168cc3a6061dd72d8">serialize</a>(std::ostream &amp;<a class="code" href="namespaceX86ISA.html#aea9fbab71662ba06cf536e05edfaaad1">os</a>);
<a name="l00601"></a>00601     <span class="keywordtype">void</span> <a class="code" href="classVirtIODeviceBase.html#a78dc1e84fd27cbf142616efd20fa1764">unserialize</a>(<a class="code" href="classCheckpoint.html">Checkpoint</a> *cp, const std::<span class="keywordtype">string</span> &amp;section);
<a name="l00602"></a>00602 
<a name="l00606"></a>00606   protected:
<a name="l00621"></a><a class="code" href="classVirtIODeviceBase.html#ad6ff618322afbcb64244fb7dc516609b">00621</a>     <span class="keywordtype">void</span> <a class="code" href="classVirtIODeviceBase.html#ad6ff618322afbcb64244fb7dc516609b" title="Inform the guest of available buffers.">kick</a>() {
<a name="l00622"></a>00622         assert(<a class="code" href="classVirtIODeviceBase.html#a8f0e7bfbe1b83e5938928d5b15269dbd" title="Callbacks to kick the guest through the transport layer.">transKick</a>);
<a name="l00623"></a>00623         <a class="code" href="classVirtIODeviceBase.html#a8f0e7bfbe1b83e5938928d5b15269dbd" title="Callbacks to kick the guest through the transport layer.">transKick</a>-&gt;<a class="code" href="classCallback.html#abd55ae2a374bf4361387fb44552d80f7" title="virtual process function that is invoked when the callback queue is executed.">process</a>();
<a name="l00624"></a>00624     };
<a name="l00625"></a>00625 
<a name="l00637"></a>00637     <span class="keywordtype">void</span> <a class="code" href="classVirtIODeviceBase.html#a9056794510d9115331a2f4fc71957d62" title="Register a new VirtQueue with the device model.">registerQueue</a>(<a class="code" href="classVirtQueue.html" title="Base wrapper around a virtqueue.">VirtQueue</a> &amp;queue);
<a name="l00638"></a>00638 
<a name="l00639"></a>00639 
<a name="l00650"></a><a class="code" href="classVirtIODeviceBase.html#a0cf2ec166fb5e27695cecea9baef6ea2">00650</a>     <a class="code" href="classVirtIODeviceBase.html#a7e1d97e8524192841f59e900860e3855">FeatureBits</a> <a class="code" href="classVirtIODeviceBase.html#a0cf2ec166fb5e27695cecea9baef6ea2" title="Feature set accepted by the guest.">guestFeatures</a>;
<a name="l00653"></a>00653   <span class="keyword">public</span>:
<a name="l00671"></a>00671     <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classVirtIODeviceBase.html#a67726d16881dc7542fb4466b70a79f0f" title="Read from the configuration space of a device.">readConfig</a>(<a class="code" href="classPacket.html" title="A Packet is used to encapsulate a transfer between two objects in the memory system...">PacketPtr</a> pkt, <a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232" title="Address type This will probably be moved somewhere else in the near future.">Addr</a> cfgOffset);
<a name="l00686"></a>00686     <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classVirtIODeviceBase.html#a722e47f470225e82c452eda795f34758" title="Write to the configuration space of a device.">writeConfig</a>(<a class="code" href="classPacket.html" title="A Packet is used to encapsulate a transfer between two objects in the memory system...">PacketPtr</a> pkt, <a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232" title="Address type This will probably be moved somewhere else in the near future.">Addr</a> cfgOffset);
<a name="l00687"></a>00687 
<a name="l00700"></a>00700     <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classVirtIODeviceBase.html#ad6665bf85dfba4ae91510c5bd25300d8" title="Driver-request device reset.">reset</a>();
<a name="l00703"></a>00703   <span class="keyword">protected</span>:
<a name="l00715"></a>00715     <span class="keywordtype">void</span> <a class="code" href="classVirtIODeviceBase.html#a26ca8575426db806e0b7b238b0bc248b" title="Read configuration data from a device structure.">readConfigBlob</a>(<a class="code" href="classPacket.html" title="A Packet is used to encapsulate a transfer between two objects in the memory system...">PacketPtr</a> pkt, <a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232" title="Address type This will probably be moved somewhere else in the near future.">Addr</a> cfgOffset, <span class="keyword">const</span> uint8_t *cfg);
<a name="l00716"></a>00716 
<a name="l00724"></a>00724     <span class="keywordtype">void</span> <a class="code" href="classVirtIODeviceBase.html#abb12c376fa0675dc5e35e553eb571906" title="Write configuration data to a device structure.">writeConfigBlob</a>(<a class="code" href="classPacket.html" title="A Packet is used to encapsulate a transfer between two objects in the memory system...">PacketPtr</a> pkt, <a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232" title="Address type This will probably be moved somewhere else in the near future.">Addr</a> cfgOffset, uint8_t *cfg);
<a name="l00725"></a>00725 
<a name="l00728"></a>00728   <span class="keyword">public</span>:
<a name="l00738"></a><a class="code" href="classVirtIODeviceBase.html#a16c34b4aba4cdce263949afbc0d9e643">00738</a>     <span class="keywordtype">void</span> <a class="code" href="classVirtIODeviceBase.html#a16c34b4aba4cdce263949afbc0d9e643" title="Register a callback to kick the guest through the transport interface.">registerKickCallback</a>(<a class="code" href="classCallback.html" title="Generic callback class.">Callback</a> *<a class="code" href="namespaceArmISA.html#a21f7b327cbedf079597394ec2c3f2a6d">c</a>) {
<a name="l00739"></a>00739         assert(!<a class="code" href="classVirtIODeviceBase.html#a8f0e7bfbe1b83e5938928d5b15269dbd" title="Callbacks to kick the guest through the transport layer.">transKick</a>);
<a name="l00740"></a>00740         <a class="code" href="classVirtIODeviceBase.html#a8f0e7bfbe1b83e5938928d5b15269dbd" title="Callbacks to kick the guest through the transport layer.">transKick</a> = c;
<a name="l00741"></a>00741     }
<a name="l00742"></a>00742 
<a name="l00743"></a>00743 
<a name="l00753"></a>00753     <span class="keywordtype">void</span> <a class="code" href="classVirtIODeviceBase.html#a5dbc32294e4bad4fd96c40a6c5128fe8" title="Driver is requesting service.">onNotify</a>(<a class="code" href="classVirtIODeviceBase.html#a3f931bdf244c344bf0b266d790a8feff">QueueID</a> <a class="code" href="namespaceMipsISA.html#aeeb2c1446acc9f3e056faacf09c36f7a">index</a>);
<a name="l00754"></a>00754 
<a name="l00755"></a>00755 
<a name="l00765"></a><a class="code" href="classVirtIODeviceBase.html#a47d9daeb2cc3b45d8df30d00e63917a0">00765</a>     <span class="keywordtype">void</span> <a class="code" href="classVirtIODeviceBase.html#a47d9daeb2cc3b45d8df30d00e63917a0" title="Change currently active queue.">setQueueSelect</a>(<a class="code" href="classVirtIODeviceBase.html#a3f931bdf244c344bf0b266d790a8feff">QueueID</a> idx) { <a class="code" href="classVirtIODeviceBase.html#a22a43c1cfdad92dcfb0c5a4215fc6e80" title="Queue select register (set by guest).">_queueSelect</a> = idx; }
<a name="l00775"></a><a class="code" href="classVirtIODeviceBase.html#a5ab062fafc8f60ef24fbb2db9223cfe7">00775</a>     <a class="code" href="classVirtIODeviceBase.html#a3f931bdf244c344bf0b266d790a8feff">QueueID</a> <a class="code" href="classVirtIODeviceBase.html#a5ab062fafc8f60ef24fbb2db9223cfe7" title="Get the currently active queue.">getQueueSelect</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classVirtIODeviceBase.html#a22a43c1cfdad92dcfb0c5a4215fc6e80" title="Queue select register (set by guest).">_queueSelect</a>; }
<a name="l00776"></a>00776 
<a name="l00791"></a>00791     <span class="keywordtype">void</span> <a class="code" href="classVirtIODeviceBase.html#a0a347f18db3d32186d74edb30ad4ffc5" title="Change the host physical address of the currently active queue.">setQueueAddress</a>(uint32_t address);
<a name="l00805"></a>00805     uint32_t <a class="code" href="classVirtIODeviceBase.html#a4953ea9530f167380ca8c00a13f31d52" title="Get the host physical address of the currently active queue.">getQueueAddress</a>() <span class="keyword">const</span>;
<a name="l00806"></a>00806 
<a name="l00813"></a><a class="code" href="classVirtIODeviceBase.html#a89775fdd932d7a74fff10fef8dc28510">00813</a>     uint16_t <a class="code" href="classVirtIODeviceBase.html#a89775fdd932d7a74fff10fef8dc28510" title="Get the size (descriptors) of the currently active queue.">getQueueSize</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classVirtIODeviceBase.html#ab570a5b7395ed3208e66da98f0e31fd8" title="Convenience method to get the currently selected queue.">getCurrentQueue</a>().<a class="code" href="classVirtQueue.html#ac18a072a0e09ba5e37c36cc9d61b61e5" title="Get the number of descriptors available in this queue.">getSize</a>(); }
<a name="l00814"></a>00814 
<a name="l00823"></a>00823     <span class="keywordtype">void</span> <a class="code" href="classVirtIODeviceBase.html#a5d795ebfece994be522e07b6ae57d82b" title="Update device status and optionally reset device.">setDeviceStatus</a>(DeviceStatus <a class="code" href="namespaceArmISA.html#ab7583452c2328b9aaf5982ce3225554a">status</a>);
<a name="l00824"></a>00824 
<a name="l00830"></a><a class="code" href="classVirtIODeviceBase.html#ac038f8456a3a56299a781f39442f8b6e">00830</a>     DeviceStatus <a class="code" href="classVirtIODeviceBase.html#ac038f8456a3a56299a781f39442f8b6e" title="Retrieve the device status.">getDeviceStatus</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classVirtIODeviceBase.html#a94a282d3ffb4c86fd7151e06ab00af82" title="Status of the device.">_deviceStatus</a>; }
<a name="l00831"></a>00831 
<a name="l00838"></a>00838     <span class="keywordtype">void</span> <a class="code" href="classVirtIODeviceBase.html#a1c4fa10c398091b8c6cf87709f7b9995" title="Set feature bits accepted by the guest driver.">setGuestFeatures</a>(<a class="code" href="classVirtIODeviceBase.html#a7e1d97e8524192841f59e900860e3855">FeatureBits</a> features);
<a name="l00839"></a>00839 
<a name="l00845"></a><a class="code" href="classVirtIODeviceBase.html#a8ac8cce84100e81e98c9b84742d4082f">00845</a>     <a class="code" href="classVirtIODeviceBase.html#a7e1d97e8524192841f59e900860e3855">FeatureBits</a> <a class="code" href="classVirtIODeviceBase.html#a8ac8cce84100e81e98c9b84742d4082f" title="Get features accepted by the guest driver.">getGuestFeatures</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classVirtIODeviceBase.html#a0cf2ec166fb5e27695cecea9baef6ea2" title="Feature set accepted by the guest.">guestFeatures</a>; }
<a name="l00846"></a>00846 
<a name="l00848"></a><a class="code" href="classVirtIODeviceBase.html#aaf5651e207b1d055984a478c3326b69d">00848</a>     <span class="keyword">const</span> <a class="code" href="classVirtIODeviceBase.html#a1b22ed10b4e720755cb018308f9f6334" title="Device Type (sometimes known as subsystem ID).">DeviceId</a> <a class="code" href="classVirtIODeviceBase.html#aaf5651e207b1d055984a478c3326b69d" title="Device ID (sometimes known as subsystem ID).">deviceId</a>;
<a name="l00849"></a>00849 
<a name="l00851"></a><a class="code" href="classVirtIODeviceBase.html#abbbf1eef529625b6c160f40c01e3ae90">00851</a>     <span class="keyword">const</span> <span class="keywordtype">size_t</span> <a class="code" href="classVirtIODeviceBase.html#abbbf1eef529625b6c160f40c01e3ae90" title="Size of the device&amp;#39;s configuration space.">configSize</a>;
<a name="l00852"></a>00852 
<a name="l00854"></a><a class="code" href="classVirtIODeviceBase.html#a25e639c97dcca5bcdf40e5c176ece915">00854</a>     <span class="keyword">const</span> <a class="code" href="classVirtIODeviceBase.html#a7e1d97e8524192841f59e900860e3855">FeatureBits</a> <a class="code" href="classVirtIODeviceBase.html#a25e639c97dcca5bcdf40e5c176ece915" title="Feature set offered by the device.">deviceFeatures</a>;
<a name="l00857"></a>00857   <span class="keyword">private</span>:
<a name="l00859"></a>00859     <span class="keyword">const</span> <a class="code" href="classVirtQueue.html" title="Base wrapper around a virtqueue.">VirtQueue</a> &amp;<a class="code" href="classVirtIODeviceBase.html#ab570a5b7395ed3208e66da98f0e31fd8" title="Convenience method to get the currently selected queue.">getCurrentQueue</a>() <span class="keyword">const</span>;
<a name="l00861"></a>00861     <a class="code" href="classVirtQueue.html" title="Base wrapper around a virtqueue.">VirtQueue</a> &amp;<a class="code" href="classVirtIODeviceBase.html#ab570a5b7395ed3208e66da98f0e31fd8" title="Convenience method to get the currently selected queue.">getCurrentQueue</a>();
<a name="l00862"></a>00862 
<a name="l00869"></a><a class="code" href="classVirtIODeviceBase.html#a94a282d3ffb4c86fd7151e06ab00af82">00869</a>     DeviceStatus <a class="code" href="classVirtIODeviceBase.html#a94a282d3ffb4c86fd7151e06ab00af82" title="Status of the device.">_deviceStatus</a>;
<a name="l00870"></a>00870 
<a name="l00872"></a><a class="code" href="classVirtIODeviceBase.html#a22a43c1cfdad92dcfb0c5a4215fc6e80">00872</a>     <a class="code" href="classVirtIODeviceBase.html#a3f931bdf244c344bf0b266d790a8feff">QueueID</a> <a class="code" href="classVirtIODeviceBase.html#a22a43c1cfdad92dcfb0c5a4215fc6e80" title="Queue select register (set by guest).">_queueSelect</a>;
<a name="l00873"></a>00873 
<a name="l00875"></a><a class="code" href="classVirtIODeviceBase.html#a103f3d2d1f62bc52496a4d7061085f95">00875</a>     <a class="code" href="classstd_1_1vector.html">std::vector&lt;VirtQueue *&gt;</a> <a class="code" href="classVirtIODeviceBase.html#a103f3d2d1f62bc52496a4d7061085f95" title="List of virtual queues supported by this device.">_queues</a>;
<a name="l00876"></a>00876 
<a name="l00878"></a><a class="code" href="classVirtIODeviceBase.html#a8f0e7bfbe1b83e5938928d5b15269dbd">00878</a>     <a class="code" href="classCallback.html" title="Generic callback class.">Callback</a> *<a class="code" href="classVirtIODeviceBase.html#a8f0e7bfbe1b83e5938928d5b15269dbd" title="Callbacks to kick the guest through the transport layer.">transKick</a>;
<a name="l00879"></a>00879 };
<a name="l00880"></a>00880 
<a name="l00881"></a>00881 <span class="preprocessor">#endif // __DEV_VIRTIO_BASE_HH__</span>
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&nbsp;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"><address style="align: right;"><small>
Generated on Mon Dec 7 02:33:08 2015 for gem5 by <a href="http://www.doxygen.org/index.html"> doxygen</a> 1.6.1</small></address>

</body>
</html>
