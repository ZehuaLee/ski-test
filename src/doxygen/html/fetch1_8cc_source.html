<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>gem5: cpu/minor/fetch1.cc Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>cpu/minor/fetch1.cc</h1><a href="fetch1_8cc.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * Copyright (c) 2013-2014 ARM Limited</span>
<a name="l00003"></a>00003 <span class="comment"> * All rights reserved</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> * The license below extends only to copyright in the software and shall</span>
<a name="l00006"></a>00006 <span class="comment"> * not be construed as granting a license to any other intellectual</span>
<a name="l00007"></a>00007 <span class="comment"> * property including but not limited to intellectual property relating</span>
<a name="l00008"></a>00008 <span class="comment"> * to a hardware implementation of the functionality of the software</span>
<a name="l00009"></a>00009 <span class="comment"> * licensed hereunder.  You may use the software subject to the license</span>
<a name="l00010"></a>00010 <span class="comment"> * terms below provided that you ensure that this notice is replicated</span>
<a name="l00011"></a>00011 <span class="comment"> * unmodified and in its entirety in all distributions of the software,</span>
<a name="l00012"></a>00012 <span class="comment"> * modified or unmodified, in source code or in binary form.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * Redistribution and use in source and binary forms, with or without</span>
<a name="l00015"></a>00015 <span class="comment"> * modification, are permitted provided that the following conditions are</span>
<a name="l00016"></a>00016 <span class="comment"> * met: redistributions of source code must retain the above copyright</span>
<a name="l00017"></a>00017 <span class="comment"> * notice, this list of conditions and the following disclaimer;</span>
<a name="l00018"></a>00018 <span class="comment"> * redistributions in binary form must reproduce the above copyright</span>
<a name="l00019"></a>00019 <span class="comment"> * notice, this list of conditions and the following disclaimer in the</span>
<a name="l00020"></a>00020 <span class="comment"> * documentation and/or other materials provided with the distribution;</span>
<a name="l00021"></a>00021 <span class="comment"> * neither the name of the copyright holders nor the names of its</span>
<a name="l00022"></a>00022 <span class="comment"> * contributors may be used to endorse or promote products derived from</span>
<a name="l00023"></a>00023 <span class="comment"> * this software without specific prior written permission.</span>
<a name="l00024"></a>00024 <span class="comment"> *</span>
<a name="l00025"></a>00025 <span class="comment"> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<a name="l00026"></a>00026 <span class="comment"> * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<a name="l00027"></a>00027 <span class="comment"> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span>
<a name="l00028"></a>00028 <span class="comment"> * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span>
<a name="l00029"></a>00029 <span class="comment"> * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span>
<a name="l00030"></a>00030 <span class="comment"> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span>
<a name="l00031"></a>00031 <span class="comment"> * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span>
<a name="l00032"></a>00032 <span class="comment"> * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span>
<a name="l00033"></a>00033 <span class="comment"> * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
<a name="l00034"></a>00034 <span class="comment"> * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span>
<a name="l00035"></a>00035 <span class="comment"> * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00036"></a>00036 <span class="comment"> *</span>
<a name="l00037"></a>00037 <span class="comment"> * Authors: Andrew Bardsley</span>
<a name="l00038"></a>00038 <span class="comment"> */</span>
<a name="l00039"></a>00039 
<a name="l00040"></a>00040 <span class="preprocessor">#include &lt;cstring&gt;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &lt;iomanip&gt;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &lt;sstream&gt;</span>
<a name="l00043"></a>00043 
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="cast_8hh.html">base/cast.hh</a>&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="fetch1_8hh.html" title="Fetch1 is responsible for fetching &amp;quot;lines&amp;quot; from memory and passing them...">cpu/minor/fetch1.hh</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="pipeline_8hh.html" title="The constructed pipeline.">cpu/minor/pipeline.hh</a>&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;debug/Drain.hh&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;debug/Fetch.hh&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;debug/MinorTrace.hh&quot;</span>
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 <span class="keyword">namespace </span>Minor
<a name="l00052"></a>00052 {
<a name="l00053"></a>00053 
<a name="l00054"></a><a class="code" href="classMinor_1_1Fetch1.html#a35c6e019502636a77f8e7375aba1868e">00054</a> <a class="code" href="classMinor_1_1Fetch1.html#a35c6e019502636a77f8e7375aba1868e">Fetch1::Fetch1</a>(<span class="keyword">const</span> std::string &amp;name_,
<a name="l00055"></a>00055     <a class="code" href="classMinorCPU.html" title="MinorCPU is an in-order CPU model with four fixed pipeline stages:.">MinorCPU</a> &amp;cpu_,
<a name="l00056"></a>00056     MinorCPUParams &amp;params,
<a name="l00057"></a>00057     <a class="code" href="classMinor_1_1Latch.html" title="Wraps a MinorBuffer with Input/Output interfaces to ensure that units within the...">Latch&lt;BranchData&gt;::Output</a> inp_,
<a name="l00058"></a>00058     <a class="code" href="classMinor_1_1Latch.html" title="Wraps a MinorBuffer with Input/Output interfaces to ensure that units within the...">Latch&lt;ForwardLineData&gt;::Input</a> out_,
<a name="l00059"></a>00059     <a class="code" href="classMinor_1_1Latch.html" title="Wraps a MinorBuffer with Input/Output interfaces to ensure that units within the...">Latch&lt;BranchData&gt;::Output</a> prediction_,
<a name="l00060"></a>00060     <a class="code" href="classMinor_1_1Reservable.html" title="Base class for space reservation requestable objects.">Reservable</a> &amp;next_stage_input_buffer) :
<a name="l00061"></a>00061     <a class="code" href="classNamed.html">Named</a>(name_),
<a name="l00062"></a>00062     cpu(cpu_),
<a name="l00063"></a>00063     inp(inp_),
<a name="l00064"></a>00064     out(out_),
<a name="l00065"></a>00065     prediction(prediction_),
<a name="l00066"></a>00066     nextStageReserve(next_stage_input_buffer),
<a name="l00067"></a>00067     icachePort(name_ + <span class="stringliteral">&quot;.icache_port&quot;</span>, *this, cpu_),
<a name="l00068"></a>00068     lineSnap(params.fetch1LineSnapWidth),
<a name="l00069"></a>00069     maxLineWidth(params.fetch1LineWidth),
<a name="l00070"></a>00070     fetchLimit(params.fetch1FetchLimit),
<a name="l00071"></a>00071     state(FetchWaitingForPC),
<a name="l00072"></a>00072     <a class="code" href="namespaceMipsISA.html#a4f7ed975e7137b5c369214789649451f">pc</a>(0),
<a name="l00073"></a>00073     streamSeqNum(<a class="code" href="classMinor_1_1InstId.html" title="Id for lines and instructions.">InstId</a>::firstStreamSeqNum),
<a name="l00074"></a>00074     predictionSeqNum(<a class="code" href="classMinor_1_1InstId.html" title="Id for lines and instructions.">InstId</a>::firstPredictionSeqNum),
<a name="l00075"></a>00075     blocked(false),
<a name="l00076"></a>00076     requests(name_ + <span class="stringliteral">&quot;.requests&quot;</span>, <span class="stringliteral">&quot;lines&quot;</span>, params.fetch1FetchLimit),
<a name="l00077"></a>00077     transfers(name_ + <span class="stringliteral">&quot;.transfers&quot;</span>, <span class="stringliteral">&quot;lines&quot;</span>, params.fetch1FetchLimit),
<a name="l00078"></a>00078     icacheState(IcacheRunning),
<a name="l00079"></a>00079     lineSeqNum(<a class="code" href="classMinor_1_1InstId.html" title="Id for lines and instructions.">InstId</a>::firstLineSeqNum),
<a name="l00080"></a>00080     numFetchesInMemorySystem(0),
<a name="l00081"></a>00081     numFetchesInITLB(0)
<a name="l00082"></a>00082 {
<a name="l00083"></a>00083     <span class="keywordflow">if</span> (<a class="code" href="classMinor_1_1Fetch1.html#af477b2228d53002b9587784aee68f892" title="Line snap size in bytes.">lineSnap</a> == 0) {
<a name="l00084"></a>00084         <a class="code" href="classMinor_1_1Fetch1.html#af477b2228d53002b9587784aee68f892" title="Line snap size in bytes.">lineSnap</a> = <a class="code" href="classMinor_1_1Fetch1.html#ac56d337ea3205bd6e1b6b1b7501329b3" title="Construction-assigned data members.">cpu</a>.cacheLineSize();
<a name="l00085"></a>00085         <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Fetch, <span class="stringliteral">&quot;lineSnap set to cache line size of: %d\n&quot;</span>,
<a name="l00086"></a>00086             <a class="code" href="classMinor_1_1Fetch1.html#af477b2228d53002b9587784aee68f892" title="Line snap size in bytes.">lineSnap</a>);
<a name="l00087"></a>00087     }
<a name="l00088"></a>00088 
<a name="l00089"></a>00089     <span class="keywordflow">if</span> (<a class="code" href="classMinor_1_1Fetch1.html#a737f49421df735252b032a0e01ffda0b" title="Maximum fetch width in bytes.">maxLineWidth</a> == 0) {
<a name="l00090"></a>00090         <a class="code" href="classMinor_1_1Fetch1.html#a737f49421df735252b032a0e01ffda0b" title="Maximum fetch width in bytes.">maxLineWidth</a> = <a class="code" href="classMinor_1_1Fetch1.html#ac56d337ea3205bd6e1b6b1b7501329b3" title="Construction-assigned data members.">cpu</a>.cacheLineSize();
<a name="l00091"></a>00091         <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Fetch, <span class="stringliteral">&quot;maxLineWidth set to cache line size of: %d\n&quot;</span>,
<a name="l00092"></a>00092             <a class="code" href="classMinor_1_1Fetch1.html#a737f49421df735252b032a0e01ffda0b" title="Maximum fetch width in bytes.">maxLineWidth</a>);
<a name="l00093"></a>00093     }
<a name="l00094"></a>00094 
<a name="l00095"></a>00095     <span class="comment">/* These assertions should be copied to the Python config. as well */</span>
<a name="l00096"></a>00096     <span class="keywordflow">if</span> ((<a class="code" href="classMinor_1_1Fetch1.html#af477b2228d53002b9587784aee68f892" title="Line snap size in bytes.">lineSnap</a> % <span class="keyword">sizeof</span>(<a class="code" href="namespaceAlphaISA.html#a63693d656cc2bf4bdd0de3e493eabe66">TheISA::MachInst</a>)) != 0) {
<a name="l00097"></a>00097         <a class="code" href="base_2misc_8hh.html#acad519418dbfdd70c1208711e609c80e">fatal</a>(<span class="stringliteral">&quot;%s: fetch1LineSnapWidth must be a multiple &quot;</span>
<a name="l00098"></a>00098             <span class="stringliteral">&quot;of sizeof(TheISA::MachInst) (%d)\n&quot;</span>, name_,
<a name="l00099"></a>00099             <span class="keyword">sizeof</span>(<a class="code" href="namespaceAlphaISA.html#a63693d656cc2bf4bdd0de3e493eabe66">TheISA::MachInst</a>));
<a name="l00100"></a>00100     }
<a name="l00101"></a>00101 
<a name="l00102"></a>00102     <span class="keywordflow">if</span> (!(<a class="code" href="classMinor_1_1Fetch1.html#a737f49421df735252b032a0e01ffda0b" title="Maximum fetch width in bytes.">maxLineWidth</a> &gt;= <a class="code" href="classMinor_1_1Fetch1.html#af477b2228d53002b9587784aee68f892" title="Line snap size in bytes.">lineSnap</a> &amp;&amp;
<a name="l00103"></a>00103         (<a class="code" href="classMinor_1_1Fetch1.html#a737f49421df735252b032a0e01ffda0b" title="Maximum fetch width in bytes.">maxLineWidth</a> % <span class="keyword">sizeof</span>(<a class="code" href="namespaceAlphaISA.html#a63693d656cc2bf4bdd0de3e493eabe66">TheISA::MachInst</a>)) == 0))
<a name="l00104"></a>00104     {
<a name="l00105"></a>00105         <a class="code" href="base_2misc_8hh.html#acad519418dbfdd70c1208711e609c80e">fatal</a>(<span class="stringliteral">&quot;%s: fetch1LineWidth must be a multiple of&quot;</span>
<a name="l00106"></a>00106             <span class="stringliteral">&quot; sizeof(TheISA::MachInst)&quot;</span>
<a name="l00107"></a>00107             <span class="stringliteral">&quot; (%d), and &gt;= fetch1LineSnapWidth (%d)\n&quot;</span>,
<a name="l00108"></a>00108             name_, <span class="keyword">sizeof</span>(<a class="code" href="namespaceAlphaISA.html#a63693d656cc2bf4bdd0de3e493eabe66">TheISA::MachInst</a>), <a class="code" href="classMinor_1_1Fetch1.html#af477b2228d53002b9587784aee68f892" title="Line snap size in bytes.">lineSnap</a>);
<a name="l00109"></a>00109     }
<a name="l00110"></a>00110 
<a name="l00111"></a>00111     <span class="keywordflow">if</span> (<a class="code" href="classMinor_1_1Fetch1.html#ace8a5001e1ead292cd20867e92c65bcd" title="Maximum number of fetches allowed in flight (in queues or memory).">fetchLimit</a> &lt; 1) {
<a name="l00112"></a>00112         <a class="code" href="base_2misc_8hh.html#acad519418dbfdd70c1208711e609c80e">fatal</a>(<span class="stringliteral">&quot;%s: fetch1FetchLimit must be &gt;= 1 (%d)\n&quot;</span>, name_,
<a name="l00113"></a>00113             <a class="code" href="classMinor_1_1Fetch1.html#ace8a5001e1ead292cd20867e92c65bcd" title="Maximum number of fetches allowed in flight (in queues or memory).">fetchLimit</a>);
<a name="l00114"></a>00114     }
<a name="l00115"></a>00115 }
<a name="l00116"></a>00116 
<a name="l00117"></a>00117 <span class="keywordtype">void</span>
<a name="l00118"></a><a class="code" href="classMinor_1_1Fetch1.html#a7fbb3eb3b964ec4e9ed1ded2968c5d1a">00118</a> <a class="code" href="classMinor_1_1Fetch1.html#a7fbb3eb3b964ec4e9ed1ded2968c5d1a" title="Insert a line fetch into the requests.">Fetch1::fetchLine</a>()
<a name="l00119"></a>00119 {
<a name="l00120"></a>00120     <span class="comment">/* If line_offset != 0, a request is pushed for the remainder of the</span>
<a name="l00121"></a>00121 <span class="comment">     * line. */</span>
<a name="l00122"></a>00122     <span class="comment">/* Use a lower, sizeof(MachInst) aligned address for the fetch */</span>
<a name="l00123"></a>00123     <a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232" title="Address type This will probably be moved somewhere else in the near future.">Addr</a> aligned_pc = <a class="code" href="classMinor_1_1Fetch1.html#a68cc41950d48d4da37da2960f973011a" title="Fetch PC value.">pc</a>.instAddr() &amp; ~((<a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232" title="Address type This will probably be moved somewhere else in the near future.">Addr</a>) <a class="code" href="classMinor_1_1Fetch1.html#af477b2228d53002b9587784aee68f892" title="Line snap size in bytes.">lineSnap</a> - 1);
<a name="l00124"></a>00124     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> line_offset = aligned_pc % <a class="code" href="classMinor_1_1Fetch1.html#af477b2228d53002b9587784aee68f892" title="Line snap size in bytes.">lineSnap</a>;
<a name="l00125"></a>00125     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> request_size = <a class="code" href="classMinor_1_1Fetch1.html#a737f49421df735252b032a0e01ffda0b" title="Maximum fetch width in bytes.">maxLineWidth</a> - line_offset;
<a name="l00126"></a>00126 
<a name="l00127"></a>00127     <span class="comment">/* Fill in the line&apos;s id */</span>
<a name="l00128"></a>00128     <a class="code" href="classMinor_1_1InstId.html" title="Id for lines and instructions.">InstId</a> request_id(0 <span class="comment">/* thread */</span>,
<a name="l00129"></a>00129         <a class="code" href="classMinor_1_1Fetch1.html#aa2f64aeccee0cb61cad0435219f2f551" title="Stream sequence number.">streamSeqNum</a>, <a class="code" href="classMinor_1_1Fetch1.html#afa3f896e1fffef34a6937cada8bef505" title="Prediction sequence number.">predictionSeqNum</a>,
<a name="l00130"></a>00130         <a class="code" href="classMinor_1_1Fetch1.html#a114e5fb7bb415b69a655df1d8c088629" title="Sequence number for line fetch used for ordering lines to flush.">lineSeqNum</a>);
<a name="l00131"></a>00131 
<a name="l00132"></a>00132     <a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html" title="Memory access queuing.">FetchRequestPtr</a> request = <span class="keyword">new</span> <a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html" title="Memory access queuing.">FetchRequest</a>(*<span class="keyword">this</span>, request_id, <a class="code" href="classMinor_1_1Fetch1.html#a68cc41950d48d4da37da2960f973011a" title="Fetch PC value.">pc</a>);
<a name="l00133"></a>00133 
<a name="l00134"></a>00134     <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Fetch, <span class="stringliteral">&quot;Inserting fetch into the fetch queue &quot;</span>
<a name="l00135"></a>00135         <span class="stringliteral">&quot;%s addr: 0x%x pc: %s line_offset: %d request_size: %d\n&quot;</span>,
<a name="l00136"></a>00136         request_id, aligned_pc, <a class="code" href="classMinor_1_1Fetch1.html#a68cc41950d48d4da37da2960f973011a" title="Fetch PC value.">pc</a>, line_offset, request_size);
<a name="l00137"></a>00137 
<a name="l00138"></a>00138     request-&gt;<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a9709683076849def8a3cccb50f542a93" title="The underlying request that this fetch represents.">request</a>.<a class="code" href="classRequest.html#a0b067551ee420e924c5e2402539df311" title="Set up CPU and thread numbers.">setThreadContext</a>(<a class="code" href="classMinor_1_1Fetch1.html#ac56d337ea3205bd6e1b6b1b7501329b3" title="Construction-assigned data members.">cpu</a>.cpuId(), <span class="comment">/* thread id */</span> 0);
<a name="l00139"></a>00139     request-&gt;<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a9709683076849def8a3cccb50f542a93" title="The underlying request that this fetch represents.">request</a>.<a class="code" href="classRequest.html#ac308d7b7145a7aaf9aa20c5e89fdf095" title="Set up a virtual (e.g., CPU) request in a previously allocated Request object.">setVirt</a>(0 <span class="comment">/* asid */</span>,
<a name="l00140"></a>00140         aligned_pc, request_size, <a class="code" href="classRequest.html#a28c8ec6b7b6b21126adeb663dcca4cf9" title="The request was an instruction fetch.">Request::INST_FETCH</a>, <a class="code" href="classMinor_1_1Fetch1.html#ac56d337ea3205bd6e1b6b1b7501329b3" title="Construction-assigned data members.">cpu</a>.instMasterId(),
<a name="l00141"></a>00141         <span class="comment">/* I&apos;ve no idea why we need the PC, but give it */</span>
<a name="l00142"></a>00142         <a class="code" href="classMinor_1_1Fetch1.html#a68cc41950d48d4da37da2960f973011a" title="Fetch PC value.">pc</a>.instAddr());
<a name="l00143"></a>00143 
<a name="l00144"></a>00144     <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Fetch, <span class="stringliteral">&quot;Submitting ITLB request\n&quot;</span>);
<a name="l00145"></a>00145     <a class="code" href="classMinor_1_1Fetch1.html#a3610e3e08037ed8642dc1521daa0e355" title="Number of requests inside the ITLB rather than in the queues.">numFetchesInITLB</a>++;
<a name="l00146"></a>00146 
<a name="l00147"></a>00147     request-&gt;<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a0bccd6fab68b7eb8b8fb39c25a3d706f">state</a> = <a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#ad6f00af739be60b2ffb58ceb376e2d78ae223b1f3a650445cb614ac3033991dce">FetchRequest::InTranslation</a>;
<a name="l00148"></a>00148 
<a name="l00149"></a>00149     <span class="comment">/* Reserve space in the queues upstream of requests for results */</span>
<a name="l00150"></a>00150     <a class="code" href="classMinor_1_1Fetch1.html#aee94137a22f4a3f6a761f2fa5cd13da2" title="Queue of in-memory system requests and responses.">transfers</a>.<a class="code" href="classMinor_1_1Queue.html#af033c3641948ec5c237492cb2678e4f6" title="Reserve space in the queue for future pushes.">reserve</a>();
<a name="l00151"></a>00151     <a class="code" href="classMinor_1_1Fetch1.html#acde80e8c25dfc087763ab86ce71054ca" title="Queue of address translated requests from Fetch1.">requests</a>.<a class="code" href="classMinor_1_1Queue.html#a6b7efb3646f9d0a1da191d1eea294dfc" title="Push an element into the buffer if it isn&amp;#39;t a bubble.">push</a>(request);
<a name="l00152"></a>00152 
<a name="l00153"></a>00153     <span class="comment">/* Submit the translation request.  The response will come</span>
<a name="l00154"></a>00154 <span class="comment">     *  through finish/markDelayed on this request as it bears</span>
<a name="l00155"></a>00155 <span class="comment">     *  the Translation interface */</span>
<a name="l00156"></a>00156     <a class="code" href="classMinor_1_1Fetch1.html#ac56d337ea3205bd6e1b6b1b7501329b3" title="Construction-assigned data members.">cpu</a>.<a class="code" href="classMinorCPU.html#a3de1a66eaefeb353de0f557a5eb8d8ba" title="These are thread state-representing objects for this CPU.">threads</a>[request-&gt;<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a82b8884846ebf2cea033ec31e35326bb" title="Identity of the line that this request will generate.">id</a>.<a class="code" href="classMinor_1_1InstId.html#a852c2408f148471a8b88d761893a8991" title="The thread to which this line/instruction belongs.">threadId</a>]-&gt;itb-&gt;translateTiming(
<a name="l00157"></a>00157         &amp;request-&gt;<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a9709683076849def8a3cccb50f542a93" title="The underlying request that this fetch represents.">request</a>,
<a name="l00158"></a>00158         <a class="code" href="classMinor_1_1Fetch1.html#ac56d337ea3205bd6e1b6b1b7501329b3" title="Construction-assigned data members.">cpu</a>.getContext(request-&gt;<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a82b8884846ebf2cea033ec31e35326bb" title="Identity of the line that this request will generate.">id</a>.<a class="code" href="classMinor_1_1InstId.html#a852c2408f148471a8b88d761893a8991" title="The thread to which this line/instruction belongs.">threadId</a>),
<a name="l00159"></a>00159         request, <a class="code" href="classBaseTLB.html#a26b67ef35b9f92e337acf48571c7585ea63234010c6a55c971617a58bd577566b">BaseTLB::Execute</a>);
<a name="l00160"></a>00160 
<a name="l00161"></a>00161     <a class="code" href="classMinor_1_1Fetch1.html#a114e5fb7bb415b69a655df1d8c088629" title="Sequence number for line fetch used for ordering lines to flush.">lineSeqNum</a>++;
<a name="l00162"></a>00162 
<a name="l00163"></a>00163     <span class="comment">/* Step the PC for the next line onto the line aligned next address.</span>
<a name="l00164"></a>00164 <span class="comment">     * Note that as instructions can span lines, this PC is only a</span>
<a name="l00165"></a>00165 <span class="comment">     * reliable &apos;new&apos; PC if the next line has a new stream sequence number. */</span>
<a name="l00166"></a>00166 <span class="preprocessor">#if THE_ISA == ALPHA_ISA</span>
<a name="l00167"></a>00167 <span class="preprocessor"></span>    <span class="comment">/* Restore the low bits of the PC used as address space flags */</span>
<a name="l00168"></a>00168     <a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232" title="Address type This will probably be moved somewhere else in the near future.">Addr</a> pc_low_bits = <a class="code" href="classMinor_1_1Fetch1.html#a68cc41950d48d4da37da2960f973011a" title="Fetch PC value.">pc</a>.instAddr() &amp;
<a name="l00169"></a>00169         ((<a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232" title="Address type This will probably be moved somewhere else in the near future.">Addr</a>) (1 &lt;&lt; <span class="keyword">sizeof</span>(<a class="code" href="namespaceAlphaISA.html#a63693d656cc2bf4bdd0de3e493eabe66">TheISA::MachInst</a>)) - 1);
<a name="l00170"></a>00170 
<a name="l00171"></a>00171     <a class="code" href="classMinor_1_1Fetch1.html#a68cc41950d48d4da37da2960f973011a" title="Fetch PC value.">pc</a>.set(aligned_pc + request_size + pc_low_bits);
<a name="l00172"></a>00172 <span class="preprocessor">#else</span>
<a name="l00173"></a>00173 <span class="preprocessor"></span>    <a class="code" href="classMinor_1_1Fetch1.html#a68cc41950d48d4da37da2960f973011a" title="Fetch PC value.">pc</a>.set(aligned_pc + request_size);
<a name="l00174"></a>00174 <span class="preprocessor">#endif</span>
<a name="l00175"></a>00175 <span class="preprocessor"></span>}
<a name="l00176"></a>00176 
<a name="l00177"></a>00177 std::ostream &amp;
<a name="l00178"></a><a class="code" href="namespaceMinor.html#adb2030362e1e23771dd70563c5f358cb">00178</a> <a class="code" href="namespaceMinor.html#a1a80620114def7129ab86df0f4c330e4" title="Print this id in the usual slash-separated format expected by MinorTrace.">operator &lt;&lt;</a>(std::ostream &amp;<a class="code" href="namespaceX86ISA.html#aea9fbab71662ba06cf536e05edfaaad1">os</a>, <a class="code" href="classMinor_1_1Fetch1.html#a017e190252de98bcb9d29249a374468f" title="State of memory access for head instruction fetch.">Fetch1::IcacheState</a> state)
<a name="l00179"></a>00179 {
<a name="l00180"></a>00180     <span class="keywordflow">switch</span> (state) {
<a name="l00181"></a>00181       <span class="keywordflow">case</span> <a class="code" href="classMinor_1_1Fetch1.html#a017e190252de98bcb9d29249a374468fa5f52d9fc976f4cc478f16cb2819b65fb">Fetch1::IcacheRunning</a>:
<a name="l00182"></a>00182         os &lt;&lt; <span class="stringliteral">&quot;IcacheRunning&quot;</span>;
<a name="l00183"></a>00183         <span class="keywordflow">break</span>;
<a name="l00184"></a>00184       <span class="keywordflow">case</span> <a class="code" href="classMinor_1_1Fetch1.html#a017e190252de98bcb9d29249a374468fafe4b09359f8a9ccf143df55b43f641ae">Fetch1::IcacheNeedsRetry</a>:
<a name="l00185"></a>00185         os &lt;&lt; <span class="stringliteral">&quot;IcacheNeedsRetry&quot;</span>;
<a name="l00186"></a>00186         <span class="keywordflow">break</span>;
<a name="l00187"></a>00187       <span class="keywordflow">default</span>:
<a name="l00188"></a>00188         os &lt;&lt; <span class="stringliteral">&quot;IcacheState-&quot;</span> &lt;&lt; <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(state);
<a name="l00189"></a>00189         <span class="keywordflow">break</span>;
<a name="l00190"></a>00190     }
<a name="l00191"></a>00191     <span class="keywordflow">return</span> os;
<a name="l00192"></a>00192 }
<a name="l00193"></a>00193 
<a name="l00194"></a>00194 <span class="keywordtype">void</span>
<a name="l00195"></a><a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a209c5cbaf41e25d40554121c4ddd36bc">00195</a> <a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a209c5cbaf41e25d40554121c4ddd36bc" title="Make a packet to use with the memory transaction.">Fetch1::FetchRequest::makePacket</a>()
<a name="l00196"></a>00196 {
<a name="l00197"></a>00197     <span class="comment">/* Make the necessary packet for a memory transaction */</span>
<a name="l00198"></a>00198     <a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a13a71ed3c97c084923198f47d5a3d2f9" title="FetchRequests carry packets while they&amp;#39;re in the requests and transfers responses...">packet</a> = <span class="keyword">new</span> <a class="code" href="classPacket.html" title="A Packet is used to encapsulate a transfer between two objects in the memory system...">Packet</a>(&amp;<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a9709683076849def8a3cccb50f542a93" title="The underlying request that this fetch represents.">request</a>, <a class="code" href="classMemCmd.html#ae5c39c2de0ad998b5176bc519b358102aa21449f51bc9023b2dc730a7cd2cbf16">MemCmd::ReadReq</a>);
<a name="l00199"></a>00199     <a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a13a71ed3c97c084923198f47d5a3d2f9" title="FetchRequests carry packets while they&amp;#39;re in the requests and transfers responses...">packet</a>-&gt;<a class="code" href="classPacket.html#aaa5d4a16d37597168dcff5857d9c6717" title="Allocate memory for the packet.">allocate</a>();
<a name="l00200"></a>00200 
<a name="l00201"></a>00201     <span class="comment">/* This FetchRequest becomes SenderState to allow the response to be</span>
<a name="l00202"></a>00202 <span class="comment">     *  identified */</span>
<a name="l00203"></a>00203     <a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a13a71ed3c97c084923198f47d5a3d2f9" title="FetchRequests carry packets while they&amp;#39;re in the requests and transfers responses...">packet</a>-&gt;<a class="code" href="classPacket.html#a8036e59fcb2cf3391e8bb9d0ffc37b9e" title="Push a new sender state to the packet and make the current sender state the predecessor...">pushSenderState</a>(<span class="keyword">this</span>);
<a name="l00204"></a>00204 }
<a name="l00205"></a>00205 
<a name="l00206"></a>00206 <span class="keywordtype">void</span>
<a name="l00207"></a><a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#aa5748afb5ebf6076ff846fddf00d5d83">00207</a> <a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#aa5748afb5ebf6076ff846fddf00d5d83" title="Interface for ITLB responses.">Fetch1::FetchRequest::finish</a>(<span class="keyword">const</span> <a class="code" href="base_2types_8hh.html#afbdce43497ec3a10ccb2d2141fb1def1">Fault</a> &amp;fault_, <a class="code" href="classRequest.html">RequestPtr</a> request_,
<a name="l00208"></a>00208                              <a class="code" href="classThreadContext.html" title="ThreadContext is the external interface to all thread state for anything outside...">ThreadContext</a> *<a class="code" href="namespaceArmISA.html#ad231afd8f3ee15e80991d6fbd5ba2e9a">tc</a>, <a class="code" href="classBaseTLB.html#a26b67ef35b9f92e337acf48571c7585e">BaseTLB::Mode</a> <a class="code" href="namespaceArmISA.html#aab42c0db74065d35a4e8809e56f72f97">mode</a>)
<a name="l00209"></a>00209 {
<a name="l00210"></a>00210     <a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#ad1ac8317c4b5c69a85c501384c99130a" title="Fill in a fault if one happens during fetch, check this by picking apart the response...">fault</a> = fault_;
<a name="l00211"></a>00211 
<a name="l00212"></a>00212     <a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a0bccd6fab68b7eb8b8fb39c25a3d706f">state</a> = <a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#ad6f00af739be60b2ffb58ceb376e2d78a25e5018ad2198b97f2b64babe5da5bc7">Translated</a>;
<a name="l00213"></a>00213     <a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#ae6e6d20f96342113baf593c006788f41" title="Owning fetch unit.">fetch</a>.<a class="code" href="classMinor_1_1Fetch1.html#a9019b8dee589adff65fbda85e4a1a421" title="Handle pushing a TLB response onto the right queue.">handleTLBResponse</a>(<span class="keyword">this</span>);
<a name="l00214"></a>00214 
<a name="l00215"></a>00215     <span class="comment">/* Let&apos;s try and wake up the processor for the next cycle */</span>
<a name="l00216"></a>00216     <a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#ae6e6d20f96342113baf593c006788f41" title="Owning fetch unit.">fetch</a>.<a class="code" href="classMinor_1_1Fetch1.html#ac56d337ea3205bd6e1b6b1b7501329b3" title="Construction-assigned data members.">cpu</a>.<a class="code" href="classMinorCPU.html#a77a7065e0dce4a18fbbea4dd3b8e0bf7" title="Interface for stages to signal that they have become active after a callback or eventq...">wakeupOnEvent</a>(<a class="code" href="classMinor_1_1Pipeline.html#ab007586d11bb6517337d2910886925a4abda76c918e6bbcb75d30264eab67271d">Pipeline::Fetch1StageId</a>);
<a name="l00217"></a>00217 }
<a name="l00218"></a>00218 
<a name="l00219"></a>00219 <span class="keywordtype">void</span>
<a name="l00220"></a><a class="code" href="classMinor_1_1Fetch1.html#a9019b8dee589adff65fbda85e4a1a421">00220</a> <a class="code" href="classMinor_1_1Fetch1.html#a9019b8dee589adff65fbda85e4a1a421" title="Handle pushing a TLB response onto the right queue.">Fetch1::handleTLBResponse</a>(<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html" title="Memory access queuing.">FetchRequestPtr</a> response)
<a name="l00221"></a>00221 {
<a name="l00222"></a>00222     <a class="code" href="classMinor_1_1Fetch1.html#a3610e3e08037ed8642dc1521daa0e355" title="Number of requests inside the ITLB rather than in the queues.">numFetchesInITLB</a>--;
<a name="l00223"></a>00223 
<a name="l00224"></a>00224     <span class="keywordflow">if</span> (response-&gt;<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#ad1ac8317c4b5c69a85c501384c99130a" title="Fill in a fault if one happens during fetch, check this by picking apart the response...">fault</a> != NoFault) {
<a name="l00225"></a>00225         <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Fetch, <span class="stringliteral">&quot;Fault in address ITLB translation: %s, &quot;</span>
<a name="l00226"></a>00226             <span class="stringliteral">&quot;paddr: 0x%x, vaddr: 0x%x\n&quot;</span>,
<a name="l00227"></a>00227             response-&gt;<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#ad1ac8317c4b5c69a85c501384c99130a" title="Fill in a fault if one happens during fetch, check this by picking apart the response...">fault</a>-&gt;name(),
<a name="l00228"></a>00228             (response-&gt;<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a9709683076849def8a3cccb50f542a93" title="The underlying request that this fetch represents.">request</a>.<a class="code" href="classRequest.html#afb93a1ae179f883930104ee1d889ed3b" title="Accessor for paddr.">hasPaddr</a>() ? response-&gt;<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a9709683076849def8a3cccb50f542a93" title="The underlying request that this fetch represents.">request</a>.<a class="code" href="classRequest.html#a7879d8a6ae8ad1af09a4cd55d7787fba">getPaddr</a>() : 0),
<a name="l00229"></a>00229             response-&gt;<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a9709683076849def8a3cccb50f542a93" title="The underlying request that this fetch represents.">request</a>.<a class="code" href="classRequest.html#afd69006362aca38468eb15ad06c3f79b">getVaddr</a>());
<a name="l00230"></a>00230 
<a name="l00231"></a>00231         <span class="keywordflow">if</span> (<a class="code" href="base_2trace_8hh.html#af76c9f7776aade1bf9d7dfa8a0c6b341">DTRACE</a>(MinorTrace))
<a name="l00232"></a>00232             <a class="code" href="classMinor_1_1Fetch1.html#a404253162839715a82f0f5b9fba4ad42" title="Print the appropriate MinorLine line for a fetch response.">minorTraceResponseLine</a>(<a class="code" href="classNamed.html#a6dbf00581f5d749f95ae4a7795df0ebc">name</a>(), response);
<a name="l00233"></a>00233     } <span class="keywordflow">else</span> {
<a name="l00234"></a>00234         <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Fetch, <span class="stringliteral">&quot;Got ITLB response\n&quot;</span>);
<a name="l00235"></a>00235     }
<a name="l00236"></a>00236 
<a name="l00237"></a>00237     response-&gt;<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a0bccd6fab68b7eb8b8fb39c25a3d706f">state</a> = <a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#ad6f00af739be60b2ffb58ceb376e2d78a25e5018ad2198b97f2b64babe5da5bc7">FetchRequest::Translated</a>;
<a name="l00238"></a>00238 
<a name="l00239"></a>00239     <a class="code" href="classMinor_1_1Fetch1.html#a9ace21e8131caf360190ea876cfa2934" title="Try and issue a fetch for a translated request at the head of the requests queue...">tryToSendToTransfers</a>(response);
<a name="l00240"></a>00240 }
<a name="l00241"></a>00241 
<a name="l00242"></a><a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a0d7106e34d69d7e48b16f060b822ae24">00242</a> <a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a0d7106e34d69d7e48b16f060b822ae24">Fetch1::FetchRequest::~FetchRequest</a>()
<a name="l00243"></a>00243 {
<a name="l00244"></a>00244     <span class="keywordflow">if</span> (<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a13a71ed3c97c084923198f47d5a3d2f9" title="FetchRequests carry packets while they&amp;#39;re in the requests and transfers responses...">packet</a>)
<a name="l00245"></a>00245         <span class="keyword">delete</span> <a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a13a71ed3c97c084923198f47d5a3d2f9" title="FetchRequests carry packets while they&amp;#39;re in the requests and transfers responses...">packet</a>;
<a name="l00246"></a>00246 }
<a name="l00247"></a>00247 
<a name="l00248"></a>00248 <span class="keywordtype">void</span>
<a name="l00249"></a><a class="code" href="classMinor_1_1Fetch1.html#a9ace21e8131caf360190ea876cfa2934">00249</a> <a class="code" href="classMinor_1_1Fetch1.html#a9ace21e8131caf360190ea876cfa2934" title="Try and issue a fetch for a translated request at the head of the requests queue...">Fetch1::tryToSendToTransfers</a>(<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html" title="Memory access queuing.">FetchRequestPtr</a> request)
<a name="l00250"></a>00250 {
<a name="l00251"></a>00251     <span class="keywordflow">if</span> (!<a class="code" href="classMinor_1_1Fetch1.html#acde80e8c25dfc087763ab86ce71054ca" title="Queue of address translated requests from Fetch1.">requests</a>.<a class="code" href="classMinor_1_1Queue.html#a97dd10547161f7f888086b469d3a963d" title="Is the queue empty?">empty</a>() &amp;&amp; <a class="code" href="classMinor_1_1Fetch1.html#acde80e8c25dfc087763ab86ce71054ca" title="Queue of address translated requests from Fetch1.">requests</a>.<a class="code" href="classMinor_1_1Queue.html#a017d4357da8b4ea76d7d5418395b4af7" title="Head value.">front</a>() != request) {
<a name="l00252"></a>00252         <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Fetch, <span class="stringliteral">&quot;Fetch not at front of requests queue, can&apos;t&quot;</span>
<a name="l00253"></a>00253             <span class="stringliteral">&quot; issue to memory\n&quot;</span>);
<a name="l00254"></a>00254         <span class="keywordflow">return</span>;
<a name="l00255"></a>00255     }
<a name="l00256"></a>00256 
<a name="l00257"></a>00257     <span class="keywordflow">if</span> (request-&gt;<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a0bccd6fab68b7eb8b8fb39c25a3d706f">state</a> == <a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#ad6f00af739be60b2ffb58ceb376e2d78ae223b1f3a650445cb614ac3033991dce">FetchRequest::InTranslation</a>) {
<a name="l00258"></a>00258         <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Fetch, <span class="stringliteral">&quot;Fetch still in translation, not issuing to&quot;</span>
<a name="l00259"></a>00259             <span class="stringliteral">&quot; memory\n&quot;</span>);
<a name="l00260"></a>00260         <span class="keywordflow">return</span>;
<a name="l00261"></a>00261     }
<a name="l00262"></a>00262 
<a name="l00263"></a>00263     <span class="keywordflow">if</span> (request-&gt;<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a325920d500a5d8952c377b2a657c5f59" title="Is this line out of date with the current stream/prediction sequence and can it be...">isDiscardable</a>() || request-&gt;<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#ad1ac8317c4b5c69a85c501384c99130a" title="Fill in a fault if one happens during fetch, check this by picking apart the response...">fault</a> != NoFault) {
<a name="l00264"></a>00264         <span class="comment">/* Discarded and faulting requests carry on through transfers</span>
<a name="l00265"></a>00265 <span class="comment">         *  as Complete/packet == NULL */</span>
<a name="l00266"></a>00266 
<a name="l00267"></a>00267         request-&gt;<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a0bccd6fab68b7eb8b8fb39c25a3d706f">state</a> = <a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#ad6f00af739be60b2ffb58ceb376e2d78a426f9bf2a8658ab3b73ff80f7e53faab">FetchRequest::Complete</a>;
<a name="l00268"></a>00268         <a class="code" href="classMinor_1_1Fetch1.html#afbd19ec6f53a978de12d4b26ad8fd8e4" title="Move a request between queues.">moveFromRequestsToTransfers</a>(request);
<a name="l00269"></a>00269 
<a name="l00270"></a>00270         <span class="comment">/* Wake up the pipeline next cycle as there will be no event</span>
<a name="l00271"></a>00271 <span class="comment">         *  for this queue-&gt;queue transfer */</span>
<a name="l00272"></a>00272         <a class="code" href="classMinor_1_1Fetch1.html#ac56d337ea3205bd6e1b6b1b7501329b3" title="Construction-assigned data members.">cpu</a>.<a class="code" href="classMinorCPU.html#a77a7065e0dce4a18fbbea4dd3b8e0bf7" title="Interface for stages to signal that they have become active after a callback or eventq...">wakeupOnEvent</a>(<a class="code" href="classMinor_1_1Pipeline.html#ab007586d11bb6517337d2910886925a4abda76c918e6bbcb75d30264eab67271d">Pipeline::Fetch1StageId</a>);
<a name="l00273"></a>00273     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (request-&gt;<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a0bccd6fab68b7eb8b8fb39c25a3d706f">state</a> == <a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#ad6f00af739be60b2ffb58ceb376e2d78a25e5018ad2198b97f2b64babe5da5bc7">FetchRequest::Translated</a>) {
<a name="l00274"></a>00274         <span class="keywordflow">if</span> (!request-&gt;<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a13a71ed3c97c084923198f47d5a3d2f9" title="FetchRequests carry packets while they&amp;#39;re in the requests and transfers responses...">packet</a>)
<a name="l00275"></a>00275             request-&gt;<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a209c5cbaf41e25d40554121c4ddd36bc" title="Make a packet to use with the memory transaction.">makePacket</a>();
<a name="l00276"></a>00276 
<a name="l00277"></a>00277         <span class="comment">/* Ensure that the packet won&apos;t delete the request */</span>
<a name="l00278"></a>00278         assert(request-&gt;<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a13a71ed3c97c084923198f47d5a3d2f9" title="FetchRequests carry packets while they&amp;#39;re in the requests and transfers responses...">packet</a>-&gt;<a class="code" href="classPacket.html#a3eafb3dde5f57c16f684862aff8da0b3">needsResponse</a>());
<a name="l00279"></a>00279 
<a name="l00280"></a>00280         <span class="keywordflow">if</span> (<a class="code" href="classMinor_1_1Fetch1.html#a36a47e0e7486db47242305dbd01e7d6c" title="Try to send (or resend) a memory request&amp;#39;s next/only packet to the memory system...">tryToSend</a>(request))
<a name="l00281"></a>00281             <a class="code" href="classMinor_1_1Fetch1.html#afbd19ec6f53a978de12d4b26ad8fd8e4" title="Move a request between queues.">moveFromRequestsToTransfers</a>(request);
<a name="l00282"></a>00282     } <span class="keywordflow">else</span> {
<a name="l00283"></a>00283         <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Fetch, <span class="stringliteral">&quot;Not advancing line fetch\n&quot;</span>);
<a name="l00284"></a>00284     }
<a name="l00285"></a>00285 }
<a name="l00286"></a>00286 
<a name="l00287"></a>00287 <span class="keywordtype">void</span>
<a name="l00288"></a><a class="code" href="classMinor_1_1Fetch1.html#afbd19ec6f53a978de12d4b26ad8fd8e4">00288</a> <a class="code" href="classMinor_1_1Fetch1.html#afbd19ec6f53a978de12d4b26ad8fd8e4" title="Move a request between queues.">Fetch1::moveFromRequestsToTransfers</a>(<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html" title="Memory access queuing.">FetchRequestPtr</a> request)
<a name="l00289"></a>00289 {
<a name="l00290"></a>00290     assert(!<a class="code" href="classMinor_1_1Fetch1.html#acde80e8c25dfc087763ab86ce71054ca" title="Queue of address translated requests from Fetch1.">requests</a>.<a class="code" href="classMinor_1_1Queue.html#a97dd10547161f7f888086b469d3a963d" title="Is the queue empty?">empty</a>() &amp;&amp; <a class="code" href="classMinor_1_1Fetch1.html#acde80e8c25dfc087763ab86ce71054ca" title="Queue of address translated requests from Fetch1.">requests</a>.<a class="code" href="classMinor_1_1Queue.html#a017d4357da8b4ea76d7d5418395b4af7" title="Head value.">front</a>() == request);
<a name="l00291"></a>00291 
<a name="l00292"></a>00292     <a class="code" href="classMinor_1_1Fetch1.html#acde80e8c25dfc087763ab86ce71054ca" title="Queue of address translated requests from Fetch1.">requests</a>.<a class="code" href="classMinor_1_1Queue.html#aab44925607edcaa046cc15b46e4f14ad" title="Pop the head item.">pop</a>();
<a name="l00293"></a>00293     <a class="code" href="classMinor_1_1Fetch1.html#aee94137a22f4a3f6a761f2fa5cd13da2" title="Queue of in-memory system requests and responses.">transfers</a>.<a class="code" href="classMinor_1_1Queue.html#a6b7efb3646f9d0a1da191d1eea294dfc" title="Push an element into the buffer if it isn&amp;#39;t a bubble.">push</a>(request);
<a name="l00294"></a>00294 }
<a name="l00295"></a>00295 
<a name="l00296"></a>00296 <span class="keywordtype">bool</span>
<a name="l00297"></a><a class="code" href="classMinor_1_1Fetch1.html#a36a47e0e7486db47242305dbd01e7d6c">00297</a> <a class="code" href="classMinor_1_1Fetch1.html#a36a47e0e7486db47242305dbd01e7d6c" title="Try to send (or resend) a memory request&amp;#39;s next/only packet to the memory system...">Fetch1::tryToSend</a>(<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html" title="Memory access queuing.">FetchRequestPtr</a> request)
<a name="l00298"></a>00298 {
<a name="l00299"></a>00299     <span class="keywordtype">bool</span> ret = <span class="keyword">false</span>;
<a name="l00300"></a>00300 
<a name="l00301"></a>00301     <span class="keywordflow">if</span> (<a class="code" href="classMinor_1_1Fetch1.html#a59ab39197283b07b184db89c5a308a72" title="IcachePort to pass to the CPU.">icachePort</a>.<a class="code" href="classMasterPort.html#acba350c337376f074a37507d6018bec3" title="Attempt to send a timing request to the slave port by calling its corresponding receive...">sendTimingReq</a>(request-&gt;<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a13a71ed3c97c084923198f47d5a3d2f9" title="FetchRequests carry packets while they&amp;#39;re in the requests and transfers responses...">packet</a>)) {
<a name="l00302"></a>00302         <span class="comment">/* Invalidate the fetch_requests packet so we don&apos;t</span>
<a name="l00303"></a>00303 <span class="comment">         *  accidentally fail to deallocate it (or use it!)</span>
<a name="l00304"></a>00304 <span class="comment">         *  later by overwriting it */</span>
<a name="l00305"></a>00305         request-&gt;<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a13a71ed3c97c084923198f47d5a3d2f9" title="FetchRequests carry packets while they&amp;#39;re in the requests and transfers responses...">packet</a> = NULL;
<a name="l00306"></a>00306         request-&gt;<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a0bccd6fab68b7eb8b8fb39c25a3d706f">state</a> = <a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#ad6f00af739be60b2ffb58ceb376e2d78a1ad9aa57690e117bbac2348275ebad41">FetchRequest::RequestIssuing</a>;
<a name="l00307"></a>00307         <a class="code" href="classMinor_1_1Fetch1.html#a6d07c9b4ce4503d73e426fc3b23fedf0" title="Count of the number fetches which have left the transfers queue and are in the &amp;#39;wild&amp;#39;...">numFetchesInMemorySystem</a>++;
<a name="l00308"></a>00308 
<a name="l00309"></a>00309         ret = <span class="keyword">true</span>;
<a name="l00310"></a>00310 
<a name="l00311"></a>00311         <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Fetch, <span class="stringliteral">&quot;Issued fetch request to memory: %s\n&quot;</span>,
<a name="l00312"></a>00312             request-&gt;<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a82b8884846ebf2cea033ec31e35326bb" title="Identity of the line that this request will generate.">id</a>);
<a name="l00313"></a>00313     } <span class="keywordflow">else</span> {
<a name="l00314"></a>00314         <span class="comment">/* Needs to be resent, wait for that */</span>
<a name="l00315"></a>00315         <a class="code" href="classMinor_1_1Fetch1.html#a03aa0813eb54c7f54d8bf6389f4464de" title="Retry state of icache_port.">icacheState</a> = <a class="code" href="classMinor_1_1Fetch1.html#a017e190252de98bcb9d29249a374468fafe4b09359f8a9ccf143df55b43f641ae">IcacheNeedsRetry</a>;
<a name="l00316"></a>00316 
<a name="l00317"></a>00317         <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Fetch, <span class="stringliteral">&quot;Line fetch needs to retry: %s\n&quot;</span>,
<a name="l00318"></a>00318             request-&gt;<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a82b8884846ebf2cea033ec31e35326bb" title="Identity of the line that this request will generate.">id</a>);
<a name="l00319"></a>00319     }
<a name="l00320"></a>00320 
<a name="l00321"></a>00321     <span class="keywordflow">return</span> ret;
<a name="l00322"></a>00322 }
<a name="l00323"></a>00323 
<a name="l00324"></a>00324 <span class="keywordtype">void</span>
<a name="l00325"></a><a class="code" href="classMinor_1_1Fetch1.html#ac143710b93ec9f55bfc3e2882ef2fe4c">00325</a> <a class="code" href="classMinor_1_1Fetch1.html#ac143710b93ec9f55bfc3e2882ef2fe4c" title="Step requests along between requests and transfers queues.">Fetch1::stepQueues</a>()
<a name="l00326"></a>00326 {
<a name="l00327"></a>00327     <a class="code" href="classMinor_1_1Fetch1.html#a017e190252de98bcb9d29249a374468f" title="State of memory access for head instruction fetch.">IcacheState</a> old_icache_state = <a class="code" href="classMinor_1_1Fetch1.html#a03aa0813eb54c7f54d8bf6389f4464de" title="Retry state of icache_port.">icacheState</a>;
<a name="l00328"></a>00328 
<a name="l00329"></a>00329     <span class="keywordflow">switch</span> (<a class="code" href="classMinor_1_1Fetch1.html#a03aa0813eb54c7f54d8bf6389f4464de" title="Retry state of icache_port.">icacheState</a>) {
<a name="l00330"></a>00330       <span class="keywordflow">case</span> <a class="code" href="classMinor_1_1Fetch1.html#a017e190252de98bcb9d29249a374468fa5f52d9fc976f4cc478f16cb2819b65fb">IcacheRunning</a>:
<a name="l00331"></a>00331         <span class="comment">/* Move ITLB results on to the memory system */</span>
<a name="l00332"></a>00332         <span class="keywordflow">if</span> (!<a class="code" href="classMinor_1_1Fetch1.html#acde80e8c25dfc087763ab86ce71054ca" title="Queue of address translated requests from Fetch1.">requests</a>.<a class="code" href="classMinor_1_1Queue.html#a97dd10547161f7f888086b469d3a963d" title="Is the queue empty?">empty</a>()) {
<a name="l00333"></a>00333             <a class="code" href="classMinor_1_1Fetch1.html#a9ace21e8131caf360190ea876cfa2934" title="Try and issue a fetch for a translated request at the head of the requests queue...">tryToSendToTransfers</a>(<a class="code" href="classMinor_1_1Fetch1.html#acde80e8c25dfc087763ab86ce71054ca" title="Queue of address translated requests from Fetch1.">requests</a>.<a class="code" href="classMinor_1_1Queue.html#a017d4357da8b4ea76d7d5418395b4af7" title="Head value.">front</a>());
<a name="l00334"></a>00334         }
<a name="l00335"></a>00335         <span class="keywordflow">break</span>;
<a name="l00336"></a>00336       <span class="keywordflow">case</span> <a class="code" href="classMinor_1_1Fetch1.html#a017e190252de98bcb9d29249a374468fafe4b09359f8a9ccf143df55b43f641ae">IcacheNeedsRetry</a>:
<a name="l00337"></a>00337         <span class="keywordflow">break</span>;
<a name="l00338"></a>00338     }
<a name="l00339"></a>00339 
<a name="l00340"></a>00340     <span class="keywordflow">if</span> (<a class="code" href="classMinor_1_1Fetch1.html#a03aa0813eb54c7f54d8bf6389f4464de" title="Retry state of icache_port.">icacheState</a> != old_icache_state) {
<a name="l00341"></a>00341         <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Fetch, <span class="stringliteral">&quot;Step in state %s moving to state %s\n&quot;</span>,
<a name="l00342"></a>00342             old_icache_state, <a class="code" href="classMinor_1_1Fetch1.html#a03aa0813eb54c7f54d8bf6389f4464de" title="Retry state of icache_port.">icacheState</a>);
<a name="l00343"></a>00343     }
<a name="l00344"></a>00344 }
<a name="l00345"></a>00345 
<a name="l00346"></a>00346 <span class="keywordtype">void</span>
<a name="l00347"></a><a class="code" href="classMinor_1_1Fetch1.html#a94df7f8249cb85765b3d61e4287c7f0a">00347</a> <a class="code" href="classMinor_1_1Fetch1.html#a94df7f8249cb85765b3d61e4287c7f0a" title="Pop a request from the given queue and correctly deallocate and discard it.">Fetch1::popAndDiscard</a>(<a class="code" href="classMinor_1_1Queue.html">FetchQueue</a> &amp;queue)
<a name="l00348"></a>00348 {
<a name="l00349"></a>00349     <span class="keywordflow">if</span> (!queue.<a class="code" href="classMinor_1_1Queue.html#a97dd10547161f7f888086b469d3a963d" title="Is the queue empty?">empty</a>()) {
<a name="l00350"></a>00350         <span class="keyword">delete</span> queue.<a class="code" href="classMinor_1_1Queue.html#a017d4357da8b4ea76d7d5418395b4af7" title="Head value.">front</a>();
<a name="l00351"></a>00351         queue.<a class="code" href="classMinor_1_1Queue.html#aab44925607edcaa046cc15b46e4f14ad" title="Pop the head item.">pop</a>();
<a name="l00352"></a>00352     }
<a name="l00353"></a>00353 }
<a name="l00354"></a>00354 
<a name="l00355"></a>00355 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>
<a name="l00356"></a><a class="code" href="classMinor_1_1Fetch1.html#aced39dac4d2185966fe6184d46cea0ce">00356</a> <a class="code" href="classMinor_1_1Fetch1.html#aced39dac4d2185966fe6184d46cea0ce" title="Returns the total number of queue occupancy, in-ITLB and in-memory system fetches...">Fetch1::numInFlightFetches</a>()
<a name="l00357"></a>00357 {
<a name="l00358"></a>00358     <span class="keywordflow">return</span> <a class="code" href="classMinor_1_1Fetch1.html#acde80e8c25dfc087763ab86ce71054ca" title="Queue of address translated requests from Fetch1.">requests</a>.<a class="code" href="classMinor_1_1Queue.html#a7a16d70b08eaa24f9341bc53e40cf536" title="Number of slots already occupied in this buffer.">occupiedSpace</a>() +
<a name="l00359"></a>00359         <a class="code" href="classMinor_1_1Fetch1.html#aee94137a22f4a3f6a761f2fa5cd13da2" title="Queue of in-memory system requests and responses.">transfers</a>.<a class="code" href="classMinor_1_1Queue.html#a7a16d70b08eaa24f9341bc53e40cf536" title="Number of slots already occupied in this buffer.">occupiedSpace</a>();
<a name="l00360"></a>00360 }
<a name="l00361"></a>00361 
<a name="l00363"></a>00363 <span class="keywordtype">void</span>
<a name="l00364"></a><a class="code" href="classMinor_1_1Fetch1.html#a404253162839715a82f0f5b9fba4ad42">00364</a> <a class="code" href="classMinor_1_1Fetch1.html#a404253162839715a82f0f5b9fba4ad42" title="Print the appropriate MinorLine line for a fetch response.">Fetch1::minorTraceResponseLine</a>(<span class="keyword">const</span> std::string &amp;<a class="code" href="trace_8cc.html#a166fa10b86d8faa127fb7c78191e3e60">name</a>,
<a name="l00365"></a>00365     <a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html" title="Memory access queuing.">Fetch1::FetchRequestPtr</a> response)<span class="keyword"> const</span>
<a name="l00366"></a>00366 <span class="keyword"></span>{
<a name="l00367"></a>00367     <a class="code" href="classRequest.html">Request</a> &amp;request <a class="code" href="namespaceArmISA.html#a7bca404a37e7db0156c4b14dad12c18f">M5_VAR_USED</a> = response-&gt;<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a9709683076849def8a3cccb50f542a93" title="The underlying request that this fetch represents.">request</a>;
<a name="l00368"></a>00368 
<a name="l00369"></a>00369     <span class="keywordflow">if</span> (response-&gt;<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a13a71ed3c97c084923198f47d5a3d2f9" title="FetchRequests carry packets while they&amp;#39;re in the requests and transfers responses...">packet</a> &amp;&amp; response-&gt;<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a13a71ed3c97c084923198f47d5a3d2f9" title="FetchRequests carry packets while they&amp;#39;re in the requests and transfers responses...">packet</a>-&gt;<a class="code" href="classPacket.html#a1ea5391da77928d157f79bebe80f6a97">isError</a>()) {
<a name="l00370"></a>00370         <a class="code" href="cpu_2minor_2trace_8hh.html#ad2cdbae0013ee5fef0f316e77aa8ff14" title="DPRINTFN for MinorTrace MinorLine line reporting.">MINORLINE</a>(<span class="keyword">this</span>, <span class="stringliteral">&quot;id=F;%s vaddr=0x%x fault=\&quot;error packet\&quot;\n&quot;</span>,
<a name="l00371"></a>00371             response-&gt;<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a82b8884846ebf2cea033ec31e35326bb" title="Identity of the line that this request will generate.">id</a>, request.getVaddr());
<a name="l00372"></a>00372     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (response-&gt;<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#ad1ac8317c4b5c69a85c501384c99130a" title="Fill in a fault if one happens during fetch, check this by picking apart the response...">fault</a> != NoFault) {
<a name="l00373"></a>00373         <a class="code" href="cpu_2minor_2trace_8hh.html#ad2cdbae0013ee5fef0f316e77aa8ff14" title="DPRINTFN for MinorTrace MinorLine line reporting.">MINORLINE</a>(<span class="keyword">this</span>, <span class="stringliteral">&quot;id=F;%s vaddr=0x%x fault=\&quot;%s\&quot;\n&quot;</span>,
<a name="l00374"></a>00374             response-&gt;<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a82b8884846ebf2cea033ec31e35326bb" title="Identity of the line that this request will generate.">id</a>, request.getVaddr(), response-&gt;<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#ad1ac8317c4b5c69a85c501384c99130a" title="Fill in a fault if one happens during fetch, check this by picking apart the response...">fault</a>-&gt;name());
<a name="l00375"></a>00375     } <span class="keywordflow">else</span> {
<a name="l00376"></a>00376         <a class="code" href="cpu_2minor_2trace_8hh.html#ad2cdbae0013ee5fef0f316e77aa8ff14" title="DPRINTFN for MinorTrace MinorLine line reporting.">MINORLINE</a>(<span class="keyword">this</span>, <span class="stringliteral">&quot;id=%s size=%d vaddr=0x%x paddr=0x%x\n&quot;</span>,
<a name="l00377"></a>00377             response-&gt;<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a82b8884846ebf2cea033ec31e35326bb" title="Identity of the line that this request will generate.">id</a>, request.getSize(),
<a name="l00378"></a>00378             request.getVaddr(), request.getPaddr());
<a name="l00379"></a>00379     }
<a name="l00380"></a>00380 }
<a name="l00381"></a>00381 
<a name="l00382"></a>00382 <span class="keywordtype">bool</span>
<a name="l00383"></a><a class="code" href="classMinor_1_1Fetch1.html#a2113cc468418b7509cc81a7472122dd7">00383</a> <a class="code" href="classMinor_1_1Fetch1.html#a2113cc468418b7509cc81a7472122dd7" title="Memory interface.">Fetch1::recvTimingResp</a>(<a class="code" href="classPacket.html" title="A Packet is used to encapsulate a transfer between two objects in the memory system...">PacketPtr</a> response)
<a name="l00384"></a>00384 {
<a name="l00385"></a>00385     <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Fetch, <span class="stringliteral">&quot;recvTimingResp %d\n&quot;</span>, <a class="code" href="classMinor_1_1Fetch1.html#a6d07c9b4ce4503d73e426fc3b23fedf0" title="Count of the number fetches which have left the transfers queue and are in the &amp;#39;wild&amp;#39;...">numFetchesInMemorySystem</a>);
<a name="l00386"></a>00386 
<a name="l00387"></a>00387     <span class="comment">/* Only push the response if we didn&apos;t change stream?  No,  all responses</span>
<a name="l00388"></a>00388 <span class="comment">     *  should hit the responses queue.  It&apos;s the job of &apos;step&apos; to throw them</span>
<a name="l00389"></a>00389 <span class="comment">     *  away. */</span>
<a name="l00390"></a>00390     <a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html" title="Memory access queuing.">FetchRequestPtr</a> fetch_request = <a class="code" href="cast_8hh.html#a5f660f8e3c1002271ec98c59eeda331f">safe_cast</a>&lt;<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html" title="Memory access queuing.">FetchRequestPtr</a>&gt;
<a name="l00391"></a>00391         (response-&gt;<a class="code" href="classPacket.html#af6ab9a18584eefa18e4c2b41f208b8e6" title="Pop the top of the state stack and return a pointer to it.">popSenderState</a>());
<a name="l00392"></a>00392 
<a name="l00393"></a>00393     <span class="comment">/* Fixup packet in fetch_request as this may have changed */</span>
<a name="l00394"></a>00394     assert(!fetch_request-&gt;<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a13a71ed3c97c084923198f47d5a3d2f9" title="FetchRequests carry packets while they&amp;#39;re in the requests and transfers responses...">packet</a>);
<a name="l00395"></a>00395     fetch_request-&gt;<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a13a71ed3c97c084923198f47d5a3d2f9" title="FetchRequests carry packets while they&amp;#39;re in the requests and transfers responses...">packet</a> = response;
<a name="l00396"></a>00396 
<a name="l00397"></a>00397     <a class="code" href="classMinor_1_1Fetch1.html#a6d07c9b4ce4503d73e426fc3b23fedf0" title="Count of the number fetches which have left the transfers queue and are in the &amp;#39;wild&amp;#39;...">numFetchesInMemorySystem</a>--;
<a name="l00398"></a>00398     fetch_request-&gt;<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a0bccd6fab68b7eb8b8fb39c25a3d706f">state</a> = <a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#ad6f00af739be60b2ffb58ceb376e2d78a426f9bf2a8658ab3b73ff80f7e53faab">FetchRequest::Complete</a>;
<a name="l00399"></a>00399 
<a name="l00400"></a>00400     <span class="keywordflow">if</span> (<a class="code" href="base_2trace_8hh.html#af76c9f7776aade1bf9d7dfa8a0c6b341">DTRACE</a>(MinorTrace))
<a name="l00401"></a>00401         <a class="code" href="classMinor_1_1Fetch1.html#a404253162839715a82f0f5b9fba4ad42" title="Print the appropriate MinorLine line for a fetch response.">minorTraceResponseLine</a>(<a class="code" href="classNamed.html#a6dbf00581f5d749f95ae4a7795df0ebc">name</a>(), fetch_request);
<a name="l00402"></a>00402 
<a name="l00403"></a>00403     <span class="keywordflow">if</span> (response-&gt;<a class="code" href="classPacket.html#a1ea5391da77928d157f79bebe80f6a97">isError</a>()) {
<a name="l00404"></a>00404         <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Fetch, <span class="stringliteral">&quot;Received error response packet: %s\n&quot;</span>,
<a name="l00405"></a>00405             fetch_request-&gt;<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a82b8884846ebf2cea033ec31e35326bb" title="Identity of the line that this request will generate.">id</a>);
<a name="l00406"></a>00406     }
<a name="l00407"></a>00407 
<a name="l00408"></a>00408     <span class="comment">/* We go to idle even if there are more things to do on the queues as</span>
<a name="l00409"></a>00409 <span class="comment">     *  it&apos;s the job of step to actually step us on to the next transaction */</span>
<a name="l00410"></a>00410 
<a name="l00411"></a>00411     <span class="comment">/* Let&apos;s try and wake up the processor for the next cycle to move on</span>
<a name="l00412"></a>00412 <span class="comment">     *  queues */</span>
<a name="l00413"></a>00413     <a class="code" href="classMinor_1_1Fetch1.html#ac56d337ea3205bd6e1b6b1b7501329b3" title="Construction-assigned data members.">cpu</a>.<a class="code" href="classMinorCPU.html#a77a7065e0dce4a18fbbea4dd3b8e0bf7" title="Interface for stages to signal that they have become active after a callback or eventq...">wakeupOnEvent</a>(<a class="code" href="classMinor_1_1Pipeline.html#ab007586d11bb6517337d2910886925a4abda76c918e6bbcb75d30264eab67271d">Pipeline::Fetch1StageId</a>);
<a name="l00414"></a>00414 
<a name="l00415"></a>00415     <span class="comment">/* Never busy */</span>
<a name="l00416"></a>00416     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00417"></a>00417 }
<a name="l00418"></a>00418 
<a name="l00419"></a>00419 <span class="keywordtype">void</span>
<a name="l00420"></a><a class="code" href="classMinor_1_1Fetch1.html#aa3a850d9e7a3469e1af95792c736c6b8">00420</a> <a class="code" href="classMinor_1_1Fetch1.html#aa3a850d9e7a3469e1af95792c736c6b8">Fetch1::recvReqRetry</a>()
<a name="l00421"></a>00421 {
<a name="l00422"></a>00422     <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Fetch, <span class="stringliteral">&quot;recvRetry\n&quot;</span>);
<a name="l00423"></a>00423     assert(<a class="code" href="classMinor_1_1Fetch1.html#a03aa0813eb54c7f54d8bf6389f4464de" title="Retry state of icache_port.">icacheState</a> == <a class="code" href="classMinor_1_1Fetch1.html#a017e190252de98bcb9d29249a374468fafe4b09359f8a9ccf143df55b43f641ae">IcacheNeedsRetry</a>);
<a name="l00424"></a>00424     assert(!<a class="code" href="classMinor_1_1Fetch1.html#acde80e8c25dfc087763ab86ce71054ca" title="Queue of address translated requests from Fetch1.">requests</a>.<a class="code" href="classMinor_1_1Queue.html#a97dd10547161f7f888086b469d3a963d" title="Is the queue empty?">empty</a>());
<a name="l00425"></a>00425 
<a name="l00426"></a>00426     <a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html" title="Memory access queuing.">FetchRequestPtr</a> retryRequest = <a class="code" href="classMinor_1_1Fetch1.html#acde80e8c25dfc087763ab86ce71054ca" title="Queue of address translated requests from Fetch1.">requests</a>.<a class="code" href="classMinor_1_1Queue.html#a017d4357da8b4ea76d7d5418395b4af7" title="Head value.">front</a>();
<a name="l00427"></a>00427 
<a name="l00428"></a>00428     <a class="code" href="classMinor_1_1Fetch1.html#a03aa0813eb54c7f54d8bf6389f4464de" title="Retry state of icache_port.">icacheState</a> = <a class="code" href="classMinor_1_1Fetch1.html#a017e190252de98bcb9d29249a374468fa5f52d9fc976f4cc478f16cb2819b65fb">IcacheRunning</a>;
<a name="l00429"></a>00429 
<a name="l00430"></a>00430     <span class="keywordflow">if</span> (<a class="code" href="classMinor_1_1Fetch1.html#a36a47e0e7486db47242305dbd01e7d6c" title="Try to send (or resend) a memory request&amp;#39;s next/only packet to the memory system...">tryToSend</a>(retryRequest))
<a name="l00431"></a>00431         <a class="code" href="classMinor_1_1Fetch1.html#afbd19ec6f53a978de12d4b26ad8fd8e4" title="Move a request between queues.">moveFromRequestsToTransfers</a>(retryRequest);
<a name="l00432"></a>00432 }
<a name="l00433"></a>00433 
<a name="l00434"></a>00434 std::ostream &amp;
<a name="l00435"></a><a class="code" href="namespaceMinor.html#a9cb73851f17986b84fedfce5cb6a736f">00435</a> <a class="code" href="namespaceMinor.html#a1a80620114def7129ab86df0f4c330e4" title="Print this id in the usual slash-separated format expected by MinorTrace.">operator &lt;&lt;</a>(std::ostream &amp;<a class="code" href="namespaceX86ISA.html#aea9fbab71662ba06cf536e05edfaaad1">os</a>, <a class="code" href="classMinor_1_1Fetch1.html#ad1f4c049c613ee93bb1da6eb6950396a" title="Cycle-by-cycle state.">Fetch1::FetchState</a> state)
<a name="l00436"></a>00436 {
<a name="l00437"></a>00437     <span class="keywordflow">switch</span> (state) {
<a name="l00438"></a>00438       <span class="keywordflow">case</span> <a class="code" href="classMinor_1_1Fetch1.html#ad1f4c049c613ee93bb1da6eb6950396aa19a9bc105f38eb8b560e93c6a3f2e1ec">Fetch1::FetchHalted</a>:
<a name="l00439"></a>00439         os &lt;&lt; <span class="stringliteral">&quot;FetchHalted&quot;</span>;
<a name="l00440"></a>00440         <span class="keywordflow">break</span>;
<a name="l00441"></a>00441       <span class="keywordflow">case</span> <a class="code" href="classMinor_1_1Fetch1.html#ad1f4c049c613ee93bb1da6eb6950396aabc1a54a4b6d3fa62ef29e92729658f4a">Fetch1::FetchWaitingForPC</a>:
<a name="l00442"></a>00442         os &lt;&lt; <span class="stringliteral">&quot;FetchWaitingForPC&quot;</span>;
<a name="l00443"></a>00443         <span class="keywordflow">break</span>;
<a name="l00444"></a>00444       <span class="keywordflow">case</span> <a class="code" href="classMinor_1_1Fetch1.html#ad1f4c049c613ee93bb1da6eb6950396aa18da5cb1b6d1a0fe8adcbfac2f03e472">Fetch1::FetchRunning</a>:
<a name="l00445"></a>00445         os &lt;&lt; <span class="stringliteral">&quot;FetchRunning&quot;</span>;
<a name="l00446"></a>00446         <span class="keywordflow">break</span>;
<a name="l00447"></a>00447       <span class="keywordflow">default</span>:
<a name="l00448"></a>00448         os &lt;&lt; <span class="stringliteral">&quot;FetchState-&quot;</span> &lt;&lt; <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(state);
<a name="l00449"></a>00449         <span class="keywordflow">break</span>;
<a name="l00450"></a>00450     }
<a name="l00451"></a>00451     <span class="keywordflow">return</span> os;
<a name="l00452"></a>00452 }
<a name="l00453"></a>00453 
<a name="l00454"></a>00454 <span class="keywordtype">void</span>
<a name="l00455"></a><a class="code" href="classMinor_1_1Fetch1.html#ae982f97f14ca82288bf09cfe97c635dd">00455</a> <a class="code" href="classMinor_1_1Fetch1.html#ae982f97f14ca82288bf09cfe97c635dd" title="Start fetching from a new address.">Fetch1::changeStream</a>(<span class="keyword">const</span> <a class="code" href="classMinor_1_1BranchData.html" title="Forward data betwen Execute and Fetch1 carrying change-of-address/stream information...">BranchData</a> &amp;branch)
<a name="l00456"></a>00456 {
<a name="l00457"></a>00457     <a class="code" href="classMinor_1_1Fetch1.html#a3dca5fe4f4dcdc26da5b875467a62f73" title="Update streamSeqNum and predictionSeqNum from the given branch (and assume these...">updateExpectedSeqNums</a>(branch);
<a name="l00458"></a>00458 
<a name="l00459"></a>00459     <span class="comment">/* Start fetching again if we were stopped */</span>
<a name="l00460"></a>00460     <span class="keywordflow">switch</span> (branch.<a class="code" href="classMinor_1_1BranchData.html#a4437ad1524118809eae3431145028137" title="Explanation for this branch.">reason</a>) {
<a name="l00461"></a>00461       <span class="keywordflow">case</span> <a class="code" href="classMinor_1_1BranchData.html#ae394e4bdf847bbf5610a6fdc9d9a6f66ad478cd3bfd3c526f4cd9323bde19252c">BranchData::SuspendThread</a>:
<a name="l00462"></a>00462         <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Fetch, <span class="stringliteral">&quot;Suspending fetch: %s\n&quot;</span>, branch);
<a name="l00463"></a>00463         <a class="code" href="classMinor_1_1Fetch1.html#afd82fe973ac20f2387518b7fe880d288" title="Stage cycle-by-cycle state.">state</a> = <a class="code" href="classMinor_1_1Fetch1.html#ad1f4c049c613ee93bb1da6eb6950396aabc1a54a4b6d3fa62ef29e92729658f4a">FetchWaitingForPC</a>;
<a name="l00464"></a>00464         <span class="keywordflow">break</span>;
<a name="l00465"></a>00465       <span class="keywordflow">case</span> <a class="code" href="classMinor_1_1BranchData.html#ae394e4bdf847bbf5610a6fdc9d9a6f66ac350bcca256df014fe8f0cf57fc6d9c4">BranchData::HaltFetch</a>:
<a name="l00466"></a>00466         <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Fetch, <span class="stringliteral">&quot;Halting fetch\n&quot;</span>);
<a name="l00467"></a>00467         <a class="code" href="classMinor_1_1Fetch1.html#afd82fe973ac20f2387518b7fe880d288" title="Stage cycle-by-cycle state.">state</a> = <a class="code" href="classMinor_1_1Fetch1.html#ad1f4c049c613ee93bb1da6eb6950396aa19a9bc105f38eb8b560e93c6a3f2e1ec">FetchHalted</a>;
<a name="l00468"></a>00468         <span class="keywordflow">break</span>;
<a name="l00469"></a>00469       <span class="keywordflow">default</span>:
<a name="l00470"></a>00470         <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Fetch, <span class="stringliteral">&quot;Changing stream on branch: %s\n&quot;</span>, branch);
<a name="l00471"></a>00471         <a class="code" href="classMinor_1_1Fetch1.html#afd82fe973ac20f2387518b7fe880d288" title="Stage cycle-by-cycle state.">state</a> = <a class="code" href="classMinor_1_1Fetch1.html#ad1f4c049c613ee93bb1da6eb6950396aa18da5cb1b6d1a0fe8adcbfac2f03e472">FetchRunning</a>;
<a name="l00472"></a>00472         <span class="keywordflow">break</span>;
<a name="l00473"></a>00473     }
<a name="l00474"></a>00474     <a class="code" href="classMinor_1_1Fetch1.html#a68cc41950d48d4da37da2960f973011a" title="Fetch PC value.">pc</a> = branch.<a class="code" href="classMinor_1_1BranchData.html#a2c6ad081d2e17f151ded481186312158" title="Starting PC of that stream.">target</a>;
<a name="l00475"></a>00475 }
<a name="l00476"></a>00476 
<a name="l00477"></a>00477 <span class="keywordtype">void</span>
<a name="l00478"></a><a class="code" href="classMinor_1_1Fetch1.html#a3dca5fe4f4dcdc26da5b875467a62f73">00478</a> <a class="code" href="classMinor_1_1Fetch1.html#a3dca5fe4f4dcdc26da5b875467a62f73" title="Update streamSeqNum and predictionSeqNum from the given branch (and assume these...">Fetch1::updateExpectedSeqNums</a>(<span class="keyword">const</span> <a class="code" href="classMinor_1_1BranchData.html" title="Forward data betwen Execute and Fetch1 carrying change-of-address/stream information...">BranchData</a> &amp;branch)
<a name="l00479"></a>00479 {
<a name="l00480"></a>00480     <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Fetch, <span class="stringliteral">&quot;Updating streamSeqNum from: %d to %d,&quot;</span>
<a name="l00481"></a>00481         <span class="stringliteral">&quot; predictionSeqNum from: %d to %d\n&quot;</span>,
<a name="l00482"></a>00482         <a class="code" href="classMinor_1_1Fetch1.html#aa2f64aeccee0cb61cad0435219f2f551" title="Stream sequence number.">streamSeqNum</a>, branch.<a class="code" href="classMinor_1_1BranchData.html#a0916cbcaab89b172654fef2bdc7f082f" title="Sequence number of new stream/prediction to be adopted.">newStreamSeqNum</a>,
<a name="l00483"></a>00483         <a class="code" href="classMinor_1_1Fetch1.html#afa3f896e1fffef34a6937cada8bef505" title="Prediction sequence number.">predictionSeqNum</a>, branch.<a class="code" href="classMinor_1_1BranchData.html#a68a163657587ebdae7be35ea5342a1ea">newPredictionSeqNum</a>);
<a name="l00484"></a>00484 
<a name="l00485"></a>00485     <span class="comment">/* Change the stream */</span>
<a name="l00486"></a>00486     <a class="code" href="classMinor_1_1Fetch1.html#aa2f64aeccee0cb61cad0435219f2f551" title="Stream sequence number.">streamSeqNum</a> = branch.<a class="code" href="classMinor_1_1BranchData.html#a0916cbcaab89b172654fef2bdc7f082f" title="Sequence number of new stream/prediction to be adopted.">newStreamSeqNum</a>;
<a name="l00487"></a>00487     <span class="comment">/* Update the prediction.  Note that it&apos;s possible for this to</span>
<a name="l00488"></a>00488 <span class="comment">     *  actually set the prediction to an *older* value if new</span>
<a name="l00489"></a>00489 <span class="comment">     *  predictions have been discarded by execute */</span>
<a name="l00490"></a>00490     <a class="code" href="classMinor_1_1Fetch1.html#afa3f896e1fffef34a6937cada8bef505" title="Prediction sequence number.">predictionSeqNum</a> = branch.<a class="code" href="classMinor_1_1BranchData.html#a68a163657587ebdae7be35ea5342a1ea">newPredictionSeqNum</a>;
<a name="l00491"></a>00491 }
<a name="l00492"></a>00492 
<a name="l00493"></a>00493 <span class="keywordtype">void</span>
<a name="l00494"></a><a class="code" href="classMinor_1_1Fetch1.html#adbc9751a36d4682f5781e5caee4272f8">00494</a> <a class="code" href="classMinor_1_1Fetch1.html#adbc9751a36d4682f5781e5caee4272f8" title="Convert a response to a ForwardLineData.">Fetch1::processResponse</a>(<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html" title="Memory access queuing.">Fetch1::FetchRequestPtr</a> response,
<a name="l00495"></a>00495     <a class="code" href="classMinor_1_1ForwardLineData.html" title="Line fetch data in the forward direction.">ForwardLineData</a> &amp;line)
<a name="l00496"></a>00496 {
<a name="l00497"></a>00497     <a class="code" href="classPacket.html" title="A Packet is used to encapsulate a transfer between two objects in the memory system...">PacketPtr</a> packet = response-&gt;<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a13a71ed3c97c084923198f47d5a3d2f9" title="FetchRequests carry packets while they&amp;#39;re in the requests and transfers responses...">packet</a>;
<a name="l00498"></a>00498 
<a name="l00499"></a>00499     <span class="comment">/* Pass the prefetch abort (if any) on to Fetch2 in a ForwardLineData</span>
<a name="l00500"></a>00500 <span class="comment">     * structure */</span>
<a name="l00501"></a>00501     line.<a class="code" href="classMinor_1_1ForwardLineData.html#a70c5824ec22e1959b756c745244d67b0" title="Set fault and possible clear the bubble flag.">setFault</a>(response-&gt;<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#ad1ac8317c4b5c69a85c501384c99130a" title="Fill in a fault if one happens during fetch, check this by picking apart the response...">fault</a>);
<a name="l00502"></a>00502     <span class="comment">/* Make sequence numbers valid in return */</span>
<a name="l00503"></a>00503     line.<a class="code" href="classMinor_1_1ForwardLineData.html#a3acc1d4724eb2adde5424cdabe4d3240" title="Thread, stream, prediction .">id</a> = response-&gt;<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a82b8884846ebf2cea033ec31e35326bb" title="Identity of the line that this request will generate.">id</a>;
<a name="l00504"></a>00504     <span class="comment">/* Set PC to virtual address */</span>
<a name="l00505"></a>00505     line.<a class="code" href="classMinor_1_1ForwardLineData.html#a8ae83da5fe05c689357432531aacbcd7" title="PC of the first requested inst within this line.">pc</a> = response-&gt;<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#ae7a84b8849e5a156cacdd63c5888dcdb" title="PC to fixup with line address.">pc</a>;
<a name="l00506"></a>00506     <span class="comment">/* Set the lineBase, which is a sizeof(MachInst) aligned address &lt;=</span>
<a name="l00507"></a>00507 <span class="comment">     *  pc.instAddr() */</span>
<a name="l00508"></a>00508     line.<a class="code" href="classMinor_1_1ForwardLineData.html#aeea64315d8a1b571e2913067bd848bf8" title="First byte address in the line.">lineBaseAddr</a> = response-&gt;<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a9709683076849def8a3cccb50f542a93" title="The underlying request that this fetch represents.">request</a>.<a class="code" href="classRequest.html#afd69006362aca38468eb15ad06c3f79b">getVaddr</a>();
<a name="l00509"></a>00509 
<a name="l00510"></a>00510     <span class="keywordflow">if</span> (response-&gt;<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#ad1ac8317c4b5c69a85c501384c99130a" title="Fill in a fault if one happens during fetch, check this by picking apart the response...">fault</a> != NoFault) {
<a name="l00511"></a>00511         <span class="comment">/* Stop fetching if there was a fault */</span>
<a name="l00512"></a>00512         <span class="comment">/* Should probably try to flush the queues as well, but we</span>
<a name="l00513"></a>00513 <span class="comment">         * can&apos;t be sure that this fault will actually reach Execute, and we</span>
<a name="l00514"></a>00514 <span class="comment">         * can&apos;t (currently) selectively remove this stream from the queues */</span>
<a name="l00515"></a>00515         <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Fetch, <span class="stringliteral">&quot;Stopping line fetch because of fault: %s\n&quot;</span>,
<a name="l00516"></a>00516             response-&gt;<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#ad1ac8317c4b5c69a85c501384c99130a" title="Fill in a fault if one happens during fetch, check this by picking apart the response...">fault</a>-&gt;name());
<a name="l00517"></a>00517         <a class="code" href="classMinor_1_1Fetch1.html#afd82fe973ac20f2387518b7fe880d288" title="Stage cycle-by-cycle state.">state</a> = <a class="code" href="classMinor_1_1Fetch1.html#ad1f4c049c613ee93bb1da6eb6950396aabc1a54a4b6d3fa62ef29e92729658f4a">Fetch1::FetchWaitingForPC</a>;
<a name="l00518"></a>00518     } <span class="keywordflow">else</span> {
<a name="l00519"></a>00519         line.<a class="code" href="classMinor_1_1ForwardLineData.html#ad6587ca41f0974e47e97ee187f7b0ead" title="Use the data from a packet as line instead of allocating new space.">adoptPacketData</a>(packet);
<a name="l00520"></a>00520         <span class="comment">/* Null the response&apos;s packet to prevent the response from trying to</span>
<a name="l00521"></a>00521 <span class="comment">         *  deallocate the packet */</span>
<a name="l00522"></a>00522         response-&gt;<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a13a71ed3c97c084923198f47d5a3d2f9" title="FetchRequests carry packets while they&amp;#39;re in the requests and transfers responses...">packet</a> = NULL;
<a name="l00523"></a>00523     }
<a name="l00524"></a>00524 }
<a name="l00525"></a>00525 
<a name="l00526"></a>00526 <span class="keywordtype">void</span>
<a name="l00527"></a><a class="code" href="classMinor_1_1Fetch1.html#a68a0a88ce6ee3dd170c977318cfb4ca9">00527</a> <a class="code" href="classMinor_1_1Fetch1.html#a68a0a88ce6ee3dd170c977318cfb4ca9" title="Pass on input/buffer data to the output if you can.">Fetch1::evaluate</a>()
<a name="l00528"></a>00528 {
<a name="l00529"></a>00529     <span class="keyword">const</span> <a class="code" href="classMinor_1_1BranchData.html" title="Forward data betwen Execute and Fetch1 carrying change-of-address/stream information...">BranchData</a> &amp;execute_branch = *<a class="code" href="classMinor_1_1Fetch1.html#a5a6b905593e55b24c21f64888b1a49bd" title="Input port carrying branch requests from Execute.">inp</a>.outputWire;
<a name="l00530"></a>00530     <span class="keyword">const</span> <a class="code" href="classMinor_1_1BranchData.html" title="Forward data betwen Execute and Fetch1 carrying change-of-address/stream information...">BranchData</a> &amp;fetch2_branch = *<a class="code" href="classMinor_1_1Fetch1.html#a9546a44ee769acfefd116ea0997c61be" title="Input port carrying branch predictions from Fetch2.">prediction</a>.outputWire;
<a name="l00531"></a>00531     <a class="code" href="classMinor_1_1ForwardLineData.html" title="Line fetch data in the forward direction.">ForwardLineData</a> &amp;line_out = *<a class="code" href="classMinor_1_1Fetch1.html#abd33d029c531a4456dfbc61292b0ba56" title="Output port carrying read lines to Fetch2.">out</a>.inputWire;
<a name="l00532"></a>00532 
<a name="l00533"></a>00533     assert(line_out.<a class="code" href="classMinor_1_1ForwardLineData.html#adb9249825e40e8786fb1c086893c7179">isBubble</a>());
<a name="l00534"></a>00534 
<a name="l00535"></a>00535     <a class="code" href="classMinor_1_1Fetch1.html#ab6c951a01059b0e91bce79bd02cf708e" title="Blocked indication for report.">blocked</a> = !<a class="code" href="classMinor_1_1Fetch1.html#a4ffc2df64eb72b063981991333f6fa4f" title="Interface to reserve space in the next stage.">nextStageReserve</a>.<a class="code" href="classMinor_1_1Reservable.html#acc1a552e13aaaca83093e6517caaf243" title="Can a slot be reserved?">canReserve</a>();
<a name="l00536"></a>00536 
<a name="l00537"></a>00537     <span class="comment">/* Are we changing stream?  Look to the Execute branches first, then</span>
<a name="l00538"></a>00538 <span class="comment">     * to predicted changes of stream from Fetch2 */</span>
<a name="l00539"></a>00539     <span class="comment">/* @todo, find better way to express ignoring branch predictions */</span>
<a name="l00540"></a>00540     <span class="keywordflow">if</span> (execute_branch.<a class="code" href="classMinor_1_1BranchData.html#a27f2481e7a2ad83e3f81235bcefa9ce5" title="Is a request with this reason actually a request to change the PC rather than a bubble...">isStreamChange</a>() &amp;&amp;
<a name="l00541"></a>00541         execute_branch.<a class="code" href="classMinor_1_1BranchData.html#a4437ad1524118809eae3431145028137" title="Explanation for this branch.">reason</a> != <a class="code" href="classMinor_1_1BranchData.html#ae394e4bdf847bbf5610a6fdc9d9a6f66a19222101ced2c6cb8e9fe525e9ead5c2">BranchData::BranchPrediction</a>)
<a name="l00542"></a>00542     {
<a name="l00543"></a>00543         <span class="keywordflow">if</span> (<a class="code" href="classMinor_1_1Fetch1.html#afd82fe973ac20f2387518b7fe880d288" title="Stage cycle-by-cycle state.">state</a> == <a class="code" href="classMinor_1_1Fetch1.html#ad1f4c049c613ee93bb1da6eb6950396aa19a9bc105f38eb8b560e93c6a3f2e1ec">FetchHalted</a>) {
<a name="l00544"></a>00544             <span class="keywordflow">if</span> (execute_branch.<a class="code" href="classMinor_1_1BranchData.html#a4437ad1524118809eae3431145028137" title="Explanation for this branch.">reason</a> == <a class="code" href="classMinor_1_1BranchData.html#ae394e4bdf847bbf5610a6fdc9d9a6f66acdef2aeeff718a6fee0a03ddbe13b07b">BranchData::WakeupFetch</a>) {
<a name="l00545"></a>00545                 <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Fetch, <span class="stringliteral">&quot;Waking up fetch: %s\n&quot;</span>, execute_branch);
<a name="l00546"></a>00546                 <a class="code" href="classMinor_1_1Fetch1.html#ae982f97f14ca82288bf09cfe97c635dd" title="Start fetching from a new address.">changeStream</a>(execute_branch);
<a name="l00547"></a>00547             } <span class="keywordflow">else</span> {
<a name="l00548"></a>00548                 <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Fetch, <span class="stringliteral">&quot;Halted, ignoring branch: %s\n&quot;</span>,
<a name="l00549"></a>00549                     execute_branch);
<a name="l00550"></a>00550             }
<a name="l00551"></a>00551         } <span class="keywordflow">else</span> {
<a name="l00552"></a>00552             <a class="code" href="classMinor_1_1Fetch1.html#ae982f97f14ca82288bf09cfe97c635dd" title="Start fetching from a new address.">changeStream</a>(execute_branch);
<a name="l00553"></a>00553         }
<a name="l00554"></a>00554 
<a name="l00555"></a>00555         <span class="keywordflow">if</span> (!fetch2_branch.<a class="code" href="classMinor_1_1BranchData.html#a01a18911150bba6e091820081f7aa946">isBubble</a>()) {
<a name="l00556"></a>00556             <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Fetch, <span class="stringliteral">&quot;Ignoring simultaneous prediction: %s\n&quot;</span>,
<a name="l00557"></a>00557                 fetch2_branch);
<a name="l00558"></a>00558         }
<a name="l00559"></a>00559 
<a name="l00560"></a>00560         <span class="comment">/* The streamSeqNum tagging in request/response -&gt;req should handle</span>
<a name="l00561"></a>00561 <span class="comment">         *  discarding those requests when we get to them. */</span>
<a name="l00562"></a>00562     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classMinor_1_1Fetch1.html#afd82fe973ac20f2387518b7fe880d288" title="Stage cycle-by-cycle state.">state</a> != <a class="code" href="classMinor_1_1Fetch1.html#ad1f4c049c613ee93bb1da6eb6950396aa19a9bc105f38eb8b560e93c6a3f2e1ec">FetchHalted</a> &amp;&amp; fetch2_branch.<a class="code" href="classMinor_1_1BranchData.html#a27f2481e7a2ad83e3f81235bcefa9ce5" title="Is a request with this reason actually a request to change the PC rather than a bubble...">isStreamChange</a>()) {
<a name="l00563"></a>00563         <span class="comment">/* Handle branch predictions by changing the instruction source</span>
<a name="l00564"></a>00564 <span class="comment">         * if we&apos;re still processing the same stream (as set by streamSeqNum)</span>
<a name="l00565"></a>00565 <span class="comment">         * as the one of the prediction.</span>
<a name="l00566"></a>00566 <span class="comment">         */</span>
<a name="l00567"></a>00567         <span class="keywordflow">if</span> (fetch2_branch.<a class="code" href="classMinor_1_1BranchData.html#a0916cbcaab89b172654fef2bdc7f082f" title="Sequence number of new stream/prediction to be adopted.">newStreamSeqNum</a> != <a class="code" href="classMinor_1_1Fetch1.html#aa2f64aeccee0cb61cad0435219f2f551" title="Stream sequence number.">streamSeqNum</a>) {
<a name="l00568"></a>00568             <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Fetch, <span class="stringliteral">&quot;Not changing stream on prediction: %s,&quot;</span>
<a name="l00569"></a>00569                 <span class="stringliteral">&quot; streamSeqNum mismatch\n&quot;</span>,
<a name="l00570"></a>00570                 fetch2_branch);
<a name="l00571"></a>00571         } <span class="keywordflow">else</span> {
<a name="l00572"></a>00572             <a class="code" href="classMinor_1_1Fetch1.html#ae982f97f14ca82288bf09cfe97c635dd" title="Start fetching from a new address.">changeStream</a>(fetch2_branch);
<a name="l00573"></a>00573         }
<a name="l00574"></a>00574     }
<a name="l00575"></a>00575 
<a name="l00576"></a>00576     <span class="comment">/* Can we fetch? */</span>
<a name="l00577"></a>00577     <span class="comment">/* The bare minimum requirements for initiating a fetch */</span>
<a name="l00578"></a>00578     <span class="comment">/* THREAD need to handle multiple threads */</span>
<a name="l00579"></a>00579     <span class="keywordflow">if</span> (<a class="code" href="classMinor_1_1Fetch1.html#afd82fe973ac20f2387518b7fe880d288" title="Stage cycle-by-cycle state.">state</a> == <a class="code" href="classMinor_1_1Fetch1.html#ad1f4c049c613ee93bb1da6eb6950396aa18da5cb1b6d1a0fe8adcbfac2f03e472">FetchRunning</a> &amp;&amp; <span class="comment">/* We are actually fetching */</span>
<a name="l00580"></a>00580         !blocked &amp;&amp; <span class="comment">/* Space in the Fetch2 inputBuffer */</span>
<a name="l00581"></a>00581         <span class="comment">/* The thread we&apos;re going to fetch for (thread 0), is active */</span>
<a name="l00582"></a>00582         <a class="code" href="classMinor_1_1Fetch1.html#ac56d337ea3205bd6e1b6b1b7501329b3" title="Construction-assigned data members.">cpu</a>.getContext(0)-&gt;status() == <a class="code" href="classThreadContext.html#a7b7149621d48abf9c88dd7ef28c3ede7af2b2df42c993156412afb11741fec94b" title="Running.">ThreadContext::Active</a> &amp;&amp;
<a name="l00583"></a>00583         <a class="code" href="classMinor_1_1Fetch1.html#aced39dac4d2185966fe6184d46cea0ce" title="Returns the total number of queue occupancy, in-ITLB and in-memory system fetches...">numInFlightFetches</a>() &lt; <a class="code" href="classMinor_1_1Fetch1.html#ace8a5001e1ead292cd20867e92c65bcd" title="Maximum number of fetches allowed in flight (in queues or memory).">fetchLimit</a>)
<a name="l00584"></a>00584     {
<a name="l00585"></a>00585         <a class="code" href="classMinor_1_1Fetch1.html#a7fbb3eb3b964ec4e9ed1ded2968c5d1a" title="Insert a line fetch into the requests.">fetchLine</a>();
<a name="l00586"></a>00586         <span class="comment">/* Take up a slot in the fetch queue */</span>
<a name="l00587"></a>00587         <a class="code" href="classMinor_1_1Fetch1.html#a4ffc2df64eb72b063981991333f6fa4f" title="Interface to reserve space in the next stage.">nextStageReserve</a>.<a class="code" href="classMinor_1_1Reservable.html#a66359f36433e1f7d0cb6b85721a45284" title="Reserve a slot in whatever structure this is attached to.">reserve</a>();
<a name="l00588"></a>00588     }
<a name="l00589"></a>00589 
<a name="l00590"></a>00590     <span class="comment">/* Halting shouldn&apos;t prevent fetches in flight from being processed */</span>
<a name="l00591"></a>00591     <span class="comment">/* Step fetches through the icachePort queues and memory system */</span>
<a name="l00592"></a>00592     <a class="code" href="classMinor_1_1Fetch1.html#ac143710b93ec9f55bfc3e2882ef2fe4c" title="Step requests along between requests and transfers queues.">stepQueues</a>();
<a name="l00593"></a>00593 
<a name="l00594"></a>00594     <span class="comment">/* As we&apos;ve thrown away early lines, if there is a line, it must</span>
<a name="l00595"></a>00595 <span class="comment">     *  be from the right stream */</span>
<a name="l00596"></a>00596     <span class="keywordflow">if</span> (!<a class="code" href="classMinor_1_1Fetch1.html#aee94137a22f4a3f6a761f2fa5cd13da2" title="Queue of in-memory system requests and responses.">transfers</a>.<a class="code" href="classMinor_1_1Queue.html#a97dd10547161f7f888086b469d3a963d" title="Is the queue empty?">empty</a>() &amp;&amp;
<a name="l00597"></a>00597         <a class="code" href="classMinor_1_1Fetch1.html#aee94137a22f4a3f6a761f2fa5cd13da2" title="Queue of in-memory system requests and responses.">transfers</a>.<a class="code" href="classMinor_1_1Queue.html#a017d4357da8b4ea76d7d5418395b4af7" title="Head value.">front</a>()-&gt;<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a49fb465d0215561e34017c98e30f5e65" title="Is this a complete read line or fault.">isComplete</a>())
<a name="l00598"></a>00598     {
<a name="l00599"></a>00599         <a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html" title="Memory access queuing.">Fetch1::FetchRequestPtr</a> response = <a class="code" href="classMinor_1_1Fetch1.html#aee94137a22f4a3f6a761f2fa5cd13da2" title="Queue of in-memory system requests and responses.">transfers</a>.<a class="code" href="classMinor_1_1Queue.html#a017d4357da8b4ea76d7d5418395b4af7" title="Head value.">front</a>();
<a name="l00600"></a>00600 
<a name="l00601"></a>00601         <span class="keywordflow">if</span> (response-&gt;<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a325920d500a5d8952c377b2a657c5f59" title="Is this line out of date with the current stream/prediction sequence and can it be...">isDiscardable</a>()) {
<a name="l00602"></a>00602             <a class="code" href="classMinor_1_1Fetch1.html#a4ffc2df64eb72b063981991333f6fa4f" title="Interface to reserve space in the next stage.">nextStageReserve</a>.<a class="code" href="classMinor_1_1Reservable.html#a7b3f7c5e3ae5ba769d149336628c9380" title="Free a reserved slot.">freeReservation</a>();
<a name="l00603"></a>00603 
<a name="l00604"></a>00604             <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Fetch, <span class="stringliteral">&quot;Discarding translated fetch at it&apos;s for&quot;</span>
<a name="l00605"></a>00605                 <span class="stringliteral">&quot; an old stream\n&quot;</span>);
<a name="l00606"></a>00606 
<a name="l00607"></a>00607             <span class="comment">/* Wake up next cycle just in case there was some other</span>
<a name="l00608"></a>00608 <span class="comment">             *  action to do */</span>
<a name="l00609"></a>00609             <a class="code" href="classMinor_1_1Fetch1.html#ac56d337ea3205bd6e1b6b1b7501329b3" title="Construction-assigned data members.">cpu</a>.<a class="code" href="classMinorCPU.html#a77a7065e0dce4a18fbbea4dd3b8e0bf7" title="Interface for stages to signal that they have become active after a callback or eventq...">wakeupOnEvent</a>(<a class="code" href="classMinor_1_1Pipeline.html#ab007586d11bb6517337d2910886925a4abda76c918e6bbcb75d30264eab67271d">Pipeline::Fetch1StageId</a>);
<a name="l00610"></a>00610         } <span class="keywordflow">else</span> {
<a name="l00611"></a>00611             <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Fetch, <span class="stringliteral">&quot;Processing fetched line: %s\n&quot;</span>,
<a name="l00612"></a>00612                 response-&gt;<a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a82b8884846ebf2cea033ec31e35326bb" title="Identity of the line that this request will generate.">id</a>);
<a name="l00613"></a>00613 
<a name="l00614"></a>00614             <a class="code" href="classMinor_1_1Fetch1.html#adbc9751a36d4682f5781e5caee4272f8" title="Convert a response to a ForwardLineData.">processResponse</a>(response, line_out);
<a name="l00615"></a>00615         }
<a name="l00616"></a>00616 
<a name="l00617"></a>00617         <a class="code" href="classMinor_1_1Fetch1.html#a94df7f8249cb85765b3d61e4287c7f0a" title="Pop a request from the given queue and correctly deallocate and discard it.">popAndDiscard</a>(<a class="code" href="classMinor_1_1Fetch1.html#aee94137a22f4a3f6a761f2fa5cd13da2" title="Queue of in-memory system requests and responses.">transfers</a>);
<a name="l00618"></a>00618     }
<a name="l00619"></a>00619 
<a name="l00620"></a>00620     <span class="comment">/* If we generated output, and mark the stage as being active</span>
<a name="l00621"></a>00621 <span class="comment">     *  to encourage that output on to the next stage */</span>
<a name="l00622"></a>00622     <span class="keywordflow">if</span> (!line_out.<a class="code" href="classMinor_1_1ForwardLineData.html#adb9249825e40e8786fb1c086893c7179">isBubble</a>())
<a name="l00623"></a>00623         <a class="code" href="classMinor_1_1Fetch1.html#ac56d337ea3205bd6e1b6b1b7501329b3" title="Construction-assigned data members.">cpu</a>.<a class="code" href="classMinorCPU.html#ae3b03c96ee234e2c5c6c68f4567245a7" title="Activity recording for pipeline.">activityRecorder</a>-&gt;<a class="code" href="classActivityRecorder.html#a020dc37917baa7ac21ed5d9d35e73071" title="Records that there is activity this cycle.">activity</a>();
<a name="l00624"></a>00624 
<a name="l00625"></a>00625     <span class="comment">/* Fetch1 has no inputBuffer so the only activity we can have is to</span>
<a name="l00626"></a>00626 <span class="comment">     *  generate a line output (tested just above) or to initiate a memory</span>
<a name="l00627"></a>00627 <span class="comment">     *  fetch which will signal activity when it returns/needs stepping</span>
<a name="l00628"></a>00628 <span class="comment">     *  between queues */</span>
<a name="l00629"></a>00629 }
<a name="l00630"></a>00630 
<a name="l00631"></a>00631 <span class="keywordtype">bool</span>
<a name="l00632"></a><a class="code" href="classMinor_1_1Fetch1.html#a564fdb4f2d22684578a7037dff41455a">00632</a> <a class="code" href="classMinor_1_1Fetch1.html#a564fdb4f2d22684578a7037dff41455a" title="Is this stage drained? For Fetch1, draining is initiated by Execute signalling a...">Fetch1::isDrained</a>()
<a name="l00633"></a>00633 {
<a name="l00634"></a>00634     <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(Drain, <span class="stringliteral">&quot;isDrained %s %s%s%s\n&quot;</span>,
<a name="l00635"></a>00635         <a class="code" href="classMinor_1_1Fetch1.html#afd82fe973ac20f2387518b7fe880d288" title="Stage cycle-by-cycle state.">state</a> == <a class="code" href="classMinor_1_1Fetch1.html#ad1f4c049c613ee93bb1da6eb6950396aa19a9bc105f38eb8b560e93c6a3f2e1ec">FetchHalted</a>,
<a name="l00636"></a>00636         (<a class="code" href="classMinor_1_1Fetch1.html#aced39dac4d2185966fe6184d46cea0ce" title="Returns the total number of queue occupancy, in-ITLB and in-memory system fetches...">numInFlightFetches</a>() == 0 ? <span class="stringliteral">&quot;&quot;</span> : <span class="stringliteral">&quot;inFlightFetches &quot;</span>),
<a name="l00637"></a>00637         ((*<a class="code" href="classMinor_1_1Fetch1.html#abd33d029c531a4456dfbc61292b0ba56" title="Output port carrying read lines to Fetch2.">out</a>.inputWire).isBubble() ? <span class="stringliteral">&quot;&quot;</span> : <span class="stringliteral">&quot;outputtingLine&quot;</span>));
<a name="l00638"></a>00638 
<a name="l00639"></a>00639     <span class="keywordflow">return</span> <a class="code" href="classMinor_1_1Fetch1.html#afd82fe973ac20f2387518b7fe880d288" title="Stage cycle-by-cycle state.">state</a> == <a class="code" href="classMinor_1_1Fetch1.html#ad1f4c049c613ee93bb1da6eb6950396aa19a9bc105f38eb8b560e93c6a3f2e1ec">FetchHalted</a> &amp;&amp;
<a name="l00640"></a>00640         <a class="code" href="classMinor_1_1Fetch1.html#aced39dac4d2185966fe6184d46cea0ce" title="Returns the total number of queue occupancy, in-ITLB and in-memory system fetches...">numInFlightFetches</a>() == 0 &amp;&amp;
<a name="l00641"></a>00641         (*<a class="code" href="classMinor_1_1Fetch1.html#abd33d029c531a4456dfbc61292b0ba56" title="Output port carrying read lines to Fetch2.">out</a>.inputWire).isBubble();
<a name="l00642"></a>00642 }
<a name="l00643"></a>00643 
<a name="l00644"></a>00644 <span class="keywordtype">void</span>
<a name="l00645"></a><a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#af91d68113f9a15dca03abad45ba750a1">00645</a> <a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#af91d68113f9a15dca03abad45ba750a1" title="Report interface.">Fetch1::FetchRequest::reportData</a>(std::ostream &amp;<a class="code" href="namespaceX86ISA.html#aea9fbab71662ba06cf536e05edfaaad1">os</a>)<span class="keyword"> const</span>
<a name="l00646"></a>00646 <span class="keyword"></span>{
<a name="l00647"></a>00647     os &lt;&lt; <a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a82b8884846ebf2cea033ec31e35326bb" title="Identity of the line that this request will generate.">id</a>;
<a name="l00648"></a>00648 }
<a name="l00649"></a>00649 
<a name="l00650"></a><a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a325920d500a5d8952c377b2a657c5f59">00650</a> <span class="keywordtype">bool</span> <a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a325920d500a5d8952c377b2a657c5f59" title="Is this line out of date with the current stream/prediction sequence and can it be...">Fetch1::FetchRequest::isDiscardable</a>()<span class="keyword"> const</span>
<a name="l00651"></a>00651 <span class="keyword"></span>{
<a name="l00652"></a>00652     <span class="comment">/* Can&apos;t discard lines in TLB/memory */</span>
<a name="l00653"></a>00653     <span class="keywordflow">return</span> <a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a0bccd6fab68b7eb8b8fb39c25a3d706f">state</a> != <a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#ad6f00af739be60b2ffb58ceb376e2d78ae223b1f3a650445cb614ac3033991dce">InTranslation</a> &amp;&amp; <a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#a0bccd6fab68b7eb8b8fb39c25a3d706f">state</a> != <a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#ad6f00af739be60b2ffb58ceb376e2d78a1ad9aa57690e117bbac2348275ebad41">RequestIssuing</a> &amp;&amp;
<a name="l00654"></a>00654         (<span class="keywordtype">id</span>.streamSeqNum != <a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#ae6e6d20f96342113baf593c006788f41" title="Owning fetch unit.">fetch</a>.<a class="code" href="classMinor_1_1Fetch1.html#aa2f64aeccee0cb61cad0435219f2f551" title="Stream sequence number.">streamSeqNum</a> ||
<a name="l00655"></a>00655         <span class="keywordtype">id</span>.predictionSeqNum != <a class="code" href="classMinor_1_1Fetch1_1_1FetchRequest.html#ae6e6d20f96342113baf593c006788f41" title="Owning fetch unit.">fetch</a>.<a class="code" href="classMinor_1_1Fetch1.html#afa3f896e1fffef34a6937cada8bef505" title="Prediction sequence number.">predictionSeqNum</a>);
<a name="l00656"></a>00656 }
<a name="l00657"></a>00657 
<a name="l00658"></a>00658 <span class="keywordtype">void</span>
<a name="l00659"></a><a class="code" href="classMinor_1_1Fetch1.html#ad88406fe188260c4c5224a0bd42a356e">00659</a> <a class="code" href="classMinor_1_1Fetch1.html#ad88406fe188260c4c5224a0bd42a356e">Fetch1::minorTrace</a>()<span class="keyword"> const</span>
<a name="l00660"></a>00660 <span class="keyword"></span>{
<a name="l00661"></a>00661     std::ostringstream data;
<a name="l00662"></a>00662 
<a name="l00663"></a>00663     <span class="keywordflow">if</span> (<a class="code" href="classMinor_1_1Fetch1.html#ab6c951a01059b0e91bce79bd02cf708e" title="Blocked indication for report.">blocked</a>)
<a name="l00664"></a>00664         data &lt;&lt; <span class="charliteral">&apos;B&apos;</span>;
<a name="l00665"></a>00665     <span class="keywordflow">else</span>
<a name="l00666"></a>00666         (*<a class="code" href="classMinor_1_1Fetch1.html#abd33d029c531a4456dfbc61292b0ba56" title="Output port carrying read lines to Fetch2.">out</a>.inputWire).reportData(data);
<a name="l00667"></a>00667 
<a name="l00668"></a>00668     <a class="code" href="cpu_2minor_2trace_8hh.html#a17932003571361d44c2b8ecc63feceda" title="DPRINTFN for MinorTrace reporting.">MINORTRACE</a>(<span class="stringliteral">&quot;state=%s icacheState=%s in_tlb_mem=%s/%s&quot;</span>
<a name="l00669"></a>00669         <span class="stringliteral">&quot; streamSeqNum=%d lines=%s\n&quot;</span>, <a class="code" href="classMinor_1_1Fetch1.html#afd82fe973ac20f2387518b7fe880d288" title="Stage cycle-by-cycle state.">state</a>, <a class="code" href="classMinor_1_1Fetch1.html#a03aa0813eb54c7f54d8bf6389f4464de" title="Retry state of icache_port.">icacheState</a>,
<a name="l00670"></a>00670         <a class="code" href="classMinor_1_1Fetch1.html#a3610e3e08037ed8642dc1521daa0e355" title="Number of requests inside the ITLB rather than in the queues.">numFetchesInITLB</a>, <a class="code" href="classMinor_1_1Fetch1.html#a6d07c9b4ce4503d73e426fc3b23fedf0" title="Count of the number fetches which have left the transfers queue and are in the &amp;#39;wild&amp;#39;...">numFetchesInMemorySystem</a>,
<a name="l00671"></a>00671         <a class="code" href="classMinor_1_1Fetch1.html#aa2f64aeccee0cb61cad0435219f2f551" title="Stream sequence number.">streamSeqNum</a>, data.str());
<a name="l00672"></a>00672     <a class="code" href="classMinor_1_1Fetch1.html#acde80e8c25dfc087763ab86ce71054ca" title="Queue of address translated requests from Fetch1.">requests</a>.<a class="code" href="classMinor_1_1Queue.html#aacbe0a292a31e332cce217285ae7107f">minorTrace</a>();
<a name="l00673"></a>00673     <a class="code" href="classMinor_1_1Fetch1.html#aee94137a22f4a3f6a761f2fa5cd13da2" title="Queue of in-memory system requests and responses.">transfers</a>.<a class="code" href="classMinor_1_1Queue.html#aacbe0a292a31e332cce217285ae7107f">minorTrace</a>();
<a name="l00674"></a>00674 }
<a name="l00675"></a>00675 
<a name="l00676"></a>00676 }
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&nbsp;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"><address style="align: right;"><small>
Generated on Mon Dec 7 02:33:09 2015 for gem5 by <a href="http://www.doxygen.org/index.html"> doxygen</a> 1.6.1</small></address>

</body>
</html>
